© Elad Elrom 2019Elad ElromThe Blockchain Developer[`doi.org/10.1007/978-1-4842-4847-8_1`](https://doi.org/10.1007/978-1-4842-4847-8_1)

# 1. 区块链基础

Elad Elrom^(1 )(1)New York, NY, USAThis chapter will serve as your ground school before you “take off” toward development. It will introduce basic concepts that will help you to understand the blockchain technology. This chapter is split into four parts.

+   加密经济学简介

+   区块链解释

+   加密货币超载

+   区块链 P2P 网络

要理解加密经济学，你首先需要理解诸如加密和解密、私钥和公钥、密码学、数字资产、密码学货币等概念。

一旦你理解了这些基本概念，我将介绍区块链。我将涵盖构成个人区块链的各个部分，如区块，以及区块是如何链接在一起的，以及区块链的问题，如双重支付。我还将解释加密挖掘、矿工和加密货币钱包。

然后，我将介绍不同类型的加密货币：比特币、代币和替代加密货币币（altcoins）。

最后，我将介绍与区块链技术一起使用的 P2P 网络以及构成网络的不同层次：共识层、矿工层、传播层、语义层和应用层。

## 加密经济学简介

加密货币的世界充满了技术术语，甚至最老练的技术忍者也可能被混淆。比特币引入了加密经济学这一概念，为许多区块链平台的创建铺平了道路。在我们深入探讨区块链如何工作之前，让我们先了解什么是加密经济学以及区块链背后的基本概念。

口头交流是基于选择词语来描述你想传达的信息。然而，有时你只想与某些人交流，而排除其他人。一个很好的例子是在战争时期；指挥官与前沿阵地上的士兵进行交流，同时确保敌人无法窃听。指挥官可以为此类通信使用加密。

从电子角度来看，今天所有的购物网站都通过一种名为安全套接层（SSL）的加密协议提供他们的商品，这种协议可以保护你的个人信息不被黑客窃取。视频加密和解密很常见，以确保视频只 delivery to authorized members only, and on personal computers, people often use encryption to back up and protect files and passwords.

此外，作为一名开发者，你可能发送过加密消息，也使用库帮助解密传入的消息，因为所有编程语言都提供字符串加密和解密功能。

所以，让我们来看一些定义：

+   加密：加密是将你的消息转换成代码的过程，以便只有授权方可以访问它。

+   *解密*：解密是反转加密过程，以便消息可以转换为原始消息。

+   *密码学*：这是使用加密和解密技术来发送和接收信息。

+   *加密货币*：这是像之前的 SSL 或视频示例一样使用密码学，但专门为了满足数字资产的需求。

### 注意

一个*数字资产*可以是任何有价值的东西，比如你家庭保险箱的组合、秘密密码、列表、消息、电子现金、文件、照片等等。

+   *密码经济学*：这是密码学与经济学相结合，提供一个平台来传递数字资产。

为了进一步澄清，让我们更详细地看看这些术语并将它们应用于本书我将涵盖的主题。

### Ig-pay Atin-lay

首先，让我们回到过去。你小时候有没有说过猪拉丁语？这种秘密的猪拉丁语很简单。你取下你想说的单词的第一个字母，然后将字母移到单词的末尾，并加上“ay”的声音。

例如：

+   “Pig”变成“ig-pay。”

+   “Latin”变成“atin-lay。”

我们刚才所做的就是加密。然后为了理解我们加密的单词，我们需要反过来工作。

+   “Ig-pay”通过从末尾移除“ay”并将最后一个字母放在第一个位置变成“pig”。

+   同样，“atin-lay”变成了“Latin。”

我们刚才所做的就是解密。孩子们能够使用这些技术以一种简单的密码学方式加密和解密单词。

#### 加密/解密

加密使您能够以一种安全的方式在特定各方之间传递信息，被排除的各方将无法理解它们。自古以来，就有需要在各方之间发送秘密信息的需求。一方在一个地方发送加密信息，然后另一方能够在另一个地方接收并解密信息。

事实上，在第一次世界大战（WWI）和第二次世界大战（WWII）期间，密码学得到了广泛应用。纳粹使用了一种名为恩尼格玛的机器来加密和解密信息（见图 1-1）。盟军找到了一种方法来破解纳粹恩尼格玛机的秘密代码并解密信息。这被认为是缩短了二战时间。![../images/475651_1_En_1_Chapter/475651_1_En_1_Fig1_HTML.jpg](img/475651_1_En_1_Fig1_HTML.jpg)

图 1-1

恩尼格玛机。图片来源：wikimedia.org。

加密和解密从纯粹的军队使用发展到了公共使用，通过 IBM 在 1970 年开发的数据加密标准（DES）和 1976 年的密钥加密术。事实上，在过去，密码学与加密是同义的。

#### 加密 + 解密 = 密码学

如前所述，密码学是使用加密和解密技术的过程。单词*密码学*来自希腊单词*kryptos*，意味着隐藏或秘密。

在猪拉丁语的例子中，我描述了你可以如何加密和解密单词。移除第一个字母并将其添加到末尾加上“ay”，反之亦然，这就是加密。不知道这个技巧，你就无法理解猪拉丁语。

大多数人可能足够聪明，能够解开秘密的猪拉丁语，因为这种语言本质上是简单的；然而，复杂的加密示例则是另一回事。

例如，回到二战时期的恩尼格玛机，纳粹正在空中传递信息。盟军能够接收到这些信息（这些信息就是“公钥”），但没有解密的方法（即“私钥”），这是不够的。一位名叫图灵的科学家和其他人花了五分之一个多月才解密了纳粹的密文信息。

### 注意

加密*密钥*可以用来加密一条信息。然后只有知道第二把钥匙（即私钥）的人才能解密这条信息。

图灵的贡献是自动化了一台能够解码纳粹恩尼格玛机不同设置的机器，以便他们能够解密信息。换句话说，它自动化了寻找私钥的过程。那台机器被称为*爆破机*。

#### 数字资产+密码学=加密货币

加密货币是一种通过使用强大的加密技术（加密和解密）设计的数字资产，以便电子货币能够进行交换，确保资金、交易以及新资金的创建的安全。

加密的私钥机制必须足够强大，以至于几乎不可能（换句话说，需要花费太多时间和精力）破解。否则，如果像恩尼格玛机那样在几个月内就能破解加密，所有用户都可能失去他们的电子货币。

加密货币的一个例子是比特币。尽管比特币不是第一个被发明的加密货币，但它通常被认为是第一个成功的加密货币。

比特币的成功归功于以下特点：没有人能够破解公私钥，它是一个没有受控政府的分布式系统，它是公开可用的，并且以开源代码的形式发布。

### 注意

比特币是在 2008 年由中本聪通过发表一篇名为“比特币：一种点对点电子现金系统”的白皮书（ [`bitcoin.org/bitcoin.pdf`](https://bitcoin.org/bitcoin.pdf) ）而发明的。实际完整的开源软件在一年后的 2009 年发布（ [`github.com/bitcoin/bitcoin`](https://github.com/bitcoin/bitcoin) ）。

#### 密码学+经济学=密码经济学

加密经济学是密码学与经济学相结合，以提供一个平台，给予维护平台、其可扩展性和安全性的激励；此外，它不受中央或地方政府的控制。换句话说，它是*去中心化*的。网络由多台计算机集合组成，而不是一台中心计算机。

### 注意

去中心化是中央控制的相反；这意味着没有中央或地方政府控制。

比特币通过使用私钥-公钥概念来实现加密经济的目标；密码学和加密哈希函数是间接使用的。实际上，密码学与加密货币之间的关系对于比特币来说不仅是间接的，对于大多数加密货币也是如此。

例如，比特币中使用了密码学在其他方面，如下所述：

+   比特币使用私钥（比特币称之为*数字签名*）结合算法函数（称为 ECDSA 椭圆曲线）来证明所有权。

+   哈希算法通过一个名为 SHA256 的哈希生成器来保持数据库账本数据（或区块链）的结构。

+   哈希算法用于生成数学难题，计算机尝试为奖品解决问题。一旦难题解决，计算机被选中帮助处理交易。

+   哈希算法也用于生成账户地址。

+   有一种叫做默克尔树（在下一章节中介绍）的概念，它将大量数据的小块使用哈希键。这对于需要在受限硬件设备上运行的轻量级钱包很有用，比如移动设备。

比特币不为用户提供身份信息；然而，交易是公开的，这意味着所有信息都被传输并在线可用。再次想象一下恩尼格玛机的例子；这意味着任何人都可以拦截传输的信息。然而，没有私钥，没有人能解密这些信息。

自 2009 年比特币发布以来，有许多其他平台使用不同类型的隐私安全地发送信息，并且对过程的更多部分使用加密，从而使公开的信息减少。例如门罗币和 Zcash 等平台，甚至在对交易细节进行消息传递时也使用密码学来实现匿名性。

## 区块链简介

如我所说，比特币是第一个成功的开源数字货币。区块链是核心技术，或者说是比特币背后的心脏，实际上也是所有加密货币平台背后的心脏。

但是什么是区块链呢？

简而言之，*区块链*是一个共享的数字账本。想象一个数据库，不是将所有的数据库条目存储在一台计算机上，而是将数据存储在多台计算机上。一个更高级的定义是，区块链是一个去中心化和分布式的全球账本。

### 区块+链=区块链

每个区块包含记录和交易；这些区块在多台计算机之间共享，除非整个网络达成协议（共识），否则不应该被修改。网络按照特定的政策运行。计算机连接在同一个网络上，被称为*对等节点*或*节点*。

### 注解

区块链是什么？区块链是一种数字化的去中心化（没有金融机构参与）和分布式账本。用通俗的话来说，它是一个存储记录和交易的数据库，存储在多台计算机上，没有一方控制，且根据共同的政策运行。存储的数据是一个区块，区块通过链接（链）连接在一起，形成区块链。

#### 链接区块

区块链由一组数据（区块）链接到前一个区块组成。它们是如何链接的？一个区块包含数据，每个区块引用前一个区块，所以它们就像链条一样，一个环节连接到另一个环节。看看图 1-2；正如你所看到的，每个区块都在引用前一个区块。![../images/475651_1_En_1_Chapter/475651_1_En_1_Fig2_HTML.jpg](img/475651_1_En_1_Fig2_HTML.jpg)

图 1-2

链接在一起的区块

因此，区块链包含区块，这些区块持有交易记录。私钥由所有者持有以证明所有权（这是数字签名），所以没有私钥的人无法解密字符串并声称所有权。这个公钥和私钥的组合代表了电子现金。

### 注解

对等节点形成一个节点网络，所以在这本书中，你可能会看到“对等节点”或“节点”这个词。这些词为了这本书的目的来说是同义的。

如我所说，数字资产可以是任何东西——一个音乐文件、视频文件、电子文档等等。在加密货币中，数字资产被表现为电子现金；你可以把公钥看作是你的银行账户和路由号码，私钥看作是你账户中的实际现金。是的，你可以把你的银行信息分享给其他人，但资金将留在你的账户中。要取出你的现金，你需要证明所有权。你走到银行，出示一种身份证明，并通过签名方式证明是你的，只有这样你才能从你的账户中取出钱。在加密货币中也有类似的过程。有一个代表你账户的公地址，只有拥有私钥的人才能证明所有权。

#### 双重支付问题

数字签名（公钥和私钥）安全地确保一方身份保持私密，电子现金被存储。

这种私钥-公钥组合的概念让你能够加密和解密字符串，并保持字符串安全，就像你看到的恩尼格玛机一样。然而，这仍然不足以解决数字货币的最大问题——双重支付。

当你使用法定货币（如美国政府发行的纸币）如美元或欧元时，这些纸币是不可兑换的，这意味着一旦你将纸币给出，你就无法再次使用它。在加密货币中，如果你同时证明所有权并发送你的数字资产两次，会发生什么？这可能导致*双重支付*。

黑客可以尝试复制数字资产，以及可能双重支付它们，这是加密货币在其可作为数字货币使用之前必须解决的问题。

### 注意

*双重支付*是数字货币可能被花费两次的风险，因为数字签名可以被复制，并且一个人可以证明所有权并在同一时间发送两次数字资产。

仅持有密钥的区块不足以提供安全保障并解决形成数字货币的潜在双重支付问题。

比特币通过创建一个计算机网络并证明没有发生双重支付的尝试来解决这个问题。通过让网络上的所有计算机都了解每一笔交易，所有交易都与其他计算机在网络上共享。

#### 双重支付解决方案：P2P 网络

在加密货币中，使用点对点网络提供了解决双重支付问题的方案。

### 注意

P2P 网络是一种分布式应用架构，它将需要执行的任务分散在不同的对等体之间，每个对等体都享有相同的权限。这些对等体共同创建了一个 P2P 网络节点。

网络上的任何连接计算机都称为一个*对等体*。对等体可以是任何满足网络要求的计算机，如笔记本电脑、移动设备或服务器。这些计算机通过 P2P 网络协议连接到互联网上，形成一个节点网络。

P2P 网络协议并非新鲜事物。它已经被广泛应用于网络多年，从通过 Kazaa 或 LimeWire 网络下载文件，到通过 Skype 进行视频聊天。

如我所说，比特币是第一个可行的加密货币，它解决了双重支付问题，并通过利用 P2P 形成区块链协议，使电子现金无需通过金融机构即可存储。

> “一种纯粹的点对点电子现金版本将允许在线支付直接从一方发送到另一方，而无需通过金融机构。”
> 
> ——中本聪，《比特币：一个点对点电子现金系统》

### 加密货币矿工的加密挖掘

如前所述，每个持有共享账本副本并连接到 P2P 网络的计算机都是一个对等体。对等体可以帮助添加记录和验证交易。这个过程被称为*加密货币挖掘*或*加密挖掘*，帮助记录和验证交易的计算机被称为*加密货币矿工*或简称*矿工*。

每位矿工都帮助验证并将交易添加到区块链数字账本中。矿工通常会因工作而获得费用，为了与其他矿工保持竞争力，矿工通常需要配备特殊硬件的计算机。

### 加密货币钱包

我介绍了公钥和私钥是什么以及它们如何用于加密和解密字符串。字符串是数字货币或加密货币，而密钥代表数字货币。

一个*加密货币钱包* 存储一个或多个公钥和私钥组合，并用于接收或花费加密货币。

一个好的类比是将钱包比作你的银行账户。加密货币可以通过做矿工工作获得奖励来创建，或者可以购买。我将在书中的后面部分进一步介绍钱包。

## 加密货币过载

在深入研究区块链 P2P 网络之前，您应该知道另一个可能引起混淆的概念是硬币与代币之间的区别。根据 Coinmarketcap.com 的数据，在撰写本文时，市场上共有 1833 种加密货币，总市值为 2000 亿美元。

这些货币中的许多肯定会在未来几年内消失，因为它们提供的价值很少，这些项目会因缺乏兴趣或诈骗而被终止。

这可能会让人感到困惑和恐惧，大多数人都不理解比特币的概念，更不用说市场上众多的硬币和代币了。为了帮助理解这些概念，让我们将加密货币分为三种类别：比特币、代币和替代加密货币币（altcoins）。见图 1-3 

图 1-3

加密货币币和代币。图片来源：blog.citowise.com

### 比特币数字货币

比特币是第一个成功实现的去中心化分布式数字货币。总共有 2100 万枚硬币。这些硬币取代了传统的法定货币。

### 代币

代币是一种去中心化的产品。它是一种与首次公开募股（IPO）或众筹相似的另一种选择。代币可以在世界任何地方创建，并通过以太坊、EOS 或其他有能力的区块链平台交付。代币通常通过首次币发行（ICO）创建并向公众分发。

代币代表一种通常位于原生区块链之上的实用工具或资产。它可以代表任何数字资产，包括忠诚度积分、加密货币，或任何有单独单位、可互换、可兑换或有交易性的资产。您可以使用现有的区块链模板（如以太坊平台）创建代币，也可以在现有的原生区块链上创建您自己的代币并发行。您可以利用智能合约简化创建代币的过程，这一点将在后面的章节中讨论。

### 注意

智能合约是可编程的代码，它能够独立运行，无需第三方参与。例如，Solidity 是一种面向合约的编程语言，可以部署在多个区块链上。

### 替代加密货币币（山寨币）

替代加密货币币（简称山寨币）是通过分叉比特币核心源代码而产生的（软分叉或硬分叉）。例子有莱特币（莱特币是比特币核心客户端的分叉），狗狗币（狗狗币 1.10 是基于比特币 0.11 构建的完整重建），比特币 X，比特币现金和比特币黄金。实际上，在撰写本文时，共有 26 种山寨币。

### 注意

硬分叉是不兼容的，因为变化将网络代码分为两部分——原始代码的 P2P 网络和新 P2P 网络，运行新代码。软分叉是兼容的，意味着以前有效的区块/交易变得无效，旧节点将新块视为有效。当开发者对发展方向有分歧时，这种分叉经常发生。例如，一些开发者希望实施其他开发者不同意更改，或需要实施重大修复。

莱特币是比特币核心客户端的一个分叉。莱特币将发送区块的时间从 10 分钟改为 2.5 分钟，使得交易能够快速且更有效地传输，比比特币更快。莱特币随后可以继续添加功能，因为它不再依赖于比特币的代码。例如，将来莱特币将支持原子交换，允许人们通过智能合约将莱特币转换为比特币，而不涉及交易所。然而，比特币核心的变化将需要手动实现，以便这些变化被包含在莱特币中。

话说回来，很多人会认为莱特币和许多山寨币提供的价值不够，无法生存，并且是为了让创建分叉的开发人员致富而创建的。只有时间会告诉我们。

EOS 是另一种好的山寨币示例。这次，山寨币变成了代币，因为 EOS 公司发布时发行了以太坊代币，但 EOS 正在建立自己的区块链平台，它用自己的 EOS 代币替换了以太坊代币。

总之，山寨币和代币之间的主要区别在于它们的结构。山寨币是其自己的货币，如比特币或莱特币，拥有自己的专用网络区块链和矿工的需求。代币，如以太坊代币，在现有的区块链之上运行，为代币和去中心化应用（DApp）的创建提供代币和基础设施（如以太坊）。以太坊代币的一个例子是币安代币（BNB）。

关于以太坊代币，以太坊提供了创建不同代币标准或以太坊请求评论（ERCs）的功能，如 ERC-20、ERC-223 或 ERC-777 等。在 BNB 代币示例中，使用了 ERC-20。这些标准各不相同，在后面的章节中将进行更详细的讨论。

## 区块链 P2P 网络

现在既然你已经对关键概念有了更好的理解，你可以更深入地了解区块链如何使用 P2P 网络来解决双重支付问题以及排除金融机构。

在本节中，你将了解加密货币 P2P 网络是如何工作的。你将通过把 P2P 网络分为五层来具体探讨不同的区块链政策以及一般的 P2P 网络。

+   共识层

+   矿工层

+   传播层

+   语义层

+   应用层

这里的概述将为后续章节铺平道路，你将利用比特币核心 API 来配置和运行一个对等节点。这种基本理解能帮助你通过利用不同的政策（如 NEO 和 EOS）来理解任何区块链网络是如何工作的。

### 共识机制

在传统集中式系统，如银行，有一个主计算机负责账本交易。银行显然可以信任自己的计算机，因此它没有问题成为负责主计算机安全和完整性的实体。

当你处理共享账本的不信任对等体时，需要制定规则以确保安全和账本完整性，以防止双重支付和其他潜在的黑客攻击。这些规则和协议被称为*共识机制*。

### 注意

共识机制是网络在出现故障时仍能正常运行所需的协议。它需要能够在分布式 P2P 网络中就网络数据达成一致。

区块链不仅仅是单一的主计算机，并旨在实现全球化工作。它通过网络中所有计算机的数据共识来实现完整性。分布式共识意味着一个地理位置分散的对等池，以去中心化方式达成一致，而不是一个主计算机（集中式）。代替规定，通常在开源环境中设定规则，而不是由政府实体设定。

P2P 网络启用账本。为了以一种安全的方式实现这一目标，P2P 网络存储数字账本规则和安全。共识机制不仅提供规则，还提供激励措施，使矿工存储数据和创建交易的工作得以进行，通过给予矿工奖励。

点对点网络通过互联网在全球范围内工作，并能够提供一个平台来实现全球分布式的共识机制。在加密货币中，共识/协议是关于区块是否有效。如果一个区块是有效的，它将被添加到区块链中。如果一个区块是无效的，它将被拒绝添加到区块链中。

这就是共识政策发挥作用的地方。网络中的大多数节点在他们的验证最佳区块链中持有相同的区块，并遵循相同的规则（共识规则）；这是区块链确保安全的方式。最难重建的链被称为*最佳区块链*（关于这个概念在本章后面会有更多介绍）。

### 工作量证明、权益证明和委托权益证明

随着区块链的普及，许多共识机制政策被创建出来。第一个是由比特币创建的，许多其他机制是为了解决其他机制存在的问题而构建的。在下面的章节中，我将讨论一些流行的共识机制。

+   工作量证明（PoW）

+   权益证明（PoS）

+   委托权益证明（DPoS）

除了这三个，还有许多其他未在本书中涵盖的共识机制，例如重要性证明、流逝时间证明（PoET）、权威证明（PoA）、销毁证明、容量证明、活动证明等。可以自由地探索这些；每个都有其优缺点，适用于不同的需求。

#### 工作量证明（PoW）

工作量证明（PoW）是第一个也是最流行的机制；它被比特币和以太坊使用，后者在撰写本文时是最受欢迎的加密货币。PoW 通过构建一个矿工网络并向矿工呈现一个数学问题来实现。当矿工解决问题时，他们会获得一种加密货币作为奖励。奖励是对所做“工作”的证明，这也是其名称的由来。

### 注意

以太坊的开发社区正在寻求从 PoW 过渡到权益证明（PoS）或 ProgPoW（减少 ASICs 的算力优势机制）。

工作量证明（PoW）通过计算能力（*算力*）来决定哪个节点进行工作，并按比例分配工作，因此它是公平的。PoW 不会单独信任网络上的任何节点，但整个网络都信任它们作为一个集体网络。

这并不意味着一个矿工与另一个矿工竞争。一个矿工网络（称为一个*池*）可以与其他矿工池竞争工作。池的算力越高，获得“工作”的机会就越大。

正如之前所提及的，加密货币是去中心化的，没有一台可信的计算机负责账本。工作量证明（PoW）是一种确保数据完整性的机制，同时也能阻止恶意攻击。

工作量证明（PoW）是矿工需要解决的数学难题。矿工需要找到一个复杂数学问题的解决方案，以成为领导者，并能够创建下一个将被添加到区块链中的区块。网络中存在的矿工越多，需要解决的数学难度就越复杂。对于比特币来说，每十分钟只添加一个区块，且只有一个胜者，所以竞争非常激烈。解决问题使计算机的芯片开始工作，这消耗了电力并产生了热量。想想你的电脑运行一个包含大量媒体的重度视频游戏，或者你的电脑在制作视频时进行处理。

你还可以使用这个在线资源，它连接到一个比特币对等节点，并进行各种计算以确定下一个难度： [`bitcoinwisdom.com/bitcoin/difficulty`](https://bitcoinwisdom.com/bitcoin/difficulty) 。

这些信息对于计算挖掘盈利能力很有用。在撰写本文时，比特币的难度率为 5 万亿美元，预计下一个难度增加为+3.74%，总哈希率为 43 万亿 GH/s。它还显示，创建一个区块需要 9.9 分钟，并产生约 25 个比特币。快速计算显示，如果我们每十分钟获得一个区块，每个区块的数据大小为 4.2 MB，那么一年就是 4.2 MB 的数据。

每十分钟创建一个区块是一个限制因素，每个区块可以包含的交易数量也是有限的。这导致了可扩展性问题，其他共识机制试图加以改进。

总结来说，每个矿工都在竞相解决同一个问题；一旦问题解决，流程将重新开始。这个问题被称为*工作量证明问题*，奖励是给予第一个解决问题的矿工。然后，验证的交易将被存储在公共账本中。

这种 PoW 并非没有其自身的缺点；这种算法可以在当今世界中造成各种问题。例如，如果一个矿池控制了总挖掘力量超过 51%，整个区块链的安全性就会受到风险，因为你有一个与拥有一台计算机没有太大区别的中心集体。针对网络的 DDOS 攻击可能会使整个网络的信誉受到风险。

这实际上是真的，而不仅仅是理论。在撰写本文时，比特币黄金（bitcoin gold），比特币的一个分叉版本，遭受了 DDOS 攻击。

分布式拒绝服务（DDoS）攻击发生在多个系统攻击目标系统的资源/带宽时。

在 PoW 上，随着难度的增加，意味着利润减少。利润减少导致挖矿的激励减少。以太坊加密货币面临着网络中矿工减少的问题，并且在 2018 年，以太坊不得不计划一个“难度炸弹”，这降低了难度（提高了矿工的利润），并且从 PoW 切换到 PoS 以提高可扩展性。

攻击是如何实现的？一个占有网络 51%算力的矿池能够创建自己的区块，并且比主区块链的更新速度更快地发布它。这个区块掌握了 51%的网络，能够通过在花费后移除交易来实现双重花费币，这样币就不会从原始钱包中取出。这种威胁是真实的。在撰写本文时，矿池公司 Bitmain 控制了超过总比特币算力的 40%。

许多人认为 PoW 是不可持续且不足的，因为它消耗的电力以及相比其他算法更慢的交易速度。从更全面的角度来看，比特币当前估计的年耗电量约为 60 至 73 太瓦时（TWh）。这相当于瑞士一年所需的电力；想象一下，如果多个使用 PoW 的货币像比特币一样流行。

关于 PoW，可以在由中本聪编写的[比特币白皮书](https://bitcoin.org/bitcoin.pdf)中了解更多。

#### 证明股份

PoS 是在 2012 年由 Sunny King 和 Scott Nadal 创建的，作为解决前面提到的 PoW 缺点的一种替代方案。

PoS 依赖于节点持有多少币。节点需要质押它想要挖矿的币数。

我们拥有的是股份力量，而不是算力，并且不依赖于能源消耗，因为没有需要解决的谜题。PoS 为比特币 PoW 提供了一个类似的哈希区块方案，但它限制了节点的数量。这提供了所需的安全性，同时降低了成本和能源消耗。网络费用提供给节点，而不是像 PoW 中为解决数学谜题提供奖励。

PoS 通过节点持有的股份大小来决定哪个节点进行工作。这在不消耗更多能源和降低成本的情况下实现了分布式共识。DDOS 攻击和欺诈仍然可能发生。然而，攻击者无法交易比他们质押的数字货币更多的数字货币。否则，他们会失去他们的存款，所以攻击的可能性较低。请记住，攻击者可以质押他人的硬币，并且不会在乎失去这些硬币，因为它们不是他们的，所以仍然有进行 DDOS 攻击的方法。

任何节点都可以通过质押硬币来参与挖矿过程，以验证新交易。要成为矿工，有两个选项；您可以质押您的硬币供可信节点使用（但通过 PoS 网络节点的欺诈您可能会失去您的硬币），或者您可以提交一个完整节点以被选为矿工。去中心化是有限的，因为只有少数矿工持有大部分硬币并拥有多数控制权。对于工作，每个矿工随机选择；这不是基于解决谜题。请查看表 1-1，比较 PoW 和 PoS。表 1-1

pow 与 pos

| 类别 | PoW | PoS |
| --- | --- | --- |
| 生成新区块 | 基于哈希能力首先解决问题的矿工 | 基于质押权力（一个节点持有多少硬币）的随机选择 |
| 奖励 | 区块奖励 | 网络费用 |
| 能源和资源消耗 | ASIC 矿工和大型足迹 | 少量资源和低能耗 |

您可以设置一个质押钱包，持有您需要的 PoS 的硬币。在某些区块链网络中，您的硬币可以获得年度回报。

以下是一些使用 PoS 的流行加密货币硬币列表：

+   ***Dash***: 您需要 1000 个单位才能成为主节点。它每年提供大约 7.5%的回报。

+   ***NEO***: 质押钱包每年返回约 5.5%。无需挖矿；你只需持有硬币即可获得燃气币。

+   ***其他***: LSK, PIVX, NAV, RDD, BEAN, Linda, DCR, NEBL, OK, STRAT.

虽然一些硬币提供年度回报，但请记住，如果硬币市值保持稳定，随着时间的推移，单个硬币的价值会降低，因为会生成新的硬币。通过质押钱包，持有（HODL）钱包的价值受到的影响较小，因为你获得更多的硬币来维持你的钱包价值。这类似于银行给你 X%的利率，通货膨胀也是 X%，你的余额显示更多的资金，但实际情况你拥有的钱是一样的。

### 注意

HODL 是与加密货币相关的一个俚语术语，用来描述不顾价格波动而持有加密货币。

让我们以 NEO 为例进行检查。你不需要挖矿就能获得奖励。你只需持有硬币作为质押交易的奖励即可获得燃气币。你可以通过使用这个网址：[`neotogas.com/`](https://neotogas.com/) 来计算你会收到多少燃气币。在撰写本文时，如果你购买五个 NEO 币并持有一年，通过将其放入质押钱包，你将获得 0.4799 燃气币（目前价格为 7.73 美元）。见图 1-4。![../images/475651_1_En_1_Chapter/475651_1_En_1_Fig4_HTML.jpg](img/475651_1_En_1_Fig4_HTML.jpg)

图 1-4

[Neotogas.com 燃气质押计算](https://neotogas.com/)

我鼓励您在这里阅读有关 PoS 的白皮书：[`peercoin.net/assets/paper/peercoin-paper.pdf`](https://peercoin.net/assets/paper/peercoin-paper.pdf) 。

#### 委托证明股份

委托权益证明（Delegated Proof of Stake）是由 Dan Larimer 发明的一种人口普查算法方法，在白皮书[`github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md`](https://github.com/EOSIO/Documentation/blob/master/TechnicalWhitePaper.md)中讨论。DPoS 旨在通过提供一种民主机制而不是随机过程来改进 PoS 共识。

### 注意

在 DPoS 中，矿工被称为 *区块生产者*。

DPoS 通过将挖矿过程分为两部分来实现技术民主。

+   **选举**：在选举区块生产者时，只有 21 个区块生产者，而不是 PoW 中的无限数量。

+   **生产调度**：21 个区块生产者中的每一个每隔 3 秒产生一个区块。

选举过程提供了一种技术民主，确保利益相关者处于控制之中，因为大的利益相关者在网络失败时损失最大。

每个区块生产者轮流产生一个区块，最长的链被采用（与 PoW 类似）。看看图 1-5 所示的正常操作。你会看到每个节点 1 到 3 轮流产生最长链区块。任何时候一个诚实的对等节点看到一个有效的更长链，它将从中断的分支切换到更长的分支。![../images/475651_1_En_1_Chapter/475651_1_En_1_Fig5_HTML.jpg](img/475651_1_En_1_Fig5_HTML.jpg)

图 1-5

DPoS 正常操作

DPoS 即使当大多数生产者失败时也能继续运行和发挥作用。图 1-6 展示了一个小众分叉，其中节点 2 在一个周期内只有一次机会发布最长链。在失败过程中，社区可以投票替换一个失败的对等生产者，在本例中是节点 1，或直到网络恢复正常运行的对等生产者。![../images/475651_1_En_1_Chapter/475651_1_En_1_Fig6_HTML.jpg](img/475651_1_En_1_Fig6_HTML.jpg)

图 1-6

DPoS 小众分叉

这份白皮书详细描述了这一过程以及区块是如何产生的以及处理失败链的规则：[`steemit.com/dpos/@dantheman/dpos-consensus-algorithm-this-missing-white-paper`](https://steemit.com/dpos/@dantheman/dpos-consensus-algorithm-this-missing-white-paper)。

设定一个区块生产者和质押用户社区，这些用户同意这些规则，赋予了 PoS 的高效性，以及 PoW 运行的去中心化方式。DPoS 使用权益人的力量来批准共识算法规则，如激励费用、区块间隔、分叉和交易大小。

这些规则可以由当选的代币持有者进行微调。这种共识机制可以显著减少交易时间（1 秒对比 PoW 的 10 分钟）。此外，共识协议旨在保护所有参与者，尽可能防止 POW 中一组节点的不受欢迎的干扰。DPoS 区块链的例子包括 Bitshares、Steem 和 EOS。

### 挖矿层

矿工在网络背后所做的努力可以描述为一场做区块链工作的竞争，实际上就是在做网络记账的工作。对于采用工作量证明（PoW）的比特币和大多数加密货币来说，每个节点都需要持有整个公共账本，里面记录了所有曾经发生的交易。PoW 矿工基于计算力和矿池，而其他网络则考虑其他因素。

对于比特币，交易必须得到矿工的验证，他们检查账本，确保发送者没有转移它不拥有的资金，然后才将交易添加到账本中。最后，为了防止黑客攻击，矿工通过多层计算工作来封存这些交易，黑客要想实现攻击需要做大量的工作。这项服务通过向矿工支付比特币作为费用来奖励。

对于比特币而言，每四年大约会减半一次 coin 的批次大小；在大约 2140 年（除非发现比 SHA2 更快的计算方法）之前，它会减到零，流通中的比特币总数将是 2100 万。

### 传播层

传播层负责决定在 P2P 网络上如何传输共享账本和区块。这一层在区块链白皮书中有详细描述。

每个节点可以将新交易传输到网络上的其他节点。这种架构允许节点间间接通信。例如，你可以发送一个影响两个钱包的交易，而这两个钱包不必直接相互连接。

任何接收到它之前没见过的有效交易的节点都会立即将其转发给它所连接的所有其他节点。这是一种称为*洪泛*的传播技术。因此，交易迅速在 P2P 网络上传播，在几秒钟内就达到大部分节点的百分比。

### 语义层

语义层负责新块与之前块的关系以及提供验证共识规则的协议。

正如你所见，根据连接的可信机器数量、质押、速度、计算力等因素，有不同的共识机制，但它们都是相似的，即新的区块如何与之前的区块相关联以确保安全。每个区块链都有其规格。在这一层，交易发生在账户之间转移代币/硬币。我讨论了最佳区块链以及每个区块包含数据，区块链中的每个区块都引用前一个区块。区块链中的共识保持相同的区块并在相同的规则（共识规则）下运行。这就是区块链确保安全的方式。

### 应用层

这一层负责在区块链之上部署应用程序。

例如，去中心化应用（dapps）、智能合约、交易所以及提供关于区块链的信息的网站都是建立在区块链之上的应用。

对于应用层，区块链需要暴露 API。不同的区块链在提供客户端与网络通信的方式方面是相似的。

比特币提供一个全节点，目前大约 27 GB，包括一个完全执行节点和区块链的所有规则。这对于挖矿以及确保你运行的节点连接到应用层时与最新的区块同步是必需的。

这些全节点为 P2P 网络的功能性做出了贡献，并帮助支持网络及其安全性。

通常，区块链还会提供一种“轻”节点版本。实际上，比特币轻客户端是在引用一个可信全节点的区块链副本。轻客户端允许用户与比特币的区块链交互，并无需占用 27 GB 的大磁盘空间就能发起和确认交易，这有助于能力较弱的设备，如移动设备。

重要的是要理解轻客户端是可信的，并不包含所有的共识规则。全节点是不可信的，并将拒绝违反共识规则的区块，即使网络上的所有其他节点都认为该交易是有效的。

我以 NEO 为例，介绍了一个流行的权益证明区块链。NEO 还提供了 NEO-CLI，其中包括支持共识功能的 API，可用于应用层。

同样，EOS 委托权益证明提供了全节点和轻节点选项。你将开始注意到，尽管市场上有很多区块链选项，但在实现区块链的方式上有很多相似之处。

## 总结

在本书的这一章中，我打下了基础，并解释了有关区块链的基本概念；我解释了诸如加密和解密、密码学、数字资产、加密货币等概念。

我介绍了组成区块链的部分，包括区块、双重支付、加密货币、加密挖矿、加密矿工和加密货币钱包。我讲述了不同类型的加密货币：比特币、代币和山寨币。

最后，我介绍了区块链 P2P 网络以及构成网络的不同层次：共识层、矿工层、传播层、语义层和应用层。你还学到了点对点网络的核心逻辑以及工作量证明（PoW）、权益证明（PoS）和委托权益证明区块链（DPOS）。

在本书的这一章中，我介绍了很多将在整本书中使用的术语，如数字资产、公钥和私钥、去中心化、双重支付、智能合约和 HODL。

在下一章中，你将安装并学习比特币核心 API，以及如何在不同的区块链中创建完整的对等节点。这将使你能够访问区块链 P2P 网络，甚至能够理解并创建可以作为矿工的对等节点。
