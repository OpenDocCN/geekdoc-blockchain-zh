# 第六章

# 使用 Python 实现区块链

+   Saugata Dutta

    印度的加尔格蒂亚斯大学

+   Kavita Saini

    印度的加尔格蒂亚斯大学

摘要

本章介绍了使用 Python 代码的区块链的简要概述。本章将对使用 Python 代码开发区块链的基本理解进行介绍。本章着重介绍初学者级别的区块链创建，这将有助于理解使用 Python 代码开发高级区块链项目。本章涵盖了基本的构建模块，这些模块将有助于创建各种功能和方法来增强区块链的安全性。这也将帮助学生创建更高级别的 Python 程序，以创建更好的挖掘算法、更好的队列管理、增强和安全的交易、共识算法、钱包和账户。

前言

我写这篇文章最初的动机源于我对网络安全和数据泄漏预防的热情。随着最新技术的创新以及数字安全漏洞的增加，对于一种具有高数据安全性、防篡改和防数据泄漏的技术的需求日益增加。怀着希望取得成功的心态，区块链技术声称能够产生与数据安全相同的效果，不用说使用这项技术，数据篡改是不可变的，整个信息都存储在区块中并进行了哈希处理。这项技术的应用不仅限于加密货币，还被用于物流、供应链、医疗保健等其他行业。本章讨论了使用 Python 代码介绍区块链的概述。由于使用这项技术而导致的外观和市场趋势的变化是面向未来的，具有高水平的数据安全性，而不涉及任何中央机构。

发现最新的区块链技术趋势、未来发展和在各种平台上使用的平台是我的兴趣。实际上，成功的功劳归功于参与使这篇文章成功的每个人。

区块链介绍

区块链可以被称为一个公共账本，它分布在各个系统之间，不受地理位置的限制。这个账本存储在世界各地的许多系统中，并不断更新。区块链技术的幕后推手是中本聪。区块链的白皮书于 2009 年提交，其中技术展示了点对点、去中心化、共识算法和在没有任何第三方干预的情况下使用技术。最初，该技术专门用于比特币，但后来其功能扩展到了各行各业，具有高安全性、追加方式、去中心化网络的属性，最重要的是不需要任何第三方的批准（Jena 等人，2019 年）。货币的使用并不新鲜，在中世纪就已经流行。古代交易的常见方法是以物易物，因为交易是在同等价值的物品（如金属、宝石等）交换的基础上进行的。随着发展的进展，交易方式发生了巨大变化，引入了硬币和纸币。中央权威负责发行这些货币，并对其拥有充分的控制权。政府、监管机构对这些货币拥有强大的控制力，并对流通货币拥有全权。这些货币是固定的，不会随着时间的推移而下降。近年来，浮动货币的引入使交易变得更加简便和快速。然而，这些涉及记录保存、识别和验证、转移等的交易是由中央管理的。信息技术使用户可以随时随地执行交易变得更加容易，但是网络威胁是一个挑战。漏洞仍然存在，并已经在全球范围内造成了损失。交易是由中央管理的，不可见的。数据和交易可以通过精心策划的信息技术漏洞和漏洞进行修改、篡改、欺骗。事实上，数据也可能受到内部叛徒的威胁。有各种其他因素和方法可以违反由中央管理的关键数据。在其显现阶段，区块链技术引入了比特币，以启动并行经济，声称解决了这些问题。区块链使用分布式和分布式网络以及分布式账本，无需任何第三方或中央权威的批准或管理即可使用技术。比特币货币被认为是加密货币的鼻祖，也是使用区块链技术引入的第一种货币（Jena 等人，2020 年）。比特币的账本副本已经在节点之间共享，每个节点都持有这个分布式账本的相同副本。发送方使用私钥和公钥对交易进行签名和加密，然后发送给接收方。任何人都可以使用公钥对这些交易进行验证，但只有发送方的私钥才能解密。一群人被称为“矿工”，负责验证交易，并将这些交易与其他交易一起累积到一个块中，作为他们获得一些奖励的交易。这个过程也被称为挖矿。在挖矿过程之后，一旦生成了块并将共享账本更新到所有节点，接收方就被认为已经收到了金额。这些交易是透明的，无法修改或篡改。比特币、数字加密货币的发明是一项创新，但是区块链技术在这些年里已经发展出了不同类型的应用。行业已经开始找到各种形式的使用这种安全技术的方法，以确保数据保持安全、未被篡改、去中心化且无任何一方的控制。以太坊是一个开源的加密货币和区块链平台，已经在智能合约的使用方面取得了进展，实际上是一个发明者。智能合约的使用已被大众接受和使用，并被授予了一种可接受的工具，可以在区块链平台上创建自执行合约。这些合约没有任何一方的干预或控制（Kumari & Saini, 2019 年）。权益证明发现使块的创建变得容易。验证者根据他们持有的更多的挖矿能力或货币来选择验证块交易。这在某种程度上比传统的工作证明算法有一些优势，比如节省电力消耗是最常见的问题，并且在 51%攻击方面更加安全。权益证明的验证者在不获得奖励的情况下会获得交易费用。在区块链技术领域的下一个成就是扩展。随着区块链交易的增加，性能下降和与存储相关的问题也会出现。为了解决这些问题，正在探索各种方法，如分片、侧链、权益证明、块压缩、混合共识等（Kavita，2018 年）。因此，区块链是一种不断发展的技术，通过使用分

区块链设计

区块链正如其名称所示，它是一系列区块。区块链是由一系列区块构建的分布式分类帐。一个区块由多个交易和区块头组成。区块头用于区分区块并帮助创建链。

区块头包括

+   -   时间戳：时间戳指定了区块创建的时间

+   -   版本：指定区块链的版本号

+   -   默克尔根：区块通过哈希值连接在一起。每个区块都有交易。它可以是一个交易或数千个交易，应该有一个块的根哈希。这是通过默克尔树实现的。树将有根、分支和叶子。端节点称为叶子，根和叶子之间的节点称为分支，顶部是根。想象一下，一个区块包含 8 个交易。因此，计算每个交易的哈希将有八个哈希。因此，我们将计算第一个和第二个的哈希值，第三个和第四个的哈希值，第五个和第六个的哈希值，依此类推直到第八个。在这里，我们将组合第一个、第二个、第三个和第四个的哈希，然后是第五个、第六个、第七个和第八个。最后，我们将结合第一个到第八个的哈希值，这将是根哈希或默克尔根。

| 图 1. 默克尔根 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f01](img/ch006.f01.png) |

+   -   难度目标：控制添加新区块到链中所需时间的数字

+   -   随机数：随机数（“只用一次的数字”）添加到哈希块中，当它重新哈希符合难度目标的条件时。

+   -   先前哈希：上一个区块的哈希

这些是区块链运行的一些关键组件。

创世区块：第一个区块称为创世区块。创世区块的先前哈希值为 0，因为它是第一个区块。

| 图 2. 区块链中连接的区块 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f02](img/ch006.f02.png) |

密码学：意味着秘密写作。在这里，发送方使用公钥加密消息。加密后的数据也称为密文，除非解密，否则无法读取。在接收者端，使用私钥解密加密数据。

数字签名：有时用于认证和完整性。如果发送数据，必须从正确的用户进行认证。在这里，数据使用发送者的私钥加密，然后使用接收者的公钥重新加密。在接收端，它使用接收者的私钥解密，然后使用发送者的公钥重新解密。

-   哈希：哈希是一个函数，它接受任意长度的数据并将其转换为固定长度的输出。这用于检查数据的完整性，如果数据更改，则固定输出数据值将发生变化。

共识：由于区块链是一个分布式账本，每个节点都会有一份这个账本的副本。当添加一个区块时，所有节点都应该达成共识，即所有节点都拥有相同的区块链副本。因此，通过共识算法，节点可以就区块链的特定状态达成一致。根据共识算法，可以决定哪个节点可以向区块链添加区块。

工作量证明：解决数学难题的节点将把区块添加到区块链中，并作为回报接收一些奖励。这些节点通常是挖矿节点。数学难题需要大量的计算和时间，并且需要特定的硬件来解决这个难题。一旦解决了难题，区块就可以添加到链中。这整个过程称为工作量证明。

综上所述，区块链的工作原理是通过哈希机制将区块添加到连接在一起的链中。在区块链中，数据无法被篡改和操纵。区块由交易数据和区块头组成，其中存储有时间戳、版本、默克尔根、难度目标、随机数和上一个哈希值（Dutta & Saini, 2019）。之所以说它是安全的，是因为如果数据被修改，哈希值将会改变。所以让我们假设有四个区块并且数据在第二个区块上被修改了，一旦同样的事情发生，第二个区块的哈希值就会改变，这将影响第三个区块。第三个区块的哈希值需要重新生成，这将再次影响下一个区块，也就是第四个区块。这个过程会继续下去。由于区块链中的区块数量庞大，几乎不可能更改所有相应的区块，因为工作量证明需要解决一个数学难题来生成一个区块，并需要一段时间。区块链还被称为一种无需信任的技术，因为没有中央控制或权威。举例来说，区块链中的一笔交易，A 为发送方，B 为接收方。A 向 B 发送一些硬币。矿工的交易将是 B 的数字地址、数字签名、公钥和金额。因此，这些交易连同其他交易一起被挖掘。难度目标可能是要衡量有效的零数。在区块中添加一个随机数（nonce），并随机尝试直到矿工找到满足共识条件的有效哈希。赢得这场竞赛的矿工被认为已成功挖掘了区块。然后将区块添加到链中，矿工将获得奖励。

区块链的 Python 库

要使用 Python 创建区块链代码，需要导入许多库。Python 库包括文字，内置函数和异常。它是一个模块库，可以在 Python 代码中使用，当需要时可以使用。“json”是 Python 中的内置包，用于处理 json 数据，类似地，“string”包包含常量，类和各种字符串操作，在导入 Python 文件后将起作用。例如，“crypto”和“crypto.Hash”包可用于签名和哈希交易。

| 图 3\. Python 库 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f03](img/ch006.f03.png) |

从区块和交易类开始

区块链是一种链，可以看作是一个列表。列表中的元素由逗号分隔。可以通过索引访问列表的元素，索引从 0 开始。区块将保存值，并且每个区块将通过哈希连接。区块将存储交易值。第一个区块是创世区块，没有前一个哈希。区块类将具有属性，并且将有几个参数。Self 表示类的实例，索引，区块的先前哈希，区块的交易项，nonce 和时间。时间函数将提供当前时间。构造函数体将具有实例属性，例如在构造函数中调用 self.transactions 来创建交易实例属性等。

| 图 4\. 区块类 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f04](img/ch006.f04.png) |

在本章中，展示了发送者和接收者之间的金融交易的简单示例。创建了一个交易类，在其中向接收者地址发送金额。

| 图 5\. 交易类 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f05](img/ch006.f05.png) |

时间变量被创建来存储交易时间。像发送者，接收者和金额这样的参数实际上存储在实例变量中。在这里，我们创建一个字典对象，它将有所有这四个变量，以便可以从单一点访问它们。

| 图 6\. 字典对象 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f06](img/ch006.f06.png) |

由于创世区块是主要区块，因此需要检查发送者是否是创世区块中第一笔交易的创建者，并且将在身份字段中分配一些值，否则将分配发送者的地址。此字典对象将由发送者的私钥使用内置的 SHA 算法进行签名。创建了一个名为 tx_signature 的方法。

| 图 7\. 签名方法 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f07](img/ch006.f07.png) |

可以声明一个交易队列，可以在此处附加交易。这是一个全局列表变量。

| 图 8\. 交易队列 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f08](img/ch006.f08.png) |

以下是数字加密交易的示例，这里发件人约翰已经将 2 个硬币转移到了莉娅。这里寻址了莉娅的公钥。调用 Tx_signature 方法以获得发送者的私钥，而一旦创建了交易对象，就调用该方法签名。

| 图 9\. 交易示例 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f09](img/ch006.f09.png) |

可以向交易队列添加更多的交易。以下是一个示例：

| 图 10\. 交易 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f10](img/ch006.f10.png) |

用户类

用户类利用内置的 Python RSA 算法生成公钥和私钥。这些值保存在实例变量中，不应丢失，因为它们持有密钥。公钥被用作用户的身份。声明了一个名为 identity 的属性，它返回公钥的 HEX 表示。

| 图 11\. 用户类 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f11](img/ch006.f11.png) |

可以创建多个用户，如下所示：

| 图 12\. 用户 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f12](img/ch006.f12.png) |

创建第一个创世交易

创世区块是区块链中的第一个区块，不包含任何先前的哈希。一个名为“block-user0”的区块类被创建。取一个交易的示例，约瑟夫向拉拉转移了 2.0 个硬币。最初声明了一个全局变量，它是最后一个区块的哈希值，牢记每个区块都存储前一个区块的哈希值。在区块链的第一个区块中，前一个区块的哈希值和 Nonce 始终为 None(Dutta & Saini, 2021a)。当区块准备好进行交易时，它被哈希化，并且哈希值存储在全局变量“l_hash”中。此值将被矿工用于挖矿过程。

| 图 13\. 第一个创世交易 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f13](img/ch006.f13.png) |

创建和列出区块链

创建一个列表变量来存储整个区块链“lst_val”。可以通过创建一个名为“disp_bchain”的方法来显示整个区块链的全部内容。随着时间的推移，内容将会增加，但是考虑到一个示例，这个方法列出了区块的数量和内容。创建一个“for”循环用于迭代，并将值临时存储在变量“temp_bl”中。从“for”循环中检索所有交易，并最终显示所有交易。

| 图 14\. 创建和显示区块链 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f14](img/ch006.f14.png) |

将区块添加到链中

将区块添加到区块链中将使用 append 方法添加到列表变量“lst_val”中。创世区块现在附加在链中，并且当调用函数“disp_bchain”时，区块链内容会显示出来。

| 图 15\. 添加列表变量 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f15](img/ch006.f15.png) |

对于块类“block-user”，创建了一个实例。选择五笔交易。矿工在将其添加到区块链之前验证和确认交易。当发送者创建的哈希等于矿工使用发送者的公钥计算的哈希时，此过程为真。增加最后一笔交易的索引，以便下一个矿工可以从下一笔交易开始验证。在这个例子中，添加了五笔交易，进行了哈希化，并以难度级别 2 进行了挖掘。创建的区块被添加到区块链中，并且全局变量“l_hash”被重新初始化以供下次使用。

| 图 16。将区块添加到区块链 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f16](img/ch006.f16.png) |

矿工和挖矿

挖掘是公共区块链中的一个重要过程。矿工（Dutta＆Saini，2021b）负责验证和确认交易，并将这些交易添加到区块中。在挖矿过程中生成了用于工作证明的摘要。

| 图 17。SHA 256 哈希 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f17](img/ch006.f17.png) |

SHA 256 是一种哈希函数，可以接受任何输入并产生 256 位输出。如果数据完整性。此函数接受消息并生成十六进制摘要输出。可以开发自己的挖矿函数，例如生成以两个“1s”开头的消息的哈希。难度级别规范依赖于“1s”的数量。如果难度级别为 3，则“1s”的前缀将是三个，例如“111”，而如果难度级别为 2，则“1s”的前缀将在输入中发生任何变化时，输出也会发生变化。这也是一个单向过程，因为无法从输出生成输入。SHA 256 最适合检查两个，例如“11”。在此示例中，指定了难度级别为 2，这意味着前缀应具有两个“1s”。

| 图 18。挖矿功能 |
| --- |
| ![Figure978-1-7998-8367-8.ch006.f18](img/ch006.f18.png) |

在这里，消息和难度级别是挖矿的两个参数，难度级别大于等于“2”。变量“j”与新数字相加，并添加到消息中，摘要值发生变化。如果满足摘要值条件，则循环将结束并返回摘要值。

范围

这一章节介绍了使用 Python 代码的区块链初步概述。本章将为您提供对在区块链项目进一步开发中使用 Python 代码的基本理解。本章介绍了使用 Python 代码创建基本区块链，并将帮助您开发高级区块链项目。您可以添加各种其他功能和方法来增强区块链的安全性。使用 Python 的高级水平，您可以创建更好的挖矿算法，更好的队列管理，增强和安全的交易，共识算法，钱包和账户。本章不包括客户端界面，服务器实现，挖矿界面，奖励分配以及运行区块链项目所需的其他增强功能，超出了本章的范围。

致谢

这一章节的成功和最终结果需要许多人的指导和帮助，我非常荣幸能够得到这些帮助。我所做的一切都是由于这样的监督和帮助，我对他们非常感谢。

参考文献

来源：6Dutta＆Saini。 （2019 年）。 区块链技术在商业应用中的演变。《新兴技术和创新研究杂志》，6（9），240-244。

来源：7Dutta，S.，＆Saini，K。 （2021a）。 数据安全：对不同转换域技术的研究。WSEAS 系统和控制交易，16。 10.37394 / 23203.2021.16.8

来源：8Dutta，S.，＆Saini，K。 （2021b）。 中小企业部门混合区块链的统计评估。WSEAS 系统和控制交易，16。 10.37394 / 23203.2021.16.6

来源：1Jena，Shanmugam，Dhanaraj 和 Saini。 （2019 年）。 边缘云框架的最新进展和未来研究方向。《国际工程与先进技术杂志》，9（2）。 10.35940 / ijeat.B3090.129219

来源：2Jena，S. R.，Shanmugam，R.，Saini，K.，＆Kumar，S。 （2020 年）。 云计算工具：内部视图和分析。ICITETM2020 下的国际智能可持续计算和应用会议，382-391。

来源：4Kavita。 （2018 年）。 未来的主导技术区块链：数字转型。IEEE 国际计算，动力和通信技术会议 2018 年（GUCON 2018）。 10.1109 / GUCON.2018.8675075

来源：3Kumari，K.，＆Saini，K。 （2019 年）。 利用区块链在制药行业中进行假药检测。《国际工程研究与技术杂志》，8（12），591-594。

来源：5Saini，K.，Agarwal，V.，Varshney，A.，＆Gupta，A。 （2018 年）。 混合云服务的端到端加密以实现数据安全性：一种新方法。IEEE 国际计算，通信控制和网络会议（IEEE ICACCCN 2018）。 10.1109 / ICACCCN.2018.8748782
