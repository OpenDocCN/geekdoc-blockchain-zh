- en: © The Author(s), under exclusive license to APress Media, LLC, part of Springer
    Nature 2022D. P. BauerGetting Started with Ethereum [https://doi.org/10.1007/978-1-4842-8045-4_4](https://doi.org/10.1007/978-1-4842-8045-4_4)
  prefs: []
  type: TYPE_NORMAL
- en: 4. Unit Tests for Smart Contracts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Davi Pedro Bauer^([1](#Aff2)  )(1)Campo Bom, Rio Grande do Sul, Brazil
  prefs: []
  type: TYPE_NORMAL
- en: Unit tests are used to test code execution scenarios and ensure that they behave
    as expected. Crucially, unit tests allow you to refactor code and make new changes
    without breaking existing behaviors.
  prefs: []
  type: TYPE_NORMAL
- en: In smart contracts, unit tests are even more important, as once the contract
    is deployed, it is no longer possible to fix it unless you deploy a new contract.
    Because of this, it is of fundamental importance that you incorporate unit tests
    into all the smart contracts you write, looking for as much coverage as possible.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, you will learn how to write unit tests using Mocha as the test
    runner and Chai as the assertion library.
  prefs: []
  type: TYPE_NORMAL
- en: 'At the end of this chapter, you will be able to do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a unit test file
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Write unit tests for the smart contract
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Write test assertions
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Run the unit tests
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Check the unit test results
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing Unit Tests for ERC-20 Smart Contracts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Truffle has an automated testing framework by default, making it considerably
    easier to test your contracts. This framework allows you to create basic and manageable
    tests in a variety of ways. Let’s start coding our first unit test.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a New Unit Test File
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Open a new terminal and execute the following command:$ truffle create test
    erc20FixedSupply
  prefs: []
  type: TYPE_NORMAL
- en: Writing a Test for the Total Supply Contract
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In the file ERC20FixedSupply.js, write a new test to assert that the contract
    was created with a fixed supply of 1,000 coins.const erc20FixedSupply = artifacts.require("erc20FixedSupply");contract("erc20FixedSupply",
    function () {    it("should assert true", async function() {        let token
    = await erc20FixedSupply.deployed();        let name = await token.name();        assert.equal(name,
    'Fixed');    });    it("should return total supply of 1000", async function()
    {        const instance = await erc20FixedSupply.deployed();        const totalSupply
    = await instance.totalSupply();        assert.equal(totalSupply, 1000);    });});Test
    using the following command:$ truffle test --network development
  prefs: []
  type: TYPE_NORMAL
- en: Make sure that the test will pass.
  prefs: []
  type: TYPE_NORMAL
- en: Writing Test Assertions for the Balance Contract
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In the file ERC20FixedSupply.js, add one more test to assert that the balance
    is correct after a new transfer is made between two accounts.it("should transfer
    150 FIX", async function(){    const instance = await erc20FixedSupply.deployed();    await
    instance.transfer(account[1], 150);    const balanceAccount0 = await instance.balanceOf(accounts[0]);    const
    balanceAccount1 = await instance.balanceOf(accounts[1]);    assert.equal(balanceAccount0.toNumber(),
    850);    assert.equal(balanceAccount1.toNumber(), 150);});
  prefs: []
  type: TYPE_NORMAL
- en: Running the Unit Tests
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now, execute the test again.$ truffle test --network development
  prefs: []
  type: TYPE_NORMAL
- en: Once again, make sure that all the tests pass. If the unit test has passed,
    a green check mark will appear; otherwise, a red x symbol will appear.
  prefs: []
  type: TYPE_NORMAL
- en: Checking the Unit Test Results
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Make sure you get the same output as shown in Figure [4-1](#Fig1).![](../images/521550_1_En_4_Chapter/521550_1_En_4_Fig1_HTML.jpg)
  prefs: []
  type: TYPE_NORMAL
- en: 'A screenshot of the V S code presents the following output. Contract colon
    e r c 20 FixedSupply. check mark for: should assert true, 72 milliseconds. check
    mark for: should return total supply of 1000, 83 milliseconds. check mark for:
    should transfer 150 FIX, 494 milliseconds, 3 passing, 776 milliseconds.'
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4-1
  prefs: []
  type: TYPE_NORMAL
- en: 'VS Code: unit test results succeed'
  prefs: []
  type: TYPE_NORMAL
- en: Try to change some values like the account balance and see how the results change
    from pass to fail, as shown in Figure [4-2](#Fig2).it("should transfer 150 FIX",
    async function(){    const instance = await erc20FixedSupply.deployed();    await
    instance.transfer("account[1]", 150);    const balanceAccount0 = await instance.balanceOf(accounts[0]);    const
    balanceAccount1 = await instance.balanceOf(accounts[1]);    assert.equal(balanceAccount0.toNumber(),
    750);    assert.equal(balanceAccount1.toNumber(), 250);});![](../images/521550_1_En_4_Chapter/521550_1_En_4_Fig2_HTML.jpg)
  prefs: []
  type: TYPE_NORMAL
- en: 'A screenshot of the V S code presents the following output. Contract colon
    e r c 20 FixedSupply; checkmark for: should assert true: 51 milliseconds; checkmark
    for: should return total supply of 1000, 51 milliseconds; 1, should transfer 150
    FIX. The next section reads Events emitted during test with details and an explanation
    for them.'
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4-2
  prefs: []
  type: TYPE_NORMAL
- en: 'VS Code: unit test results failed'
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this chapter, you learned the importance of writing unit tests for smart
    contracts and wrote your first unit test.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will explore the ERC-721 token standard and how it differs
    from ERC-20\. In addition, you’ll learn to create and deploy contracts in this
    standard.
  prefs: []
  type: TYPE_NORMAL
