©作者（们），受 Springer Nature 新加坡私人有限公司独家授权，2021Z. 郑等（eds.）区块链智能[`doi.org/10.1007/978-981-16-0127-9_3`](https://doi.org/10.1007/978-981-16-0127-9_3)

# 3. 区块链交易网络的分析与挖掘

Dan Lin^(1, 2  ), Jiajing Wu^(1, 2  ), Qi Yuan^(1, 2  ) 和 Zibin Zheng^(2  )(1)中山大学数据与计算机科学学院，广州，中国(2)中山大学数字生活国家工程研究中心，广州，中国 Dan Lin 电子邮件： lind8@mail2.sysu.edu.cnJiajing Wu（通讯作者）电子邮件： wujiajing@mail.sysu.edu.cnQi Yuan 电子邮件： yuanq29@mail2.sysu.edu.cnZibin Zheng 电子邮件： zhzibin@mail.sysu.edu.cn

## 摘要

在本章中，我们介绍了区块链网络构建的概述。近年来，网络在各种领域广泛用于表示信息，图嵌入技术吸引了来自各领域的关注。以太坊是一个支持智能合约的基于区块链的平台。区块链的开放性质使得以太坊上的交易数据完全公开，也为交易网络分析带来了前所未有的机遇。我们首先通过整合交易的时序和金额特征，将以太坊交易记录建模为一种名为时间加权多图（TWMDG）的复杂网络，然后通过整合边的时序和加权信息，定义了时间加权多图嵌入问题（T-EDGE）。此外，我们还为这个大规模网络设计了几个灵活的时间游走策略，基于随机游走图表示方法，并从网络视角研究以太坊交易追踪问题和交易网络演变因素的链接预测。

## 3.1 概述

网络是一种常用于描述对象之间关系的数据形式。在过去的十年中，网络数据爆炸式增长，并被用于表示生物网络、社交网络、计算机网络和金融交易网络等各种领域的信息（Boccaletti 等人 2006）。复杂网络可以以一种优雅的方式表示现实世界中的复杂信息。越来越多地关注学术界和工业界对大规模网络的分析。随着机器学习技术的快速发展，如何有效地分析大规模复杂网络数据成为人工智能领域的一个中心议题。

在现实世界中，由于考虑到安全和利润，很少有对金融交易的分析研究，而这些交易记录通常是私有的。区块链的开放性质为我们提供了前所未有的数据挖掘机会。实际上，自从区块链技术从比特币诞生以来，加密货币与区块链就高度相关。加密货币交易网络的研究具有极高的应用价值，现在已经有包括图分析、价格预测、投资组合管理、反洗钱、非法行为检测等方面的一些研究（Chen 等人 2018a,b, 2019; Feder 等人 2018; 江等人与梁等人 2016; 梁等人 2018; Ron 和 Shamir2013）。2017 年，江等人提出了一种确定性的深度强化学习方法，用于加密货币投资组合管理，该方法将一组金融资产的历史价格输入到其交易算法中，输出一组投资组合权重。2018 年，梁等人通过构建月度交易网络，追踪了三种代表性加密货币（即比特币、以太坊和 Namecoin）的特性随时间变化，理解了其动态。

由于处理整个区块链交易网络非常耗时，找到一种有效高效的方法来分析区块链交易数据至关重要。众所周知，机器学习任务的表现很大程度上取决于数据特征的选择，因此在大规模交易网络中如何合理表示特征信息是关键问题。此外，基于机器学习的算法通常需要样本的特征信息，而交易网络的账户信息往往难以获得。图嵌入算法可用于挖掘账户的隐性特征。

对于网络分析和下游的机器学习任务，图嵌入是一种有效的表示节点特征的方法，将节点特征表示在低维空间中（Cai 等人 2018）。图嵌入算法可以有效减少交易网络的数据维度，将大规模稀疏的高维独热节点向量转换为密集的低维节点向量。因此，使用图嵌入分析区块链数据可能是一个有效的方法。

区块链交易网络上的数据分析与挖掘可以帮助我们更好地理解区块链交易模式、区块链金融市场的演变以及区块链上的非法活动等。

在这一章节中，我们将

1.  1.

    介绍网络的基本知识，包括网络的概念和网络的表达

1.  2.

    提供一种可以完全保留区块链交易信息的网络构建模型

1.  3.

    介绍使用区块链交易网络进行数据分析与挖掘的应用案例

## 3.2 网络基础知识

随着以互联网为代表的信息网络技术的快速发展，人类已经进入了复杂网络时代。人类的生产和生活越来越依赖于各种复杂网络系统的安全、可靠和有效运行。

### 3.2.1 网络概念

在自然界甚至人类社会中，大量个体之间存在各种联系，这些相互连接的个体构成了各种复杂的系统。如果用节点来表示个体，用连接的边来表示个体之间的联系，那么这些复杂系统可以通过网络来描述。例如，腾讯平台的社会网络记录了用户的同学关系、朋友关系，甚至具有相似兴趣的群组关系；计算机网络描述了通过通信介质连接的一些计算机之间的通信关系；生物体的神经系统描绘了大量神经细胞之间的相互连接和作用。这些网络是由不同个体通过各种规则连接起来的。它们在结构上有许多相似但不相同的特点，而且在功能上也有不同的特征。它们通常被统称为复杂网络。网络是描述相互作用实体复杂系统的通用语言（图 3.1）。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig1_HTML.png](img/506524_1_En_3_Fig1_HTML.png)

图 3.1

通信网络

网络有许多类型，而真实的复杂系统需要不同类型的网络来描述它们。例如，在调查科学家之间的合作关系时，至少共同发表过一篇文章的科学家将建立一个连接边。然后这样的系统可以通过最简单的无向网络来描述。无向意味着连接边没有方向性，也没有权利意味着连接边没有强度或弱度。如果你想用边来表示科学家之间的合作文章数量，那么这个系统需要一个无向加权网络来表示，边的粗细表示权重的大小，即合作频率。在另一个例子中，在食物链系统中，边代表捕食者与被捕食者之间的关系。为了用有向边表示这种关系，必须使用有向网络（图 3.2）。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig2_HTML.png](img/506524_1_En_3_Fig2_HTML.png)

图 3.2

神经网络

### 3.2.2 网络的数学表示

网络通常指的是现实系统，图是网络的数学表示。图提供了一种统一的方法，用抽象的点和线表示各种实际网络，因此成为了研究复杂网络的共同语言。但在大多数情况下，这两个术语是可以互换的。

一个具体的网络可以被抽象为一个图![](img/506524_1_En_3_Chapter_TeX_IEq3.png)。

](../images/506524_1_En_3_Chapter/506524_1_En_3_Chapter_TeX_IEq1.png), *V* 是一组顶点，*E* 是一组边，排除多重边和自连边。图中的顶点总数是![$$N\left (N = |V|\right )$$](img/506524_1_En_3_Chapter_TeX_IEq2.png)，边的数量是![$$M\left ( M = |E|\right )$$](img/506524_1_En_3_Chapter_TeX_IEq3.png)。图中有![$$N\left (N-1\right ) / 2$$](img/506524_1_En_3_Chapter_TeX_IEq4.png)顶点对，这是完整的集合*U*。

一般来说，根据图中的边是否是有向和加权的，可以有四种图类型：

1.  1.

    无权无向图。图中的边是无权且无向的。

1.  2.

    无权有向图。图中的边是无权且定向的。无权图实际上可能意味着图中的权重都是相等的。

1.  3.

    加权无向图。图中的边是加权的且无向的。无向意味着*(i, j)*和*(j, i)*表示同一条边。

1.  4.

    加权有向图。图中的边是加权的且定向的。边的定向意味着从节点*i*到节点*j*存在边*(i, j)*，但不一定存在从节点*j*到节点*i*的边*(j, i)*。

## 3.3 区块链交易网络

最近，图已被广泛用于分析各种网络，但现有的大多数图构造都忽略了边缘的时态和加权信息，这些信息在金融交易网络中可能发挥作用。基于区块链的平台以太坊的开放性为我们提供了在这个领域进行数据挖掘的机会。通过考虑交易网络的现实规则和特点，我们将以太坊交易网络建模为具有时间加权多向图（TWMDG），其中每个节点是一个独特的以太坊账户，每条边代表一个由金额加权和时间戳分配的交易。

### 3.3.1 区块链交易网络建模方法

截至目前，图形已被用于模拟和分析基于区块链系统的大量交易网络。2018 年，Chen 等人进行了首次系统研究，以特征化以太坊并使用各种指标获得新的观察结果。Alqassem 等人通过交易网络数据分析发现了比特币系统的反社交特性。在现有研究中，交易记录被建模为简单图形，在构建图形的过程中，一对地址之间的多个交易被合并为一次交易。然而，与其他大型复杂网络的边只包含单一信息不同，区块链交易网络中的每一条边代表特定的币种交易，因此包含一些独特信息，如特定交易的流向、金额价值和时间戳。

准确建模、表征和理解交易网络数据，融入上述信息至关重要。此外，预计两个用户之间会有多次交易，将交易网络建模为多图而不是简单图更为全面。在图论中，多图（与简单图相对）是指允许有自环和多重边的图（也称为平行边）。多图是一种有向多图。

将交易记录建模为简单图形的现有方法不足以表征交易网络的时间和多重特征。因此，我们将区块链交易记录建模为**时间加权多图**，并提出了新的图形抽样和表示方法，以保持区块链交易的时序和加权信息。接下来，我们将提供一个如何将区块链交易网络建模为时间加权多图的示例。选择的区块链交易系统是以太坊，这是支持智能合约的最大公共区块链平台。

### 3.3.2 通过图形建模以太坊交易网络

建模框架包括两个主要程序，如图 3.3 所示：3.3（a）数据收集。通过[`​etherscan.​io/​`](https://etherscan.io/)的 API 获取目标账户的以太坊交易记录（以太坊的区块浏览器和分析平台）；（b）网络构建。基于收集的交易数据，构建一个时间加权多图来表示账户之间的以太坊转账关系。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig3_HTML.png](img/506524_1_En_3_Fig3_HTML.png)

图 3.3

提出的用于建模以太坊交易网络的框架基于图形架构。（**a**）数据获取。（**b**）网络构建。

#### 3.3.2.1 数据收集

以太坊账户有两种类型，即外部所有者账户（EOA），这与普通银行账户（Chen 和 Zheng 2018）相似，以及智能合约账户，这些是源代码文件。以太坊账户/地址（在本文档中，“账户”和“地址”可以互换使用）由前缀“0x”，一个十六进制的常见标识符，与公钥的最右边的 20 个字节连接而成。一个例子是“0x51faeda318982f439e80012fb45d2b017ddccd-be。”通常，交易发生在由地址表示以匿名的方式之间的账户。在此工作中，我们关注 EOAs 之间的交易，因为以太币转账记录公开可查于区块链上。此外，我们只将成功且金额值非零的交易纳入我们的数据集中。由于整个以太坊交易网络中有超过两百万个 EOAs，它（Chen 等人 2018a）处理起来非常耗时，在这里我们选择目标账户，然后通过以太坊扫描的 API 获取其交易数据。如图 3.4 所示，以特定的目标账户为中心，我们获得了一个有向*K*阶子图。*K*-入和*K*-出是以太坊账户分别为中心向外和向内采样的深度参数。*K*阶抽样方法可以获取空间密集的交易数据，其相应的交易网络总是连通，并更好地保留目标节点的位置信息。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig4_HTML.png](img/506524_1_En_3_Fig4_HTML.png)

图 3.4

一个有向*K*阶子图的示意图

使用这种抽样方法，我们从以太坊中得到了不同大小的三个子图用于实验。以太坊 G1 以账户“0x51faeda318982f4-39e80012fb45d2b017ddccdbe”为中心，*K*-入=*K*-出=*K*=3；以太坊 G2 以账户“0x5e247060f48eeb64367250ed03ff5091bba 47fd1”为中心，*K*-入=*K*-出=*K*=4；以太坊 G3 与以太坊 G1 相同，中心账户为“0x51faeda318982f439e80012fb45d2b017ddccdbe”，*K*-入=*K*-出=*K*=4。数据集的总结列于表 3.1。构建子图的中心账户是随机选择的，没有特定要求。表 3.1

数据集统计。符号“#”表示“数量”的意思，“Txs”是“Transactions”的缩写。

| 数据集 | 中心节点的地址 | *K* | #账户 | 交易量 |
| --- | --- | --- | --- | --- |
| 以太坊 G1 | 0x51faeda318982f439e80012fb45d2b017ddcc | 3 | 3832 | 208927 |
| 以太坊 G2 | 0x5e247060f48eeb64367250ed03ff5091bba47fd1 | 4 | 10,628 | 208533 |
| 以太坊 G3 | 0x51faeda318982f439e80012fb45d2b017ddccdbe | 4 | 26,175 | 677785 |

在以太坊上，与以太币交易相关的各种信息以数据包的形式存储。具体来说，*TxHash* 字段是交易的唯一标识，交易中的 *Value* 字段指的是转账的金额，*Timestamp* 字段指的是交易发生的时间。此外，*From* 和 *To* 字段分别表示交易的发送者和接收者。利用收集到的四元组 *(From, To, Value, Timestamp)*，我们可以构建一个时间加权多图。

#### 3.3.2.2 网络构建

以太坊转账是发生在以太坊上的主要活动之一。这里我们将以太坊转账交易抽象为一个四元组 *(src, dst, w, t)*，意味着发送者 src 将在时间 将 *w* 以太币转给接收者 *dst*。为了研究以太坊上的以太币转账，我们将以太坊交易网络抽象为一个时间加权多图：

定义 3.1（时间加权多图（TWMDG））

给定一个图 ![$$G = \left (V, E\right )$$](img/506524_1_En_3_Chapter_TeX_IEq5.png)，让 *V* 成为顶点集合，*E* 成为边集合。每条边都是唯一的，表示为 ![$$e = \left (u, v, w, t\right )$$](img/506524_1_En_3_Chapter_TeX_IEq6.png)，其中 *u* 是源顶点，*v* 是目标顶点，*w* 是权重值，*t* 是时间戳。为了简化起见，我们定义映射函数 ![$$Src\left (e\right ) = u$$](img/506524_1_En_3_Chapter_TeX_IEq7.png)，![$$Dst\left (e\right ) = v$$](img/506524_1_En_3_Chapter_TeX_IEq8.png)，![$$W\left (e\right ) = w$$](img/506524_1_En_3_Chapter_TeX_IEq9.png)，![$$T\left (e\right ) = t$$](img/506524_1_En_3_Chapter_TeX_IEq10.png) 对于 ∀*e* ∈ *E*。

基于从以太坊交易记录中收集的四元组，我们可以建立一个 TWMDG，其中每个节点代表一个独特账户，每条边代表一个独特的以太币转账交易。

## 3.4 以太坊交易网络为基础的数据分析和挖掘

现有关于区块链交易网络分析和数据挖掘的研究可以分为两组。一组是应用复杂网络的度量和拓扑特征来分析和表征区块链交易网络。另一组是通过机器学习方法解决区块链交易数据挖掘问题。这些研究主要关注区块链系统中的所有权识别和异常检测问题。除了所有权识别和检测问题，加密货币交易的追踪也是提高区块链系统金融安全的重要方面。目前关于交易追踪的研究主要讨论如何通过研究交易记录来追踪过去的资本流动，而利用过去记录来预测未来交易的问题很少被考虑。然而，预测交易执行是研究交易追踪的另一种有效方式。在这部分，我们提出了一种基于网络嵌入的方法来研究区块链交易，并将其应用于实际的区块链数据分析。

### 3.4.1 时间加权的多元图嵌入

给定一个加权的时间多元图 ![$$G = \left (V,E\right )$$](img/506524_1_En_3_Chapter_TeX_IEq11.png), 其构建方法已在第 3.3.1 节中展示。我们定义以下的映射函数：对于 ∀*e* ∈ *E*, ![$$Src\left (e\right ) = u$$](img/506524_1_En_3_Chapter_TeX_IEq12.png), ![$$Dst\left (e\right ) = v$$](img/506524_1_En_3_Chapter_TeX_IEq13.png). 函数 ![$$W\left (e\right ) = w$$](img/506524_1_En_3_Chapter_TeX_IEq14.png) 将边映射到其权重和函数 ![$$T\left (e\right ) = t$$](img/506524_1_En_3_Chapter_TeX_IEq15.png) 将边映射到其时间戳。我们的主要目标是学习一个嵌入函数 ![$$\Phi :V\rightarrow \mathbb {R}^d$$](img/506524_1_En_3_Chapter_TeX_IEq16.png) (*d* ≪|*V* |) 以保留原始网络信息。

学习到的表示的目的包括节点相似性，以及针对金融交易网络的时间和加权属性，这可以提高下游机器学习任务的预测性能。所提出的 T-EDGE 方法可以更适当和有意义地使用包含两个主要部分的通用嵌入框架来学习动态节点表示：

1.  1.

    第一部分是有时间限制的随机游走生成器以及行走策略。

1.  2.

    第二部分是基于跳字法的更新过程，参数通过随机梯度下降算法进行更新。

#### 3.4.1.1 随机游走

对于可扩展的网络表示学习，随机游走机制已经被广泛证明是一种有效的方法来捕捉节点之间的结构关系（Perozzi 等人 2014）。考虑到时间依赖性和边的多重性，我们采用了一种时间随机游走来处理事务网络。这种随机游走序列包含了事务网络中资本流动的实际意义。在一种时间加权的多重图中，定义为从起始节点到结束节点的序列增量路径的*时间随机游走*。这样的时间随机游走被表示为一系列*l*个节点*游走* [*n*] = {*v* [1], *v* [2], …, *v* [*l*]}以及一个序列 ![$$\left (l - 1\right )$$](img/506524_1_En_3_Chapter_TeX_IEq17.png) edges *walk* [*e*] = {*e* [1], *e* [2], …, *e* [*l*−1]}, where ![$$Src\left (e_i\right )=v_i$$](img/506524_1_En_3_Chapter_TeX_IEq18.png), ![$$Dst\left (e_i\right ) = v_{i + 1}$$](img/506524_1_En_3_Chapter_TeX_IEq19.png) ![$$\left (1\leq i \leq \left (l - 1\right )\right )$$](img/506524_1_En_3_Chapter_TeX_IEq20.png), and ![$$T\left (e_i\right )\leq T\left (e_{i + 1}\right )$$](img/506524_1_En_3_Chapter_TeX_IEq21.png) ![$$\left (1\leq i \leq \left (l - 2\right )\right )$$](img/506524_1_En_3_Chapter_TeX_IEq22.png)停止在节点*v* [*i*]上。这种时间限制是专为时间随机游走设计的新颖想法。

考虑一个刚刚遍历了边*e* [*i*−1]的时间随机游走，现在在时间![$$t = T\left (e_{i - 1}\right )$$](img/506524_1_En_3_Chapter_TeX_IEq23.png). The next node *v* [*i*+1] of the random walk is decided by selecting a temporally valid edge *e* [*i*]. We define the *temporal edge neighborhood* for a node *u* as ![公式$$N_t\left (u\right ) = \{ e~|~Src\left (e\right ) = u, T\left (e\right )\geq t \} $$描述了与时间戳 u 相关的边。](img/506524_1_En_3_Chapter_TeX_IEq24.png)。令 ![公式$$\eta _-: \mathbb {R}\rightarrow \mathbb {Z}^+$$定义了一个函数。](img/506524_1_En_3_Chapter_TeX_IEq25.png) 是一个将边的时间戳映射到降序排名的函数，令 ![公式$$\eta _+:\mathbb {R}\rightarrow \mathbb {Z}^+$$定义了一个函数。](img/506524_1_En_3_Chapter_TeX_IEq26.png) 是一个将边的时间戳映射到升序排名的函数。以下是我们的行走策略，用于以太坊交易网络嵌入作为示例：

T-EDGE 在我们的时态加权多图中，T-EDGE 随机游走生成器均匀地从邻居中采样。所有在 *N* [*t*] 中的候选边都有相同的机会被选为随机游走的下一条边。概率的表达式为![公式$$\displaystyle \begin{aligned} P(e)=\frac{1}{|N_t(v_i)|}. \end{aligned} $$表示概率。](img/506524_1_En_3_Chapter_TeX_Equ1.png)(3.1)T-EDGE (TBS)TBS 指的是时间偏置采样。对于金融交易网络，账户之间的相似性是时间依赖的和动态的。自然而然，频繁交易账户之间存在很强的相关性。选择每个边 *e* \(\in\) *N* *t* 的概率可以给出为：![$$\displaystyle \begin{aligned} P(e)=P_{TBS}(e)=\frac{\eta_-(T(e))}{\sum_{e'\in N_t(v_i)}~\eta_-(T(e'))}. \end{aligned} $$](img/506524_1_En_3_Chapter_TeX_Equ2.png)(3.2)T-EDGE (WBS)WBS 指的是加权偏置采样。每个交易的权重值表示涉及两个账户之间交互的重要性。交易金额可以反映账户间交易的重要性，进而可以反映账户之间的相关程度。在大多数情况下，交易数量较多的账户之间存在很大的相似性。每个边 *e* \(\in\) *N* *t* 被选择的概率是![$$\displaystyle \begin{aligned} P(e)=P_{WBS}(e)=\frac{\eta_+(W(e))}{\sum_{e'\in N_t(v_i)} \eta_+(W(e'))}. \end{aligned} $$](img/begin{aligned} P_{TBS+WBS}(e) = P_{TBS}(e)^\alpha P_{WBS}(e)^{(1-\alpha)} , (0\leq\alpha\leq1), \end{aligned} $$

](../images/506524_1_En_3_Chapter/506524_1_En_3_Chapter_TeX_Equ4.png)(3.4)![$$\displaystyle \begin{aligned} P(e)=\frac{P_{TBS+WBS}(e)}{\sum_{e'\in N_t(v_i)} P_{TBS+WBS}(e')}, \end{aligned} $$](img/506524_1_En_3_Chapter_TeX_Equ5.png)(3.5)

对 ∀*e* \(\in\) *N* *t*. 这里 *α* \(= 0.5\) 是平衡 TBS（时间域）和 WBS（金额域）之间的默认值。

当结束到一个叶节点时，我们立即返回该路径。

请注意，对于像交易网络这样的时序有向图，T-EDGE 可以被视为深度游走的一个特定版本。如表 3.2 所示，T-EDGE 同样可能选择所有候选边（时序连续边）。T-EDGE (TBS) 和 T-EDGE (WBS) 分别表示在时间域和金额域上添加采样偏好，而 T-EDGE (TBS+WBS) 表示在时间域和金额域上都添加采样偏好。表 3.2

以太坊交易网络的四种 T-EDGE 变种

|    | 时间域 | 金额域 |
| --- | --- | --- |
| 算法 | 无偏 | 有偏 | 无偏 | 有偏 |
| --- | --- | --- | --- | --- |
| T-EDGE | *√* |    | *√* |    |
| T-EDGE (TBS) |    | *√* | *√* |    |
| T-EDGE (WBS) | *√* |    |    | *√* |
| T-EDGE (TBS+WBS) |    | *√* |    | *√* |

#### 3.4.1.2 学习过程

在上一个子节中，我们已经描述了获得与时间和权重相关的时间步序列的采样方法。本节将正式使用跳字模型来描述学习节点向量的过程（Mikolov 等 2013a,b）。

| 研究领域 | 示例 | 输入 | 输出 |

$$\displaystyle \begin{aligned} \min_{\Phi} -\Pr(\{v_{i-k}, \ldots, v_{i+k}\} \backslash v_i | \Phi(v_i)), \end{aligned} $$

](../images/506524_1_En_3_Chapter/506524_1_En_3_Chapter_TeX_Equ6.png)(3.6)表 3.3

词模型 word2vec 与图模型 Deepwalk 之间的比较

| ](../images/506524_1_En_3_Chapter/506524_1_En_3_Chapter_TeX_IEq26.png) 的计算。该概率是![ || --- | --- | --- | --- || 自然语言处理 | word2vec | 序列词（句子） | 词向量 || 图表示学习 | deepwalk | 序列节点（随机游走） | 节点向量 |其中 *k* 是窗口大小。根据跳字模型中的条件独立假设，我们有：![跳字模型的本质是一个三层神经网络模型，包括输入层、隐藏层和输出层。首先，我们基于采样行走序列训练一个神经网络模型；然而，训练的目的并不是使用该模型来预测测试集，而是使用模型学到的参数，即隐藏层参数，作为节点向量。然后，通过最大化条件概率来学习节点表示，该概率是观察到一个节点的](img/506524_1_En_3_Chapter_TeX_Equ7.png)(3.7)与 DeepWalk 类似，我们采用“分层 softmax”技术（Perozzi 等 2014）来加速 ![$$\Pr (v_j|\Phi (v_i))$$](img/506524_1_En_3_Chapter_TeX_IEq27.png). 我们首先将 |*V* | 节点分配给哈夫曼树的非叶节点，然后将 ![$$\Pr (v_j|\Phi (v_i))$$](img/506524_1_En_3_Chapter_TeX_IEq28.png) 建模为从哈夫曼树的根节点随机行走，输入节点 *v* [*i*] 并输出节点 *v* [*j*] 的概率计算。概率是![$$\displaystyle \begin{aligned} \Pr(v_j | \Phi(v_i)) = \prod_{t=1}^{\lceil \log |V| \rceil}~\Pr(b_t|\Phi(v_i)), \end{aligned} $$](img/506524_1_En_3_Chapter_TeX_Equ8.png)(3.8)其中 *b* [*t*] 来自 ![$$\{ b_0=root, b_1, \ldots , b_{\lceil \log |V| \rceil }=v_j\}$$](img/506524_1_En_3_Chapter_TeX_IEq29.png). 然后我们将 ![$$\Pr (b_t|\Phi (v_i)$$](img/506524_1_En_3_Chapter_TeX_IEq30.png) 的计算转换为 *sigmiod* 函数：![$$\displaystyle \begin{aligned} \Pr(b_t|\Phi(v_i)=\frac{1}{1+\exp(-\Phi(v_i)\cdot \Phi(b_{t-1}))}, \end{aligned} $$](img/506524_1_En_3_Chapter_TeX_Equ9.png)(3.9)

其中Φ(*b* [*t*−1])表示*b* [*t*]在 Huffman 树中的父节点。跳过模型然后使用反向传播算法和随机梯度下降更新权重。

随机游走基于的图嵌入方法已被证明是可扩展且有效的，适用于大型图。时间复杂度的时间游走部分和 SkipGram 学习过程是*O*(*r*|*V* |*L*)和![$$O(|V| \log |V|)$$](img/506524_1_En_3_Chapter_TeX_IEq31.png)，分别，其中|*V* |是节点数，*r*代表每个节点的游走数，*L*指的是随机游走的长度。

### 3.4.2 钓鱼诈骗

随着在线业务的出现，钓鱼诈骗成为了一种新型网络犯罪（刘和叶[2001]）。据报告，自 2017 年以来，以太坊超过 50%的所有网络犯罪都是钓鱼诈骗（团队[2017]）。为了评估所提出的 T-EDGE 策略的性能，我们在以太坊上进行了节点分类实验，以将标记的钓鱼节点和未标记的节点（视为非钓鱼节点）进行分类。

#### 3.4.2.1 数据获取

为了使用监督学习训练我们的节点分类模型，我们获得了由 Etherscan 标记的 445 个钓鱼节点，以及与目标节点相同数量的随机选择的未标记节点。

如第 3.3 节所示，*K*阶采样是一种有效的方法，用于获取目标账户的局部信息（林等人[2020]）。我们假设对于一个典型的以以太坊为中心的钓鱼节点的转账流，钓鱼节点的上一个节点可能是受害者，接下来的一到三个节点可能是具有洗钱行为的桥梁节点。因此，我们收集了*K*个目标节点的子图，*K*个目标节点的子图，然后将它们拼接成一个包含 86,623 个节点的的大型网络。

#### 3.4.2.2 设置

在实验中，我们将提出的 T-EDGE 算法与两种基线随机游走基于图嵌入方法进行了比较：

1.  1.

    **DeepWalk**是利用随机游走学习社交互动的潜在空间表示的先驱工作。借鉴了 word2vec 的思想，学到的表示编码了社区结构，因此可以很容易地被标准分类方法利用（Perozzi 等人[2014]）。

1.  2.

    **Node2vec**进一步探索了一种灵活的邻域采样策略，即广度优先采样（BFS）和深度优先采样（DFS），参数*p*和*q*捕捉局部和全局结构（Grover 和 Leskovec[2016]）。

为确保公平比较，我们实现了 DeepWalk 的有向版本和 node2vec，使用了 OpenNE（一个开源的网络嵌入包，[github.​com/​thunlp/​openne](https://github.com/thunlp/openne)）。对于这些基于随机游走的嵌入方法，我们设置了一些超参数：节点嵌入维度 *d* = 128，窗口大小 *k* = 4，游走长度 *l* = 10，每个节点的游走数 *r* = 4\。对于 node2vec，我们根据 Grover 和 Leskovec(2016)在 *p*, *q* ∈{0.50, 1.0, 1.5, 2.0} 上进行网格搜索。对于 DeepWalk，我们将其设置为 *p* = *q* = 1.0，因为它是对 node2vec 的一个特例。我们使用一个名为 Gensim 的 Python 库（Rehurek 和 Sojka2010）实现 Skip-gram 模型，这是一个用于快速向量空间建模的框架。

#### 3.4.2.3 指标

为确保全面理解，我们随机选择{50%，60%，70%，80%}的目标节点作为训练集，其余的目标节点作为测试集。我们使用训练集来训练一个经典的双分类器，即支持向量机（SVM），然后用它来分类测试集的样本。注意我们用五折交叉验证来训练分类器并在测试集上评估它。

对于基于监督学习框架的二分类任务，可以根据实际样本标签和分类器的预测结果分为以下四种情况。

1.  1.

    真阳性（TP）：标签为阳且被预测为阳性的样本。

1.  2.

    真阴性（TN）：标签为阳但被预测为阴性的样本。

1.  3.

    假阳性（FP）：标签为阴但被预测为阳性的样本。

1.  4.

    假阴性（FN）：标签为负且被预测为阳性的样本。

在分类任务中，微 F1（Mi-F1）和宏 F1（Ma-F1）通常用于评估分类准确性。首先我们有

1.  1.

    精度：![    $$ \frac {TP}{TP+FP}$$    ](img/506524_1_En_3_Chapter_TeX_IEq32.png)

1.  2.

    召回率：![    $$ \frac {TP}{TP+FN}$$    ](img/506524_1_En_3_Chapter_TeX_IEq33.png)

F1 分数是衡量二分类模型准确性的指标。计算公式是![$$\displaystyle \begin{aligned} 2 \times \frac{precision\times recall }{precision + recall}. \end{aligned} $$](img/506524_1_En_3_Chapter_TeX_Equ10.png)(3.10)

宏 F1 指的是计算所有类别的总*精度*和*召回率*的 F1 分数，而微 F1 指的是在计算每个类别的*精度*和*召回率*的平均值之后计算 F1 分数。

#### 3.4.2.4 结果

图 3.5 展示了微 F1（Mi-F1）和宏 F1（Ma-F1）的结果。根据图 3.5，我们得出以下观察结果：![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig5_HTML.png](img/506524_1_En_3_Fig5_HTML.png)

图 3.5

不同训练比例下的节点分类性能

1.  1.

    我们提出的 T-EDGE、T-EDGE(TBS)、T-EDGE(WBS)、T-EDGE(TBS+WBS)方法在性能上大幅超越了 DeepWalk 和 node2vec。

1.  2.

    both T-EDGE(TBS) and T-EDGE(WBS) attain better performance than T-EDGE in which the random walk generator has uniform probability.

1.  3.

    both T-EDGE(TBS) and T-EDGE(WBS) perform better than T-EDGE(TBS+ WBS) which considers both temporal and amount information with parameter *α* = 0.5.

总的来说，我们提出的方法结合了丰富的信息，有效地学习了节点表示，这确实帮助我们在分类任务中获得更好的性能。结果也表明，在交易网络中，时间依赖的遍历和边信息是必不可少的。

### 3.4.3 链接预测

链接预测问题是在给定图的基础上，根据观察到的信息预测链接的出现。在这项工作中，我们通过基于二分类的时序有向链接预测任务来评估所提出 T-EDGE 方法的表现。

#### 3.4.3.1 数据获取

为了进行链接预测，我们从以太坊获取了三个不同大小的子图用于实验。以太坊 G1 以账户“0x51faeda318982f439e 800-12fb45d2b01-7ddccdbe”为中心，*K*-in=*K*-out=3；以太坊 G2 以账户“0x5e247060f48eeb64367250ed03ff5091bba47fd1”为中心，*K*-in=*K*-out=4；以太坊 G3 与以太坊 G1 相同，以账户为中心，*K*-in=*K*-out=4。数据集的总结列于表 3.4 中。表 3.4

用于链接预测问题的数据集统计

|  | 当前网络 | 用于分类的节点对划分 |
| --- | --- | --- |
| 数据集 | &#124;*V* &#124; | &#124;*E′*&#124; | #train | #test | #test/train |
| --- | --- | --- | --- | --- | --- |
| 以太坊 G1 | 3832 | 208927 | 13658 | 1140 | 8.35% |
| 以太坊 G2 | 10628 | 208533 | 26958 | 7510 | 27.86% |
| 以太坊 G3 | 26175 | 677785 | 66102 | 11502 | 17.40% |

首先，我们根据时间戳对所有收集的边进行排序，假设较早的边*E′*（时间戳较小）为已知的链接，*V*表示参与*E′*的节点集合。当前网络*G*=(*V*, *E′*)由节点集*V*和边集*E′*组成。然后我们可以使用图嵌入方法来学习当前网络*G*的节点表示Φ(*v*)对于任意的*v*∈*V*。其次，存在于*E′*中的节点对(*src*, *dst*)作为二分类器训练集中的正样本。然后随机选择相同数量的节点对作为负样本。我们从节点*v* [*i*]到*v* [*j*]的有向链接的特征通过连接它们的节点嵌入获得，即*F* [*i*,*j*] = [Φ(*v* [*i*]), Φ(*v* [*j*])]。如果*i* = *j*, *F* [*i*,*j*] = *F* [*j*,*i*]。最后，我们训练一个支持向量分类器来分类测试集中的链接，其正样本为剩余链接（时间戳较大）。

#### 3.4.3.2 设置

在实验中，我们将提出的 T-EDGE 与两种基于随机游走的图嵌入基线方法进行了比较：DeepWalk（Perozzi 等人 2014）和 node2vec（Grover 和 Leskovec2016)。为确保比较的公平性，我们使用 OpenNE（THUNLP2017）实现了 DeepWalk 的有向版本和 node2vec，这是一个用于图嵌入的开源工具包。对于这些基于随机游走的嵌入方法，我们有几个超参数：节点嵌入维度*d*、窗口大小*k*、游走长度*l*以及每个节点的游走次数*r*。通常，我们设置*d*=128，*k*=4。具体来说，对于以太坊 G1，我们设置*r*=20，*l*=10；对于以太坊 G2，*r*=10，*l*=10；对于以太坊 G3，*r*=10，*l*=20。对于 node2vec，我们对*p*、*q*∈0.50、1.0、1.5、2.0 进行了网格搜索。对于 DeapWalk，我们将其设置为*p*=*q*=1.0，因为它是对 node2vec 的一个特例。

#### 3.4.3.3 结果

在时序有向链接预测方面，各种方法的性能通过曲线面积（AUC）和平均精度（AP）进行了比较，如表 3.5 所示。为了更清晰的解释，我们只展示了算法的两种极端采样策略：T-EDGE，不应用任何偏差，以及 T-EDGE (TBS+WBS)，它结合了时间域和数量域的偏差，默认*α*=0.5。根据表 3.5，我们得出以下观察结果：(1) 不带任何偏差的 T-EDGE 明显优于 DeepWalk 和 node2vec，这表明对于金融交易网络的分析与理解，时间信息以及 TWMDG 中边的多重特性非常重要且有意义；(2) 带有时间和数量域偏差的 TEDGE (TBS+WBS)的性能优于无偏差的 T-EDGE，这证明了时间和数量域的丰富信息确实有助于我们获得更全面的预测任务表示。表 3.5

不同方法在链接预测中的性能

|  | 以太坊 G1 | 以太坊 G2 | 以太坊 G3 |
| --- | --- | --- | --- |
| 指标(%) | AUC | AP | AUC | AP | AUC | AP |
| --- | --- | --- | --- | --- | --- | --- |
| DeepWalk | 82.71 | 76.69 | 85.91 | 82.13 | 79.92 | 77.72 |
| node2vec | 83.03 | 76.94 | 86.30 | 82.47 | 82.20 | 79.99 |
| T-EDGE | 87.73 | 83.73 | 92.85 | 90.29 | 93.00 | 90.78 |
| T-EDGE(TBS+WBS) | **89**.**55** | **85**.**58** | **93**.**36** | **90**.**94** | **93**.**83** | **91**.**89** |

为了进一步说明 T-EDGE 方法的优点，我们在 EthereumG1 上比较了节点嵌入维度*d*、步行长度*h*、每个节点的步行数*l*和窗口大小*k*变化的嵌入方法的性能。图 3.6 的结果指出：（1）无论在*k*、*l*、*r*的不同条件下，T-EDGE 带或不带额外偏差始终优于 DeepWalk 和 node2vec；（2）DeepWalk 和 node2vec 对两个超参数，步行长度*l*和每个节点的步行数*r*更敏感，而 T-EDGE 方法可以在*l*和*r*的宽范围内变化，始终取得满意的结果；（3）有趣的是，随着*d*的增加，T-EDGE 方法的性能单调提高，而 DeepWalk 和 node2vec 的性能在*d*超过 64 时随着*d*的增加而降低，这表明 T-EDGE 方法可以嵌入更多有用的信息，因此对于数据表示，需要*d*的较大值。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig6_HTML.png](img/506524_1_En_3_Fig6_HTML.png)

图 3.6

在变化超参数下的性能，当（**a**）固定*l*=10、*r*=20、*d*=128，变化*k*从 2 到 8；（**b**）固定*k*=4、*r*=20、*d*=128，变化*l*从 4 到 10；（**c**）固定*k*=4、*l*=10、*d*=128，变化*r*从 8 到 20；（**d**）固定*k*=4、*l*=10、*r*=20，变化*d*从 8 到 256

为了进一步研究 T-EDGE 方法的采样策略，我们提供了不同偏差在时间和数量领域所有可能的组合的结果。图 3.7 显示，平均而言，有偏方法 T-EDGE（TBS）、TEDGE（WBS）和 T-EDGE（TBS+WBS）优于无偏方法 T-EDGE；在时间和加权域方法 T-EDGE（TBS+WBS）中添加偏差，超越了仅添加一个偏差的方法 T-EDGE（TBS）和 T-EDGE（WBS）。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig7_HTML.png](img/506524_1_En_3_Fig7_HTML.png)

图 3.7

用于链路预测的提出 T-EDGE 不同策略组合的热图（%）

### 3.4.4 区块链上的交易追踪

区块链的出现为解决数字世界中的信任问题并提供高效的协作提供了一个理想的解决方案。众所周知，该行业对区块链作为互联网基础设施的新应用场景抱有特殊的期望。然而，近年来在区块链生态系统中也出现了各种网络犯罪。犯罪分子利用区块链的匿名性逃避监管，从事洗钱、走私和其他非法活动。例如，比特币据称参与了暗网市场上的许多非法交易，例如“丝绸之路”，隐藏了大量的毒品交易、暗杀和其他犯罪（ElBahrawy 等人 2019）。此外，对于支持智能合约功能的以太坊，已经报道了更多类型的网络犯罪，例如利用漏洞、黑客攻击、钓鱼和庞氏骗局（Chen 等人 2018b; 以太坊）。

由于区块链系统上网络犯罪的出现，*加密货币的交易追踪*已经成为一个日益紧迫的问题。过去几年见证了一系列知名项目和公司在这个领域的兴起，如 Chainalysis、以太坊和 CipherTrace。交易追踪对于监管机构、加密货币交易所和投资者来说是一个有趣且重要的问题。对于监管机构来说，交易追踪可以帮助他们识别欺诈团伙，追踪资金流向，追回被盗资金，并改进监管体系。例如，据报道，Chainalysis 帮助 FBI 识别了两名被指控从在线毒品市场运营商那里窃取比特币的代理人（O’Neill2017）。而对于加密货币交易所，交易追踪提高了他们的了解你的交易（KYT）和反洗钱（AML）的能力，从而更好地了解市场，确保遵守法律的用户的权益不受影响。此外，对于普通投资者或加密货币公司，他们可以利用交易追踪的结果来检查某些资金或交易是否与非法身份有关或通过可疑路径被污染，这防止了提现到被列入黑名单的地址。

直观地说，加密货币的巨大交易记录可以被建模为一个网络，用于分析和理解。以以太坊为例，其交易历史可以被建模为一个有向交易网络，其中节点代表一个账户，两个节点之间的边表示它们之间至少存在一次交易。在这项工作中，我们从网络的角度研究了以太坊上的交易追踪问题。

当前关于交易追踪的研究主要讨论如何通过研究交易记录来追踪过去的资本流动，而使用过去记录来预测未来交易的问题很少被考虑。然而，预测交易执行是研究交易追踪的另一有效途径。因此，在本部分中，我们提供一个研究以太坊上交易追踪预测方面的例子，并通过这种方式，也可以发现区块链交易网络演化的驱动因素。

在图 3.8 中，我们在以太坊上绘制了交易追踪、网络演变和链接预测之间的关系。关于这三个问题，以下详细讨论。

1.  1.加密货币的交易追踪包括追踪和预测两部分。追踪问题关注通过研究交易记录来了解加密货币过去如何积累和流动，而预测问题则试图弄清楚加密货币未来将流向何方。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig8_HTML.png](img/506524_1_En_3_Fig8_HTML.png)

    图 3.8

    交易追踪、网络演变和链接预测之间的关系。

1.  2.

    在网络科学领域，链接预测和网络演变密切相关：链接预测方法为相应的演变模型提供了定量技术评估，而网络演变的机制则解释了相应链接预测模型的结果。此外，链接预测和网络演变可以被看作是从微观和宏观角度分析网络随时间变化的规则，即链接预测关注预测网络中新链接的生成，而网络演变研究整个网络的整体变化趋势。

1.  3.

    链接预测旨在基于观察到的信息（现有链接作为学习预测测试集中的未来链接的训练数据）预测给定网络中链接的发生。同样，交易追踪试图通过从历史记录中挖掘和提取信息来预测未来的交易。因此，从网络角度使用链接预测技术来处理交易追踪问题是有道理的。

1.  4.

    由于加密货币交易是一种金融和社会行为（Alqassem 等人 2020），交易模式是由内在机制驱动的，交易网络应展现出一些相应的演变规则。因此，探索网络演变的规则和因素可以为设计加密货币追踪策略提供重要的洞察。

考虑到链接预测与网络演化之间的关系，我们提出了一种综合框架，采用有监督的链接预测方法对交易网络进行分析。此外，我们还探讨了金融网络中的两个重要因素，即交易时间和交易金额，如何影响以太坊交易网络的演化。特别是，我们讨论了在新的交易关系更可能出现的情况，如图 3.9 所示！../images/506524_1_En_3_Chapter/506524_1_En_3_Fig9_HTML.png

图 3.9

在以太坊交易网络中发现新的关系生成因素的草稿。情景（**a**）和（**b**）考虑交易特征（即边缘特征）。我们注意到，在情景（**a**）中，货币转移路径{*a* → *d* → *e*}中涉及的*Ether*比{*a* → *b* → *c*}要多得多。在情景（**b**）中，货币转移路径{*a* → *d* → *e*}中的交易频率比{*a* → *b* → *c*}要高。为了研究以太坊的驱动因素，我们试图回答问题：*在什么情况下更有可能生成账户*(*a*, *c*)或(*a*, *e*)*之间的新的交易*?*

以下，我们介绍了一个框架，通过基于嵌入的链接预测来研究以太坊交易网络的交易追踪问题和演化因素。首先，从网络角度将交易记录转换为时间加权的多边图，这在 Sec. 3.3 中已经说明。接下来，通过使用不同策略运行随机游走来跟踪交易路径，以获得考虑不同因素的共现统计数据，然后学习将原始图映射到嵌入空间的表示。最后，利用链接预测方法预测交易，并通过比较不同游走策略得到的结果来尝试推断网络演化的可能因素。

#### 3.4.4.1 用于调查的基于嵌入的链接预测

链接预测是一种用于全面研究演化机制的定量工具。它是基于当前网络信息（如观察到的链接和节点属性（Kumar 等人 2020））来估计节点对之间存在链接的可能性。类似相似度指数的链接预测技术在处理大规模网络时较为困难，因为对于每个未连接的节点对计算指数会花费以太坊交易网络大量时间。

网络嵌入被认为是图形挖掘领域近年来变得流行的一个维度降低技术（Cai 等人 2018）。网络嵌入，也称为网络表示学习，是保持网络节点邻域结构的有效网络表示。如 图 3.10 所示，在原始网络中相似的节点在嵌入的低维空间中应该有相似的节点向量。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig10_HTML.png](img/506524_1_En_3_Fig10_HTML.png)

Fig. 3.10

将网络嵌入到 2D 空间的玩具示例。（**a**）输入图。（**b**）嵌入空间和节点

对于可扩展网络，随机游走机制已经被广泛证明是一种有效的方法来捕捉节点之间的结构关系（Perozzi 等人 2014）。考虑不同因素的各种游走策略，通过抽样截断随机游走将原始网络转化为不同的节点序列集合。节点在其短随机游走中的出现频率及其内容反映了它们之间的接近程度。因此，通过优化过程获得的具有不同分布的节点序列导致不同的节点表示。

对于可以建模为时间加权多图的以太坊交易网络，我们提出了一种动态节点表示方法，包括两个主要部分：随机游走和优化过程，这在第 3.4.1 节中详细解释。在这里，我们为你提供一个完整的算法，以便更好地理解它。结合这两部分，时间加权多图嵌入的伪代码在算法 3.1 中给出（#FPar2）。

算法 3.1 时间加权多图嵌入![../images/506524_1_En_3_Chapter/506524_1_En_3_Figa_HTML.png](img/506524_1_En_3_Figa_HTML.png)

#### 3.4.4.2 时间链接预测的评估测量

链接预测的目的是基于观察信息预测网络中链接的出现。在传统的链接预测实验中，由于链接没有时间戳，网络的观察链接通常随机分为训练集和测试集。

对于在这里考虑的具有时间戳的时态网络链接预测问题，我们认为根据时间戳拆分训练集和测试集，并使用过去现有的链接来预测未来链接的出现更为合理。

我们将在图 3.11 中描述时间链接预测的主要步骤，并解释如下：

1.  1. 我们根据时间戳对从交易记录中收集的所有边进行排序，假设早于 50%的边为已知边，这些已知边构成了当前网络。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig11_HTML.png](img/506524_1_En_3_Fig11_HTML.png)

    Fig. 3.11

    我们工作中时间序列链接预测的主要步骤。t r a i n_p o s a n d t e s t_p o s 是训练集和测试集的正链接，而 t r a i n_n e g a n d t e s t_n e g 分别是训练集和测试集的负链接。

1.  2.

    然后我们可以通过图嵌入方法学习当前网络 Φ(*v*) 对于 ∀*v* ∈ *V* 的节点表示。对于基于随机游走的嵌入方法，我们有几个超参数：节点嵌入维度 *d*、窗口大小 *k*、游走长度 *l* 以及每个节点的游走次数 *r*。通常，我们设置 *d* = 128，*k* = 4\。具体来说，我们在 EthereumG1 上设置 *r* = 20，*l* = 10，在 EthereumG2 上设置 *r* = 10，*l* = 10，在 EthereumG3 上设置 *r* = 10，*l* = 20。

1.  3.

    对于二分类器，原始网络中时间戳较早的 50%的链接作为训练集的正样本，其余的（时间戳较晚的 50%的链接）作为测试集的正样本。此外，我们随机从训练集和测试集中抽取相同数量的节点对作为负样本，这些节点对之间没有链接。

对于链接预测实验的评估，测试集中的样本可以根据真实类别和预测类别的组合分为四个类别。

1.  1.

    真阳性（TP）：预测为正性的正数据项（存在的链接）

1.  2.

    真负例（TN）：预测为负性的负数据项（不存在的链接）

1.  3.

    假阳性（FP）：预测为正性的负数据项（不存在的链接）

1.  4.

    假阴性（FN）：预测为负性的正数据项（存在的链接）

基于这四个类别，可以导出以下两个度量指标。

1.  1.真阳性率（TPR）：![    $$\displaystyle \begin{aligned} TPR= \frac{\#TP}{\#TP+\#FN}. \end{aligned} $$    [](img/506524_1_En_3_Chapter_TeX_Equ11.png)(3.11)

1.  2.假阳性率（FPR）：![    $$\displaystyle \begin{aligned} \frac{\#FP}{\#FP+\#TN}. \end{aligned} $$    ](img/506524_1_En_3_Chapter_TeX_Equ12.png)(3.12)

此外，基于 TPR 和 FPR，我们计算曲线下面积（AUC）来评估实验性能。AUC 是在许多预测任务中常被考虑的度量指标，其值通常定义为接收者操作特征曲线（ROC）下的面积，其中水平轴为 FPR，垂直轴为 TPR。AUC 值越高，分类器越准确。

### 3.4.5 结果与分析

#### 3.4.5.1 交易时间的研究

首先我们研究时间信息如何影响以太坊交易网络的演变。考虑一个当前正在节点 *v* [*i*] 停止的随机游走，随机游走的下一个节点是通过选择节点 *v* [*i*] 的一个时间上有效的边来决定的。如前所述，这个边是从表示时间上连续边集合 *L* *t* 中使用特定的抽样偏差选出的。考虑交易时间信息，每个候选边 *e* ∈ *L* *t* 被分配一个选择概率 *P* *T*，其计算方法在不同游走策略下如下表 3.6 所示。考虑交易时间信息的四种游走策略如下解释：表 3.6

考虑不同游走策略下的抽样偏差，将边的时间戳（交易时间）考虑在内。*T* [*max*] 是当前网络的最大时间戳

| 因素 | 游走策略 | 方程式 |
| --- | --- | --- |

| 从 *WS* [4] 到 *WS* [1]，随机游走倾向于抽取时间间隔较短的连续交易。 | *WS* [1] | *P*(*e*) = ![ $$\frac {T_{max}-T(e)}{\sum _{e'\in L_t(v_i)}~(T_{max}-T(e'))}$$](img/506524_1_En_3_Chapter_TeX_IEq34.png) |

|   | *WS* [2] | *P* *T* = ![ $$\frac {\eta _-(T(e))}{\sum _{e'\in L_t(v_i)}~\eta _-(T(e'))}$$](img/506524_1_En_3_Chapter_TeX_IEq35.png) |

|   | *WS* [3] | *P* *T* = ![ $$\frac {1}{&#124;L_t(v_i)&#124;}$$](img/506524_1_En_3_Chapter_TeX_IEq36.png) |

|   | *WS* [4] | *P* *T* = ![ $$\frac {\eta _+(T(e))}{\sum _{e'\in L_t(v_i)}~\eta _+(T(e'))}$$](img/506524_1_En_3_Chapter_TeX_IEq37.png) |

1.  1.

    策略 *WS* [1]：该策略假设当前节点最早的交易（具有最小的时间戳）具有被选为随机游走下一边的最高概率。更具体地说，下一游走（即交易）的选择概率与下一游走时间戳 *T*(*e*) 和当前网络的最大时间戳 *T* [*max*] 之间的时间间隔线性相关。

1.  2.

    Strategy *WS* [2]: 与策略 *WS* [1] 类似，更早的交易具有更高的被选中概率。然而此策略采用一个降序排名函数 *η* [−] ，该函数将边的 时间戳映射到一个降序。下一游走的选择概率线性依赖于时间戳的降序排名 *η* −)。

1.  3.

    Strategy *WS* [3]: 采用此策略时，每个候选交易具有相同的被选中概率。

1.  4.

    策略 *WS* [4]：这一策略与策略 *WS* [2] 相反，当前节点的最早交易被选为随机游走的下一个边的概率最低。类比地，该策略采用一个递增排名函数 *η* [+]，将边的 timestamp 映射到递增顺序。下一个游走的选中概率与 timestamp 的递增排名 *η* +)线性相关。

不同策略的本质是调整连续边之间的时间间隔对随机游走路径的影响，同时影响图中的节点邻近度。我们可以看到，表 3.6 中的游走策略，从 *WS* [1] 到 *WS* [4]，随机游走倾向于采样具有更长时间间隔的连续交易。图 3.12 在 AUC 方面比较了不同游走策略下链接预测的性能。在所有三个交易网络中，基于策略 *WS* [1] 的算法表现最佳。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig12_HTML.png](img/506524_1_En_3_Fig12_HTML.png)

Fig. 3.12

考虑交易时间因素的不同游走策略的链接预测结果

回到加密货币交易的跟踪问题，我们可以大致推断，在以太坊交易网络中，新交易的生成与时间因素有关。图 3.9b 中的问题的答案是，在账户 *a* 和 *e* 之间更有可能生成新的交易。这表明，在路径中交易频率更高的节点对之间更有可能发生新交易。在跟踪以太坊账户之间的资金流动时，我们应该更加关注那些时间间隔较短的交易路径。

#### 3.4.5.2 交易金额的研究

接下来，我们研究了边权重信息（即交易金额值）对链接预测实验的影响。考虑交易金额，每个候选边 *e* ∈ *L* *t* 被分配一个选择概率 *P* *W*，其计算方法在不同游走策略下给出表 3.7，如下解释考虑交易时间信息的游走策略：表 3.7

不同游走策略下的抽样偏差，考虑边的权重（交易金额）

| 因素 | 游走策略 | 方程式 |
| --- | --- | --- |

| 从*WS* [7]到*WS* [5]，随机游走倾向于采样具有最大交易金额的连续交易。 | *WS* [5] | *P* *W* = ![ $$\frac {W(e)}{\sum _{e'\in L_t(v_i)} W(e')}$$](img/506524_1_En_3_Chapter_TeX_IEq38.png) |

|   | *WS* [6] | *P* *W* = ![ $$\frac {\eta _+(W(e))}{\sum _{e'\in L_t(v_i)} \eta _+(W(e'))}$$

图 3.13 |

|   | *WS* [7] | *P* *W* = ![ $$\frac {1}{&#124;L_t(v_i)&#124;}$$

图 3.13 |

1.  1.

    策略 *WS* [5]：该策略假设每个候选边的选择概率与其边权重成比例，即交易金额 *W*(*e*)。

1.  2.

    策略 *WS* [6]：在此策略下，权重较高的边被选择的概率更高，但采用了线性映射函数（即排名函数）来弱化边权重信息的影响，与策略 *WS* [5] 相比。具体来说，下一个游走的的选择概率依赖于 *η* +)。

1.  3.

    策略 *WS* [7]：在此策略下，每个候选交易具有相同的选择概率。

从策略 *WS* [5]、*WS* [6] 到 *WS* [7]，边权重的影响逐渐减弱。图 3.13 给出的结果表明，基于策略 *WS* [5] 的链接预测模型取得了最佳性能。这一结果暗示未来交易发生的可能性与交易金额成正比。在大多数情况下，交易金额越大，两个账户之间的关系越密切。我们可以回答图 3.9a 中的问题——账户 *a* 和 *e* 之间产生新交易的概率更高。由于节点 *a* 和 *e* 与共同邻居 *d* 有大量交易，它们之间的关系应该比节点 *a* 和 *c* 之间的关系强得多。在处理交易追踪问题时，我们应该更加关注那些金额较大的交易路径。![图 3.13](img/506524_1_En_3_Fig13_HTML.png)

图 3.13

考虑不同游走策略下交易金额因素的链接预测结果

#### 3.4.5.3 对两个因素的研究

此外，我们将时间和权重因素结合起来，研究它们如何影响交易演变。我们将上述从时间和加权域中得到的采样概率结合起来，通过设置选择边 *e* 的概率为：![

$$\displaystyle \begin{aligned} P(e)_{TW} = P_T(e)^\alpha P_W(e)^{(1-\alpha)}, \end{aligned} $$

图 3.13(3.13)其中 *α* 是一个从 0 到 1 变化的调节参数。这里 *α* = 0.5 是平衡时间和金额域的默认值。值得注意的是，*P* *T* 指的是使用从 *WS* [1] 到 *WS* [4] 的策略的选择概率，*P* *W* 指的是使用从 *WS* [5] 到 *WS* [7] 的策略的选择概率。最后有一个标准化操作作为![$$\displaystyle \begin{aligned} P(e)=\frac{P_{TW}(e)}{\sum_{e'\in L_t(v_i)} P_{TW}(e')}. \end{aligned} $$](img/506524_1_En_3_Chapter_TeX_Equ14.png)(3.14)我们在图 3.14 中提供了所有可能的时间策略和金额策略组合的结果，并可以观察到，从下到上，从左到右，链接预测模型倾向于获得更好的性能。此外，当考虑金额因素时，尤其是采用策略*WS* [5]（最右列），不同时间策略组合之间的差异不那么明显。![../images/506524_1_En_3_Chapter/506524_1_En_3_Fig14_HTML.png](img/506524_1_En_3_Fig14_HTML.png)

图 3.14

考虑交易时间和金额因素的链接预测结果。（**a**）*EthereumG1*。（**b**）*EthereumG2*。（**c**）*EthereumG3*

结果进一步验证了交易时间和金额因素都影响以太坊交易互动，并暗示金额因素对网络演化的影响大于时间因素。这启发我们在谈论交易追踪时要注意大额交易。

## 3.5 总结

在本章中，我们简要介绍了复杂网络，这是理解复杂系统的重要手段。我们通过网络嵌入提出了一个用于以太坊分析的新颖框架。特别是，我们构建了一个时间加权的多图以尽可能保留信息，并介绍了一种名为 T-EDGE 的图嵌入方法，该方法将金融交易网络的时间和加权信息纳入节点嵌入中。为了探究交易时间和金额的影响，我们为基于随机游走的时间网络嵌入设计了灵活的行走策略。

我们已经实现了所提出的方法和两种基线嵌入方法在实际以太坊网络上，以实现两个实际相关的预测任务，即时间链接预测和钓鱼/非钓鱼节点分类，我们首先讨论了以太坊交易追踪问题的重要性，并从网络科学的角度处理了这个问题。技术上，我们提出了一个全面的框架，通过基于网络嵌入的链接预测来探索以太坊交易网络演化的因素。实验结果证明了所提出的 T-EDGE 嵌入方法的有效性，同时表明时间加权的多图可以更全面地表示动态交易网络的时间和金融属性。
