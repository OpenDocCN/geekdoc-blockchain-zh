创建新区块的过程

创建新区块涉及以下步骤：

1\. 获取包含交易的 Merkle 树的根-

需要添加的操作数据。

2\. 创建指向那个区块头的哈希引用

将是新区块标题的前任

观点。

3\. 获取所需的难度水平。

2Okupski，Krzysztof。比特币开发者参考。工作论文。2014 年。

![](img/index-141_1.png)

140

***第 16 步｜保护数据存储***

4\. 获取当前时间。

5\. 创建一个包含数据的初步区块标题

提到的第 1 至第 4 点。

6\. 解决初步区块标题的哈希难题。

7\. 通过添加解决的随机数完成新区块

通过哈希谜题到初步标题。

图 16-1 说明了向区块链数据结构中添加新区块时需要解决的哈希谜题。它显示了区块的数据

其哈希值必须满足给定的限制或难度水平。请注意，难度水平是区块头的一部分，

因此也是区块的哈希值的一部分。这确保了没有人可以

通过任意减少哈希谜题的计算成本来绕过

难度水平。

**图 16-1\.** 添加新区块到区块链数据结构时需要解决的哈希谜题的示意图

验证规则

每个区块头必须满足以下规则：

1\. 它必须包含对先前区块的有效哈希引用。

2\. 它必须包含一个包含的 Merkle 树的有效根

交易数据。

***区块链基础***

141

3\. 它必须包含一个正确的难度水平。

4\. 其时间戳在其前一个时间戳之后

区块头。

5\. 必须包含一个随机数。

6\. 所有五个数据的哈希值组合

共同实现难度水平。

验证规则确保只有那些区块被添加到区块链

用于解决哈希谜题和计算工作的链式数据结构

成本已支付。规则 4 确保区块和交易数据是

确实按照时间进行排序。

■ **注意** 通过解决哈希难题将新区块添加到区块链数据结构中的活动也称为挖矿或区块挖矿。

为什么它有效

区块链数据结构使其数据的任何更改显眼

关于哈希引用对数据更改的脆弱性

被引用。这导致需要重写所有受影响的区块

通过操作。哈希难题导致需要为每个区块支付成本

以便在嵌入操纵的过程中重写。积累的

重新插入区块链数据结构的成本

操纵使得操作交易历史变得不那么吸引人

首先。结果，区块链数据结构变得不可变

仅添加数据存储。

操纵区块链的成本-

数据结构

让我们假设我们要试图操纵特定的交易

作为默克尔树的一部分的交易数据，其根属于一个块头

位于当前区块链数据结构的头部下面的 20 个块。

嵌入被操纵的交易数据需要以下工作：

1\. 重新编写被操纵的默克尔树

行为属于。

2. 重写根的块头到重写的

十个默克尔树所属。

142

***第 16 步 | 保护数据存储***

3. 重写到块链数据结构头部的所有后续块头

区块链数据结构。

点 2 需要解决哈希难题，因为改变默克尔

根的哈希值变化的块头，因此其解决方案

哈希难题。第 3 点需要解决 20 个哈希难题，因为连续的变化

对以前块头的哈希引用的假设下

解决一个哈希难题平均需要 10 分钟，总共需要

210 分钟来嵌入属于一个块的操纵

位于当前头部以下 20 个块的块头。这些巨大成本阻止

节点改变区块链数据结构。

在现实世界的不可变数据存储

区块链数据结构的不可变性取决于计算复杂度

哈希难题所造成的成本。哈希难题的难度决定了

计算工作量和因此需要多少时间来解决

他们，这反过来决定了区块链数据

结构。如果难度太低，改变的计算成本

区块链数据结构将会下降，可能不再被视为

过高，这反过来可能会鼓励节点操纵

交易数据的历史。另一方面，如果难度太高，甚至添加新块的计算成本也可能被视为过高，这反过来会阻止节点添加新的交易数据。

因此，在设计区块链时的一个挑战是确定适当的

哈希难题的难度水平。这一挑战更加严峻，因为计算机的计算能力由于技术进步而发生变化。因此，难度级别可能需要动态确定。

现实世界中的区块链应用很少使用恒定的难度

对所有块。相反，它们通常利用基于新增块速度的动态难度级别。3 这确保了解决哈希难题所需的时间保持在一个防止节点的水平

当实际的计算工作量增加时，操纵交易历史的成本

努力可能会增加。

3 Okupski，Krzysztof。比特币开发者参考。工作论文。2014 年；伍德，加文。

以太坊：一个安全的去中心化的广义交易分类帐。2014 年。[`gavwood.`](http://gavwood.com/paper.pdf)

[com/paper.pdf](http://gavwood.com/paper.pdf)。

***区块链基础***

143

展望

此步骤解释了区块链通过将区块链数据结构转变为不可变的只追加数据存储来防止操纵或伪造交易数据的历史记录

转变为不可变的只追加数据存储。 下一步聚焦于确保

在分布式的对等系统中使数据存储可供所有人使用。

摘要

• 区块链保护交易数据的历史记录

通过存储交易

在不可变的数据存储中存储数据。

• 通过利用的默克尔树根节点使交易的历史记录变得不可变

删掉两个想法：

• 在变更敏感的数据存储中存储交易数据

区块链数据结构，当它被改变时

需要重写数据结构，从头开始

引起改变的那个点，直到块的头部

整个链条。

• 写入需要解决一个哈希难题，

重写或添加每一个块头

区块链数据结构。

• 每个块头的哈希难题是独一无二的，因为

它取决于其独特的内容。

• 当需要重写区块链数据结构时

更改并且这样做的成本使得它不具有吸引力

操纵交易数据的历史记录。

• 每次写入都需要解决一个哈希难题，

重写或添加区块链数-

结构转变为只能追加的数据存储。

• 一个块头至少包含以下数据：

• 对其前一个块的头部的哈希引用

• 包含交易数据的默克尔树的根

• 它的哈希难题的难度

• 开始解决哈希难题的时间

• 解决哈希难题的随机数

**步骤**

17

分散

数据存储

在对等方之间

当计算机进行八卦

[第 16 步](http://dx.doi.org/10.1007/978-1-4842-2604-9_16) 将区块链数据结构转变为不可变的只追加数据存储，可用作交易数据的不可篡改分类帐。 在一个不可变的只追加的交易数据历史记录中有一个不可破坏的追加的历史记录

隔离可能对澄清基于所有权的目标的价值有限

一组充当所有权相关事件见证者的计算机。

因此，本步骤侧重于建立纯粹的分布式对等系统-

允许共享关于交易信息的系统。

隐喻

传播个人新闻给所有员工的最佳方法是什么？

如果你没有访问全球电子邮件列表，你会如何在公司内部与同事分享信息？

保证所有员工最终会收到新闻的方法

是与一两个关系密切而多嘴的同事分享，并要求

© 丹尼尔·德雷舍 2017

D·德雷舍，*区块链基础*，DOI 10.1007/978-1-4842-2604-9_17

146

***第 17 步 | 将数据存储分散在对等方之间***

他们为了保密新闻而做这些。 这种方法奏效，因为

几乎没有其他信息比如在同事间更快速交换

与在保密条件下分享的个人新闻相比要更重要。技-

这一事实的原因非常简单：人类是社会性动物，具有

对同龄人具有真正的兴趣，分享有关其他人的信息是维护或加强社会联系的一种常见行为模式。这一步

考虑到一个可能描绘点对点系统的区块链的一个方面

考虑在此步骤中讨论的一个方面：计算机之间通过通信交换信息。

目标

区块链是一个纯粹的分布式点对点系统，用于管理自己的-

一见证。它由维护自己版本的个人计算机组成

一本不可修改的分类账，存储了所有交易数据的完整历史。因此，

个体计算机相当于能够证明的见证人

一笔特定交易已经发生，根据他们自己的记忆。但是

个别计算机是如何观察或了解交易的？

首先？因此，这一步的主要目标是确保构成点对点系统的个体计算机获知交易并能够维护其自己的交易数据历史。

挑战

纯粹分布的点对点系统没有任何中心点

协调或控制。因此，没有传播任何中心组件

向构成系统的所有计算机广播信息的方法。这类系

中心信息点将是自相矛盾的。此外，

由于技术问题，信息的分发可能失败。因此，

挑战是让系统的所有节点接收所有信息

交易而不依赖于中心组件。

这个想法

想法是让组成点对点系统的计算机们分享

并以人类分享新闻的方式交流信息。如果

点对点系统的节点将信息转发给他们的对等节点，

他们又将信息转发给他们的同龄人，最终所有节点

在系统中将接收信息。

更详细的层面上，点对点系统将模仿

人类群体，如公司的员工、一群朋友或

一个俱乐部的成员彼此之间交流。简而言之

这些群体的成员从事三种不同种类的对话-

为地区目的提供服务的会话：

***区块链基础知识***

147

• 闲聊，从社交角度来看是很重要的

社交的角度，因为它使现有的关系保持活跃

但它不包含任何实质性信息。

• 新闻，包括有实质性内容的对话

信息在参与者之间进行交流。

• 引入新的同龄人，种类的对话

让新的人加入现有的朋友圈是必要的

或同事。建立新关系并接受

对任何新成员来说，都需要某种形式的入门

仪式。这是渴望成员被制作的地方

熟悉群体的历史和价值观，并

介绍给群体的杰出成员。

工作原理：概览 w1

计算机对等系统是计算机的数字等效物

人。构成对等系统的个人计算机也是如此

进行闲聊，交换新闻，并通过入门仪式接受新成员

仪式。这些互动是任何对等系统的组成部分。类似于通过口头单词相互交流的人类，分布式对等系统中的计算机也通过一种

数字网络。连接大量计算机的最大网络

是互联网。因此，构建对等系统的最廉价方法

系统的目的是让节点通过互联网相互通信。

因此，利用互联网作为媒介的分布式对等系统

通信的特点是由以下事实所决定的：

• 每台计算机通过

互联网。

• 每台计算机都有唯一的地址。

• 每台计算机可以与系统断开并重新连接

系统在任何给定时间。

• 每台计算机独立维护一个对等方列表

与组的显要成员交往。

• 节点之间的通信基于消息。

• 消息从一个节点发送到另一个节点

通过其独特的互联网地址在互联网上进行通信。

1Tanenbaum, Andrew S.，和 Maarten Van Steen. *分布式系统：原理与模式*（第 2 版）。新泽西州上塞德尔河：皮尔逊预数学厅，2007 年；Tanenbaum, Andrew S.，和 David J. Wetherall。 *计算机网络*（第 5 版）。新泽西州上塞德尔河：预数学厅，2010 年\

148

***第 17 步 | 将数据存储分配给对等节点***

节点通过网络进行通信，它们可以断开

组成员网络的交付受到影响。该

在这样的网络中传递消息具有以下特点：

• 消息不保证到达指定地址，

它们可能会丢失。

• 消息可能会到达多次。

• 消息可能以与它们被

发送。

这些特征会在通信中引起一些障碍，但它们是

以下方式解决：

• 消息以流言方式发送。每个接收到新消息的节点

接收新信息将其转发给对等方

与之通信。这反过来将处理新闻

以相同的方式操作。这确保最终每个节点

接收新闻，即使一些个别信息丢失

失去。

• 由于消息可以通过其

数字指纹或加密哈希值，节点可以

轻松识别重复项并忽略它们。

• 事务数据以及区块头部的事实

包含时间戳，允许节点对其进行排序

基于客观标准。

工作原理：细节

分布式对等组成的节点之间的通信

对等系统有以下三个目的：

• 保持现有连接保持活动

• 建立新连接

• 分发新信息

前两种通信主要集中在对等

系统本身。他们关心的是保持对等网络连接在一起

并做一些数字清理工作。但对等

系统不是为了保持忙碌而忙碌。相反，

对等系统的目的是所有权管理。

因此，第三种通信类型侧重于新交易数据和

新块添加到区块链数据结构中。此信息是

每台系统的每个节点都需要的内容，以便维护自己的版本

交易历史。

***区块链基础知识***

149

保持现有连接保持活动

网络中的每台计算机都独立维护其与之通信的对等列表

通信。此列表仅包含组成

整个系统。这类似于保持社交联系的员工

给部分同事发送，仅包括所有员工的一个子组

同一家公司。每台计算机定期验证这些

同行仍然可以使用。这是通过发送对等方一条小消息进行的

称为 ping，要求回复 pong 消息。同行

不断不回答这些消息的对等方被从列表中删除

对等方。这类似于同事之间的闲聊，主要目的是保持社会关系活跃。

建立新连接

每台计算机都可以通过发送一条相应的请求来请求加入对等系统

对组成系统的任何节点做出响应请求消息。这

请求的节点将添加询问者的地址到其对等列表中并发送

作为答复的确认。收到答复后，节点将添加地址

发送者的地址到它自己的对等节点列表中。结果，建立了一个新连接，系统增加了一个节点。只有一个连接到系统是有风险的，因为每个节点都可以终止连接，关闭

下，甚至在任何时候崩溃。因此，加入对等系统时

电脑通常建立与许多不同节点的连接

已经成为系统的一部分。这确保了与系统的连接

整体被维护，即使个别节点断开连接或关闭。

分发新信息

这种类型的通信服务于系统的应用目标

管理所有权。这是通过转发新的交易数据和

新块被添加到区块链数据结构中一种八卦类型的

信息转发。共享与所有权相关的信息发生在

以下三个场合：

• 在不断进行的情况下：新信息（例如新的交易

数据和新区块）随其产生而分发。

连接到系统的任何节点最终都

接收所有新闻。

• 作为更新：在断开连接后重新连接到系统的节点

它们在一段时间内断开连接后会接收所有的传输-

行动数据和他们在

期间。

150

***第 17 步 | 将数据存储分布在节点之间***

• 作为入职程序的一部分：新节点

与系统建立连接之前没有机会建立他们自己的

自己的交易历史，因为他们从未被

连接到系统的。因此，他们需要

获取发生的所有交易的整个历史记录

到他们加入系统的时间。传输一个副本

整个最新版本的区块链数据-

新手节点的结构确保它成为

在加入系统后成为一个成熟的节点。这种类型的

信息传递可以被看作是极端情况的

一个更新：整个交易历史的更新

在系统中发生过的所有事情。

为什么它有效

不同种类的通信确保新计算机可以加入

系统并因此为其增长做出贡献。此外，该系统是

基于建立新连接和

维护现有连接。最重要的是，该系统利用闲话

一种通信类型，最终确保对等体系统的所有成员都

对等体系统中的所有交易数据和要添加到

区块链数据结构。

展望

这一步着重于个人计算机如何成为分布式节点的过程-

分布式对等体系统和构成系统的计算机如何

互相通信。具体来说，这一步着重于各方面

在不可靠的网络中交付消息的极端情况。但是，这一讨论并没有

不考虑个别节点在加入系统后对信息的处理方式

接收到它，但处理信息和接收信息一样重要-

行。因此，下一步讨论了交易数据如何被处理

在各个节点内部进行传输。

总结

• 分布式对等体系统中的计算机通信

通过数字网络进行通信。

• 由于互联网的无处不在，它具有强大的

通过连接

个别节点通过互联网形成分布式对等体系统。

***区块链基础知识***

151

• 使用互联网作为媒介的对等体系统

通信的特点如下：

• 计算机之间通过一种

互联网上。

• 每台计算机都有一个独特的地址。

• 每台计算机都可以断开并重新连接到

任何给定时间的系统。

• 每台计算机都独立地维护着一份对等体的列表

它通信。

• 节点之间的通信是基于消息的。

• 消息从一个节点发送到另一个节点，

使用它们独特的地址在互联网上进行通信。

• 由于网络的对手，通信

那些节点之间的通信具有以下特征：

• 消息不能保证到达收件人，

但它们可能会丢失。

• 消息可能不止一次到达。

• 消息可能不会按到达的顺序到达

被发送。

• 区块链对抗通信对手

通过以下方式在不可靠的网络上传递：

• 消息采用流言蜚语的方式发送。每个与之通信的节点

接收到消息将把它转发给它的对等节点

与之交流，这将处理

以同样的方式验证消息。

• 识别交易或区块的副本

并基于它们的加密哈希进行过滤

值。

• 每个节点都可以对接收到的信息进行排序

因为交易数据和区块头部包含

时间戳。

• 进行通信的计算机通常包括

对等系统服务以下三个目的：

• 保持现有的连接活跃

• 建立新连接

• 分发新信息

152

***第十七步 | 在对等节点之间分发数据存储***

• 在

三种场合：

• 以持续的方式转发新的交易

数据和所有连接的节点添加新区块

到系统

• 作为重新连接到系统的节点的更新

在断开连接一段时间后

• 作为转移的一部分

一个最新版本的副本

区块链数据结构的副本传输给新节点以确保

他们加入后变成完全成熟的节点

系统

**步骤**

18

验证

和添加

交易

用胡萝卜和

棍

[在第 17 步](http://dx.doi.org/10.1007/978-1-4842-2604-9_17)个别计算机被转化成纯粹的分布式对等系统的节点，彼此之间交流关于交易数据

并将新的区块添加到区块链数据结构。这个步骤关注

一旦节点接收到交易数据并确保

只有有效的交易数据和区块才会被添加到区块链数据结构。

都被送给

让我们考虑一个提供简单服务的公司：给多选题打分

学校和大学的测试。学校和大学可以发送

学生的多个选择答案表和正确答案

© Daniel Drescher 2017

D. Drescher，*区块链基础*，DOI 10.1007/978-1-4842-2604-9_18

154

***第十八步 | 验证和添加交易***

公司的解决方案，反过来会为所有答案卷评分。

不幸的是，公司的员工对这种服务表现出了很少的动力

他们的工作做得很好。因此，公司将所有员工变成只接受与表现相关的补偿的承包商，受规范

按照以下三条规则：

1\. 所有要打标记的答卷，以及解决方案

所有标记的答卷都对所有承包商可用

可以随时通过公司的软件系统进行。

2\. 只有第一个标记答题纸的承包商

正确得到一美元作为奖励。

3\. 如果承包商发现另一个承包商标记错了

一个答题纸错误地，那么犯错的承包商

犯错者必须偿还赔偿金和一个

发现并纠正错误的人会收到

而不是补偿。

结果

对上述情景的规则有几个后果：

• 由于承包商只收到完整

绩效相关的补偿，他们有强大的经济

鼓励遵守规则。

• 由于规则 1，所有承包商有同样的机会

贡献工作并赚钱。

• 由于规则 1，所有承包商都有必要的信息-

控制和纠正其同事的工作。

• 由于规则 2，每个承包商都有动机去工作

快。然而，由于速度，工作质量可能会受到影响。

• 由于规则 3，每个承包商都有动机去工作

有良心地工作。

• 由于规则 3，每个承包商都有动机去控制和改

干预和纠正同事的工作。

由于这些规则，公司的效率显着提高

但几个月后，公司收到了大量投诉

客户。工作质量急剧下降。似乎所有

多项选择测验完全是随机标记的。在做一些

研究后，公司发现承包商已经达成了协议。他们

自行商定不控制任何同事的结果，而是

尽快进行标记。由于随机分配标记是

最快的方式去完成工作，所有承包商最终都会使用那个

标记策略。

***区块链基础知识***

155

从这个隐喻中学到的教训是奖励与

惩罚，同行压力和竞争可以用来管理一群

独立行动的个体只要他们不集体对抗。

这一步解释了区块链算法，它不过是一种

胡萝卜与棍子方法的巧妙实施结合

以一种类似于公司的方式工作的公证和同行压力

这个例子。但是，挑战在于把所有细节都搞对。

目标

目标是允许每个人向交易历史记录中添加新的交易数据

保留其完整性的交易数据。

挑战

区块链是完全公开的。甚至最不诚实的人都可以

连接计算机到系统，结果可以创建交易和

将它们发送给构成系统的所有其他节点。结果，它不能

可以保证通过网络发送的交易是正确的。

因此，挑战是保持系统对所有人开放，同时确保

只有有效交易才能被添加。

这个想法

为了确保只有有效交易被添加到系统中，所有

系统的节点也被允许充当其同行的监督者

并奖励他们添加有效和授权的交易，并找出

查找他人工作中的错误。因此，系统的所有节点都有

处理交易正确并监督并指出任何节点的任何错误

1 位。](index_split_002.html#155)

工作原理：构建块

区块链算法是指导

节点处理新的交易数据和区块。单个规则和程序

程序可以追溯到以下基本构建块：

• 验证规则

• 奖励

1Nakamoto，Satoshi。比特币：点对点电子现金系统。2008\. [https://](https://bitcoin.org/bitcoin.pdf)

[bitcoin.org/bitcoin.pdf](https://bitcoin.org/bitcoin.pdf)。

156

***步骤 18 | 验证并添加交易***

• 惩罚

• 竞争

• 对等控制

验证规则

区块链算法的最终目标是确保区块

链数据结构仅包含有效区块，这些区块又由有效区块组成

交易数据和有效区块头。这些数据的有效性根据两组不同的验证规则评估：

• 交易数据的验证规则

• 区块头的验证规则

交易数据的验证规则

交易数据的验证规则定义了描述交易所需的数据。这些规则包括形式上的正确性，语义上的正确性-

[步骤 9](http://dx.doi.org/10.1007/978-1-4842-2604-9_9)讨论了交易数据的验证规则。这些规则特定于区块链的应用目标。因此，用于管理数字奖励点的区块链可能具有不同的

比管理房地产所有权的区块链有更多的验证规则。

区块头的验证规则

区块头的验证规则关注形式和语义的正确性

区块头的正确性。这些规则对区块头的内容不关心

交易数据；相反，他们关心信息的方式是

添加到区块链数据结构中。[步骤 16](http://dx.doi.org/10.1007/978-1-4842-2604-9_16)讨论了区块头强制数据及其验证规则。验证区块头的核心要素是验证工作证明或哈希难题

分别。只有头部包含正确解决方案的区块

单个哈希难题进一步处理。每个头部验证失败的区块

其工作证明的验证被立即丢弃。

奖励

创建有效块的成本是能源，时间和金钱，因为它需要解

解决每个区块独特而计算昂贵的哈希难题。

哈希难题是使区块链数据结构

不变。因此，解决哈希难题绝对是必不可少的，因此

承担成本的唯一方式是

solving the hash puzzle is to offer them a reward as compensation for their

***区块链基础知识***

157

work. Hence, the blockchain-algorithm defines how nodes that submit valid

blocks are rewarded. From a more abstract point of view, one can state that

the reward is the compensation for all burdens related to achieve and main-

tain the integrity of the whole system.

Punishment

Reward is only one instrument to provide peers an incentive to validate trans-

action data and to create valid blocks. The blockchain also needs a way to

punish peers for counteracting the integrity of the system. Typical measures

of punishment are reclaiming the reward for blocks that were accepted in

the past but were identified as invalid or useless later on. Another form of

punishment is the absence of reward. Letting nodes do the proof of work but

not rewarding them because of identifying the block as duplicate, being too

old, or being useless is a punishment in its own right. This is true since the

creation of a valid block requires the solution of an hash puzzle, which in turn incurs costs. Not getting rewarded for creating a block implies that the costs

for creating it cannot be covered. Hence, not realizing a reward is a form of

punishment too.

Competition

Rewarding nodes for submitting valid blocks is a core concept of the block-

chain-algorithm, but handing out rewards costs resources. Hence, it is impor-

tant to prevent wasting resources by giving rewards to nodes that do not

contribute significantly to the maintenance of the system. The best way to

achieve a high quality of work while reducing costs is to establish a competi-

tion for rewards based on a well-defined criterion. The blockchain-algorithm

holds a continuous competition for rewards based on two criteria. The com-

petition is actually a combination of the following competitions that are held

sequentially:

• Speed competition

• Quality competition

Only the node that wins both competitions receives the reward for submit-

ting a new block. The trick of the competition is that the losers of the speed

competition are the referees in the quality competition, and they validate the

block that the winner of the speed competition submits. This ensures a strict

examination of the submitted block.

158

***第 18 步 | 验证并添加交易***

Speed Competition

The speed competition among the nodes is based on the hash puzzle. The

central element of creating a valid block is creating the proof of work, which

means solving the unique hash puzzle of the new block. Based on the nature

of cryptographic hash functions, solving the hash puzzle takes an unknown

period of time. There is no way to solve a hash puzzle in advance because the

puzzle depends on the content of the block itself. As a result, all nodes take

part in a competition for solving the hash puzzle of a new block. Once a node

submits a new block, the speed competition is over. The first node that sub-

提交一个有解的哈希谜题的新区块的节点是赢家

速度竞争，并成为唯一候选者参与质量竞争。

质量竞争

质量竞争关注的是提交的区块的正确性。

一旦节点提交了一个新区块，它就会发送到系统的所有节点。通过

收到一个新的区块，每个节点都必须充当质量裁判

请愿，意味着根据验证规则来验证新区块

交易数据和区块头。如果发现区块有效，节点

提交的新区块将获得奖励，以及新的速度竞争-

以开放剩下或已经到达的交易数据进行

同时。如果发现区块无效，它将被丢弃，速度

竞争将重新开始，所有已经到手的交易将都参与。

质量竞争具有一个有趣的对等控制方面。通过接收

一个新区块，每个节点都意识到他已经输掉了速度竞争

并且必须作为质量竞争中的裁判。它会继续

毫无疑问，这些裁判是最细致、严格的裁判

可以想象的因为他们已经输掉了速度竞争和

因此再也没有东西可以失去。其实，所有节点都知道他们可以

回来争夺奖励，只要他们能证明提交的区块无效

无效。在这种情况下，速度竞争重新开始，他们有机会

完成他们自己的区块，其完成被中断，并赢得奖励

他们自己进行比赛。因此，质量竞争或检查

提交的区块，将分别以非常高的精度完成。

对等控制

即使最好的规则也没有用，如果没有人遵守并观察它们

被遵循，并强制其遵循。不幸的是，纯粹的分布式点对点系统既没有，也不会接受中央控制点

或协调，以监督遵守规则并执行

他们的实施。因此，区块链算法使系统的所有节点

系统监督了所有其他节点。系统的节点是工作-

***区块链基础***

159

称为监督员，因为他们会验证交易

创建新区块，同时接收、审查和验证创建的区块

由其他节点执行。每个节点的工作有助于创建

新的有效区块，以及检测、拒绝或移除无效

交易数据或无效区块。

工作原理：骨架

竞争的规则确立了一个简单的两步节奏来管理

网络中每个节点的工作。在任何给定时间，所有节点

系统的节点或处于两个阶段中的任何一个：

1.评估一个由创建和提交的新区块

同伴中的一个

2。努力成为创建新区块的下一个节点

这反过来又必须由其他所有人评估

区块链算法最重要的结果之一是，它不仅

不仅确保了交易数据和区块的验证，还确保了所有

节点具有相同的工作节奏。这种相同的工作节奏是

保证所有区块保持相同的交易历史的

交易数据。但是，工作节奏不是被一个

中央时钟，因为那将与完全分布式背道而驰

系统的特性。使节拍声响的是消息的到来

在各个节点之间进行。一旦一个节点收到一个包含

新区块，它将切换到评估阶段；一旦评估

阶段结束后，节点切换回验证新的交易数据和

创建一个新的区块。

它如何工作：细节

（-   ）节点处理新交易数据的过程以及

从同伴那里收到的区块包含以下规则（规则

用粗体打印出的规则是建立两步节奏的规则）：

1\. 新的交易数据和新的区块都是

点对所有节点进行传递。

将新的交易数据收集到收件箱中

选择它们进行处理。

160

***步骤 18 | 验证和添加交易***

3\. **每个节点立即处理新的区块**

**优先级最高。**

检查每个节点的新交易数据是否有效

对它们进行授权和形式和语义上的

正确性。

每个节点只会收集有效的交易数据到一个

Merkle 树并开始创建一个新区块，通过解决它的

Hash 难题。

6\. **一旦节点完成了 Hash 难题，它就会发送**

**向所有其他节点发送新创建的区块。**

7\. 每个节点通过验证解决方案处理新区块

完成了它的 Hash 难题并验证了其包含的所有交易

对交易数据进行形式上的正确性、语义上的正确性

和授权。

每个节点将有效的区块添加到自己的

区块链数据结构中。

如果新到达的区块被识别为无效，它

将被丢弃，节点将继续进行处理

处理交易数据或完成

新区块。

如果新到达的区块被确认为有效，则

节点删除了其中包含的那些交易

从它自己的收件箱中删除新区块，并开始处理

处理交易数据并创建一个新的区块。

11\. 如果添加到区块链数据结构的区块

被识别为无效或无用，那个区块

以及所有后续区块将被从区块链数据结构中移除，并且它们的交易将

将被添加到收件箱再次处理。

12\. 如果接受了一个区块，包含的费用将转给

作为奖励。

如果从区块链数据结构中删除了一个区块，

那么添加它的奖励将从节点的奖励中扣除

最初接收到该区块的节点。

2 在后来被确认为无效的区块实际上并没有从区块链数据结构中物理上移除。相反，它们被标记为无效，并被视为已被移除。因此，所有更改都将被记录在案。

***区块链基础知识***

161

为什么它有效

之前的规则有效的原因是：

• 根据规则 1，所有节点都会收到所需的所有信息

验证和添加交易数据。

• 根据规则 2，节点处理新的交易数据

接收。

• 根据规则 3，来自其他节点的区块是被处理的

到达节点收件箱时立即处理。

• 根据规则 4，只有有效的交易数据会被添加到

区块链数据结构。

• 根据规则 5，所有节点参与解决问题的比赛

哈希难题。由于哈希难题的性质，它是

无法预测哪个节点会最先解决它。

• 根据规则 6，当节点解决问题时，所有节点都会得到通知

新区块的哈希难题。

• 根据规则 6 和 3，所有节点都会收到新创建的

区块并确定解决问题的赢家

新区块。

• 根据规则 7，系统的所有节点都会审查和验证

新创建的区块，并确保只有正确的区块

都被接受。

• 根据规则 8，所有节点将新区块添加到自己的

区块链数据结构的副本，因此增长

交易历史。

• 根据规则 9，共同维护的交易

历史记录不含无效交易，因此

保持了完整性。

• 根据规则 10，不会添加两次交易数据。

• 根据规则 11，即使

以前处理的区块已被重新处理。

• 根据规则 11，系统能够进行事后

先前处理的区块将被重新处理。

回顾。

• 根据规则 12，节点有动机处理转-

行动和快速创建新区块。

162

***第 18 步| 验证和添加交易***

• 根据规则 12，所有节点都有动机通知所有

因为赚取奖励而告知其他节点有关新区块

取决于检查和接受交易的交易

由所有其他节点。

• 根据规则 13，节点有动机工作。。

直接地，以避免接受任何无效的交易数据，或

生成无效的区块。

• 根据规则 13，节点有动机审查和

回顾和验证系统中所有节点

处理不诚实行为

区块链旨在在完全开放的对等系统中创建完整性和信任

数目和未知节点组成的对等系统

可靠性和信誉。管理所有权

对对等系统中的不诚实行为的最突出的种类是：

• 通过假冒的方式提交交易

其他

• 接受无效的交易数据或区块

• 用许多交易数据淹没一个节点

使其崩溃

• 拒绝处理某些交易数据

• 拒绝转发信息

这些不诚实行为已经被覆盖：

• 交易的安全概念（识别，

通过非对称加密进行验证，授权和授权）

和数字签名）限制对

相应私钥的拥有者

• 确保每个节点的八卦通信模型

节点最终会收到所有信息

• 确保系统的架构

即使出现个别节点

崩溃或停止处理数据

• 区块链算法

区块链对抗不诚实节点的最重要武器是

诚实大多数的力量以及奖惩的效果。即使

如果一些节点发送伪造交易或接受无效的交易数据或

无效区块，多数诚实节点及其为奖励而努力的

***区块链基础知识***

163

超越不诚实的尝试以相对不诚实的正确性

系统。显然，这种方法取决于这样一个假设，即确实存在

多数诚实节点。

展望

本步骤解释了区块链如何处理交易数据并添加

将它们包含在区块链数据结构中，从而将它们包含在官方

交易数据的官方历史。本步骤中讨论的指示

应确保系统中所有节点保持相同版本

区块链数据结构，并因此维护交易的相同历史记录

交易数据。但有时节点保留不同的历史记录，而且

意味着它们不同意交易数据的相同历史。

解决这些冲突是区块链算法的另一个任务，这

将在下一步中考虑。

摘要

• 区块链算法是一系列规则和指令

规范交易数据的方式。

处理并添加到系统中。

• 区块链算法解决的挑战是

让系统向所有人开放，同时确保

仅添加有效和授权的交易。

• 区块链算法利用胡萝卜和棍棒

方法，结合竞争和对等控制。

• 区块链算法的主要思想是允许所有

系统的节点作为他们同行的主管

并奖励他们添加有效和授权的交易

任务和查找他人工作中的错误。

• 由于区块链算法的规则，所有节点都会

系统有激励来处理交易

监督和指出任何错误

由其他同行。

• 区块链算法基于以下

概念：

• 交易数据和区块的验证规则

标头

• 提交有效区块的奖励

164

***第 18 步 | 验证和添加交易***

• 反对系统完整性的惩罚

系统的访问

• 同行之间竞争以赚取奖励

对处理速度和质量

• 对等控制

• 竞争规则建立了一个两步节奏

控制着网络中每个节点的工作。对于

在任何特定时刻，系统中的所有节点都在

两个阶段的任一个：

• 评估其他人创建的新区块

• 努力成为创建新区块的下一个节点

必须由所有其他节点评估的区块

• 工作节奏是由消息的到达来决定的。

个体节点的消息。

• 大多数诚实的节点及其追求

奖励将超出不诚实节点的努力，以

对抗系统的完整性。

**S T E P**

19

选择在公园中走的道路可以被视为一种非常基本的民主形式的结果。

交易

历史

让计算机用步伐来投票

第[18](http://dx.doi.org/10.1007/978-1-4842-2604-9_18)步解释了区块链节点如何处理交易数据和新区块。然而，由个人维护的交易历史

系统中的节点仍可能因消息传递中的延迟或错误而不同。

因此，本步骤的重点是解决系统中节点之间的冲突

由个体节点维护的交易历史的版本之间的冲突。

选取一个节点的决策由每个节点的投票来决定。

最后一次你在公园里散步是什么时候？你是否注意到

一种现象，可以在世界上大多数公园观察到吗？他们

铺设了根据景观设计师的计划和想法创建的道路

建筑师，也有游客创建的踏出的道路。通常这些

被踏出的道路是穿过草坪的直线，提供有效的捷径

两个地标之间，两个公园长椅或其他相关点。踏出

© Daniel Drescher 2017

D. Drescher，*区块链基础*，DOI 10.1007/978-1-4842-2604-9_19

166

***第 19 步 | 选择交易历史***

踏出的道路出现在许多人独立且一致地出现的地方

决定离开铺设的道路，因为这样做似乎更合适

比走铺设的道路更具吸引力。因此，泥土路

这个比喻可以在世界各地的大多数公园中观察到吗？他们

没有官方的投票或选举来规定这些道路的创建，而是每个游客都以自己独立的方式促成了道路的出现

决定走或不走某条路，并且留下他或她

地面的足迹。不经常使用的踏出的路会随着自然

回占领自己的领土，但其他道路却留下来，因为许多人继续往来

这一学习步骤解释了区块链中的一个功能

与公园中踏出的路的出现和消失类似。

目标

目标是在系统的个体节点中保持一份明确的交易数据历史。

系统中的所有节点，从而产生相同的结果，这个阶段关注解决不同版本之间的冲突

澄清所有节点，无论特定节点是否处于被联系

或请求。

这个挑战

如 S[tep 18 中解释的区块链算法](http://dx.doi.org/10.1007/978-1-4842-2604-9_18)对系统的所有节点施加了一个两步节奏。在任何特定时间点，系统的每个节点

是检查其同行创建的新区块，或者

努力成为随后创建新区块的下一个节点

必须由所有其他人进行检查。但是，没有全局时钟来统治

指定哪种工作必须在任何节点完成

某一时刻。新区块到达各个个体节点的收件箱

统治任何给定节点工作的时钟脉冲发生器。但是，

新区块到达各个个体节点的收件箱的时间高度

受网络消息传递能力的影响，这个网络有其

自身的不利因素。消息可能丢失，可能会延迟发送，或者

可能以任何顺序到达。因此，网络节点没有

在同一时间拥有相同的信息。此外，该

在相同的时间内切换两个工作阶段并不同时发生

所有节点的时间。相反，每个节点在两个工作阶段之间切换

由消息到达时间来控制其个体时间的两个工作

邮件。这导致个体节点的工作阶段重叠。

这两种影响对维护一个明确的产生巨大障碍

在网络中所有对等节点之间共享交易数据的历史。因此，通过

挑战是找到一种方法来识别一个清晰的交易历史

不向集中式解决方案回退，就要在所有消息传递不利的情况下保持数据的一致性。

***区块链基础知识***

167

这个想法

公园中的踏上的例子表明，一群人可以

在集体决策问题中达成一致意见或共识 by

独立且一致地践行自己的信仰。那种结果

投票通常称为分布式一致性，因为它是在

独立行动的个体，没有中央控制元素或

协调。

■ **注** 一致是独立个体之间达成一致的同义词。分布式一致性是纯分布式对等系统成员之间的一致。

集体或群体的独立行为

解决一个集体问题可以在以下条件下表现出来 1：

1\. 一组个体在相同的环境中操作。

2\. 存在一个集体决策问题。

3\. 这些个体独立努力实现一个相同的

目标。

4\. 执行个体行为以实现自己的目标

留下的可见标记在环境中帮助决定

集体决策问题。

5\. 这些个体使用相同的标准来评估

基于他们的改变的集体决策问题

环境。

区块链的想法是让所有节点独立投票

英尺，从而达成有关选择一个的集体协议

区块链目前所知的版本是

书的第一至第四条件已经满足：集体决策的条件。

1.所有节点在相同的环境中操作

网络的一部分，维护其个人副本的节点

区块链-数据结构，和区块链-

控制节点行为的算法。

2.决策问题是选择一个交易

组合地。

1 Hassanien，Aboul Ella 和 Eid Emary。S *warm intelligence: Principles，advances and applications*。

佛罗里达州博卡拉顿: CRC 出版社，2016 年。

168

***第 19 步|选择交易历史***

3.所有节点都努力最大化他们的个人收入

作为奖励添加新有效区块的量

区块链数据结构。

4。为了实现他们的目标，所有节点发送他们的新的

向所有同行发送块，以供检查和

接受。因此，每个节点都留下自己的个人

环境中的足迹是集体的

维护的区块链数据结构。

但是，缺少第五点：所有节点用于制定的标准

基于改变环境的决策。如何

选择交易数据历史的想法是基于新区块的添加方式

到区块链数据结构以及如何保护数据免受

操纵。由于工作证明，添加一个新块在计算上是

昂贵，尝试操纵交易历史更加

计算昂贵的。因此，集中计算量的数量

用于创建交易历史的努力似乎是一个自然的标准

用于在一个以上的情况下选择交易数据历史

存在冲突版本。如果系统的所有节点都应用相同的标准进行选择交易历史，那么系统的所有节点最终都

同意历史的相同版本。通常称为权威链或历史的集体选择版本。

它是如何工作的

选择基于计算工作量的交易历史的想法

用于创建它的花费导致以下两个标准：

• 最长链标准 2（index_split_002.html＃168）

• 最重链标准[3]（index_split_002.html＃168）

最长链标准

最长链标准基于区块链数据的想法-

结构包括最多的块代表最聚合的

计算工作量。为了研究这个标准，让我们考虑一个最初的情况，其中分布式系统的所有节点都维护并同意

2 Nakamoto，Satoshi。比特币：点对点电子现金系统。2008 年。【https://bitcoin.】（https://bitcoin.org/bitcoin.pdf）

[org/bitcoin.pdf](https://bitcoin.org/bitcoin.pdf)。

3Wood, Gavin. 以太坊：安全的分散式通用交易分类帐。2014\.

[`gavwood.com/paper.pdf;`](http://gavwood.com/paper.pdf) Okupski, Krzysztof. 比特币开发者参考资料。

工作论文。2014\.

![](img/index-169_1.png)

***区块链基础***

169

如图 19-1,中所示，这些节点都维护着相同版本的区块数据结构。

它呈现了一个省略了许多细节的区块链数据结构的图示

为了简单起见，每个方框代表一个被

一个缩短的哈希值。指向从一个方框指向另一个方框

表示将区块头链接到其前任的哈希引用。在

在这种初始情况下，所有节点都同意事务数据的一个历史，并努力扩展现有的链，并带有另一个引用为 AB12 区块的新区块

A397 作为他的前任。

**图 19-1\.** 分布式系统中的初始区块链数据结构

寻找新区块是所有节点之间的竞争，因为它需要

解决了一个新区块的哈希难题后的结果。图 19-2 shows 在一个节点解决了一个新区块的哈希难题并将其发送给其对等节点后，大多数

维护一个区块链数据结构的节点，如图 19-2

努力将其扩展成一个新区块，该区块将其引用为前任区块 AB12。

前任。从多数观点来看，只有一种版本的

区块链数据结构由三个区块组成。然而，

通过网络发送一个新区块需要时间，而且要遇到所有

对抗。由于消息传递延迟，少数

节点们还没有接收到区块 AB12。因此，它们仍然尝试扩展

图 19-1 所示的区块链。最终，它们中的一个成功地解决了区块的哈希难题，并成功传递了新区块使用哈希值 DD01 到

对等节点。最终，大多数节点都接收到了 AB12 区块和

区块 DD01\. 因此，大多数节点都维护着一个区块数据结构。

结构，如图 19-3,所示，该区块链结构由一个共同的主干上方的两个分支组成。在这种情况下，最长链准则不

不能产生明确的结果，因为两条链（AB12  A397  33FF

和 DD01  A397  33FF）拥有相同的长度。

![](img/index-170_1.png)

![](img/index-170_2.png)

170

***步骤 19 | 选择事务历史***

**图 19-2\.** 在现有区块链数据结构中添加一个新区块的结果 在 19-3 中展示的情况下，节点可自由决定扩展哪个分支。

**图 19-3\.** 在延迟交付的区块后的区块链数据结构

![](img/index-171_1.png)

***区块链基础***

171

某些节点可能努力寻找一个新区块，该区块将其引用为 AB12 区块

作为其前任，而其他节点努力找到一个引用新区块

作为其前任的或者。突然，大多数节点收到

两个新区块，BB11 和 CCC1，其都将区块 AB12 作为其

前任。这可能是由于两个节点完成了工作证明

其块几乎同时到达其结果，在合并这些

两个新的区块进入区块链数据结构是数据结构

包含三条链，如图 19-4\所示。其中一条链仅由三个区块组成，而另外两条由四个区块组成。

最长链准则明确排除了最短链，即

链 DD01  A397  33FF。然而，最长链准则并没有

产生一个明确的结果，因为有两条相同长度的链。

因此，一些节点可能会努力找到一个新区块，将其指向区块

BB11 作为其前任，而其他节点可能努力找到一个新区块

将区块 CCC1 作为其前任。

**图 19-4\.** 两个节点几乎同时完成工作证明后的区块链数据结构

![](img/index-172_1.png)

172

***第 19 步|选择交易历史***

最后，一个新的区块到达，将区块 BB11 作为前任引用，

这导致如图 19-5 的数据结构。 19-5 所示的区块链数据结构包含了许多冲突的交易历史版本，但最长链准则产生了一个明确的结果，即由区块 0101  BB11  AB12  A397  33FF 组成的链。

大多数节点和最终所有系统节点都将使用该链进行所有权相关请求的澄清。大多数节点和最终所有系统节点都将努力通过找到一个新区块，将区块 0101 作为其前任进行扩展此分支。

**图 19-5\.** 新区块到达后包含最长链的区块链数据结构的图解

一个重要的结果是，区块链数据结构实际上并不

看起来像一条直链，而更像树或柱状仙人掌，也就是说区块仙人掌。树的分支代表冲突

交易历史的版本，但基于最长链准则，

所有节点最终确定交易历史的相同版本

一致的。

■ **注意** 由于其形状，区块链数据结构通常被称为树形数据结构。区块链数据结构中的第一个也是最老的区块就是没有前任的那个，并且通常被称为树形结构的根。没有后继者的区块称为叶子。从根到叶子的连续区块序列称为路径。

***区块链基础知识***

173

最重链准则

在[第 16 步](http://dx.doi.org/10.1007/978-1-4842-2604-9_16)中，您了解到区块链应用程序很少使用恒定的难度级别来解决添加新块的哈希难题

区块链数据结构。 相反，它们通常确定难度

级别动态变化，导致各个区块在

用于将它们添加到区块链数据-的计算工作

结构。 另一方面，最长链标准基于这样的想法

包含最多区块的路径代表

大多数计算工作量。 但在难度不同的情况下

等级，最长路径不一定是代表最多

计算工作量。

对于每条路径，可以测量花在其上的计算工作量

通过为属于它的所有区块的难度级别相加来计算。可以利用块标题包含其哈希难题的难度级别的事实来计算此值。 一条路径的聚合难度级别通常被称为其权重。 图 19-6 描绘了与图 19-5 中所示的相同区块链数据结构，但这次还显示了每个块的难度级别。

最长链（从根 33FF 到叶 0101 的路径）的权重为 5，

而第二长链（从根 33FF 到叶 CCC1 的路径）有

权重为 6\. 因此，图 19-6 中所示的区块链数据结构

阐明了最长链标准将导致节点选择一条不代表最多计算工作量的链的情况。

因此，动态确定难度级别的区块链不

利用最长链标准。 相反，它们利用最重链-

标准：他们选择由最重链代表的交易数据的历史。 在所有块的难度级别相同的情况下，最长路径与最重路径相同，最长链标准和最重链标准产生相同结果。

![](img/index-174_1.png)

174

***第 19 步 | 选择交易历史***

**图 19-6**\. 具有难度级别后果的区块链数据结构的示意图选择一个链的后果

在冲突版本之间选择一个特定的链并将其建立为

权威链具有以下后果：

-   孤立区块

-   回收奖励

-   澄清所有权

-   重新处理交易

-   一个共同的增长树干

-   最终一致性

-   对操纵的鲁棒性

孤立区块

区块链数据结构的集体增长看起来像一棵树

其分支代表交易的不同冲突版本

历史。 应用选择标准实际上意味着选择一条路径

那棵树，并将其确立为历史的权威版本

交易数据。树形数据结构中的所有区块均不是

来源节点弃用并称为

***区块链基础知识***

175

孤儿块。4 F 例如，在将最长链标准应用到图 19-4 所描述的情况时，区块 DD01 是孤儿区块，而在图 19-5 中，区块 DD01 和 CCC1 不是最长链的一部分，并被弃用。在将最重链标准应用到情况

图 19-6 中所描述的图中，区块 0101、BB11 和 DD01 并不是权威链的一部分，因此被弃用。

收回的奖励

为了澄清所有权，孤儿块是无用的，因为它们

不对权威链作出贡献。因此，给予的奖励

创建和提交它们的节点将会被收回。这是由规则 11

和区块链算法中的规则 13，如[18](http://dx.doi.org/10.1007/978-1-4842-2604-9_18)中所解释的，规定一旦区块被确认为无效或无用，该区块及其后续区块将从区块链数据结构中逻辑上被移除，并且创建和提交这些区块的节点的奖励也将被收回。

为添加而给出的奖励也将被从最初接收到它的节点中撤回。

澄清所有权

只有那些是权威链的一部分的交易才被认为是

用于澄清与所有权相关的请求。孤儿

区块不是被共同选定的链的一部分。因此，它们的交易数据不是交易数据的历史。它们被

被视为从未发生过，并且被视为不存在

当涉及澄清与所有权相关的请求时。

重新处理交易

孤儿区块中的交易数据最初是被提交

目的是将它们添加到交易历史记录中。它们是孤儿块而不是

被视为从未发生过，这并不是事先计划好的，而是

工作证明的随机性及其在增长区块链数据结构中的作用。不幸地，交易数据可能最终进入了孤儿

区块有机会成为选定交易的一部分

通过将它们重新放入节点的收件箱中来重新处理和

后来被添加到区块链数据结构中。这是由区块链算法中的规则 11 所导致的

区块链算法如 S[tep 18\.](http://dx.doi.org/10.1007/978-1-4842-2604-9_18)所解释的那样，一旦曾经是权威链的交易可能会暂时消失

大多数节点都会放弃它们所属的区块，但它们会

一旦它们被重新处理，它们将再次出现

4Okupski, Krzysztof. 比特币开发者参考. 工作论文. 2014\.

176

***第 19 步 | 选择交易历史***

一个不断增长的共同主干

应用选择标准并不总是产生明确的结果。

例如，在图 19-3 和图 19-中描绘的情况下

4, 存在多个最长链。在这些情况下，区块链数据结构具有两条等长的路径，这些路径起源于一个共同的主干。

图 19-3 中，共同主干仅由两个区块组成，形成了一个短链 A397  33FF。在图 19-4 中，共同主干已经由三个区块组成，形成了链 AB12  A397  33FF，包括了

先前情况的共同主干。因此，即使有一个选择标准

产生了模糊的结果，交易历史的冲突版本

起源于一个不那么模糊的共同主干。区块链越深

你看，决定区块是否属于

最长的链。

最终一致性

让我们考虑图 19-4,中描绘的情况，最长链的标准没有产生明确的结果。如图 19-5 所示，被添加到区块链数据结构中的下一个区块决定了

区块 BB11 或 CCC1 将成为最长链的一部分，或被抛弃

反而。但是谁决定下一个添加到区块链的区块-

数据结构中描绘的图 19-4 r 指的是区块 BB11 作为其前身，因此放弃区块 CCC1？令人惊讶，也许令人失望的

答案是纯随机的。在图 19-4,中所示的情况下，节点可以自由决定延伸哪个分支。因此，一些节点

可能会努力寻找引用区块 BB11 作为其前身的新区块，

而其他节点可能会努力寻找引用区块 CCC1

作为其前身。它们中的哪一个完成新区块取决于

哈希难题的解决，需要有限但随机的时间长度。

首先解决新区块的哈希难题的节点决定扩展哪一个

冲突的分支得到延伸，哪些区块被抛弃。因此，

树状区块链数据结构的增长展示了随机

由于解决哈希难题的速度竞赛和随机

通过网络传递消息的波动。下一个区块，它的

出现的时间由解决它的随机持续时间

哈希难题，决定哪条路径将被延伸，哪个区块

将被抛弃。

正如前面所讨论的，树状区块链的冲突分支-

区块链数据结构共享一个不断增长的共同主干，而不受

被放弃的区块或叶子。因此，位于或接近

***区块链基础知识***

177

权威链顶部最受随机性影响

新区块到达时，而区块深入到区块链中的路径-

数据结构受影响较小。因此，可以说：权威链的位置越*深*：

• *越过去越远*

• *过去的时间*越久

区块链数据结构

• *越花费了共同的努力*

后续区块

• *它受到的随机变化越少*

属于最长链的节点

• *越不太可能*被放弃

• 它越*被接受*系统节点

• 它越*锚定*在节点的共同历史上

确定块是否包含在权威性之内的事实

链增加随着时间的推移和更多区块的添加最终被称为

*最终一致性*。

抵抗操纵的鲁棒性

代表树状区块链数据结构的路径

大部分计算工作是交易的权威版本

历史。建立和维护权威路径只是一个问题

控制整个系统大部分计算能力的事实。

建立一个新的具有权威性的路径，从内部区块开始

区块链数据结构需要赶上并超过

大多数。这一事实是系统鲁棒性的基础

区块链。

只要诚实节点拥有大多数计算资源的资源

整个系统，由它们维护的路径将增长最快，并超过任何

竞争路径。为了操纵内部区块，攻击者将

必须重新做该区块的工作证明，随后重新做哈希值

拼图后的所有区块，然后赶上并超过路径

由诚实的节点维护 2\. 然而，通过赶上和超越由大多数维护的路径建立新路径是不可能的

任何攻击者控制的计算能力少于多数。因此，

178

***步骤 19 | 选择交易历史***

任何试图建立包含欺诈性的新权威路径的尝试

交易将被超越，因此被路径所抛弃

由诚实的大多数节点维护。因此，交易历史

由系统维护是抵御操纵的

投票方案的威胁

任何集体决策程序都将成为操纵的目标

如果它似乎值得影响整个过程的结果。

区块链及其分布式共识算法也不例外。

关于区块链共识算法的讨论很多

可以被操纵。不管这些操纵看起来有多么多元，都

他们只有一个目标：将属于权威链的区块转变为孤立区块，并建立一个代表

交易数据的历史以及所有权的替代分布

攻击者更有利的权利。

然而，可以从各种观点讨论这些操纵。

从经济上讲，这些操纵尝试改变所有权的分配

通过更改交易数据的集体历史来获得更多权利。关于

共同决策，这些操纵试图聚集多数

投票权力，以实现所需的结果。从技术角度上看

观点，任何试图操纵集体决策过程的尝试旨在

以破坏系统的完整性。关于分布式性质

系统，这些操纵试图至少暂时建立一个隐藏的中心要素，改变系统的状态。因此，这些攻击通常被称为 51% 攻击。

■ **注意** 51% 攻击是试图收集或控制整体表决权的尝试在集体决策过程中。

哈希难题的作用

在[16](http://dx.doi.org/10.1007/978-1-4842-2604-9_16)步中，你学会了如何使区块链数据结构不可变。

因此，从纯技术角度看，哈希难题只是一种实现使区块链数据结构不可变的手段。然而，在你

考虑使用区块链数据结构，另一方面是

哈希难题是看了。在达成关于达成集体协议的过程中

交易历史，构成区块链的个体块-

数据结构可以被视为一个选票，而哈希难题可以被视为

被视为使提交选票成本高昂，因此阻止了

不诚实，参与投票。

***区块链基础知识***

179

任何试图操纵

区块链旨在收集大多数投票权。由于事实

区块链通过哈希绑定投票权力到计算能力

难题，任何试图聚集大多数投票权实际上意味着

引导整个对等计算力的大部分

系统中只有一个微小的声音。区块链达成一致性和可信度的方式

集体协议依赖于这样一个假设，即没有单个人或实体

可以获取或收集多数已累积的计算能力

整个对等系统。

为什么它奏效

共同构建区块链数据结构有点像参与连续的投票方案。每个单个节点在

关于哪个交易历史应该被选择的进行中的投票，但所有节点

共同形成一个强大的群体，始终选择自己的历史。

这个原因是因为参与正在进行的投票方案既不是

无需成本，也不是不通融。参与投票需要工作

解决哈希难题，并通过提交投票或新区块，

一个节点为了获得奖励而承诺。由于所有节点

独立地使用相同的标准选择交易历史，最终所有节点达成一致意见。

展望

本步骤着重于纯粹的分布式对等节点的方式

系统达成一致意见，关于共同维护的历史

交易数据的重要性，并强调哈希难题

达成共识并保持完整性。接下来的步骤讨论了

奖励的重要性以及用于补偿的支付工具

为了增强系统的完整性，对等方

总结

• 在网络中发送新的区块或两个之间的延迟

几乎同时创建新区块的节点导致

区块链数据结构形成

树或柱状仙人掌，由分支产生

代表冲突版本的共同主干

交易历史。

• 选择交易历史的相同版本是

集体决策问题。

180

***第 19 步|选择交易历史***

• 分布式共识是对在纯粹的分布式对等系统中的成员达成的一致意见

纯粹的分布式对等系统的成员

集体决策问题。

• 区块链的共同决策问题

具有以下特点：

• 所有节点在相同的环境中运行，

由网络组成，节点保持自己的

区块链数据结构的各个副本，

和管理

节点行为的鲁棒性。

• 决策问题是选择相同的

在所有节点上跨越交易历史。

• 所有节点都努力最大化他们的个人收入

作为奖励，为新添加的有效区块

区块链数据结构。

• 为了实现他们的目标，所有节点发送他们的新

区块发送给所有同行进行检查和

被接受。因此，每个节点都留下了自己的个人

环境中的足迹，即共同

维护的区块链数据结构

• 所有节点使用相同的标准选择

交易数据历史。

• 最长链标准表明每个节点

独立选择了树状路径

最多的区块。

• 最重链标准表明每个节点

独立选择了树状路径

具有最高聚合

难度。

• 选择树状区块数据的路径之一 -

结构具有以下后果：

• 孤立区块

• 收回的奖励

• 澄清所有权

• 交易的再处理

• 不断增长的共同主干

***区块链基础知识***

181

• 最终一致性

• 对操纵的鲁棒性

• 区块所在的权威链越深：

•添加到区块链中，过去的时间越长

•自加入区块链后过去的时间越长

区块链数据结构

•花在添加上的共同努力越多

后续区块

•不太容易受到随机变化的影响

属于最长链的区块

•越不可能被放弃

•被系统节点接受的越多

•它在共同历史中锚定的越久

节点

• 确定区块包含的事实

随着时间的推移，权威链中

随着最终

一致性。

• 51% 攻击是试图收集或控制

整体选举权力中的绝大多数

以目的改变区块

是权威链的一部分，变成孤儿区块

并建立包含

更有利的交易历史

攻击者的观点。

• 51% 攻击具有以下特征：

•经济上：改变所有权的分配

改变共同历史的集体历史

交易数据。

•决策：汇集多数选票

权力，以强制实现期望的结果。

•技术上：破坏系统的完整性。

• 结构上：至少暂时确立

改变状态的隐藏中心要素

系统。

**S T E P**

20

支付

完整性

完全不是重要的，也不能建立信任

无需成本

讨论了区块链如何处理新的交易数据和

系统节点如何达成关于真实历史的协议

交易的重要性。解决哈希

谜题在实现和维护系统完整性中起着重要作用。但解决哈希谜题需要计算资源，并且，作为

结果，这是需要成本的。因此，有必要补偿

为此，对维护系统完整性有所贡献的节点。然而，

在讨论过程中，一直假设节点是相互补偿的。

以某种方式满足，而不询问所使用的支付工具。

因此，这一步骤专注于节点如何获得补偿

对系统完整性的贡献。

隐喻

假设你是一家面包店的老板。有一天，你想出了

如何改善你的生意。你意识到钱是

稀缺的，但你的面包店总是有面包出售，大多数

© Daniel Drescher 2017

D. Drescher，*区块链基础*，DOI 10.1007/978-1-4842-2604-9_20

184

***第二十章 | 为完整付费***

大多数工作日面包都会有相当数量剩下。因此，

你决定用面包支付员工，而不是给他们付钱。

这样可以达到两个目的：省钱并避免扔掉

将剩余的面包统统带走。你的员工对这个想法并不感到兴奋，但

你认为这个人为哪家公司或机构工作？事实证明他在

这个补偿计划：汽车制造商以车辆为员工支付

车辆，建筑公司以房子支付他们的员工，等等。

有一天你的朋友们在抱怨他们的不切实际的补偿，

除了一个人仍然拿钱支付。哪家公司

• 系统哲学的影响

为一个中央银行，这个中央银行恰好是货币的生产者！

这个例子玩弄着我们通过

履行我们的工作和我们作为补偿获得的商品。这个步骤生产。

在区块链中保持完整性。这是因为系统的节点

很快其他公司效仿你，最终所有公司开始应用

变得更像一家用银行票据支付员工的中央银行

它生产。但在我讨论这个特殊情况之前，让我们更详细地回顾一下区块链中费用的作用和补偿的重要性。

区块链中的费用的作用

[第 18 步](http://dx.doi.org/10.1007/978-1-4842-2604-9_18)强调了区块链利用胡萝卜和大棒的手段来让组成系统的节点相互控制。竞争

的两个力量。

系统有序验证交易和选择最大集体努力的交易历史。奖励和惩罚

系统。但我们怎么知道这些节点确实获得了有价值的

• 系统完整性的影响

• 系统开放性的影响

• 系统分布性的影响

185

基于交易费用和工作证明的奖励。1 T](index_split_002.html#183)这种效应在所有区块链应用中都是普遍的，无论其具体应用目标如何。然而，在所有区块链应用中，用于补偿系统维护者的具体支付工具的选择并不相同。定义和使用将给节点验证和添加新区块到区块链的同行获得的支付工具被认为是建立区块链应用的重大挑战之一。因此，支付工具选择的以下后果必须被考虑：

[bitcoin.org/bitcoin.pdf](https://bitcoin.org/bitcoin.pdf).

***区块链基础***

1Nakamoto, Satoshi. 比特币：点对点电子现金系统. 2008\. [https://](https://bitcoin.org/bitcoin.pdf)

系统完整性的影响

在某些条件下，区块链可能变得值得

奖励和惩罚的力量是实现

作为奖励和惩罚的威胁是保持节点

对他们的工作而言？这就是重点。 

系统的节点接受的是守护系统完整性的

对于哪种支付工具来说是有价值和值得的

做维护系统的工作？ 如果这个支付工具有问题会发生什么

支付即将失去其价值或不值得信任？ 我们能期望

维护区块链的同行将继续这样做

用一个不可信、无价值的支付工具补偿同行？

不，我们不能。 对于用于补偿的支付工具的信任缺乏

的同行污染整个系统。 因此， 

用于补偿系统支持者的支付工具

直接影响区块链本身的可信度。

对系统开放性的影响

区块链应该是一个开放的点对点系统。 每个人都可以

连接他的计算机到系统，并为贡献

有损于维护其完整性的行为。 但是，如果使用的支付工具有瑕疵

用于补偿同行的支付工具并不像区块链本身一样开放吗？

如果补偿是通过使用一种支付工具完成的，而这种支付工具是

仅在特定国家可用或被接受，或受资本流动限制吗

限制？ 在这种情况下，支付工具抵消了

技术的开放性通过引入经济约束来对抗。

对系统分布性的影响

区块链是一个纯粹的分布式点对点系统，没有任何元素

控制或协调。 但是，如果使用的工具有瑕疵会发生什么

用于补偿同行的支付工具受到一个中心的控制和监管

机构？ 这意味着允许中心性通过

后门。 它将抵消系统的分布特性。

对系统哲学的影响

前面的讨论揭示了支付工具的性质

用于补偿同行的支付工具具有

抵消区块链的主要方面。 这引发了一个有趣的问题：

基本问题：一个完全分布式的点对点系统如何

被认为是可信的吗

186

***第二十章  |  为完整性付费***

使用用于补偿其同行的支付工具来抵消

主要价值？ 每个声称完全开放和纯粹的区块链

分布式必须找到一个令人满意的答案

支付工具的理想属性

补偿同行

为了尽量不干涉系统的目标和价值观

区块链，用于补偿同行的支付工具

应该：

• 以数字形式提供；否则不能包含

在区块链中。

• 在真实世界中被接受作为支付工具；

世界；否则同行无法用他们来自

支持系统的同行用来支付他们在现实世界中的账单。

• 被所有国家接受为支付工具；

否则支持系统会变得不具吸引力

只有那些不接受它的国家中的同行

作为一种支付工具。

• 不受资本流动限制；

否则其对同行的转移受到限制。

• 有稳定的价值；否则同行会面临经济

购买力的风险。

• 可信赖；否则会削弱

区块链来建立信任。

• 不受单一中央机构的控制

或国家；否则会导致严重冲突

区块链的分布性质。

此属性列表读起来像是完美世界货币的愿望清单。

因此，毫无疑问，没有一种现有的法定货币符合这些期望的属性。

密码出现的一次绕道

货币

前一节列出了支付工具的期望属性

用于补偿区块链同行。发现没有一种现存

使用法定货币来满足这些属性略显沮丧，因为它们

***区块链基础***

187

本身就具有吸引力。具有这些属性的货币或支付工具

这些属性不仅在补偿情况下有用，还在许多其他场合有用

解决这个问题。很多人已经考虑过了。最早也是最重要的区块链应用就是为了

一种新型数字货币，反过来又用于补偿同行

用于验证和添加新的区块到区块链数据结构的系统

它的应用目标联系在一起，管理

新型货币的所有权，需要具有可信赖性

用于补偿其贡献者的支付工具。我正在说的是

比特币。比特币系统不仅管理新数字货币的所有权

纯分布式点对点系统中的货币，同时也对其

为了贡献系统的完整性而向同行提供货币。由于

区块链严重依赖密码学，所以这种新型货币也是

称为加密货币或加密货币简而言之。一般来说，

你可以说比特币和许多其他加密货币就像

用他们所生产的面包支付员工的面包店，与传统的

他们所生产的面包实际上是一种新的数字货币的区别

展望

这一步凸显了用于付款的工具的重要性

补偿区块链的同行。这一步是一系列

着重讲解了区块链的基本原理这一步骤。

下一步将把所有要点汇总起来，并总结你所学到的东西

在之前的学习步骤中学到的。

摘要

• 区块链利用费用来补偿其同行

用于贡献系统完整性的。

• 用于补偿同行的支付工具

对区块链的主要方面产生影响，例如：

• 完整性

• 开放性

• 分布式性质

• 该系统的哲学

188

***第二十章 | 为完整性付费***

• 作为支付工具的可取特性

补偿对等体是：

• 以数字形式存在

• 在现实世界中被接受

• 在所有国家被接受

• 不受资本流动的影响

限制

• 值得信赖的

• 不受单一中心控制

组织或国家

• 加密货币是独立的数字货币

其所有权由使用它的区块链管理

作为一个支付工具来补偿其对等方

用于维护系统完整性的方式。

**步骤**

21

将

聚合各部分

不仅仅是其各部分的总和

这一步是本书迈向理解区块链的知识之旅的顶峰。与第[9](http://dx.doi.org/10.1007/978-1-4842-2604-9_9)步至[20](http://dx.doi.org/10.1007/978-1-4842-2604-9_20)步探索区块链各个独立概念不同，这一步是将所有这些部分聚合起来。因此，你不仅会理解区块链作为一个整体

但也要看到这些不同概念如何共同起作用。这一学习步骤

从审查区块链的主要概念和技术开始

并进一步解释区块链基于

前面几个步骤获得的技术知识。最后，这一步提供了

对区块链技术套件的定义进行审查，其中包括

因此，将区块链向广泛的应用领域敞

审查概念和技术

这一对理解区块链的知识之旅始于

在[8](http://dx.doi.org/10.1007/978-1-4842-2604-9_8)步，我们规划了一个用于管理所有权的纯分布式点对点系统的设计。表 21-1 presents 这些任务，它们的目标，相应的步骤以及区块链的相应概念。

© Daniel Drescher 2017

D. Drescher, *区块链基础*, DOI 10.1007/978-1-4842-2604-9_21

190

***第 21 步 | 集成各部分***

**表 21-1\.** 设计用于管理所有权的分布式点对点系统的任务审查

**任务编号**

**目标**

**步骤编号**

**主要概念**

1

描述所有权

9

交易数据的历史

2

保护所有权

10–13

数字签名

3

存储交易数据

10, 11, 14, 15

区块链数据结构

4

为准备分类帐

16

不变性

去分发

5

分发分类帐

17

信息转发中

网络

6

添加新的交易

18

区块链算法

7

决定哪个分类帐

19

分布式共识

代表真相

了解构成区块链的这些主要概念和技术非常重要。

区块链依赖于其他概念和技术。了解区块链的主要概念和技术

链至少需要欣赏这些概念。为此

原因，表 21-2 总结了更详细地解区块链的构成技术。这一步的其余部分是基于概念

在这两张表中展示出来。

**表 21-2.** 区块链的技术概念、目的和隐喻**概念**

**目的**

**使用的隐喻**

交易数据

描述所有权转让的银行转账表

交易历史

证明当前的状态

接力赛的过程

所有权

密码散列值

识别任何类型的数据

人类指纹

独特地

非对称加密

加密和解密数据

带锁的公共邮箱

数字签名

表明对

手写签名

交易数据的内容

散列引用

变成参考的

携带衣帽检票的外套

一旦正在展示的数据无效

利用散列值

所指的是被改变了

识别衣帽钩

敏感数据的更改

以一种使外套携带

结构

任何篡改都会显现出来

他们的衣帽房票

立即

口袋

（续）

***区块链基础知识***

191

**表 21-2.**（续）

**概念**

**目的**

**使用的隐喻**

散列难题

强加一个计算上的

通过

昂贵的任务

试错法

区块链数据结构

存储交易数据

一家带卡片的图书馆

一种敏感的方式和

目录

保持它们的顺序

不可变性

使其不可能改变

试图建立一个假的

交易数据的历史

家族史

分布式对等网络

共享交易历史

独立的群体

网络

网络的所有节点之间

证人

传递消息

确保系统的所有节点

人们之间的传闻

系统最终接收所有

信息

区块链算法

确保只有有效的

鼓励和惩罚的方法

交易数据被添加到

承包商

区块链数据结构

分布式一致性

确保系统的所有节点

公园里的踏盛径

系统使用相同的历史访客的投票结果

交易数据

他们的脚

补偿

给节点一个动力

付工资的面包店

保持完整性

带面包的员工

什么是区块链？

了解组成区块的各个概念的概述后

链，重要的是要看到它们如何共同工作。分析的方法是

通过识别应用程序的功能和非功能方面来系统

实现层为应对挑战提供了支持

了解区块链概念如何共同工作。表 21-3

提供了区块链的层和方面的概述

将指导您将概念整合在一起。

192

***步骤 21 | 将碎片整合在一起***

**表 21-3.** 区块链的层和方面

**层**

**功能**方面

**非功能**方面

应用

阐明所有权

高可用性

一直是全天候的，全年无休。它甚至没有关闭按钮。

可靠

开放

伪匿名

实施

所有权逻辑

安全

交易安全

有韧性

交易处理逻辑

最终一致

存储逻辑

应用层的

一致逻辑

纯分布式点对点架构

区块链的目的：功能方面

的。

区块链有两个目的：

• 阐明所有权

• 转让所有权

阐明所有权

阐明所有权意味着回答构成主要问题的问题

拥有哪个物体的数量在什么时间？

所有权，即：谁以多少金额将所有权转移到谁

转移所有权意味着改变当前的所有权状态。具有

关于此目的，区块链让所有者将其财产转让给

别人。因此，它回答了证明所有者的另一个重要问题-

转让所有权

在什么时间？

保持完整性

193

区块链的属性：非功能方面

与区块链互动时，您会注意到它如何履行其职责。

区块链服务其目的的质量由其

非功能方面：

• 高可用性

• 防审查

• 可靠

• 开放

• 伪匿名

• 安全

• 有韧性

• 最终一致

• 保持完整性

高可用

区块链没有停机时间。相反，区块链一直可用

***区块链基础***

无审查证据

转让所有权

关闭整个系统。

可靠

区块链始终以良好的质量保持其目的。一个人可以

信任区块链在正确阐明和转移所有权方面是正确的。

开放

区块链不排除某些用户或计算机利用其

服务。相反，它对所有人开放。

伪匿名

区块链可以唯一地识别所有者，但它既不维护也不透露

他们的现实身份。

194

***第 21 步|把碎片放在一起***

安全

区块链在两个方面是安全的：（1）在个人交易层面上

个人指定区块链的内容，也不能

只有合法的所有者。在整体层面上，区块链保护所有权

所有所有者从操纵、伪造、伪造、双重支付和

未经授权的访问。

有韧性

区块链能够正确阐明和转移所有权，

困难条件。区块链承受着各种攻击

所有权，如伪造、双重支付、伪造和访问他人的

假装成其他人的财产。

最终一致

区块链不会始终产生一致的结果。相反，获得一致结果的机会会随着时间的推移而增加，并最终达到

在整个系统中保持完全的一致性。

保持完整性

区块链通过展示没有自由行为来维护其完整性

逻辑错误。它保持数据一致性，并确保安全性。

个别交易和整个交易数据的历史。

内在功能：区块链的功能方面

实施层

区块链的内部功能可以追溯到以下

主要组件：

• 拥有权逻辑

• 交易安全

• 交易处理逻辑

• 存储逻辑

• 点对点架构

• 共识逻辑

![](img/index-194_1.png)

***区块链基础知识***

195

拥有权逻辑

拥有逻辑规定了如何澄清和转移所有权。该

区块链利用个别交易数据描述转移

拥有权并维护了全部交易数据，以澄清所有者-

关系。图 21-1 说明了所有权逻辑及其基本概念。

顶部的框所示的概念取决于它们下面的概念。非常

最底层的框表明了所有权逻辑的基础概念

取决于并需要进一步指定。

**图 21-1\.** 拥有权逻辑及其基本概念

区块链使用的所有权逻辑依赖于保管逻辑

保持整个交易数据历史记录和一种共识逻辑

确保其一致性。此外，所有权逻辑依赖于交易-

交易处理逻辑，确保只有有效的交易数据被添加

到数据存储和交易安全，确保只有合法所有者

拥有者可以将其财产转移到另一个账户。这四个概念-

剩余的区块链组件解决了这些问题。

交易安全

交易安全确保只有合法所有者可以访问和转-

他把他的所有权转移到另一个账户。图 21-2 说明了这些概念的实现

实施了实现交易安全的概念。基本概念，如

密码哈希值和非对称加密位于框中

![](img/index-195_1.png)

196

***第 21 步 | 将所有元素整合在一起***

由于它们是所有其他概念的基础

位于它们上方的框中。例如，数字签名位于下方

授权，因为它是授权交易的措施，但它是

位于密码哈希值和私钥之上，因为它利用这些

概念。类似地，图 21-2 使低级加密身份验证和识别之间的依赖关系更明显。

**图 21-2\.** 交易安全及其基本概念

交易处理逻辑

交易逻辑确保只有有效的交易数据被添加到

集中维护的交易数据的历史记录。很明显，它依赖于

表示系统真实目标的交易数据的验证。

系统的每个节点都可以独立进行交易验证-

但是，单个节点可能在验证交易时出错

数据，也可能故意接受无效的交易数据。两种情况

对整个系统的完整性构成威胁。因此，处理

交易包括一个包含验证的复杂机制

新块或其头部：点对点架构和对等架构

控制和竞争，这又依赖于奖励和惩罚的力量，

的关系，通过在框内逐级呈现它们来指出它们的依赖关系。

![](img/index-196_1.png)

***区块链基础***

197

**图 21-3\.** 交易处理逻辑及其基本概念

存储逻辑

有效交易的处理导致它们被添加到整个

密码哈希值概念。图 21-4 描述了

维护整个交易数据的历史记录。整体的完整性

系统及其能够实现其澄清和转让所有权的目的取决于此数据

阻止它们被操纵、伪造或伪造，追求的理念

由称为节点的独立对等节点组成。这些节点相互连接

存储逻辑通过维护一个不可变的追加数据来实现

存储是基于工作证明和区块链数据结构的。它的

的功能可以追溯到哈希谜题、哈希引用和更改-

敏感数据结构，这又可以追溯到基本的概念-

独立节点组成。

派生概念的存储逻辑通过对代表的框进行

更基本的概念。

![](img/index-197_1.png)

![](img/index-197_2.png)

198

***第 21 步|将碎片拼凑在一起***

**图 21-4\.** 存储逻辑及其基本概念

点对点架构

架构决定系统的组件或节点的

之间相关并相互连接。如图 21-5，

区块链利用纯分布式的点对点系统

交易数据历史记录，这意味着将它们添加到数据存储中

通过充当通信的媒介进行通信。每个

节点维护了自己的区块链数据结构的副本

整个交易数据历史记录。节点相互通信

另一个通过利用一种八卦式消息传递协议，确保

最终每个对等体将接收所有信息。

**图 21-5.** 架构及其基本概念

![](img/index-198_1.png)

***区块链基础知识***

199

共识逻辑

由于分布式系统的所有节点独立地维护其交易数据历史记录，由于通过网络传递消息时的延迟或其他不利因素，它们的内容可能会有所不同。因此，原本意味着的数据存储

形成一个链式数据块直线实际上形成了一个三形状的数据结构，其中每个分支代表着交易的冲突版本

逻辑逻辑如图 21-6 mak 描述的使系统的所有节点最终一致，使它们选择相同版本的

最集体努力团结的交易历史。

**图 21-6.** 共识逻辑及其基本概念

获得抽象化

通过识别和区分历史记录中的组件获得抽象化

区块链是特定于管理所有权目标的组件与

不关注特定应用目标。这与我们对区块链技术套件的理解一致，如第[5 步](http://dx.doi.org/10.1007/978-1-4842-2604-9_5)中讨论的那样。显然，所有权逻辑和交易数据都是特定于

应用程序，因为它们决定了所有权是如何使用交易-

行动数据以及所有权如何被交代和转移。另一方面，

交易安全性和交易处理逻辑对

应用目标。前者利用识别通用概念-

认证，授权和数字签名，可用于

任何其他应用程序。如图 21-3 所示，后者是一个巨大的数据处理装置，其大部分组件与

应用目标。交易处理逻辑中唯一与

与应用目标紧密耦合的是交易数据的验证。

所有其他组件，如竞争，对等控制，奖励，惩罚，

区块头的验证与特定数据无关-

运行。图 21-7 展示了 r 区分特定于应用程序的区块链组件与那些对特定应用目标不可知的组件的结果，这进而形成了区块链技术套件。

![](img/index-199_1.png)

200

***步骤 21 | 将各要素整合在一起***

**图 21-7.** 区块链中的区块链技术套件

展望

此步骤旨在整合前几步的所有要素

为了获得对区块链的概述。开放性和缺乏

任何形式的中心控制或协调都是

系统，因为它们允许其节点作为独立的见证人来澄清-

所有权相关事项的处理。然而，这些特征也可能引起

不良后果。这些不良后果是什么以及如何

它们可能限制区块链的使用会在下一步讨论。

概要

• 区块链是纯分布式的对等网络

系统，解决了管理以下方面的问题

所有权：

• 描述所有权：交易数据历史

• 保护所有权：数字签名

• 存储交易数据：区块链数据结构

• 准备分布式账本：不可变性

• 分布式账本：八卦式信息

在网络中转发

***区块链基础***

201

• 处理新交易：区块链算法

• 决定哪个账本代表真相：

分布式共识

• 分析区块链涉及以下方面：

• 应用目标

• 其属性

• 其内部功能

• 区块链有两个应用目标：

• 澄清所有权

• 转移所有权

• 区块链在实现其应用目标的同时展现出

以下特质：

• 高可用

• 防审查

• 可靠

• 公开

• 伪匿名

• 安全

• 有弹性

• 最终一致

• 保持完整性

• 区块链在内部由组件组成，这些组件

或特定或与

管理所有权。

• 区块链的应用特定组件

是：

• 所有权逻辑

• 交易数据

• 交易处理逻辑
