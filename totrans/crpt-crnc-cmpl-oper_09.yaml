- en: © The Author(s), under exclusive license to Springer Nature Switzerland AG 2022J.
    ScharfmanCryptocurrency Compliance and Operations [https://doi.org/10.1007/978-3-030-88000-2_9](https://doi.org/10.1007/978-3-030-88000-2_9)
  prefs: []
  type: TYPE_NORMAL
- en: 9. Decentralized Finance (DeFi) Compliance and Operations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Jason Scharfman^([1](#Aff2)  )(1)Corgentum Consulting, LLC, New York, NY, USAKeywordsDecentralized
    finance (DeFi)***Centralized decentralized finance (CeDeFi)***Centralized finance
    (CeFi)Rug pullsFlash loansAtomic swapsMoney legosSolidity
  prefs: []
  type: TYPE_NORMAL
- en: Introduction to DeFi
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Decentralized Finance, often abbreviated simply as DeFi, is a broad term that
    encompasses many different types of applications, protocols, and investment practices.
    DeFi is also sometimes referred to by the term ***open finance***. DeFi involves
    the transition of traditional financial tools such as savings, loans, trading,
    and the utilization of derivatives onto blockchain related technologies. An underpinning
    principle of DeFi is the removal of traditional intermediaries that have historically
    been a cornerstone of traditional finance, also called ***centralized finance
    (CeFi)***. DeFi also removes many of the barriers to entry that are also typically
    present in the world of traditional finance such as extensive compliance pre-qualification
    paperwork, identity verification requirements, preferential terms, and credit
    scores.[¹](#FPar1) DeFi has continued to evolve and in a compromise between total
    decentralization and traditional finance a new category of DeFi termed ***centralized
    decentralized finance (CeDeFi)*** that seeks to capitalize on the strengths of
    traditional finance while being rooted in DeFi. Some have argued that CeDeFi would
    work to facilitate increased scale in DeFi and promote enhanced integration of
    institutional custody arrangements for DeFi.[²](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: In December 2020 the DeFi market was worth less than $700 million and by February
    2020 it had grown to $1 billion.[³](#FPar1) The exponential growth of the DeFi
    market has continued with estimates as of March 2021 putting its market capitalization
    at approximately $74.8 billion.[⁴](#FPar1) As of May 2021 the DeFi market capitalization
    had topped $130 billion.[⁵](#FPar1) In addition to a number of different DeFi
    protocols and individual associated coins, in February 2021 Bitwise Asset Management
    launched the first DeFi crypto index fund.[⁶](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: DeFi and the Ethereum Blockchain
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As the DeFi universe has expanded there has been an increasing number of crypto
    projects, and associated coins, linked to the space. While there are DeFi tokens
    on several different blockchains on which DeFi application run, the dominant blockchain
    employed in the DeFi universe is Ethereum. This growth in DeFi through Ethereum-based
    DeFi applications has been a strong contributor to the vast growth in ***Ethereum
    block size***.
  prefs: []
  type: TYPE_NORMAL
- en: 'Before discussing block size, we must understand what Ethereum blocks are.
    They are groups of transactions. These transactions contain a hash of the previous
    block in the chain. By containing the previous hash, the blocks are then linked
    together in a chain. Ethereum blocks contain[⁷](#FPar1):'
  prefs: []
  type: TYPE_NORMAL
- en: Timestamp – this is the time when the mining of the block occurred
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: mixHash – this is a one-off unique identifier for that specific block
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A parent hash – this is the unique identifier for the previous block that links
    the current block to the previous block
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Block number – this a measurement metric that contains the length of the blockchain
    specified in blocks
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Difficulty – this refers to the effort required to mine the block
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Transactions list – the transactions included in the block.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: State root – this is a record of the whole state of the system including contract
    storage, and code, account nonces and balances
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Nonce – this represents a specific hash that when it is combined with the mixHash,
    validates proof of work for the current block
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In an Ethereum context the term, “***gas***” is utilized to refer to the amount
    of Ether (ETH) that is used as a fee to complete a transaction, such as executing
    a smart contract, on the Ethereum blockchain. Gas is usually a small amount of
    ETH relative to the overall size of the transaction. A common measurement for
    gas is a ***gwei*** or ***nanoeth*** which equals 0.000000001 ETH however, different
    units can be utilized for gas measurements with the smallest being a ***wei***,
    also called an AttoEthereum, which is 0.000000000000000001 ETH. The gas limit
    for each new block can be increased or decreased approximately 0.1% from the previous
    block by the miner of the block. As of April 2021, the gas limit is approximately
    15 million.[⁸](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: There have been historical instances where individuals have paid nonsensical
    gas fees. In one such transaction a user spent 10,668 ETH worth approximately
    $2.6 million at the time, to transfer $130 worth of ETH.[⁹](#FPar1) The same user
    then again spent another 10,668 ETH to transfer $87,000 worth of ETH.[^(10)](#FPar1)
    While the specific reasons why this type of transaction was executed, twice, some
    have speculated that it was an error with the user’s wallet software or an attempt
    at money laundering.
  prefs: []
  type: TYPE_NORMAL
- en: DeFi Coins
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The DeFi marketplace has grown to over 200 tokens.[^(11)](#FPar1) Leading coins
    in terms of market cap include Uniswap (UNI), Chainlink (LINK), Wrapped Bitcoin
    (WBTC), Terra (LUNA), PancakeSwap (CAKE), Aave (AAVE), and Maker (MKR). Exhibit
    [9.1](#Tab1) contains a list of leading DeFi tokens categorized by market capitalization.Exhibit
    9.1
  prefs: []
  type: TYPE_NORMAL
- en: Leading DeFi Tokens by Market Capitalization
  prefs: []
  type: TYPE_NORMAL
- en: '| Name | Symbol | Market Cap (in millions) |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Uniswap | UNI | $22.81 |'
  prefs: []
  type: TYPE_TB
- en: '| Chainlink | LINK | $19.97 |'
  prefs: []
  type: TYPE_TB
- en: '| Wrapped Bitcoin | WBTC | $9.24 |'
  prefs: []
  type: TYPE_TB
- en: '| Terra | LUNA | $6.38 |'
  prefs: []
  type: TYPE_TB
- en: '| PancakeSwap | CAKE | $6.05 |'
  prefs: []
  type: TYPE_TB
- en: '| Aave | AAVE | $5.84 |'
  prefs: []
  type: TYPE_TB
- en: '| Maker | MKR | $5.36 |'
  prefs: []
  type: TYPE_TB
- en: '| Dai | DAI | $4.13 |'
  prefs: []
  type: TYPE_TB
- en: '| Avalanche | AVAX | $4.05 |'
  prefs: []
  type: TYPE_TB
- en: '| THORChain | RUNE | $4.01 |'
  prefs: []
  type: TYPE_TB
- en: '| Compound | COMP | $3.85 |'
  prefs: []
  type: TYPE_TB
- en: '| Synthetix | SNX | $1.94 |'
  prefs: []
  type: TYPE_TB
- en: '| Year.finance | YFI | $1.89 |'
  prefs: []
  type: TYPE_TB
- en: '| The Graph | GRT | $1.83 |'
  prefs: []
  type: TYPE_TB
- en: '| Basic Attention Token | BAT | $1.71 |'
  prefs: []
  type: TYPE_TB
- en: '| SushiSwap | SUSHI | $1.66 |'
  prefs: []
  type: TYPE_TB
- en: '| UMA | UMA | $1.46 |'
  prefs: []
  type: TYPE_TB
- en: '| 0x | ZRX | $1.36 |'
  prefs: []
  type: TYPE_TB
- en: '| Bancor | BNT | $1.28 |'
  prefs: []
  type: TYPE_TB
- en: '| BakeryToken | BAKE | $1.16 |'
  prefs: []
  type: TYPE_TB
- en: '| Venus | XVS | $1.09 |'
  prefs: []
  type: TYPE_TB
- en: '| Reserve Rights | RSR | $1.07 |'
  prefs: []
  type: TYPE_TB
- en: '| Ren | REN | $0.89 |'
  prefs: []
  type: TYPE_TB
- en: '| 1inch | 1INCH | $0.84 |'
  prefs: []
  type: TYPE_TB
- en: '| Curve DAO Token | CRV | $0.80 |'
  prefs: []
  type: TYPE_TB
- en: '| renBTC | RENBTC | $0.68 |'
  prefs: []
  type: TYPE_TB
- en: '| Loopring | LRC | $0.64 |'
  prefs: []
  type: TYPE_TB
- en: '| Kyber Network Crystal Legacy | KNC | $0.62 |'
  prefs: []
  type: TYPE_TB
- en: '| Mdex | MDX | $0.56 |'
  prefs: []
  type: TYPE_TB
- en: '| Ocean Protocol | OCEAN | $0.56 |'
  prefs: []
  type: TYPE_TB
- en: '| Serum | SRM | $0.52 |'
  prefs: []
  type: TYPE_TB
- en: '| Alpha Finance Lab | ALPHA | $0.48 |'
  prefs: []
  type: TYPE_TB
- en: '| Reef | REEF | $0.47 |'
  prefs: []
  type: TYPE_TB
- en: '| Balancer | BAL | $0.46 |'
  prefs: []
  type: TYPE_TB
- en: '| Origin Protocol | OGN | $0.45 |'
  prefs: []
  type: TYPE_TB
- en: '| Swipe | SXP | $0.44 |'
  prefs: []
  type: TYPE_TB
- en: '| Augur | REP | $0.43 |'
  prefs: []
  type: TYPE_TB
- en: '| Injective Protocol | INJ | $0.43 |'
  prefs: []
  type: TYPE_TB
- en: '| DODO | DODO | $0.40 |'
  prefs: []
  type: TYPE_TB
- en: '| Band Protocol | BAND | $0.39 |'
  prefs: []
  type: TYPE_TB
- en: '| Gnosis | GNO | $0.37 |'
  prefs: []
  type: TYPE_TB
- en: '| Neutrino USD | USDN | $0.36 |'
  prefs: []
  type: TYPE_TB
- en: '| iExec RLC | RLC | $0.35 |'
  prefs: []
  type: TYPE_TB
- en: '| BitShares | BTS | $0.35 |'
  prefs: []
  type: TYPE_TB
- en: '| Kava.io | KAVA | $0.33 |'
  prefs: []
  type: TYPE_TB
- en: '| TrustSwap | SWAP | $0.33 |'
  prefs: []
  type: TYPE_TB
- en: '| Numeraire | NMR | $0.32 |'
  prefs: []
  type: TYPE_TB
- en: '| Haven Protocol | XHV | $0.29 |'
  prefs: []
  type: TYPE_TB
- en: '| Uquid Coin | UQC | $0.27 |'
  prefs: []
  type: TYPE_TB
- en: '| JUST | JST | $0.27 |'
  prefs: []
  type: TYPE_TB
- en: '| Wanchain | WAN | $0.27 |'
  prefs: []
  type: TYPE_TB
- en: '| Badger DAO | BADGER | $0.27 |'
  prefs: []
  type: TYPE_TB
- en: '| Ampleforth | AMPL | $0.26 |'
  prefs: []
  type: TYPE_TB
- en: '| Secret | SCRT | $0.25 |'
  prefs: []
  type: TYPE_TB
- en: '| COTI | COTI | $0.22 |'
  prefs: []
  type: TYPE_TB
- en: '*Source* CoinMarketCap.com/view/defi as of May 5, 2021'
  prefs: []
  type: TYPE_NORMAL
- en: Flash Loans
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Flash loans have become increasingly popular in the DeFi space. A flash loan
    is a type of instantaneous loan that requires no collateral. This uncollateralized
    arrangement remains intact as long as liquidity is returned to the transactions
    reserve pool within one transaction block.[^(12)](#FPar1) If the liquidity is
    not returned, then the transaction is effectively reversed. Common use cases for
    flash loans are for swapping collateral, exploiting arbitrage opportunities, and
    self-liquidation. Flash loans effectively allow anyone to borrow millions of dollars
    under a risk free loan for the duration of a single transaction.[^(13)](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: DeFi Case Studies
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As with most areas of the crypto space the bulk of developers of coins are honest
    but as with all emerging industries there are fraudulent scams that attempt to
    profit. As more investors have piled into the DeFi space in recent years so too
    unfortunately have the number of criminal activities in the DeFi space increased.
    According to industry research the number of DeFi hacks went from virtually zero
    in 2019 to 25% of total cryptocurrency space frauds in 2020 and by April 2021,
    the number of DeFi hacks represented over 60%of all crypto hacks.[^(14)](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: The following cases outline different situations in which various schemes were
    undertaken in the DeFi space that cost investors millions of dollars. As you read
    through these cases consider the way in which the schemes were implemented and
    what corrective measures that could have been taken to prevent the scheme. Additionally,
    you should consider what measures you would implement today in existing and nascent
    DeFi applications and tokens to prevent the recurrence of these events.
  prefs: []
  type: TYPE_NORMAL
- en: EasyFi Network Hack
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: EasyFi is a universal layer 2 DeFi lending protocol that runs on the Polygon
    network.[^(15)](#FPar1) The EasyFi protocol offers a number of services related
    to micro-lending, under collateralized loans, secure (collateralized) loans, and
    credit default swaps. EasyFi also offers services related to a type of service
    known as ***credit delegation***. Credit delegation is
  prefs: []
  type: TYPE_NORMAL
- en: 'EasyFi is a universal layer 2 #DeFi lending protocol for digital assets on
    @ethereum Built on top of compound’s solid codebase & #PoweredByMatic, it offers
    faster & low-cost DeFi transactions and sophisticated consumer-centric financial
    products. Some of the core functions will include - Secured (Collateralized) Loans
    - Under Collateralized Loans - Micro-Lending - Credit Delegation - Credit Default
    Swaps'
  prefs: []
  type: TYPE_NORMAL
- en: Other DeFI Attacks
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'There have been a series of other notable DeFi attacks including the following:'
  prefs: []
  type: TYPE_NORMAL
- en: bZx - also known as Fulcrum, is a DeFi borrowing and lending platform. that
    was subjected to two different attacks in 2020\. The first attack resulted in
    a theft of $350,000 through what is known as a ***flash loan attack***.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Lendf.me - An April 2020 DeFi reentrancy attack where the hackers can withdraw
    funds repeatedly, of Lendf.me where the hackers resulted in losses of $25 million.
    Ultimately the hackers leaked their own IP address and returned the capital.[^(16)](#FPar1)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Rug Pull scams – A ***rug pull*** is a scam that primarily happens in DeFi,
    where developers desert a project and simply depart with investor funds. Research
    suggests that rug pulls accounted for half of all 2020 crypto hacks.[^(17)](#FPar1)
    Rug pulls are commonly like to well promoted coins, called ***hype coins***, that
    are then abandoned, and investors money is stolen.[^(18)](#FPar1) An example of
    a rug pull was the Amplyfi.money rug pull that resulted in the theft of over 2,500
    ETH.[^(19)](#FPar1)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Pump and Dump Scams
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A common scam that has been historically implemented throughout the crypto space
    is known as a ***pump and dump scam***. Under this scheme individuals either purchase,
    or are gifted, large amounts of relatively nascent lower priced coins. They then
    make positive bullish comments about the coin in order to generate increased demand.
    If these attempts work the new demand can send the price of the coin skyrocketing.
    When a coin jump in price significantly in a short period of time it is often
    referred to as ***going to the moon*** or ***mooning***. Once the price increases
    dramatically based on the demand, they helped create the promoters that fueled
    the demand then sell the coin and reap large profits. Ultimately, the over inflated
    coin typically crashes in price when the original demand push. The individuals
    that purchased the coins based on the comments of the influencers now have large
    losses on paper and they can either sell the coins and realize significant losses
    or keep holding the coins in hope of an eventual recovery in price. This latter
    group are commonly referred to as ***bag holders*** because they are left holding
    a bag of coins that have kept losing value. Bag holders can be viewed as having
    a preference for HODL (Hold On For Dear Life) rather than SODL (Sell For Dear
    Life).[^(20)](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: The individuals that participate in the pump and dump scheme are often influential
    people in the crypto world who have large followings on outlets such as Twitter.
    Other promoters are those with large followings on media outlets such as Facebook,
    Tik-Tok, and Instagram. Additionally, in many instances it is not a single individual
    pumping a coin but groups of individuals, referred to as ***pump groups***, that
    agree to collaborate on pumping up a coin. Many of these pump groups collaborate
    and subsequently outreach to potential coin purchases to generate demand through
    message board type venues and chat style applications such as BitCoinTalk, Telegram,
    and Reddit. Additionally, a tiering system is also employed in many of these chat
    forums with messages about certain coins being sent to higher ranking tiered members,
    giving them an opportunity to purchase the coins prior to the large anticipated
    price increase prior to the demand push for the pump, in advance of lower ranking
    members.[^(21)](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: Regulatory Action Involving DeFi
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Regulators are increasingly focusing on overseeing not only the cryptocurrency
    industry broadly but DeFi in particular. In August 2021, the US Securities and
    Exchange Commission (SEC) charged a decentralized finance lender and certain executives
    for raising $30 million through fraudulent offerings in what the agency described
    as the first case involving securities using DeFi technology. The following excerpt
    is a summary from the SEC’s press release involving the matter[^(22)](#FPar1):'
  prefs: []
  type: TYPE_NORMAL
- en: The Securities and Exchange Commission today charged two Florida men and their
    Cayman Islands company for unregistered sales of more than $30 million of securities
    using smart contracts and so-called “decentralized finance” (DeFi) technology,
    and for misleading investors concerning the operations and profitability of their
    business DeFi Money Market.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'According to the SEC’s order, Gregory Keough, Derek Acree, and their company
    Blockchain Credit Partners offered and sold securities in unregistered offerings
    through DeFi Money Market from February 2020 to February 2021\. The order finds
    that they used smart contracts to sell two types of digital tokens: mTokens that
    could be purchased using specified digital assets and that paid 6.25 percent interest,
    and DMG “governance tokens” that purportedly gave holders certain voting rights,
    a share of excess profits, and the ability to profit from DMG governance token
    resales in the secondary market.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: According to the order, in offering and selling mTokens and DMG governance tokens,
    the respondents stated that DeFi Money Market could pay the interest and profits
    because it would use investor assets to buy “real world” assets that generated
    income, like car loans. However, the order finds that after publicly unveiling
    DMM, the respondents realized that DeFi Money Market could not operate as promised
    because the price volatility of the digital assets used to purchase the tokens
    created risk that the income generated through income-generating assets would
    be insufficient to cover appreciation of investors’ principal. The order finds
    that rather than notifying investors of this roadblock, the respondents misrepresented
    how the company was operating, including by falsely claiming that DeFi Money Market
    had bought car loans that they displayed on DeFi Money Market’s website. While
    the respondents controlled another company that owned car loans, DeFi Money Market
    never acquired an ownership interest in any of those loans. Instead, the order
    finds that the respondents used personal funds and funds from the other company
    they controlled to make principal and interest payments for mToken redemptions.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: “Full and honest disclosure remains the cornerstone of our securities laws –
    no matter what technologies are used to offer and sell those securities,” said
    Gurbir S. Grewal, Director of the SEC Enforcement Division. “This allows investors
    to make informed decisions and prevents issuers from misleading the public about
    business operations.”
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: “The federal securities laws apply with equal force to age-old frauds wrapped
    in today’s latest technology,” said Daniel Michael, Chief of the SEC Enforcement
    Division’s Complex Financial Instruments Unit. “Here, the labeling of the offering
    as decentralized and the securities as governance tokens did not hinder us from
    ensuring that DeFi Money Market was immediately shut down and that investors were
    paid back.”
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The SEC’s order finds that the mTokens were notes and were also offered and
    sold as investment contracts, the DMG governance tokens were offered and sold
    as investment contracts, and the respondents violated Sects. 5(a) and 5(c) of
    the Securities Act of 1933 by conducting unregistered offers and sales of both
    types of digital assets. The SEC’s order also finds that Respondents violated
    the antifraud provisions of Sect. 17(a) of the Securities Act and Sect. 10(b)
    of the Securities Exchange Act of 1934 and Rule 10b-5 thereunder.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Without admitting or denying the findings in the SEC’s order, respondents consented
    to a cease-and-desist order that includes disgorgement totaling $12,849,354 and
    penalties of $125,000 each for Keough and Acree. In addition, prior to the issuance
    of this order, the respondents funded the smart contracts so that mToken holders
    could redeem their mTokens and receive all principal and interest owed.”
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Automated Market Maker (AMM)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In traditional centralized crypto exchanges, an automated process is utilized
    to match buyers and sellers. This supply and demand process based on order flow
    in the pipeline allows for price quotations to be generated for different cryptocurrencies
    at any point in time. In the world of DeFi, decentralized exchanges increasingly
    serving in a role known as an ***Automated Market Maker*** (AMM). AMMs are smart
    contracts that allow for the permissionless trading of digital assets. A unique
    feature of AMMs particularly applicable to DeFi is that they do not use the traditional
    marketplace of buyers and sellers but instead utilize ***liquidity pools***.
  prefs: []
  type: TYPE_NORMAL
- en: Atomic Transactions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '***Atomic transactions*** are those that have one of two outcomes and as such
    they can be thought of as binary transactions. The first option is that the transaction
    is executed in its entirety. The other option would be that the transaction fails
    completely. In this way atomic transactions can be thought of as all or nothing
    endeavors. The name of atomic transactions comes from a database concept known
    as atomicity which outlines that a transaction must be not allowed for partial
    completion.'
  prefs: []
  type: TYPE_NORMAL
- en: Atomic Swaps
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: One of the most common examples of an atomic transaction in cryptocurrency is
    known as a ***cross-chain transaction***. This is also referred to as an ***atomic
    swap***.[^(23)](#FPar1) Since their inception in the crypto world in 2013, atomic
    swaps have gained in popularity. In 2017 for example Charlie Lee, atomic swaps
    were brought into focus the founder of Litecoin successfully completed an atomic
    swap between Litecoin and Bitcoin.[^(24)](#FPar1) Under an atomic swap transaction
    cryptocurrencies from distinct blockchains are exchanged directly for one another.
  prefs: []
  type: TYPE_NORMAL
- en: An atomic swap could happen through either a on-chain or off-chain solution.
    ***On-chain atomic swaps*** are executed on the blockchain but can suffer from
    delays due to network congestion on the blockchain. Additionally, on-chain transactions
    occur the network fees, such as Gas fees on Ethereum, to process the swap. ***Off-chain
    atomic swaps*** occur outside of the blockchain. Off-chain solutions can have
    a number of advantages including their private nature, almost instantaneous execution,
    and typically lower costs to execute as compared to on-chain solutions. Off-chain
    solutions, however, have faced a number of technical and operational implementation
    challenges which have slowed their adoption.
  prefs: []
  type: TYPE_NORMAL
- en: 'Atomic swaps utilizing a specific type of smart contract known as a ***Hash
    Timelock Contract (HTCL)***. HTCLs can be considered to be virtual lockboxes that
    require two unique keys[^(25)](#FPar1):'
  prefs: []
  type: TYPE_NORMAL
- en: '***TimeLock key*** – a mechanism that provides an element of safety to the
    parties engaged in the atomic swap. The TimeLock key ensures that if the atomic
    swap is not completed within a pre-determined time period, then the cryptocurrency
    is returned to the original parties.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '***HaskLock key*** – a mechanism that ensures that the cryptocurrency that
    is the subject of the atomic swap is only distributed after all the parties have
    fulfilled their respective parts of the transaction'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In addition to their all or nothing execution, atomic swaps also offer a number
    of other advantages over traditional centralized exchange platform transactions.
    One advantage is the fee structure employed by atomic swaps. The only fees are
    the fees to execute the trade on the blockchain
  prefs: []
  type: TYPE_NORMAL
- en: Counterparty Risk Implications
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: An example of this would be a transaction whereby you convert Ethereum directly
    to another coin such as Polygon MATIC via a wallet-to-wallet transaction. A key
    advantage of these types of peer-to-peer transactions is related to a concept
    known as ***counterparty risk***.
  prefs: []
  type: TYPE_NORMAL
- en: To better understand the implications of counterparty risk let us consider the
    straightforward transaction such as the Ethereum / MATIC swap described above.
    Let us further assume that the transaction was not instantaneous in nature but
    instead there was a waiting time between when the coins were transferred between
    wallets. In this example transaction, there is a single buyer (i.e.- the person
    wanting MATIC) and a single seller (i.e. – the person giving up Ethereum). The
    buyer can be thought of as the counterparty to the seller and vice-versa. In all
    transactions there is a risk that there will be an issue with the counterparty
    that could cause the transaction to either fail entirely or not go as planned.
  prefs: []
  type: TYPE_NORMAL
- en: This is particularly important because what you do not want to happen is that
    you transfer custody of the asset from one party to another, but the other party
    doesn’t do their part. For example, let’s say that the seller transferred the
    Ethereum to the MATIC buyer’s wallet, but then the buyer’s part of the transaction
    failed and the MATIC was never transferred to the Ethereum buyer’s wallet. Making
    matters worse there is no guarantee that the buyer would be able to reclaim the
    Ethereum they had originally transferred. For example, if the buyer was a scammer
    or simply went out of business there is a very low likelihood of reclaiming the
    lost Ethereum. In practice, atomic swaps are instantaneous and there is no delay
    between for cryptocurrency to arrive in the wallet once the transaction is executed.
    In this way, atomic swaps effectively eliminate the counterparty risk associated
    with traditional swap arrangements.
  prefs: []
  type: TYPE_NORMAL
- en: Atomic Composability and Money Legos in DeFi
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Earlier in this chapter we introduced the concept that DeFi involved the transition
    of traditional financial tools onto blockchain-related technologies. More specifically,
    within the DeFi universe there are a number of different protocols that address
    each of these different aspects of tools. For example, there are specific DeFi
    protocols for lending and trading. Each of these different protocols can be combined
    into unique projects. This is where the concept of ***money legos*** comes into
    play. Legos are a toy that allows the combination of bricks of different sizes
    and configurations to be clicked together to construct a wide variety of different
    combinations. When different DeFi protocols are utilized to develop unique projects,
    the application of each DeFi protocol can be thought of as an individual, “money
    lego,” being used to construct a larger project. For example, you could combine
    a savings-related DeFi protocols money lego piece and combine it with a trading-related
    DeFi protocols piece to construct a unique DeFi project. A ***flash loan*** can
    be thought of in this context as another example of a combination of trading and
    lending money legos.
  prefs: []
  type: TYPE_NORMAL
- en: Solidity Programming Language and DeFi
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Smart contracts are essential tools of DeFi. The Lightning Network is an example
    of a popular decentralized network using smart contracts.[^(26)](#FPar1) On the
    Ethereum blockchain one of the most commonly utilizing coding languages for smart
    contracts is named ***Solidity***. To be clear this is not the exclusive language
    in which smart contracts may be written and other more established programming
    languages as well such as JavaScript. Solidity is an Ethereum blockchain native
    object-oriented curly bracket programming language that was influenced by other
    computer languages such as C +  + and Python.
  prefs: []
  type: TYPE_NORMAL
- en: In addition to smart contracts Solidity can be utilized for a wide variety of
    applications such as crowdfunding, multi-signature wallets, blind auctions and
    voting.[^(27)](#FPar1) Although Solidity has continued to grow in popularity,
    particularly for DeFi applications, it is still a relatively young programming
    language and there has been a significant increase in both hacks and security
    issues with the language as well that have caused developers to re-evaluate their
    approach toward securing DeFi applications written in Solidity.[^(28)](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: Creating and Deploying DeFi Apps on Ethereum
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the crypto world, the term dApps refers to decentralized applications. It
    should be noted that there are several alternative spellings employed for this
    term including DApps, dApps and dapps. While there are dApps built on alternative
    blockchain networks, the bulk of dApps are built on the Ethereum blockchain. A
    key reason for this is because the ***Ethereum Virtual Machine (EVM)*** allows
    developers to deploy dApps regardless of the underlying coding language utilized
    to write the application.[^(29)](#FPar1)
  prefs: []
  type: TYPE_NORMAL
- en: In the context of DeFi, from an operational perspective it is important to understand
    the basic steps involved in creating and deploying a ***DeFi applications***.
    These DeFi applications are sometimes referred to as DeFi dApps.
  prefs: []
  type: TYPE_NORMAL
- en: 'Although there can be a great degree of technical complexity involved in developing
    and running DeFi apps there are several basic steps in the process. Due to the
    prominence of the DeFi apps built on the Ethereum blockchain, we will illustrate
    the steps in creating and deploying a smart contract DeFi app on Ethereum utilizing
    Solidity. In this example the following items will be accomplished[^(30)](#FPar1):'
  prefs: []
  type: TYPE_NORMAL
- en: The DeFi app will deposit a fungible token to the smart contract
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In exchange the smart contact will mint Farm Tokens back to the user
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Later the user will then be able to withdraw fungible tokens by burning the
    previously acquired Farm Token
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The ERC20 token will then be transferred back to the user
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If all we are doing is exchanging fungible tokens for Farm Tokens, in order
    to later convert them back to the original fungible tokens we started with you
    may be asking yourself what the point of this smart contract is. The reason one
    would do this is that you could utilize the acquired Farm Tokens for a variety
    of purposes such as yield staking.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following are the steps that would be taken to deploy this smart contract:'
  prefs: []
  type: TYPE_NORMAL
- en: 1)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Step #1: Setup the proper software environment – to accomplish this in Ethereum
    two tools are commonly utilized are Truffle and Ganache. A description of these
    tools from Ethereum.org is outlined below:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Truffle is a development environment and testing framework for developing smart
    contracts for Ethereum. With Truffle it is easy to build and deploy smart contracts
    to the blockchain. Ganache allows us to create a local Ethereum blockchain in
    order to test smart contracts. It simulates the features of the real network and
    the first 10 accounts are funded with 100 test Ether, thus making the smart contract
    deployment and testing free and easy. Ganache is available as a desktop application
    and a command-line tool.[^(31)](#FPar1)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 2)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Step #2 – Create an ERC20 token – In Chapter [1](513667_1_En_1_Chapter.xhtml)
    we introduced the concept that a token on any blockchain can be utilized to represent
    virtually anything ranging from fiat currency to the skills of a character in
    a game. In Ethereum, ***ERC-20*** is the name of the standard employed to ensure
    that tokens maintain certain properties that ensure that they are exactly the
    same both in value and type of another token.[^(32)](#FPar1) ERC-20 is also sometimes
    written as ERC20 without the hyphen. To clarify the ERC-20 standard applies to
    a class of tokens known as ***fungible tokens***. The term fungible means that
    the token can be interchanged for other tokens, and they will all be equivalent.
    Cryptocurrencies are examples of fungible tokens. This is in contrast to ***non-fungible
    tokens (NFTs)*** that contain uniquely identifiable features. NFTs employ a different
    standard called ***ERC-721*** on Ethereum. These unique NFT features under the
    ERC-721 standard include a unit256 variable, tokenId, and contract address.[^(33)](#FPar1)'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: A common approach to create an ERC20 token Ethereum is to utilize pre-built
    smart contract libraries that already contain standard implementations of smart
    contracts such as the OpenZepplin library.[^(34)](#FPar1)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 3)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Step #3 – Compile and deploy the ERC20 token that was created in Step #2'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 4)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Step #4 – Create Farm Token Smart Contract'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: DeFi Custody Considerations
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the decentralized finance (“DeFi) the operational mechanics of custody relationships
    can become more complex, as compared to the more straightforward practice of holding
    custody of crypto assets. Due to the way many DeFi investments work, many DeFi
    solutions rely on the crypto manager holding self-custody of assets. This has
    presented a challenge for institutional investors seeking increased exposure to
    the Dei space because many of these types of investors simply cannot invest in
    self-custodied crypto asset managers due to the increased risks inherent in this
    model. For reference custody is discussed in more detail in Chapter [3](513667_1_En_3_Chapter.xhtml).
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This chapter provided an introduction to decentralized finance (DeFi). It began
    with a comparison of traditional centralized finance (CeFi) and DeFi. Next, we
    discussed trends in centralized decentralized finance (CeDeFi) and the overall
    growth of the DeFi space. The chapter continued with a discussion of the interaction
    between DeFi and the Ethereum Blockchain. We then proceeded with an overview of
    various DeFi coins and flash loans. The chapter then proceeded with a discussion
    of DeFi case studies including rug pulls, pump and dump scams and regulatory action
    involving DeFi. Other topics covered in this chapter include atomic transactions,
    DeFi counterparty risk, money legos, solidity programming language and DeFi custody
    considerations. In the next chapter, we will introduce investor due diligence
    considerations on cryptocurrency and digital assets.
  prefs: []
  type: TYPE_NORMAL
- en: Notes
  prefs: []
  type: TYPE_NORMAL
- en: '1.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Bison Trails, “tBTC and DeFi: How To Get Involved,” November 12, 2020.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '2.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Taylor, J., “Decentralized and Centralized Finance Need to Collaborate,” *CoinTelegraph.com*,
    August 5, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '3.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Dale, B., “Why DeFi’s Billion-Dollar Milestone Matters,” *Coindesk.com*, February
    7, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '4.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Rapoza, K., “What’s The Big Deal About DeFI And How Do You Invest in It?,” *Forbes*,
    March 21, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '5.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: CoinMarketCap.com/view/DeFi accessed on May 5, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '6.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Benzinga Staff, “Bitwise Asset Management Launches DeFi Index Fund,” *Yahoo!
    Finance*, February 18, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '7.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '@thelostone-mc, “Blocks,” May 1, 2021, Ethereum.org.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '8.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Harper, C. and Kim, C., “Ethereum Gas Limit Hits 15 M as ETH Price Soars,” *CoinDesk*,
    April 22, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '9.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Young, J., “Why A Mysterious Ethereum User Paid $2.6 Million To Send $130 Of
    Crypto,” *Forbes*, June 10, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '10.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Chong, N., “Not Again: Unknown Ethereum User Pays A $2.6 Million Transaction
    Fee For The Second Time,” *Forbes*, June 11, 2020.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '11.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Cryptoslate.com accessed on May 5, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '12.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Aave, “Flash Loans,” aave.com/flash-loans/ accessed on May 6, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '13.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Coinbase, “Around the Block #3: Analysis on the bZx Attack, DeFi Vulnerabilities,
    the State of Debit Cards in Crypto, and Other Crypto News,” *The Coinbase Blog*,
    March 13, 2020.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '14.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Ciphertrace, “Cryptocurrency Crime and Anti-Money Laundering Report,” May 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '15.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*See* [www.​easyfi.​network](http://www.easyfi.network).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '16.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Cimpanu, C., “Hackers Steal $25 Million Worth of Cryptocurrency from Lendf.me
    “Platform,” *ZDNet*, April 19, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '17.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Gottsegen, W., “DeFi ‘Rug Pulls’ Were Crypto’s Top Fraud Scheme in 2020: CipherTrace,”
    *Decrypto.co*, January 28, 2021.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '18.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Segal, D., “Going for Broke in Cryptoland,” *The New York Times*, August 5,
    2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '19.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Bitcoin.com, “12 Defi Con Artists Exposed – Are Rug Pulling Incidents Threatening
    the Future of Defi?” October 12, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '20.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Coins Capture, “Understanding The Concept Of the Crypto Bag Holder”, *Medium*,
    July 22, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '21.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Li, T. & Shin, D. et al., “Cryptocurrency Pump-and-Dump Schemes,” January.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '22.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: U.S. Securities and Exchange Commission, “SEC Charges Decentralized Finance
    Lender and Top Executives for Raising $30 Million Through Fraudulent Offerings,”
    August 6, 2021.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '23.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Atomic swaps were introduced by an individual with the username TierNolan in
    2013 on the BitcoinTalk message forums. For more information see [https://​bitcointalk.​org/​index.​php?​topic=​193281.​msg2003765#msg2003765](https://bitcointalk.org/index.php%253Ftopic%253D193281.msg2003765%2523msg2003765).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '24.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For Charlie Lee’s Twitter post announcing this atomic swap see [https://​twitter.​com/​SatoshiLite/​status/​9113282529286430​72](https://twitter.com/SatoshiLite/status/911328252928643072).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '25.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Fitzpatrick, L., “A Complete Beginner’s Guide To Atomic Swaps,” *Forbes*, September
    2, 2019.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '26.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: See [https://​lightning.​network/​](https://lightning.network/).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '27.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '“Solidity,” available at: [https://​docs.​soliditylang.​org/​en/​v0.​8.​4/​](https://docs.soliditylang.org/en/v0.8.4/).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '28.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Channing, E., Tse, C., “DeFi: Solidity Sees Significant Uptick in Security
    Erros in 2020,” *CrowdFund Insider*, November 17, 2020.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '29.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Cryptopedia Staff, “Why Are Most dApps Built on Ethereum,” March 23, 2021, *Gemini.*
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '30.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This example is sourced from Strykerin, “Create and Deploy A DeFi App,” *Ethereum.org*,
    December 30, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '31.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Strykerin, “Create and Deploy A DeFi App,” *Ethereum.org*, December 30, 2020.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '32.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '@ensaryusuf, “ERC-20 Token Standard,” *Ethereum.org*, April 11, 2021.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '33.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '@pgrimaud, “ERC-721 Non-Fungible Token Standard,” *Ethereum.org*, April 27,
    2021.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '34.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'See OpenZeppelin | docs available at: [https://​docs.​openzeppelin.​com/​contracts/​4.​x/​](https://docs.openzeppelin.com/contracts/4.x/).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
