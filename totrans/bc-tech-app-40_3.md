# 3 分布式账本与物联网

分布式账本技术与物联网的集成对许多非去中心化金融（DeFi）应用之外的 applications and use cases 至关重要。应用领域包括智能城市、智能机器人、智能工业与物流、移动性和能源或废物管理等方面。这些应用领域中的某些方面在第四部分中讨论得更详细。

基本的以云为中心的物联网架构如图 3.1 所示。图 3.1 感知层包括集成到物品中的传感器、执行器和嵌入式设备。感知层与现实世界互动，实现基本信号和数据处理，并确保某种形式的连通性（个人区域通过蓝牙或有线连接，局部区域通过 WiFi，或广域区域，例如，窄带物联网（NB-IoT））。因此，嵌入式设备可以直接或通过通信网关连接到通信层，该层是一个公共（互联网）或私有 IP 网络。平台和应用层是基于云的服务两套，它们使物联网数据的收集、存储、数据处理和基于物联网数据的应用开发成为可能。物联网与分布式账本的集成一直被视为解决物联网架构的基本挑战的补救措施。这些挑战，如集中的生态系统、连接成本、业务模式的中断、安全和信任问题以及缺乏功能性价值，需要得到解决，才能继续成功实施物联网。

![](img/b_9783110681130-003_fig_001.jpg)

图 3.1：基本的物联网架构。

分布式账本技术所寄予的厚望源于其分布式和去中心化的特性。例如，人们期待一种去中心化的物联网网络方法能解决上述许多问题。“*区块链技术是物联网应对未来挑战的缺失环节*”[46], 它能够降低成本，建立信任，加快交易，提供可扩展性，消除单一故障点，为智能设备的历史记录保持不可篡改的记录，实现机器对机器的交易，微支付等。

不幸的是，许多这些期望都是基于对分布式账本技术的技术和业务范围过于简化的理解和不切实际的假设。例如，分布式账本技术并不能解决物联网的可扩展性问题。相反，所有相关的分布式账本技术部署都在努力达到现有基于云的物联网后端平台能力的一小部分（在每秒交易数和延迟方面）。然而，如果理解了分布式账本技术的真正好处，物联网 DApps 可以被合理地设计和精简，并且这项技术可以应用于它能颠覆商业运营的情况。分布式账本技术为物联网的创新和范式转变开启了广阔的机会[47]。目前，我们已经有了能够可靠地收集物联网数据或安全处理数万个金融交易的商用级系统。在大多数情况下，分布式账本技术的性能难以与中心化系统相比，更不用说取代它们了。同样，云应用的一个故障点仅仅是设计实现不当的结果。基于云的架构通过内容分发网络、平台虚拟化以及应用均衡和扩展，可以提供极其可靠的服务。在 5G 网络中，预见到了新的服务架构机制。云计算、边缘计算和移动计算的结合使得分布式（但不是去中心化！）服务部署成为可能。结合网络切片提供的网络内在资源保障，它们可以支持节能、大规模或时间敏感的物联网应用。

我们认为分布式账本技术在物联网中扮演着有意义的角色，并不是为了缓解已知的物联网瓶颈，而是主要在于提供新的特性，比如改进的信任、设备操作和业务的全自主性、无缝的机器对机器交易，以及通过智能合约的可信操作、可靠的 DApps、数据来源和通过金融激励的公平性。除了通过 DApps 实现自主的机器对机器通信外，我们还看到了物联网和分布式账本技术集成的另外两个基本概念：数据收集，以及物联网设备的认证、授权和（更新）管理。这两个概念在本节中会有更详细的介绍。

基于分布式账本技术的物联网应用可以看作是 DApps 的一个特例，由于物联网系统的性质，这里有一些额外的要求和限制。这些特定之处包括分布式网络性能、智能合约和端设备安全（例如，设备访问分布式账本账户），或者在受限的物联网设备中实现离链应用。物联网解决方案经常对底层分布式账本网络施加行业级的要求（见第 2.3.2 节），以及对开发和支持生态系统的需求（见第 2.7 节）。

对于物联网（IoT）未来的成功去中心化，我们需要整合分布式账本（DL）、物联网（IoT）和底层通信网络。在传统的物联网架构(图 3.1)中，物联网被认为只是通信基础设施的一个覆盖层。4G 最近的趋势已经预见了雾/边缘基础方法，其中一些应用和数据逻辑从云中移动到物联网端设备附近或更近。在 5G 架构中，预计将添加额外机制（例如，切片）以支持此类网络架构中的 QoS 或安全性。因此，集成下一步应该是对雾、边缘和基于云的通信基础设施组织和发展适当的 DL 网络和 DApp 架构。与 DeFi 应用不同，许多与物联网相关的 DApp 不需要公共或无需许可的 DL 网络。这为新的 DL 网络架构开启了可能性，结合了私有、联盟和公共 DL 网络（见第 2.3.1.1 节）在网络边缘或覆盖服务中实现，并通过跨链交换（第 2.3.3.3 节）进行集成。

## 3.1 物联网安全的分布式账本

分布式账本技术（DLT）和区块链在很大程度上依赖于先进的网络安全机制，并将它们独特地结合在一起，以实现 DLT 系统预期的信任。然而，DLT 并不是简单地改进了 DL 网络、系统和应用的所有方面的机密性、完整性和可用性。它也并非没有安全风险（见表 3.1）。

保密性并不是 DLT 设计的关键安全特性。在所有网络参与者之间共享一个共同的去中心化账本，是建立去中心化信任的关键。除非应用非常具体的机制和 DL 网络架构，否则 DL 数据是透明的，DL 网络用户最多只能是伪匿名。

完整性是 DLT 被发明出来的安全特性。它指的是交易的不可变性、智能合约代码的防篡改部署和执行。然而，这些相同的特性也带来了新的隐私和安全风险，甚至可能导致在使用 DLT 应用和系统中的前所未有的法律或道德问题。

系统的可用性通常会在系统分布式和去中心化后得到提升。尽管在分布式账本（DL）网络中没有单一的中央攻击点，但 DLT 系统并非对服务拒绝或其他影响可用性的攻击免疫。这些攻击针对的是 DL 网络服务、共识过程或去中心化应用。拒绝服务可能只影响选定的网络节点或网络参与者。除了 DL 网络，系统中很少有去中心化的实体容易受到传统的分布式拒绝服务（DDoS）攻击。这些攻击限制了例如预言机和 API 服务器或链下和辅助服务的可用性，例如加密货币交易所和挖矿池。

各种向量经常汇聚到一个攻击区域。第一个目标是获得对网络、网络的一部分或个别节点的控制，然后利用这种控制来操纵交易并影响完整性。其中一些攻击向量可能非常难以执行且成本高昂。在真正的去中心化 DL 网络上，它们可能几乎是不切实际的。然而，在更集中、私有或共识网络上，风险依然存在。

表 3.1：区块链技术在物联网中的机密性、完整性和可用性方面。

|  | 方面 |
| --- | --- |
| **机密性** |

+   区块链数据默认不是机密的。

+   公共网络中的伪匿名性。

+   私有和联盟网络提高了机密性。

+   零知识机制用于保护隐私。

|

| **完整性** |
| --- |

+   完整性是分布式账本技术的亮点。

+   然而，风险无处不在。交易篡改通常发生在节点或网络参与者被拒绝信任访问分布式账本网络服务之后。

+   分布式账本技术交易和智能合约的不变性带来了相关的新安全性和隐私风险。

|

| **可用性** |
| --- |

+   分布式账本技术的分布式特性增加了链上数据和服务的可用性，与集中式解决方案相比。

+   新的攻击向量可能会损害网络可用性。

|

尽管本节中强调了某些安全性限制，但分布式账本技术系统的可信性质使得物联网系统能够进行进一步的安全增强 [47]. 这些范围从数据管理和完整性到机密性和 PKI 管理，具有去中心化的后端和去中心化的方法来认证和授权物联网设备和用户。

### 3.1.1 机密性和隐私

共享账本是一个普遍的真理，确保了分布式账本技术系统的信任。在公共区块链网络中，对账本的访问根本不受限制。任何人都可以访问、阅读和重新分配账本的内容，包括所有交易。任何人都可以在区块链网络中分析每个过去交易的每一个细节。在公共网络中，用户不必出示任何个人身份信息即可创建新的区块链账户。这使得他们的个人身份保持私密，但账户活动，包括加密货币余额，都是公开的。公共 DL 网络因此是伪匿名的。通常，出于监管原因，用户在加密货币交易所创建账户时必须验证其个人身份。这将其个人身份与其公共区块链账户联系起来，并丢弃了他们的匿名性和隐私。

在受许可的网络中，只有经过认证的节点才能访问账本。账本的访问不再是公开的，而是限制在已知的网络参与者之间。这对与业务相关的区块链系统非常有利，例如工业物联网、智能电网等。除此之外，通常没有其他的账本访问控制。受许可的网络通过排除匿名公众来增强交互的隐私，但仍不支持传统在线应用中知名的机密性和隐私性。

交易中的用户内容（例如，存储在以太坊交易中的数据）可以被加密。这可以是端到端加密，这不是分布式账本网络协议的固有特征，而是由离线应用实现的。在这种情况下，区块链交易被用作加密内容的传输机制，并在链外解密。这种方法增强了交易中用户数据的机密性，但限制了在智能合约中对用户数据的利用。

此外，区块链交易流量也可能暴露用户信息和使用模式。我们可以对公开的链数据进行大数据分析，揭示重要账户和 DApp 的使用模式。这些方法正在被用来分析交易的可追溯性、交易混合、加密货币洗钱和智能合约的使用，这影响了用户隐私。

区块链研究的一个方向[48]旨在提供零知识证明，除了证明交易有效外，不揭示关于交易的其他任何信息，以增加区块链的隐私。通过复杂的加密方法，零知识证明可以证明某事是真的，而不必透露它究竟在证明什么。最早的例子之一是 ZK-SNARK，用于 Zcash。除了零知识证明外，零知识方法已作为隐私保护的基线，包括安全多方计算、承诺方案、ZK-SNARK、ZK-STARK、环签名和同态隐藏。ZK-SNARK 最初需要一个或多个可信方来设置零知识证明系统，这些可信方可能会泄露整个系统的隐私。ZK-STARK 通过消除可信设置的需要改进了这项技术。ZK-STARK 的集成正在考虑作为以太坊 2.0 可能的特性之一。

### 3.1.2 可用性

分布式账本网络攻击通常是进一步攻击的基础，这些攻击影响完整性。它们针对分布式账本网络的治理或运营，目标是控制大多数节点，从而控制整个账本（例如，51%攻击）。网络攻击还可能试图将分布式账本网络分割成几个分离且不兼容的分区，或使选定节点与剩余的可信节点隔离（日食攻击、Sybil 攻击）。

这是通过向攻击中的节点呈现一个区块链的欺骗性状态来实现的，通常是通过操纵攻击中节点的 时间感知（例如，时间劫持、延迟攻击）。

挖矿节点和共识机制也存在风险。挖矿节点可以不诚实，自私地行为并保留一些已经挖出的块（例如，自私挖矿、块保留）。这样，矿工试图增加他们奖励的份额。有效的对策包括应用块定时器或增加矿工池分配的随机性。

## 3.2 数据管理

尽管区块链是分布式数据库，但公共区块链网络不能直接满足物联网系统后端数据库替换的需求。交易结构针对区块链操作进行了优化。通过分布式共识，新的条目添加到存储中，以确保分布式特性、不可变性和没有中央权威。然而，它不能满足传统或分布式数据库的高吞吐量、低延迟、丰富的权限设置或查询能力 [47]。

区块链协议中的一些协议允许在交易中放置附加数据。这些可以是智能合约调用中的参数，甚至是任意数据，例如，Ethereum 交易中的 JSON 输入字段。然而，交易中包含的大量数据会导致链上数据大量增加，以及链上存储数据的成本。

物联网应用产生了大量的流量，并且通常对延迟非常敏感。因此，大多数基于区块链的物联网数据管理方法，如 IPFS、FairAccess、ENIGMA 或 BigchainDB，采用混合方法并不令人惊讶。这些方法结合了离线存储和区块链功能，将管理功能分配给区块链，以确保完整性和透明度，在需要可审计记录的应用中。只有较小的信息存储在链上，例如离线数据的哈希值或访问控制信息。尽管将大部分流量从区块链网络卸载，但这些方法仍然需要提供比公共区块链网络更低的延迟和更高的吞吐量记录保持；因此，使用私有或联盟区块链。

例如，BigchainDB 从大数据分布式数据库开始，然后添加了区块链特性，如通过投票联邦进行去中心化控制、不可变性和数字资产转移。一旦存储，数据就无法更改或删除。同时，它还支持任何 MongoDB 查询以搜索所有存储的交易、资产、元数据和区块的内容。

如图 3.2 所示，BigchainDB 可以无缝地集成到传统的应用堆栈中，作为一个区块链数据库，用于去中心化的时间戳、证书、智能合约和交易。同时，它也可以是一个完全去中心化应用的一部分，其中处理和文件存储都是去中心化的。

![](img/b_9783110681130-003_fig_002.jpg)

图 3.2：BigchainDB 应用的参考堆栈——传统和去中心化应用堆栈。

他们在一个集成的物联网区块链平台上采用了混合方法来确保感测数据完整性[49]，其中大文件存储在单独的离线数据库中。该系统利用了一个私有的受许可的 Hyperledger Fabric 区块链网络，以及一个专用的物联网服务器，用于关键设备和用户服务。系统中的应用程序逻辑部分采用传统方法实现，部分作为智能合约实现。该系统允许用户注册和设备注册，其中证书授予通信实体，以验证其交易。它为设备数据提供了一个不可篡改的日志，并允许轻松访问已部署的设备。

## 3.3 认证与授权

认证和授权是任何信息通信技术（ICT）系统中管理各种实体（如用户、设备和服务的）访问的两个基本步骤。它们基于唯一的实体标识符、一组机制来验证特定实体的身份，以及规则来授权系统中的预定义权利和服务集合。

在物联网（IoT）中，常见的识别、认证和授权方法需要进行调整，以避免复杂且大规模的物联网网络基础设施中的单点故障，并简化受限、无人的设备的注册和认证过程。

区块链技术可以有助于设备识别，例如，通过为设备分配唯一的区块链地址来进行认证和授权。基于区块链上的智能合约能力，后者验证其身份并授予适当的权利。基于区块链的方法的额外好处是，认证和授权行为的透明且不可篡改的历史记录。

### 3.3.1 识别与设备注册

对于认证和授权，任何 ICT 系统中的用户、设备和服务的身份必须是独特且可区分的。对于设备来说，这可以是由制造商分配的硬件地址（例如，以太网或蓝牙设备的媒体访问控制地址和移动设备的 IMSI）或注册过程中授予设备的标识符，例如，账户地址、代币或区块链账户。一些新的识别技术依赖于设备指纹识别。在这种方法中，设备没有显式的标识符。相反，监控和分析设备的通信模式以唯一地识别设备。

在物联网（IoT）中，新设备的注册阶段可能相当具有挑战性。注册过程必须可靠、安全，同时最小化或甚至消除任何人工干预。这在大量部署无人驾驶设备的情况下尤为关键。注册的后端可能依赖于区块链技术，也可能不依赖。在不是基于硬件标识的物联网系统中，通常由设备所有者执行注册。例如，如果使用区块链地址来标识设备，它通常是由人工分配的。通常，关于设备钱包控制的细节并没有被清晰地解释。这可能导致与 PKI 私钥管理相关的相关硬件安全风险。因此，许多基于区块链的物联网系统主要关注用户和服务的安全认证和授权，这并不令人惊讶。

一种简化物联网设备注册的方法，在很大程度上实现自动化，其中设备被赋予一个唯一的基于区块链的地址进行标识，可以模仿例如 WPA3 中管理的网络访问的 Easy Connect 方法。它通过使用二维码、NFC 标签、从云下载的设备信息或用户选择的配置器（如智能手机）来简化设备配置。基于区块链的此注册过程的适应结果将是后端系统中的一个独特的区块链地址，并分配给设备以进行后续授权。

对于用户和服务来说，已知的识别原则可以被适用来利用区块链技术。自主主权身份（SSI）是一种基于去中心化技术建立数字身份的新兴方法。与某些中心化的身份范式不同，其中一些中心化的可信发卡机构提供身份证明，SSI 用户控制他们验证信息的范围和使用。SSI 以用户为中心，注重隐私，减少了个人数据的无意分享。在 SSI 系统中，实体通过去中心化标识符（DID）来识别。DID 的信任和管理由区块链技术保证，并且 DID 可以与中心化注册表、身份提供者和证书机构解耦。尽管 SSI 的初衷是为了提高数字公民的安全性和隐私性，但同样的框架也可以适配于非人员主体，因此，也可以适用于物联网（IoT）[50]。任何东西都可以成为 DID 的主题：一个人、一个群体、一个组织、一个物质物品、一个数字物品、一个逻辑物品等。

### 3.3.2 认证

当一个独特的区块链地址被分配并用于标识设备时，可以验证特定设备创建的每一笔交易的 authenticity。如果一个设备拥有与给定区块链地址关联的区块链账户，它就可以创建有效的交易。可验证的交易来源是区块链系统的基本信任特征。因此，如果一笔交易源自正确的设备地址且该交易是有效的（在区块创建过程中没有被拒绝），我们可以假设它是由真实的设备创建的，而不是由其他声称相同身份的设备创建的。

如果需要通过认证来访问一些链上的智能合约功能，那么访问授权可以完全依赖于这种认证。例如，在以太坊智能合约中，Solidity 有一个 tx.origin 全局变量，它返回发送交易的账户地址。然而，基于 tx.origin 的认证可能面临交易来源攻击，这是一种钓鱼攻击。因此，智能合约中的 tx.origin 认证通常与 msg.sender 变量结合使用，该变量识别发送智能合约的地址，而不是原始账户地址。具体内容请参见第 2.4.4.2.4 节。

区块链系统也可以仅作为底层技术，用于在链下服务中认证和授权设备的访问控制。在这种情况下，去中心化应用程序的目的在于安全地为设备、用户或后端系统提供适当的识别和认证信息，例如令牌、一次性密码、IP 地址或证书。这些信息随后用于验证给定实体和管理服务访问。除了识别和认证信息，这种方式我们还可以为实体颁发一些初始授权数据或凭证。在这里，基于区块链的设备识别和认证主要不是关于访问智能合约方法，而是关于访问物联网架构中的其他实体。

严格的访问控制需要通信设备的确切身份。在物联网中，一个专用的网关通常管理这些身份，然后在与其他实体认证时使用它们[51]。这些身份的形式非常多样，例如，独特的虚拟 IPv6 地址、一次性密码、不可伪造的令牌或其他凭证。

### 3.3.3 授权和访问控制

传统的访问控制技术管理用户和设备访问同类实体提供的能力和服务的能力。OM-AM 参考模型可以帮助我们在异构环境中定义组织安全和访问控制策略。这是一个四层模型，每层都是单独设计的。在每层的水平方向上，我们可以比较不同的访问控制方面。在垂直方向上，我们可以比较和组合不同的访问控制策略。参考模型如图 3.3 所示[52]。OM-AM 代表目标、模型、架构和机制。目标和模型（OM）层阐述安全目标是什么以及应该实现什么，而架构和机制（AM）层解决如何满足这些要求[52]。

![](img/b_9783110681130-003_fig_003.jpg)

图 3.3：物联网授权参考模型。

#### 3.3.3.1 授权模型

可能的访问控制模型在许多方面存在差异，包括粒度、灵活性、集中度和互操作性。因此，它们并不都适用于物联网系统的实现。在 3.3.1 节和 3.3.2 节中，我们突出了一些用分布式账本技术（DLT）识别和认证物联网设备的可能方法。然而，去中心化方法仅仅是一种选择，设备识别可以采用传统（集中式）方式进行。同样，访问控制可以利用集中式或去中心化方法。

基于身份的访问控制（IBAC）是一种关注基于实体认证的身份访问数字信息或服务的安全类型。自主访问控制（DAC）考虑了认证的身份和实体所属的组。在 DAC 中，主体可以相互转让访问控制。因此，这个名字是自主的。随着设备数量的激增，IBAC 和 DAC 变得不适合物联网，因为几乎不可能为系统中的每个人管理适当的访问控制列表。

另一方面，在强制访问控制（MAC）中，安全策略由安全策略管理员集中控制。用户无法覆盖或修改此策略——因此，强制性。MAC 的一个风险是高度集中化和控制器单一故障点。位于不同位置或具有不同功能的物联网设备可能属于不同的管理组织。这为集中式强制访问控制模型带来了另一个相关问题，它不适合物联网系统。

我们可以同时实现 MAC 和 DAC，其中 DAC 指的是实体可以相互转让的一类访问控制，MAC 指的是对第一类访问控制施加约束的第二类访问控制。

基于角色的访问控制（RBAC）使用预定义的角色，这些角色携带一组特定的权限。它也可以强制实施 MAC 和 DAC 访问控制模型。尽管 RBAC 被用来管理拥有数百名用户和数千个权限的大型组织的访问控制，但它可能对物联网不够灵活和可扩展。

基于属性的访问控制（ABAC），也称为基于策略的访问控制，更加灵活和可扩展，动态性更强，可以提供物联网所需的更细粒度的访问控制。系统中没有访问列表或角色。相反，为每个设备分配属性，只有拥有足够匹配访问策略的属性的人才被允许。策略可以表达复杂的布尔规则集，并可以评估许多不同的属性。在几个示例中，分布式账本技术（DLT）被应用于记录 ABAC 中属性的分布。在[51]，提出了一种适用于物联网的简化 DLT 基础访问控制协议。

大多数传统的访问控制模型面临一个共同的问题——需要一个可信的中心来确保信任。此外，在[52]，他们对物联网的各种访问控制方案进行了广泛的回顾。结论是，传统的访问控制机制可能不完全适用于资源受限的环境。

#### 3.3.3.2 OAuth 授权架构

OAuth 2.0 [53] 是一个广泛应用的授权框架，它引入了一个授权层，并将客户端的角色与资源所有者的角色区分开来。这个标准化的协议为网页或桌面应用、移动设备、应用或物联网提供了具体的授权流程(图 3.4)，并简化了整体的授权架构和客户端开发。在 OAuth 中，客户端请求访问由资源所有者控制并由资源服务器托管的资源，并颁发一套与资源所有者不同的凭据。

![](img/b_9783110681130-003_fig_004.jpg)

图 3.4：OAuth 授权流程。

客户端不是使用资源所有者的凭据来访问受保护资源，而是获得一个访问令牌——一个表示特定范围、生命周期和其他访问属性的字符串。访问令牌是由授权服务器颁发给第三方客户端，并得到资源所有者的批准。OAuth 不在客户端和资源提供者之间传递身份验证数据，而是作为授权令牌。客户端使用访问令牌来访问由资源服务器托管的受保护资源。然而，[54] 表明，在资源受限的设备上运行所有 OAuth 逻辑可能是不可能的，因为它的高通信和计算开销。

#### 3.3.3.3 去中心化授权示例

公平访问 FairAccess [55] 是早期尝试使用区块链实现物联网的去中心化授权管理框架之一。作为最早的尝试之一，它指出了在识别和认证中需要细粒度、隐私、透明度和主权。该实现反映了区块链技术的初级阶段。在公平访问中，他们使用区块链的 UTXO 模型以及类似 BTC 的地址来标识所有交互实体。底层区块链网络不支持我们今天所知的智能合约。它使用新类型的交易来授予、获取、委派或撤销用户访问权限。脚本语言用于表达细粒度和上下文访问控制策略，这些语言被包含在这些交易中。获取受保护资源需要一个访问令牌。交易在请求者满足模型中描述的所有访问控制条件并包含在交易中之前，不会传递访问令牌。作为这个想法的概念验证，两个访问控制模型（身份和受权限的访问控制模型）已在实现中使用。

由于 OAuth 依赖于一个可信的第三方认证提供者，该提供者完全控制着用户数据，认证服务器可以阻止某些应用，从而拒绝应用程序提供的服务。DAuth [56] 提供了一个基于以太坊区块链的类似 OAuth 的认证服务。去中心化的方法提供了无需信任的架构，并增强了透明度和用户控制。在 DAuth 中，资源所有者（用户）在认证智能合约中注册其区块链地址。对于授权，后端应用程序请求智能合约中的用户区块链地址，并与此同时要求用户使用相同的区块链账户凭据签署一个认证请求消息。然后比较用户和智能合约的签名。如果它们匹配，应用程序向用户提供资源。

VaultPoint [57] 是一种基于区块链的自主权身份管理模型，符合成熟且流行的 OAuth 2.0 标准。它遵循 OAuth 的授权码授予类型，包括客户端授权、用户认证和访问令牌的发放。提出的模型可以使 Web 或移动开发变得简单，并减轻用户学习新的认证和授权流程的负担，因为他们已经熟悉 OAuth。利用区块链，提出的模型为用户和客户端信息提供去中心化和完整性，并确保认证和授权流程的可靠性。该系统基于以太坊区块链。使用了三种智能合约——身份验证、通知和客户端管理合约。提出的模型不仅解决了现有由大型公司主导的联合 ID 管理模型的信息集中化和隐私问题，还使用户能够安全地访问并拥有自己信息的主权。

## 3.4 货币化

分布式账本技术可以成功地保存货币交易的信任记录。如果将分布式账本技术的这一方面与物联网相结合，它将促进新商业模式的发展。物联网生态系统在应用、技术和涉及的利益相关者方面可能非常异构。例如，在一个智能城市的去中心化生态系统商业模式中，可以优先考虑整个社区和更广泛生态系统目标的整体利益，而不是最大化参与个体参与者的碎片化价值 [58]。

物联网商业市场是多面的。生态系统中参与的不同的实体可以为市场的多个方面服务，并在商业模式中扮演各种角色。参与者的多面角色不仅影响商业模式，它们直接在系统中施加身份验证和授权，这得到了去中心化方法的支持。参考第 3.3 节。在第 3.6 节的一个说明性例子中，我们在一定程度上展示了这样一个多面利益相关者环境。例如，每个参与的自主机器可以充当服务提供商或服务消费者。

有几个供应商参与了物联网生态系统的提供，包括软件和硬件供应商、通信和信息服务提供商以及解决方案提供商。他们需要对其对物联网基础设施的投资以及服务提供进行补偿。在物联网生态系统中，数据的所有权和共享中数据货币化起着关键作用。物联网设备产生的数据通常伴随着丰富的上下文信息，这些也可以进行货币化。然而，这需要对数据进行高效和细粒度的控制。在数据货币化中有两个突出的商业模式。首先，数据所有者将其数据提供给第三方提供商以换取服务，其次，所有者在使用相同服务的同时支付以保持其数据的安全。

分布式账本技术的货币和非货币方面可以结合在同一个去中心化的物联网解决方案中。然而，这带来了与分布式账本（DL）网络架构及其为不同应用需求而互操作性相关的新问题。看似技术背景相似的网络在实际实施、治理和性能上可能会有很大差异。在物联网的去中心化货币化中，一方面强制实施一个面向用户的公共、无需许可的网络。在另一方面，一个受许可的联盟网络满足了机器接口的性能要求，降低了交易成本。

## 3.5 物联网与分布式账本的集成方案

嵌入式物联网设备通常以其长时间内电池自给自足而著称，并且由于其大规模生产，往往倾向于严格控制生产成本。这限制了物联网设备的计算和存储能力以及它们的加密能力。为了物联网的能效，广域网（例如，LoRaWAN，NB-IoT）或个人区域网（例如，蓝牙）等无线通信技术也被优化以实现低功耗操作。因此，物联网设备通常不作为完整的区块链节点使用，因为计算和通信开销不能证明潜在的好处，或者因为在一个受限的设备中实现完整的区块链节点根本是不可能的[47]。

受限设备的处理能力阻碍了高级加密协议的使用，并限制了受限设备可以执行的区块链功能。有限的存储使得在物联网设备中保存整个链数据或甚至所有区块头成为不可能。

区块链网络节点的通信流量包括与区块链网络同步所需的持续流量和由于事务提交和事件通知引起的间歇性流量。持续流量源于分布式账本网络的操作，不受去中心化应用的设计和实现影响。减轻物联网设备上的持续流量的唯一方法是放弃区块链同步协议，并将它们分配给更强大的边缘网关。间歇性流量取决于应用程序，并且可以通过适当的去中心化应用工作流设计在一定程度上限制。它仅在设备-机器接口（MI）向网络提交新事务以获得确认时发生，或者当设备接收到与设备中的 MI 应用程序有关的状态变化的通知时，为了对智能合约做出反应。

物联网设备的有限用户交互，例如在没有用户界面的无人驾驶设备中，限制了区块链凭证的安全和识别所需的灵活管理和深度理解。这影响了设备注册和认证流程。

因此，物联网中的绝对去中心化是有问题的。我们可以调整区块链网络架构和协议以及物联网去中心化应用（DApp）和物联网机器接口的设计，以应对物联网设备的限制，并确保所需的网络性能和延迟。

### 3.5.1 物联网的分布式账本网络

分布式账本网络在第 2.3 节中详细讨论。在物联网中，我们试图调整性能、可扩展性、网络成本和隐私。物联网设备对分布式账本网络的要求可能与去中心化金融（DeFi）应用程序的要求不同。如果这些不同的应用程序方面需要在同一个去中心化应用程序中结合，则可以同时应用公共网络和联盟网络（第 2.3.3.3 节）并进行跨链（第 2.3.3.3 节）。在公共网络中，可以使用来自 PoW 的其他共识算法，例如 PoS 或 PoA（第 2.3.2.1 节），以降低交易成本并提高性能。对于物联网的私有或联盟网络，可以找到简化版的 PoW 共识。然而，这将减少去中心化和固有的信任。一些分布式账本技术试图在一个网络中将金融和物联网性能（和隐私）方面结合起来（例如，IOTA）。

### 3.5.2 适用于物联网设备的去中心化应用架构

表 3.2 总结了各种实体在区块链协议执行中的参与程度，即网络节点和物联网设备。物联网设备通常充当交易发行者或请求者。全节点或轻节点并非物联网终端设备，而是专门提供区块链网络功能的实体。我们可以将区块链功能（例如，链同步、事件过滤、交易创建、验证或密钥库管理）在物联网设备、边缘网关和全区块链网络节点之间进行划分。然后，我们将离链应用逻辑适配到物联网设备上[25]. 一种常见的做法是，物联网设备仅创建并签署其交易；网关执行所有其他区块链操作，作为轻网络节点管理与区块链网络的全部通信。即使是一个要求不高的选项也是一个没有任何能力的物联网设备和一个运行所有区块链功能（包括交易创建和签署）的网关。

表 3.2：物联网区块链实体的类型。

|  | 存储 | 验证器 | 账户密钥 |
| --- | --- | --- | --- |
| **全节点** | 完整链数据 | 是 | 是 |
| **轻节点** | 区块头 | 否 | 是 |
| **交易发行者** | 无 | 否 | 是 |
| **交易请求者** | 无 | 否 | 否 |

作为交易发行者的物联网设备能够构建和签署有效的区块链交易。发行者拥有有效的区块链身份。它需要访问密钥库以正确签署发行的交易。访问密钥库需要在设备中进行可靠的认证，可能会带来硬件安全风险。构建交易后，它通过网络节点中的 API 提交给区块链网络。

在受限的基于以太坊的物联网设备架构中，如图 3.5 所示(Fig. 3.5)，我们看到区块链客户端安装在一个单独的不受限边缘网关上。这个网关能够作为完整节点或轻客户端运行所有区块链协议。设备附着到 DL 客户端 API 以利用网关提供的 DL 功能。图中的架构假设设备能够安全地保存其密钥库。该设备也足够智能，能够构建和签署交易并通过 DL 客户端 API 与 DL 边缘网关/节点进行通信。

![](img/b_9783110681130-003_fig_005.jpg)

图 3.5：物联网交易发行设备和边缘网关以太坊节点。

交易请求者是一个纯粹的物联网设备。它只运行传统的物联网协议，并且没有访问区块链密钥库的权限。它不能直接执行任何区块链特定操作，也不运行任何区块链协议。交易请求者只是组装数据以提交，并通过网络节点与其通信，然后代表其发出交易。因此，交易请求者依赖于一个网关设备，该设备将传统的物联网协议原则与区块链操作相结合。

在图 3.6 中，物联网设备的离线逻辑通过专有的通信接口与边缘网关通信，与分布式账本无关。该设备也拥有与分布式账本无关的凭据。所有功能，包括分布式账本交易创建，都在边缘网关的应用逻辑中完成，其中也保存着密钥库。这可以大大降低对设备的要求。然而，物联网设备现在无法直接从任何分布式信任增强中受益，并必须完全信任边缘网关。

![](img/b_9783110681130-003_fig_006.jpg)

图 3.6：物联网交易请求设备与边缘网关以太坊节点。

这些架构安排帮助我们应对物联网设备的通信和计算限制，通常是将受限的物联网设备纳入去中心化应用的唯一可行方法。然而，我们需要意识到这会降低系统的去中心化。因此，对整体信任可能产生的不利影响不容忽视。

## 3.6 工业物联网 DApp 示例

tetramax 技术转移实验 CORONA⁶⁰将分布式账本技术与协作机器人学相结合。这个概念验证实验在制造环境中实现了创新物联网机器自治用例，例如服务化和机器人即服务。作为一个说明性例子，一个 3D 打印机可以将其打印能力提供给系统中的其他参与者。机器或其他参与者可以为此类服务下单。服务谈判随后通过区块链交易和智能合约自主进行。打印机记录生产过程。这作为完成工作的确认，并记录在区块链上。基本用例图示在图 3.7。

参与者拥有独特的区块链账户，并通过区块链地址进行识别。用例活动中的业务逻辑通过智能合约实现，并通过机器和用户界面执行。机器通过单板计算机中的应用与区块链系统接口。可信机器作为预言机，从外部世界向智能合约提供数据。

![](img/b_9783110681130-003_fig_007.jpg)

图 3.7：分布式协作机器人系统的用例图。

机器之间的整个通信包括发布、确认和执行订单。如果任务按时完成，并提供所需的执行证明，订单就完成了。系统中放置和执行订单的关键消息交换显示在图 3.8 中。

![](img/b_9783110681130-003_fig_008.jpg)

图 3.8：放置和执行订单的消息序列。

数据和事件模型基于 UML 类图，修改后包括智能合约方法和参数，以及操作过程中抛出的事件。因此，所需系统数据被分为三类：必填、辅助以及大文件或二进制对象。关键项作为智能合约参数实现。这些是实现最小系统功能所必需的参数，例如，订单 ID 或机器地址。一些额外的参数放在交易数据字段中作为 JSON 字符串。它们也存储在区块链上，但其结构可以不直接影响智能合约代码进行调整。这允许有一定的灵活性；例如，向机器或用户描述中添加新的参数字段。大文件或二进制对象，例如，打印机配置文件、制造过程中的图像和视频证明等，由于其大小原因不存储在区块链上。相反，它们放在链下存储服务器上，只有它们的哈希值设置在链上。

解决方案是一个基于以太坊技术的去中心化应用程序。建立了一个基于 Proof of Authority（PoA）的联盟链网络，以克服区块链和物联网的一些性能和成本限制。区块时间设置为 3 秒，这比例如公共以太坊网络的区块时间要短得多。这使得可以获得更好的交易吞吐量和更低的延迟。此外，PoA 机制提供了非常可预测的区块时间，且不消耗能源。网络运行智能合约平台。UI 和 MI 通过 HTTP RPC 启用的访问节点访问区块链功能。

智能合约平台实现了注册新机器和机器所有者、选择合适的服务提供商、发布和管理订单的后端逻辑。与智能合约的所有交互都是基于角色的，并为选定的区块链账户定义了一个角色。这使得可以安全地执行整个智能合约功能。

用户界面允许对系统进行配置和监控。它用于注册和配置机器所有者的详细信息，注册新机器，以及监控与订单执行相关的事件。通用网络技术（HTML，JavaScript，Vue）和接口将区块链的特定细节和复杂性对用户隐藏起来。然而，UI 网络应用程序是区块链意识到的，只有在用户拥有必要的访问凭据并通过相应的区块链账户进行身份验证后才能运行。
