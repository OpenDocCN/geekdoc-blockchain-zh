# 11

不断发展的区块链景观

## 11.1 现实世界中的区块链应用：概览

传统系统允许中央机构、银行、证券交易所和其他可信的中介在生活的各个方面变得不可或缺，从出生注册到教育、就业、金融和土地收购；随着时间的推移，它们从中间人变成了守门人。它们限制访问，对一切收费，制造摩擦，抑制创新，并巩固其主导地位。

在这种背景下，区块链既不能承诺让用户一夜之间成为亿万富翁，也不能提供保护其金融活动免受政治动机政府干扰的方法。但可以肯定的是，它可以通过一种彻底的、去中心化的会计方法显著降低信任成本，并提供构建经济组织的一种创新方式。

因此，区块链在现实世界中几乎每个行业都有无限的应用。账本技术可以应用于验证证书或在教育或金融领域跟踪某人的过去；它还可以在医疗保健专业人士之间安全地共享患者的医疗记录，并为科学家、研究人员和作者跟踪知识产权。目前，区块链主要应用于金融部门，但有许多传统行业中区块链解决方案提供了卓越的功能（参见图 11.1; 表 11.1; Garg, 2021a, 2021b):

![](img/c11f001.png)

**图 11.1** 区块链技术在现实世界的应用。

**表 11.1** 区块链技术在现实世界的应用。

| 领域 | 不断发展的景观 |
| --- | --- |
| 1. | 身份管理 | 政府可以实施通用数字身份来替代各种分散的身份证明——比如驾驶执照、护照、选民身份证等。 |
| 2. | 文件存储与检索 | 简化验证程序，减少欺诈性索赔。所有身份证——出生证明、学历证明、工作经历、医疗和人寿保险、结婚证明、所有权证明、公证文件、死亡证明，都集中在一张身份证上。加密但可共享的记录。 |
| 3. | 人力资源管理 | 更快地简化筛选和招聘流程。 |
| 4. | 网络安全 | 消除人力中介的需求，减少黑客攻击、腐败或人为错误的风险。 |
| 5. | 政府服务 | 提供“智能警察”并升级法律部门。承诺实现透明的行政系统。 |
| 6. | 选举过程（投票） | 为投票的投放、跟踪和计数提供强大的基础设施。消除重新计票、伪造投票和恶意行为的需要。 |
| 7. | 法律执行 | 合理化证据处理流程。政府可以监控交易并阻止洗钱活动。 |
| 8. 公共记录 | 减少基于纸张的流程，最小化欺诈，提高责任感。政府可以以一种细致的方式记录所有立法报告。 |
| 9. 公共援助 | 识别贫困、有需要或难民，并以安全和私密的方式提供人道主义援助。 |
| 10. 福利分配和民用供应 | 堵住系统漏洞，实现直接福利转移。 |
| 11. 邮政服务 | 简化与身份证关联的二维码和跟踪系统，减少成本并节省分拣时间。 |
| 12. 账单和支付 | 政府可以通过智能合约自动化传统的账单和支付系统。 |
| 13. 税收 | 政府可以加快税收流程，并在解决税收问题时提供透明度。 |
| 14. 医疗和健康护理 | 允许医院、支付方和其他医疗保健各方共享访问他们的网络。加快诊断速度并保留患者信息。提供更好的临床支持，更准确的诊断，更有效的治疗，以及更经济的护理。 |
| 15. 基因组学 | 为研究提供原始 DNA 数据文件，去除个人标识和敏感信息。 |
| 16. 临床试验 | 通过研究和临床试验，在治疗阶段找到更好的解决方案。 |
| 17. 药理学 | 更快地创新，更好地规范生产，更智能的医疗数据安全。创建一个更高效的系统。 |
| 18. 疫苗接种和社区健康 | 实现供应管理的实时可见性。验证疫苗证书。 |
| 19. 医疗索赔结算 | 自动化索赔提交、审查、批准或拒绝以及结算。 |
| 20. 保险 | 提高运营效率。消除伪造风险。降低处理时间和成本。 |
| 21. 银行 | 加快关键服务——结算、跨境支付和结算，准确性提高。围栏：年金、银行存款、债券、股权、股票和衍生品。简化交易，如众筹、个人贷款、共同基金、公积金、工资和养老金。 |
| 22. 贷款和信贷 | 允许标记化债务，P2P 借贷和去中心化金融。管理身份，风险和信用评分 |
| 23. 股票交易和对冲基金 | 更有效地自动化和加强购买、出售和交易股票的过程。 |
| 24. 众筹 | 支持初始币发行（ICO）。消除资本形成的中介，直接基金创建。 |
| 25. 交易 | 提供安全的加密货币交易平台。为资产提供更高水平的 security。 |
| 26. 电子商务 | 使用户与更好的商品连接。在数字市场中促进公平。在运输和交付过程中维护商品流动的共享、时间戳记录。确保交付证明和跟踪合同细节，而无需担心数据被篡改的风险。 |
| 27. | 账户和审计 | 使用 AI 自动化会计服务。帮助审计员准确地审核数字资产。可验证的交易使企业会计更加透明。 |
| 28. | 忠诚度计划 | 允许忠诚度激励跨多个部门和无数销售点进行交换。 |
| 29. | 零售和消费品包装 goods (CPG) | 使制造商、品牌、零售商、第三方卖家、内容提供商和消费者之间能够无中间商协作。 |
| 30. | 预测市场和预测 | 应用机器学习算法培养有针对性的预测和洞察。 |
| 31. | 航运和货物运输 | 改善交易和货物跟踪。保护资产并提高舰队效率。 |
| 32. | 公共交通、旅行和流动性 | 存储和共享有关车辆效率的信息。维护时间线。将乘客与更高质量的运输连接。 |
| 33. | 网约车 | 创建了一个更加以用户驱动和价值为导向的市场。 |
| 34. | 航空旅行 | 准确记录飞机维护日志。防止超额预订。 |
| 35. | 分布式资源和物联网 | 支持设备在没有中心权威的情况下进行连接、互动和交易。管理软件更新、漏洞或能源管理。更好地处理运营挑战的系统。 |
| 36. | 信息和通信 | 实施网络租赁的共享模型。管理合同共同建设 5G 基础设施。自动化与多个国家漫游覆盖合作伙伴之间的服务级别协议的谈判、结算和实施。 |
| 37. | 消息传递 | 消除了第三方监控。 |
| 38. | 酒店业 | 简化预订和销售过程。去除中间商。无缝访问酒店房间、宴会和租赁汽车。 |
| 39. | 娱乐 | 现代化娱乐渠道并确保更好的艺术家价值。通过流媒体进行编码、存储和分发。 |
| 40. | 游戏 | 为游戏提供高端技术。在数字空间提供统一的竞技场，奖励和交换。 |
| 41. | 食品和饮料 | 通过二维码追踪食品的来源。揭示了产品从农场到餐桌的完整旅程。 |
| 42. | 渔业 | 使行业更加可持续、环保且符合法律规定。透露从诱饵到餐桌的完整生命周期。 |
| 43. | 畜牧业 | 揭示动物的基因组谱、所提供的饲料及其医疗历史。改善食品安全、可追溯性和可持续性。推进家畜的育种和养殖。 |
| 44. | 农业和自然资源 | 保护供应链中的交易、市场扩张和特定产品的物流。数字化粮食的购买、销售和储存。 |
| 45. | 基础设施和能源 | 促进分布式能源发电方案。允许人们向邻居发电、购买和销售能源。 |
| 46. | 制造业 | 实现智能制造业。优化时间、速度，并降低成本。 |
| 47. | 房地产（土地注册、所有权和转让） | 保存土地和房产证、注册、营业执照。追踪和转让土地证、房产证、抵押权等。 |
| 48. | 建筑行业 | 在多个团队合作中追踪材料来源和建设进度。根据项目里程碑自动支付。 |
| 49. | 汽车行业 | 追踪车辆历史，包括租赁和保险。根据产品生命周期验证 genuine 备件。 |
| 50. | 遗嘱和遗产 | 在确认后自动执行遗产信托的合规性，消除法院的需要。执行授权书、合同、信托、抵押和遗嘱。 |

## 11.2 电子治理

世界上许多国家都开发了自己的电子治理系统，以向其公民提供关键服务。在大多数国家，这些系统存在隐私和安全问题。尽管许多学者已经尝试解决电子治理系统的安全挑战，但大多数现有的框架和模型并不符合安全要求。此外，不能忽视对互联网中介交易的信任缺失和系统内部人员的未授权访问。从这个角度看，使用区块链技术似乎是解决这些不足的唯一选择。它确保了安全、高效和更好的公共服务。

在过去的四年到五年里，数百个区块链项目已经被组织起来，用以替换三十多个国家的政府系统（见图 11.2）。爱沙尼亚已经实施了基于区块链的 ID，用于公民身份验证（见表 11.2）。在澳大利亚和乌克兰，它被用来构建电子投票系统。美国正在使用区块链安全地共享医疗信息，英国正在改善公共服务。分布式账本正在格鲁吉亚和洪都拉斯管理土地登记（Myungsan, 2018）。

![](img/c11f002.png)

**图 11.2** 区块链技术在政府部门中的应用。

**表 11.2** 不同国家使用区块链的情况。

| 联合国 | 援助分发 |
| --- | --- |
| 格鲁吉亚 | 土地注册 |
| 英国 | 福利支付 |
| 爱沙尼亚 | 身份管理、电子投票、健康记录 |
| 新加坡 | 银行间支付 |
| 美国（特拉华州） | 智能合约、公共档案 |

爱沙尼亚使用数字 ID 作为：

+   为在欧盟内旅行的爱沙尼亚公民提供合法的旅行身份证

+   国家健康保险卡

+   登录银行账户时身份验证的证明

+   数字签名

+   用于 i-Voting 的仪器

+   一个用于电子处方、检查医疗记录、提交税收索赔等工具

## 11.3 供应链管理

每天都有数十亿产品通过复杂的供应链在全球范围内的每个角落进行制造和供应。然而，关于这些产品何时何地起源、制造和使用，在其生命周期中却知之甚少。甚至在到达最终消费者之前，商品就要通过庞大的零售商、分销商、运输商、仓储设施和供应商网络参与设计、生产、分销和销售。然而，在几乎每个案例中，这段旅程对消费者来说都是一个未解之谜（Jessi, Jutta, 和 Wood, 2016）。

供应链正在变得越来越复杂、精致和全球化。世界上一个角落的事件可以停止另一个角落的生产、分销或供应。当由于关键因素（自然现象、基础设施故障或假冒产品）导致服务交付中断或受影响时，不仅供应链，整个经济都会崩溃。生产商、销售商、分销商、收货人和仓库不仅遭受经济损失，还影响消费者的日常生活。

因此，供应链可见性是导致大多数公司对其第二层和第三层供应商知之甚少或一无所知的重大商业约束。将透明度和可见性纳入端到端供应链有助于产品从原材料到制造、测试和最终产品供应的流动。这可以通过进行新类型的分析来采取补救措施，以改善运营、可见性和可持续性。

然而，操作和可见性，即在所有相关方之间维护关于每种产品的信息流，需要数据收集的高度准确性和数据存储的安全性。目前，这一责任由少数政府实体、非营利组织或拥有集中信息存储的第三方来执行。作为一个制造系统单元，这样的组织可能会故意滥用信息以施加压力或损害任一方。此外，这些机构必须具备有效存储和处理敏感商业信息的技术能力。

可持续性标准和认证对供应链管理提出了另一个问题。认证标志，如 ISO、ISI、FPO、生态标志、有机和公平贸易，已成为向消费者提供关于产品生命周期更好理解的关键工具（Baier，2005 年；Elder、Zerriffi 和 Le Billon，2013 年）。然而，最终结果只是一个印在产品上的认证标志或徽章，向普通消费者保证政府和公司以最大的诚信制造了该产品。尽管这种认证的成本也由消费者自己承担，但消费者既不了解这种认证的含义，也无法验证这一信息，因为验证这些证书的真实性是一个昂贵的过程，需要严格的审计。此外，这些标准可能表明在认证机构与企业实体之间串通的情况下，信任被滥用。

供应链中采用区块链技术可以承诺更好的输出。可以部署一个基于共享和共识的公共账本来跟踪与产品相关的来源和过程（Zhao 等人，2018 年）。区块链可以提供认证和文件，包括产品生命周期数据，这些数据用于供应链管理，并使所有各方同时能够访问。可以追踪产品从工厂到存储、运输、交付和销售的过程。这可以简化产品追踪和及时支付的过程，并在供应商和客户之间建立信任。

区块链可能具有多种类型的权威机构和贸易伙伴。注册机构通过在网络上注册参与者来提供唯一身份。标准化组织设定或定义制造商机构供应产品的标准。验证机构根据其资质为参与者（如制造商、分销商、托运人、仓库负责人、零售商和废物管理组织）提供证书，这使得他们能够将产品特定数据写入区块链。提议的区块链在供应链中为制造系统应用的概述显示在图 11.3 中。

![](img/c11f003.png)

**图 11.3** 区块链在供应链管理中的应用。

在制造系统中，随着产品在其生命周期中进展，它会经过不同的贸易持有者或商业实体——制造商、供应商、生产商、分销商、零售商——最终到达终端消费者。这些单位中的每一个都可以在实时基础上在网络上写下产品的相关信息。这将创建每个产品的独特数字档案，并且产品生命周期的每个阶段都应适时显示相关信息。为了简化这个过程，每个项目上可能印有条形码、RFID 或二维码，为产品在网络上提供一个虚拟身份。该代码将从唯一的数字加密标识符生成，该标识符将代表产品在系统软件上的数字档案。

贸易持有者可以通过注册商在网络上注册为区块链参与者，以获得凭据和唯一身份。注册后，将为每个参与者生成一对公钥和私钥——公钥在网络中识别参与者，私钥验证参与者与系统交易。交易方只能通过使用私钥进行加密验证来与网络互动。这确保了每个产品在供应链中交换或推进时都由相关的商业方进行数字签名。

在网络上，他们在注册时可能创建的商务实体的数字档案将显示信息，如商务身份、位置和有关实体的认证。虽然系统允许参与者保持完全匿名以维护其档案的保密性，但实体应由注册商或审计师进行认证，以维持系统中的信任。现在，每当商业伙伴在产品上签字时，它将链接到该商务实体的档案。

每个使用系统的利益相关者都可以通过用户界面访问特定的区块链网络。利益相关者所使用的软件应用程序可能由一组可信方开发，并配置以满足产品的特定要求。每位消费者都将拥有一个定制的用户界面版本，从中他们可以访问与产品相关的数据。通过提供的选项，系统软件可以浏览新产品或访问现有产品。这种软件可以在允许执行程序代码的区块链上运行，例如以太坊区块链（Buterin，2014）。

一套用代码编写的规则决定了网络中利益相关者如何互动以及数据如何在网络之间共享。一旦规则存储在区块链上，它们将严格遵行且无法更改。所有交易都存储在区块链上，经过验证后，系统的参与者可以根据其管辖范围和工作性质访问数据。

在认证和标准计划下，认证机构和审计师将访问工业单元和服务区域，检查是否遵守监管措施。在物理测试和验证产品后，审计师可以数字签名资料以证明产品。在验证后，所做的条目将可供所有参与者访问，同时保持系统的透明性，并保护数据的完整性和安全性。

### 11.3.1 在账本上进行数据记录

在提议的系统中，每个物理产品都可以在区块链网络上进行数字化表示，以便该产品的所有利益相关者都能直接访问产品的资料。贸易方可以使用他们的私钥添加数据。一个软件应用程序允许利益相关者为产品编写新的条目，这取决于产品的性质和规格。特定于产品的信息可以共享，以反映产品的某些特征或向生产商、制造商和质量控制人员传达性能数据。它可能包含有关现代工业流程、对环境的无害影响、碳足迹等信息。

在某一时间点，一个产品只能由一个单位拥有。只有该实体可以进入产品资料库中的新信息或与另一方合作执行分配的任务。当产品从一个参与者转移到另一个参与者时，双方签署一个数字合同以验证交换。为了签署这个数字合同或注册表，相关方使用他们的私钥，这有助于追踪区块链上记录的每条信息的认证来源。

网络随后会将此信息转交给下一个利益相关方。此外，前一个方的产品访问权限将被终止，现在只有新方可以创建新的条目并更新产品详情。在所有各方签署合同后，交易详情将在区块链上更新。这样，网络就能实时创建每个产品的完整历史和转让记录，所有参与者都可以访问。

因此，可以将在产品整个生命周期中的事件按时间顺序记录在区块链网络上，从提供原料的商家到最终消费者（Verhoeven, Sinn, 和 Herden, 2018）。无论产品在两个当事人之间如何交换，系统都会在产品的档案中创建一条新记录，以记录交易各方的详细信息，并记录该记录的时间。由于系统默认包含所有注册参与者的位置详细信息，因此每次创建新记录时都会记录产品的位置。这通常可以是一个独特的位置 ID，或者可以应用于供应链以确定产品实际位置的动态 GPS 数据。通过这种方式，区块链为每个人提供了一个透明的窗口，从农场到餐桌，分享关于产品规格、质量、实时和位置的全面信息。

一些产品在其使用寿命内可以被编程，以在区块链上广播其性能数据。例如，一款运动型多功能车可能连接到互联网，自主上传与其机械效率、传感器性能、高速驾驶和维护成本相关的信息至区块链。这些信息可以帮助发动机设计师做出关于发动机性能、电子产品和其他设备的有根据的决策，以提高其成本效益并改善整体的驾驶体验。此外，客户也将能够长期获得车辆的性能信息。

### 11.3.2 访问账本

接下来的图片展示了产品档案的模板，其中每个条目都由商业各方时间戳和数字签名。与产品相关的证书、时间、地点和特定产品详情都可以记录在产品的数字档案中（参见图 11.4）。为了控制信息的访问权限，可能会有某些条款和条件与产品档案嵌入。它允许每个参与者使用其私钥 authenticate 自己以访问产品的档案，并且系统允许该参与者访问档案到指定的程度。

![](img/c11f004.png)

**图 11.4** 产品档案的示例模板。

例如，像部落手工艺品这样的产品可能有一个详细说明该物品何时制造以及在哪里制造的档案。获得该物品的分销商、零售商或消费者可以访问这些详细信息，但不会知道制作该物品的具体部落名称。然而，经销商或质量控制员将能够获取更多信息，例如部落群体的身份、他们进行制作工作的城市以及他们购买原材料的地方。

通过设计、制造、生产和供应链参与业务组织可以整合智能合约，以创建更好的生态系统。这使得系统能够在保护所有级别交易的同时检测欺诈。

## 11.4 电子商务

数据安全对于公司获取客户的名字、地址、电话号码等敏感信息及其他相关详细信息非常重要。基于区块链的电子商务平台在各个层面提供全面的安全保护，包括钱包安全。

在电子商务中应用最广泛的区块链技术是以太坊。它是一个平台，让希望通过接受比特币支付的应用来管理自身区块链的电子商务品牌使用。区块链通过保护电子商务平台上百万用户的私人机密数据，确保了其安全性。区块链在全球金融格局中的兴起可能会颠覆零售市场，因为去中心化市场能够利用大规模定价、实时物流和基于区块链的加密货币交易。或许这就是为什么许多公司鼓励初创企业向前发展，加强零售商的品牌管理体系，保障国际贸易的流通，减少与金融交易无处不在的费用，并在基于区块链的电子商务上引入积分计划。将区块链技术引入供应链将帮助用户追踪他们的采购订单、存储产品、服务保修，并获得访问数据的能力。

区块链技术的一个主要好处是，它允许零售商将服务结合起来，比如支付处理、库存管理、产品详细信息等，以节省购买和维护单独系统的费用。它还扣除了银行对借记交易或信用卡公司支付处理收取的费用。由于区块链交易基本上是即时的，并且不通过传统银行，可以直接进行购买，这意味着客户可以更快地完成订单。

区块链也被称为链码。它可以存储智能合约，这些智能合约可以根据预先确定的规则和声明来自动化任务，比如自动支付或库存管理。对于那些有时间限制的产品，比如食品或药品，这尤其有帮助。区块链可以确保库存的有效性和质量，并让客户确信他们得到了物有所值的商品。

例如，你购买了一台 LED 电视，并通过区块链支付了其价格。你收到的是以虚拟合约形式的收据。据此，零售商会在指定的交货日期发送 LED 电视给你，如果未能按时送达，区块链会退还你的定金。如果你收到了 LED 电视，区块链会将你的全部付款转给零售商。作为回报，区块链存储了它接收到的现金收据和保修单据。在 LED 电视出现故障的情况下，根据存储在区块链上的账单和保修卡，验证所有权和保修变得容易。

因此，区块链似乎是电子商务市场的一个有前景的技术，因为它为在线数据库提供全天候的安全保护。在这个网络犯罪分子极具创新性的时代，这项新技术可以为交易者和客户提供一个协作和用户友好的平台。

**基于区块链的电子商务应用程序**

### 11.4.1 后端

```
**Sample database**

const mongoose = require('mongoose');

mongoose. connect(
'mongodb+srv://rishabh1234:rishabh@blockchain-ecommerce.up78i. mongodb. net/blockchain-ecommerce?retryWrites=trueandw=majority', { useNewUrlParser: true, useUnifiedTopology: true }
);

const paymentSchema = new mongoose.Schema({
id: String,
itemId: String,
paid: Boolean
});

const Payment = mongoose.model('Payment', paymentSchema);

module.exports = {
Payment
}

```

**代码单元 11.1** 电子商务应用程序（后端）。

```
**Server**

const Koa = require("koa");
const Router = require("@koa/router");
const cors = require("@koa/cors");
const ethers = require("ethers");
const PaymentProcessor = require("../frontend/src/contracts/PaymentProcessor.json");
const { Payment } = require("./db.js");
const app = new Koa();
const router = new Router();

router.get("/api/getPaymentId/:itemId", async ctx => {
   const paymentId = (Math.random() * 10000).
toFixed(0);
   await Payment.create({
       id: paymentId,
       itemId: ctx.params.itemId,
       paid: false
   })
   ctx.body = {
      paymentId
   };
});

const items = {
    '1': { id: 1, url: 'http: //UrlToDownloadItem1' },
    '2': { id: 1, url: 'http; //UrlToDownloadItem2' }
}

router.get("/api/getItemUrl/:paymentId", async ctx => {
   const payment = awaitPayment.findOne({ id: ctx.
params.paymentId });
if (payment andand payment.paid === true) { 
       ctx.body = {
          url: items[payment.itemId].url
     }
 } else {
    ctx.body = {
        url: ''
    }
 }
})

app. use(cors()).use(router.routes()).use(router.
allowedMethods());
app.listen(4000, () => {
   console.log("Server started");
});
const listenToEvents = () => {
   const provider = new ethers.providers.
JsonRpcProvider('http: //localhost:9545');
   const networkId = '5777';

  const paymentProcessor = new ethers.Contract(
PaymentProcessor.networks[networkId].address, 
      PaymentProcessor.abi,
      provider
);

  paymentProcessor.on('PaymentDone', async(payer,
amount, paymentId, date) => { 
       console.log(`
       from ${payer}
       amount ${amount}
       paymentId ${paymentId}
       date ${(new Date (date.toNumber()*1000)).
toLocaleString()}
     `);

const payment = await Payment.findOne({ id: 
paymentId });
       if (payment) {
          payment.paid = true;
          await payment.save();
        }
   });
}
listenToEvents();

```

**代码单元 11.2** 电子商务应用程序（Server.js 文件）。

### 11.4.2 智能合约

加密货币（Dai）的发行

```
// SPDX-License-Identifier: BITS
pragma solidity ⁰.8.0;

import '@openzeppelin/contracts/token/ERC20/ERC20.sol';

contract Dai is ERC20 {
   constructor() ERC20('Dai Stablecoin', 'DAI')
public {}
   function faucet(address to, uint amount) external {
      _mint(to, amount);
   }
}

```

**代码单元 11.3** 发行货币的智能合约。

迁移

```
// SPDX-License-Identifier: BITS
pragma solidity >=0.4.22 <0.9.0;

contract Migrations {
  address public owner = msg.sender;
  uint public last_completed_migration;

modifier restricted() {
  require(
   msg.sender == owner,
   "This function is restricted to the contract's owner"
  );
 _;
}

function setCompleted(uint completed) public restricted {
   last_completed_migration = completed;
  }
}

```

**代码单元 11.4** 由所有者部署智能合约。

支付处理器

```
// SPDX-License-Identifier: BITS
pragma solidity ⁰.8.0;

import '@openzeppelin/contracts/token/ERC20/IERC20.sol';

contract PaymentProcessor {
   address public admin;
   IERC20 public dai;

   event PaymentDone(
      address payer,
      uint amount,
      uint paymentId,
      uint date
   );

   constructor(address adminAddress, address daiAddress) public {
      admin = adminAddress;
      dai = IERC20(daiAddress);
   }

function pay(uint amount, uint paymentId) external { 
    dai.transferFrom(msg.sender, admin, amount);
    emit PaymentDone(msg.sender, amount, paymentId,
block.timestamp); 
   }
}

```

**代码单元 11.5** 支付智能合约（向管理员转账）。

#### 11.4.3 以太坊前端

```
import React from "react";
import { ethers, Contract } from "ethers";
import PaymentProcessor from "./contracts/
PaymentProcessor.json";
import Dai from "./contracts/Dai.json"; 
const getBlockchain = () =>
  new Promise((resolve, reject) => {
     window.addEventListener("load", async () => {
       if(window.ethereum) {
          await window.ethereum.enable();
          const provider = new ethers.providers.
Web3Provider(window.ethereum);
          const signer = provider.getSigner();

const paymentProcessor = new Contract( 
            PaymentProcessor.networks[window.
ethereum.networkVersion].address, 
            PaymentProcessor.abi,
            signer
        );
        const dai = new Contract(
           Dai.networks[window.ethereum.
networkVersion].address,
           Dai.abi,
           signer
        );
        resolve({provider, paymentProcessor, dai});
      }
      resolve({provider: undefined, payment
Processor: undefined, dai:undefined})
       })
    })
    export default getBlockchain;

```

**代码单元 11.6** 编写以太坊代码（前端）。

#### 11.4.4 货币商店

```
import React from 'react';
import {ethers} from 'ethers';
import axios from 'axios'
import { darkviolet } from 'color-name';

const API_URL = 'http: //localhost:4000';
const ITEMS = [ 
   {
     id: 1,
     price: ethers.utils.parseEther('100')
   },
   {
     id: 2,
     price: ethers.utils.parseEther('200')
   }
];
function Store() {
   const buy = async item => {
      const response1 = await axios.get(`${API_URL}/api/getPayment/${item.id}`);
     const tx1 = await dai.approve(paymentProcessor.address, item.price);
     await tx1.wait();

     const tx2 = await paymentProcessor.pay(item.price, response1.data.paymentId);
     await tx2.wait();
     await new Promise(resolve => setTimeout(resolve, 5000));
     const response2 = await axios.get(`${API_URL}/api/getItemUrl/${response1.data.paymentId}`);
     console.log(response2);
   }
}

```

**代码单元 11.7** 使用货币商店在 dApp 上进行交易。

## 11.5 分布式资源和物联网

在区块链启用的物联网平台上，人们可以选择要管理、分析、优化和允许的客户和合作伙伴之间共享的数据。

物联网中的智能设备可以通过分布式区块链网络相互连接（参见图 11.5）。许多功能已经使用区块链使物联网实现点对点通信。已经有很多研究致力于设计区块链启用的物联网，从贸易和金融到工业和学术活动的同步。

![](img/c11f005.png)

**图 11.5** 区块链启用的物联网。

在区块链中，参与者（矿工）需要通过复杂的算法解决一个加密难题。只有胜者才能编写区块并与其他矿工达成共识。这种方法在可扩展性和安全性方面是最优的，但代价是计算资源和共识速度。

物联网中的节点资源非常有限，尤其是在计算和网络资源方面，这使得它们极难解决这些复杂的谜题并在所有矿工之间传播区块。为了不降低系统性能，矿工本身可以为物联网节点充当挖矿代理，他们可以将挖矿操作卸载到附近的云计算服务器上，或者他们可以动态地租用网络资源。这样，可以提高矿工的可用性，增强区块链支持的物联网的性能。

如果由于用户的服务需求、计算能力和网络资源而限制系统性能，可以通过将用户访问选择、计算资源分配和网络资源分配制定为一个组合优化问题来增加系统性能。深度强化学习方法也可以解决这个问题。

区块链和物联网系统的集成可以有效地确保物联网应用的效率和数据安全。为了便于在资源有限的物联网端设备上使用区块链，可以使用一种带有新领导者选择方案的算法。领导者选择方案由深度 Q 网络（DQN）生成，它可以在利用有限系统资源并在多个物联网端设备之间平衡共识机制负载的情况下，在各种情况下选择领导者。

此分布式共识算法基于 RAFT，有助于减少不同类型的物联网端设备之间的差异。这使得各种物联网端设备之间可以进行区块共识，并使区块链网络的一致性更加健壮。

+   它基于分布式能源资源（DER）的理念。

+   它可以在高负载条件下保持系统安全的同时增强系统性能。

+   供应链机制中 50%的成本是由于行政开支。

+   它操作于电力供应链的能量零售阶段（能量生成、输电、分配、零售之外）。

+   它的目标是将能量传输和支付交易通过加密货币在区块链架构上进行。

+   除了电力公司之外，市场参与者还拥有发电厂和输电线路。

+   企业将这些电力卖给参与者，而这些参与者又向最终用户供电。

+   Grid+使用智能代理，即一个托管区块链交易、多签名加密钱包和 PKI 安全的计算设备。

+   智能电能通过编码高效的价格选项利用智能合约进行利用。与物联网设备的集成进一步强化了这一过程。

+   用于支付的 ERC20（等值）代币 BOLT 被使用。

+   签署交易需要 MS1、MS2、MS3 中的两个签名。

+   MS2 和 MS3 被用来控制智能代理。

+   使用智能代理托管来保留代币，并有一定的安全押金（以防过度耗电）。

基于区块链的分布式资源和物联网的其他一些用例如下：

### 11.5.1 追踪与合规

追踪运输中的产品对于安全和合规性都至关重要。存储在共享区块链账本中的物联网数据使得所有参与方都能在产品的整个生命周期中查看组件的来源。这使得与监管机构、货运商和制造商分享所有相关信息变得安全、容易且成本效益高。

### 11.5.2 交货凭证

货运运输是一个涉及不同参与方和不同优先级的复杂过程。借助物联网（IoT）和区块链技术的结合，可以存储货物集装箱在运输过程中的温度、位置、到达时间以及状态信息。不可篡改的区块链通过提供一个统一的真相来源，帮助所有参与方可靠、快速、高效地移动产品。

### 11.5.3 维护记录

物联网设备还追踪关键机器的安全状态及其维护情况。区块链提供了一个不可篡改的操作数据账本和随后的维护记录。维护合作伙伴可以持续监控区块链上的预防性维护，并直接在区块链上记录他们的工作。操作记录也可以与政府实体和认证机构共享，以验证合规性。

## 11.6 去中心化流媒体

视频具有吸引力、教育性和赋权性，但对于公司来说，它们的流媒体传输成本极高，而直播的成本更高，因为通过互联网分发视频的广播商必须先进行转码。这就是视频流媒体占据所有互联网带宽 80%的原因。

视频广播商最大的成本开支是转码，这个过程涉及将原始视频转换和重新格式化，以确保它可以在多种设备和宽网络带宽上播放，从而提供沉浸式的观看体验。对于像亚马逊这样的云服务来说，这个过程的成本大约从每流每小时 3 美元到每月 4500 美元不等，用于媒体服务器。随着 4K 视频、VR 流媒体、超高清视频等的到来，视频服务的需求迅速增长，取代了互联网上的传统和广播频道。为了跟上即将到来的需求，视频基础设施需要更多可扩展和经济的解决方案。

Livepeer 旨在通过让广播者访问众多分布式处理器，彻底改变视频转码市场，使应用开发者能够在一种可访问、安全且成本效益高的架构内生产视频。它是一个可扩展的平台，那些希望通过添加点播或直播视频使项目更加吸引人和参与性的；那些希望流式传输内容，如教育视频、编程、游戏、视频、娱乐等；以及那些拥有更大观众群体和高流媒体账单或基础设施开支的人。该公司提供了一个基于以太坊区块链的分布式视频流媒体基础设施，旨在打造一个类似亚马逊 Twitch 和谷歌 YouTube 的市场，以提高视频流传输的可靠性并降低相关成本高达 50 倍。

其教义的核心是 Livepeer 代币（LPT），用于网络上的视频转码和分发。用户拥有的 LPT 越多，他可以在网络上为单位工作收取的费用就越多。LPT 用于保障 Livepeer 网络的安全并协调支持视频编码过程的参与者任务。

### 11.6.1 运作机制

Livepeer 网络中有两个主要组件确保直播流的质量——调度器和代表。

#### 11.6.1.1 调度器

任何通过连接到 Livepeer 网络来操作软件的用户都被称为调度器。调度器将他/她的计算机资源贡献出来为广播者和开发者提供视频转码和分发服务。为此，他们以加密货币的形式获得报酬，比如 ETH，或者与美元挂钩的稳定币，比如 Dai。但为了获得在网络上执行这类工作的权利，调度器首先必须赚取 Livepeer 代币。需要注意的是，LPT 是一个协议代币，它协调网络上的工作分配。它不是一种交换代币，用于在 Livepeer 协议内支付服务。

#### 11.6.1.2 代表

Livepeer（2022）认为，并非所有 LPT 持有者都具备执行调度器角色所需的专业知识或计算能力。因此，在 Livepeer 协议中的另一组参与者，称为 Livepeer 代表，在该协议中扮演着较小但同样重要的角色。代表们选择将自己手中的代币押注在他们认为在视频转码过程中贡献了质量和诚实工作的调度器上。一旦代币押注，会在一段时间内锁定，然后可以提取出来或者用来投注另一位调度器。这有助于确保网络的安全。

#### 11.6.1.3 参与奖励

当用户向网络支付费用以进行视频广播时，编排器和委派器都会从中获得一部分费用作为奖励。这笔赚取的费用，可使用以太坊或稳定币，如 Dai 支付，与 LPT 编排器和委派器在 Livepeer 协议中的权益成正比。Livepeer 还会在一段时间内发行新代币，类似于比特币和以太坊的区块奖励，在每 5760 个以太坊区块（Livepeer 称之为一个回合）后，这些奖励会分配给委派器和编排器。在以太坊中，平均每 15.21 秒挖掘一个区块，这意味着一个 Livepeer 回合大约持续 24.33 小时（略超过一天）。

根据[livepeer.org](http://livepeer.org)的数据，如果通货膨胀率为 2022 年 3 月的 0.02185%，并且总供应量为 24,918,514.38 个 Livepeer 代币，所有参与者将在下一轮中获得总计 5,444.7 个新铸造的 Livepeer 代币。在 Livepeer 中，通货膨胀率是自动调整的，取决于总流通供应中有多少代币处于悬空状态。截至 2022 年 3 月，Livepeer 代币的总供应量为 24,918,514.38，其中 12,559,303.81 个的参与率为 50.4%。为了在网络安全和代币流动性之间达到健康的平衡，协议通过在参与率低于 50%时将通货膨胀率提高到每轮 0.00005%，以及在参与率高于 50%时每轮降低 0.00005%，来鼓励参与。

### 11.6.2 视频挖掘

视频挖掘是如何工作的？

在 Livepeer 网络上运行一个节点，宣传其将为视频转码收取的价格。继续使用你的 GPU 进行加密货币挖矿（参见图 11.6）。

![](img/c11f006.png)

**图 11.6** 通过 Livepeer 进行视频挖掘。

当视频编码任务找上门来时，Livepeer 节点会将任务分配给你的 GPUs，并且编码利用的是 GPUs 的另一部分资源，所以挖矿可以继续进行，最小化哈希率损失。没有机会成本！

先决条件：为了成为一名视频挖掘者，必须拥有配备视频编码芯片的 GPU；从互联网服务提供商那里获得实惠的带宽；以及能够持续运行区块链功能的 Livepeer 节点（24/7）。

市场上可用的大多数媒体服务器解决方案都是专有的，不是开源的。由单一公司开发，这些解决方案伴随着高昂的成本或许可费用。如果存在开源解决方案，它们通常是 incomplete, outdated, or require an upgrade to a proprietary service package to get the full set of features.

Livepeer 媒体服务器是一个开源的媒体服务器，能够接收实时视频和音频的输入流，并将它们转码成不同的编码格式。它将实时视频转换为不同的比特率，并将它们转换为不同的传输格式。这是必要的，这样一种格式和比特率的录制视频就可以在任何平台和任何设备上流式传输，而无需考虑格式和带宽规格。

由于 Livepeer 媒体服务器是经济高效协议和网络的核心组件，其开发由协议本身资助。媒体服务器可以作为任何媒体流应用的独立组件使用。实际上，它是 Livepeer 网络内运行的强大工具。同行评审和社区贡献等功能使其真正成为开源和透明的。

#### 11.6.2.1 双重挖矿

双重挖矿是一种使用相同硬件完成两种不同工作的技术。这个术语首次出现在 PoW 挖矿的背景下，它指的是使用同一 GPU 执行 PoW 哈希算法的同时，挖掘多种加密货币。在 Livepeer 网络上，双重挖矿可能仍然可行，这涉及到使用 GPU 挖掘以太坊等加密货币，同时使用 GPU 作为网络上的视频矿工进行视频转码。

双重挖矿可以首先增加 GPU 利用率，这对于 Livepeer 视频矿工来说尤其重要，因为与其他区块链网络不同，在 Livepeer 网络中 GPU 并不总是有工作可做，其次，利用现有的 GPU 创造了一条新的收入流。在双重挖矿中使用转码作为第二工作负载的一个优点是，因为它比其他可能的工作负载使用更少的 GPU 核心，因为 GPU 的硬件编码器和解码器完成了大部分繁重的工作。有关从 GPU 核心分离视频编码和解码的更多信息，请参阅 Nvidia 的视频编码和解码文档（Nvidia，2022 年）。

#### 11.6.2.2 权衡和考虑

在双重挖矿时，还有一些考虑和问题：

+   VRAM 很可能是大多数情况下转码容量的限制因素。其他活动（如以太坊挖矿）使用的 VRAM 越多，同时可以转码的流就越少。在进行双重挖矿时，具有更高 VRAM 的 GPU 将具有更多的转码能力。

+   在这两个工作负载之间，仍然存在性能权衡。例如，当同时转码更多流时，以太坊挖矿的哈希率将线性下降。使用新一代 GPU 的 CUDA MPS 可以帮助减缓哈希率下降的速度——更多信息，请阅读双重挖矿教程（Livepeer，2022 年）。

+   如果你目前只是进行转码操作，那么同时挖另一个加密货币会消耗你的 GPU 更多电力，特别是如果第二个加密货币使用的是 PoW 哈希算法。在考虑双重挖矿时，应当考虑到 GPU 的电力和冷却成本。

+   根据过去的测试，如果你现在只是在挖像以太坊这样的加密货币，转码不太可能提高你的 GPU 电力消耗。

#### 11.6.2.3 收入

协调者通过 LPT 奖励和 ETH 费用获得视频转码服务报酬。请注意，参与池的转码器根据池的规则进行报销。

#### 11.6.2.4 奖励

每天，一个协调者根据其总投注（包括它自己的自我投注以及其投注者的投注）收集激励。像比特币这样的 PoW 区块链的区块奖励等同于这些激励。

+   投注更多 LPT 是获得更大奖励的一种方式。

+   通过在[`explorer.Livepeer.org`](https://explorer.Livepeer.org)上的表现良好、在网络上高效运行并获得来自广播者的报酬，投注者可能会通过投注委托来吸引。

+   设置佣金率以与投注者分配奖励和费用。

#### 11.6.2.5 费用

费用支付给为广播者提供视频转码服务的协调者。如果协调者进行更多的转码，它会收到更多的钱。这些收费与比特币等 PoW 区块链上的交易费用相似。

为了通过投注更多 LPT 或吸引投注委托为广播者提供更多经济稳定性，需要通过提供访问硬件和带宽资源来最小化延迟，并扩大地理覆盖范围——这些都是产生更多费用的方式。

#### 11.6.2.6 成本

在网络上工作时产生的成本包括以太坊交易费用、硬件成本、带宽费用和电力成本。

#### 11.6.2.7 每像素定价

支付的价值基于转码视频的像素数量。在离线情况下，协调者提供每个像素的转码价格。广播者根据他们愿意花费的最大像素转码价格来筛选和选择协调者。

转码的像素数量将受到广播者请求的视频配置的影响。更多的视频配置，或者更复杂的视频配置，将需要更多的像素转码，从而产生更多的费用。

#### 11.6.2.8 概率微支付

使用概率微支付协议进行支付。

广播者向协调者提供“彩票”以换取转码结果。每张“彩票”都有一个面值，这是如果彩票中奖支付给协调者的金额，以及中奖概率。

每张票被视为对票的预计价值的微支付（计算方式为：票面价值乘以票赢得的概率）。

组织者描述所需的票券预期价值（EV）为他们愿意承担的工作量，在请求票券之前。例如，如果票券 EV 是 1000 gwei，那么组织者愿意在需要票券之前完成 1000 gwei 的工作。由于 Livepeer 中的默认票券 EV 设置为合理值（1000 gwei），因此建议组织者暂时遵守。使用非默认数字可能导致广播者由于广播者的最大票券 EV（基于默认票券 EV 设置的默认值）而排除某个组织者。

中奖票券将由组织者通过链上方式兑换，兑换金额为票券的面值。

#### 11.6.2.9 自动价格调整

组织者的默认做法是根据赎回票券的预期开销自动调整每像素的标价。赎回交易的成本除以票券面值，表示为百分比，是赎回票券的开销。例如，以 1000 Wei 的基础价格每像素为例：

+   如果开销为 1%，则标价应为 1010 Wei。

+   如果开销为 20%，则标价应为 1200 Wei。

+   如果开销为 50%，则标价应为 1500 Wei。

此自动价格调整技术的目标是允许组织者在 gas 成本高时动态调整其价格，以补偿更高的票券兑换开销。

#### 11.6.2.10 转码池

由于拆分的组织者和转码器架构，可以创建转码池。这些池类似于 PoW 挖矿池，将 PoW 散列委托给一个或多个个体矿工。池运营商是 Livepeer 网络中的组织者，而池参与者是转码器。由于转码池不是核心协议的一部分，因此池中工作的跟踪方式以及转码器的报销方式由池实现决定。

私有池和公共池是两种类型的池。

#### 11.6.2.11 私有池

根据池运营商提供的一组标准，只有已知的转码器允许加入私有池。

+   只有由池运营商运行的转码器

+   只有由与池运营商合作的实体运行的转码器

+   只有经过身份验证过程的转码器

#### 11.6.2.12 公共池

公共池允许任何转码器参与。

#### 11.6.2.13 选择

Livepeer 网络是一个开放的交易市场，广播者可以根据自己的偏好选择将工作发送给哪个组织者。选择组织者的算法因广播者实现方式的不同而有所差异，但包括 Livepeer 中的默认实现在内的所有选择算法都会考虑以下因素：

+   经济安全

+   延迟

#### 11.6.2.14 经济安全

编排者的经济保障是通过其总股份来评估的，这包括它自己的自委托股份和它委托人的股份。因为如果工作执行不正确，股份可能会被削减，所以编排者拥有的股份越多，它对广播者提供的经济保障就越多。

默认的广播者实现将倾向于那些提供更多经济保障的编排者，编排者获得工作的可能性与其在网络其他编排者中的股份成比例。然而，仅仅因为一个编排者获得了工作并不能保证它会保留它；如果编排者没有满足广播者的其他选择考虑要求，即使最初被选中，编排者也可能失去工作。

#### 11.6.2.15 延迟

编排者的延迟是从它将转码结果返回给广播者的整个时间。这包括广播者上传片段到编排者所需的时间，编排者转码片段所需的时间（在分级的编排者和转码器的情况下，这包括编排者和转码者之间的网络传输时间），以及广播者从编排者下载转码结果所需的时间。编排者的延迟由其与广播者的地理接近度决定，以及其硬件资源，这些资源影响转码速度和带宽资源，这些资源影响上传/下载速度。

在初始选择之后，默认的广播者实现将评估编排者的延迟，以确定是否继续向编排者传输工作。默认标准是转码结果实时接收，这意味着往返时间必须小于或等于片段持续时间。如果一个最初被选中的编排者未能达到这个条件，广播者可能会停止与他们的合作，让其他编排者有机会获得就业。

#### 11.6.2.16 其他考虑因素

Livepeer 选择方法随时间不断改进，网络可能会在未来使用各种选择技术。选择算法也可能考虑以下因素：

+   赚取的费用

+   声誉

##### 即将到来

基于不断发展的区块链网络，本章概述了区块链在所有主要现实世界领域的应用，包括人力资源管理、电子治理、电子商务、跟踪、合规、维护、货物交付等。

在下一章我们将努力去理解它的功能。我们还将发现如何构建一个区块链网络来保护人们免受黑客攻击和盗窃，以及技术如何使人们能够构建加密的数字身份而不是想出几个用户名和密码——以及这些身份如何可能帮助人们在现实世界中完成任务。

## 参考文献

1.  拜尔 A，2005. 有机认证过程.*美洲文学和艺术评论*，8。

1.  但特林 V，2014. 下一代智能合约和去中心化应用平台.*以太坊白皮书*，1-36。

1.  埃尔德 SD, 泽里菲 H, 和勒比尔农 P, 2013. 公平贸易认证正在绿化农业实践吗？对卢旺达公平贸易环境标准的分析.*乡村研究*，32: 264-274。

1.  高尔 R，2021a. 通过区块链的全球身份.*区块链国际研讨会*，印度，学者公园，1-60。[`doi.org/10.13140/RG.2.2.27803.18728`](https://doi.org/10.13140/RG.2.2.27803.18728) [`zenodo.org/record/5122164#.YwIvD6BBzIU`](https://zenodo.org/record/5122164#.YwIvD6BBzIU)。

1.  高尔 R，2021b.*自有主权身份*. 我们的知识出版社，葡萄牙语，1-104。doi: 10.5281/zenodo.5647905。

1.  杰西 B, 朱塔 S, 和伍德 G, 2016. 来源白皮书.*来源.org*。[`provenance.org`](http://provenance.org)。[`www.provenance.org/whitepaper`](https://www.provenance.org/whitepaper)。

1.  Livepeer，2022.*https://docs.livepeer.org/video-miners/guides/dual-mining](https://docs.livepeer.org/video-miners/guides/dual-mining)。

1.  我的尚 J，2018. 区块链政府——21 世纪第二种基础设施形式.*开放创新：技术、市场和复杂性期刊*，4(1): 7。[`doi.org/10.1186/s40852-018-0086-3`](https://doi.org/10.1186/s40852-018-0086-3)

1.  英伟达，2022.*https://developer.nvidia.com/nvidia-video-codec-sdk](https://developer.nvidia.com/nvidia-video-codec-sdk)

1.  弗尔霍文 P, 辛恩 F, 和赫登 T, 2018.*物流和供应链管理中区块链实施的例子：探索新技术的谨慎使用*. 柏林工业大学，德国柏林，2(3): 20。

1.  赵 H, 白 P, 彭 Y, 和徐 R, 2018. 健康区块链的高效密钥管理方案。中国人工智能与应用学会智能技术期刊，3: 114-118。
