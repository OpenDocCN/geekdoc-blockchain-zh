© Springer Nature Switzerland AG 2020A. M. Langer 下一代软件架构的分析与设计[`doi.org/10.1007/978-3-030-36899-9_7`](https://doi.org/10.1007/978-3-030-36899-9_7)

# 7. 区块链分析与设计

Arthur M. Langer^(1  )(1)哥伦比亚大学技术管理中心，纽约，美国 Arthur M. LangerEmail: al261@columbia.edu

## 7.1 理解区块链架构

区块链技术代表了一种有趣的架构发明，主要解决了互联网中的网络安全挑战。正如我之前所讨论的，现有的中央数据库架构无法提供启动物联网系统所需的安全性。区块链被定义为“基于账本”的系统，因为它旨在跟踪所有交易并更新链中的所有成员。实际上，区块链设计是从最初的链表数据结构发展而来的。本质上，链表最初被设计为一种数据结构，通过存储关于值存储位置的信息，链接到另一个数据元素。这是一个指针系统，显示了先前的链接和向前的链接，如图 7.1 所示。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig1_HTML.png](img/480347_1_En_7_Fig1_HTML.png)

图 7.1

链表数据结构

链表数据结构解决的问题是其能够在不要求物理存储连续的情况下存储相关数据或值。换句话说，通过这些“链接”，相关文件元素实际上可以存储在存储的不同部分和不同的物理设备上，如图 7.2 所示。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig2_HTML.png](img/480347_1_En_7_Fig2_HTML.png)

图 7.2

跨物理存储设备的链表存储

链表数据结构的重要性在于它允许将逻辑文件存储在不同的物理位置。但对于用户来说，它是不可见的，并允许系统最大化数据存储。然而，与任何数据结构策略一样，总会有不利因素。将逻辑文件分布在多个物理设备上会降低性能。对于分布在许多设备上的大型逻辑文件，甚至是在同一磁盘上分片的情况，性能会显著降低。

区块链改进了类似但目标不同的链表模型。图 7.1 中显示的链式数据结构现在更加复杂，并被定义为信息的“块”。该架构允许动态添加新块，并在进行更改时同时更新每个块。一个块，而不是代表一个数据元素，实际上代表一个账户或用户。因此，每个人在链中都有自己的块。根据区块链的设计（或区块链产品），用户可以具有相等或不相等的权利，以决定他们如何访问和更新链中的其他块。所有块都包含诸如交易日期、时间和金额之类的信息。实际上，区块链架构充当了一个修改过的链表，用于跟踪交易而不是链接数据元素。因此，这种区块链是保持账目的完美解决方案，并经常被称为基于账本的技术。

“分类帐”这个词真正源自会计专业，会计师创建分类帐来跟踪详细的交易，通常称为借方和贷方。在任何给定时刻，会计师只需添加和减去所有交易金额条目，即可计算任何分类帐账户的余额。然而，分类帐的重要特性是其审计跟踪功能，确保了构成余额的每笔交易的知识。它始终像一个流动总数一样运作。分类帐的另一个重要特性是，每次都能重新计算余额，以便测试给定余额的准确性。此外，分类帐中每笔交易的源日期都有记录。在区块链中，分类帐就是账户；每个账户在链中都有一个唯一的分类帐。在任何分类帐中的另一个重要因素是不允许修改任何交易。例如，当您需要调整会计分录时，您不会直接修改原始交易或分录，而是输入一个“调整”分录来修改余额。因此，在分类帐中，您只能创建交易或读取它，但不能修改或删除！区块链遵循这个规则，这就是为什么它提供了两个重要的好处，(1) 对块中所有行为的完整审计跟踪，以及(2) 不能撤销或修改交易，这真的限制了黑客。因此，每个区块链条目都有文档记录，并且每个交易的关联授权和日期/时间都存储在一个块中。

在区块链中，用户分类帐通过“哈希”代码键进行标识。哈希代码是一个随机计算的数字，极其难以解密，因此它为链添加了强大的安全性。区块链的每个成员都可以访问所有区块，并在其本地网络系统上保留区块链的单独副本。这意味着当一个区块被更新或一个新区块被添加时，必须更新每个副本，这当然带来了性能上的延迟挑战。然而，由于没有中央控制的区块链副本，这使得黑客很难操纵每个副本。这就是区块链为建立一个能够保护用户的互联网架构提供希望的地方。

区块链协议建立在“共识”的概念上。由于延迟问题，共识协议始终假定区块链版本中最长的链代表了用户最信任的链。因此，在复杂和大型的区块链中，更新不断发生，通常最长的链在任何时刻都是最新的。当然，共识的重要性与链中新区块的大小和数量直接相关。区块链既是私有的又是公开的。从公众的角度来看，任何人都可以查看区块链的内容，但不能在没有私钥的情况下访问帐户，私钥允许用户向区块中转移物品。还有一个重要的因素需要注意，即区块链基础设施提供了信任（更好地称为对区块的访问），但不提供区块或用户之间的直接信任，因为这最大化了区块链的安全性。有各种类型的信任，这意味着，我怎么知道你是访问区块的真实授权人。在任何区块链产品中实施的六种常见证明如下：

1.  1.

    *工作证明*：避免了黑客入侵，因为网络机器需要证明其所需的复杂算法对黑客不可用。此外，网络机器必须具有特定的配置和空间才能完成算法。工作证明往往对开发者最具吸引力。

1.  2.

    *权益证明*：要求用户证明拥有特定金额的货币所有权。在比特币区块链中，这种方法更常见，因为加密货币的交易。简而言之，所有者必须证明他们拥有他们试图交易的货币。

1.  3.

    *持有证明*：用户根据持有硬币的时间更多的权利。

1.  4.

    *委托权益证明 (DPOS)*：这允许被称为代表的用户在网络上生成新的区块。代表根据他们从其他代表那里获得的最高选票数量被分配区块。当通过拥有多个区块或帐户来评估对区块链的访问时，DPOS 是相关的。

1.  5.

    *容量证明*：这是一种算法，要求用户解决以谜题形式出现的挑战。请求者拥有的存储空间越多，就能更快地解决谜题。谜题是由服务提供者创建的。

1.  6.

    *已过时间的证明*：用户被随机分配等待时间。等待时间较短的用户首先获得访问权限。

正如人们可以看到，这些访问证明对于防止黑客入侵非常有效，与作为用户拥有权利的人相比。这就是为什么区块链对于特别是物联网应用而言如此具有吸引力的解决方案。

## 7.2 区块链的增长预测

预测区块链技术的增长将会大幅增长。德勤在 2019 年最近调查了七个国家的 1000 家公司，发现 34%的公司已经在生产中使用区块链，另有 40%计划在 2020 年投资 500 万美元！这种对区块链兴趣的爆炸性增长很大程度上可以归因于三个因素：

1.  1.

    2009 年比特币的推出是第一个成功的区块链实施；

1.  2.

    5G 的到来解决了区块链架构的延迟批评；以及

1.  3.

    需要一个允许保护物联网的网络安全基础设施。

有一些特定的行业是区块链的早期采用者，特别是银行、医疗保健、财产记录保存、智能合约和投票等行业。

### 7.2.1 区块链的优势和劣势

尽管区块链代表了一个有利于物联网设备的去中心化解决方案，但还是有特定的优势和劣势需要考虑：

优点：

+   验证准确性

+   消除第三方验证者降低成本

+   通过去中心化实现的安全性

+   透明度

+   物联网和 5G 能力

+   可扩展性

+   可审计性和可追溯性

+   更好地访问数据

缺点：

+   技术成本增加

+   仍然存在延迟和性能问题

+   吸引黑客

+   结果的短期历史

正如人们在上面可以看到的，虽然存在缺点，但积极因素更多，希望区块链能发展成为下一代新架构设计的希望。

## 7.3 区块链的分析与设计

区块链决策的许多焦点都集中在两个方面；（1）需求分析，以确定区块链实施的可行性，以及（2）关于区块链规则和治理的架构基础设施决策。尽管我将提供这两个问题的各种例子，但本节的重要目标是定义分析员在这个过程中在 SDLC 方面的责任。

总的来说，在评估区块链用例时，首选的方法是设置和选择正确的区块链设计。区块链的用例必须首先关注特定行业共有的特定功能和功能。随着特定行业的出现，可能还有处理法规以及技术要求，包括智能合约、加密货币和法律限制等。所有这些都必须成为分析功能的一部分。此外，数据需求和响应时间的速度是决定区块链解决方案及其选择的关键技术问题。因此，这不仅仅是可行性问题，而是区块链本身的整体结构，尽管在金融行业中，人们可以理解为何区块链虽然吸引人，但在涉及性能容量和可伸缩性的延迟问题时仍然受到关注。此外，分析师还必须解决交易的大小以及链中的存储需求。表 7.1 提供了分析师应准备捕获和记录的通用类型列表。表 7.1

通用区块链业务流程需求定义

| 通用需求 | 描述 |
| --- | --- |
| 数据存储 | 在块内/在块外 |
| 模式位置 | 网络中的轮辐位置 移动、物联网等 |
| 网络带宽 | G 功率（5G、4G 等） |
| 区块链类型 | 公共、私有、混合、联盟 |
| 行业 |   |
| 客户体验因素 | 用户友好性、健壮性、可访问性 |
| 系统的总体目标 | 目标段落 |
| 演员 | 人类和机器对机器 |
| 权威级别 | 可信、去中心化 |
| 外部系统接口 | 其他网络 |
| 数据结构 | 外部接口 |
| 内部功能 | 修饰符 |
| 测试 | 安全评估 |
| 外部子系统 | 用户故事、插入新区块、系统的验收测试、用户界面 |
| 前置条件 | 成为演员的要求 |

从分析和设计的角度来看，区块链本质上类似于交易处理器的许可。这几乎就像为汽车选择一种引擎。引擎的能力和限制因你希望拥有的车型以及你想如何驾驶汽车而异。诸如油耗、加速性、耐用性、可靠性以及引擎的换档方式等因素。为了安装区块链引擎，您还必须了解安装产品的最佳方式。安装还需要反映行业要求、性能偏好和监管限制。所需的设置是选择最终区块链供应商和产品的考虑因素之一。与所有第三方供应商一样，每个供应商都有产品的优缺点。当然，每个供应商都认为他们提供的是最好的产品，但也有一些区块链可能更适合特定行业，比如金融市场上的比特币。

一旦选择了产品，就会存在数百个行业和技术用例原型，可以帮助分析人员安装和设置区块链。一旦选择了产品，这甚至可能是决策的一部分；假设供应商不支持您行业所需的某项功能。设计的一个示例是 Yrjola（2019）为公民宽带无线电服务频谱提供的用例。他的模型还提供了接口的流程图、交易的生命周期流程以及用于设置区块链的决策图，如图 7.3 所示。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig3_HTML.png](img/480347_1_En_7_Fig3_HTML.png)

图 7.3

Yrjola 宽带无线电服务频谱区块链

确定需求的另一种建议方法是设计流程——一种事件序列的数据流/流程图，描述用户进入系统时发生的事件以及定义流程的决策树。Xu 等人（2017）提供了一个样例设计流程，演示了分析人员如何在图 7.4 中记录需求和逻辑流程。不可避免地，逻辑流程还会揭示数据元素的需求。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig4_HTML.png](img/480347_1_En_7_Fig4_HTML.png)

图 7.4

Xu 等人针对基于区块链的系统的设计流程

区块链设计也可以利用本书早期介绍的传统分析工具。Marchesi 等人（2018）创建的区块链智能合约系统的设计文档中可以纳入各种敏捷分析工具。他们的方法可以作为通用区块链 SDLC 的指南。在他们的特定解决方案中，作者使用了 UML 方法，但分析人员可以选择任何结构化分析方法。

+   第 1 步：以几段话的形式说明系统的目标。

+   步骤 2：确定最终代表输入和输出边界的参与者（包括人类和机器）。

+   步骤 3：制作开发流程图，如图 7.5 所示。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig5_HTML.png](img/480347_1_En_7_Fig5_HTML.png)

    图 7.5

    智能合约系统的示例开发流程

+   步骤 4：使用散文和用例图制定高级用户故事的系统需求，如图 7.6 所示。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig6_HTML.png](img/480347_1_En_7_Fig6_HTML.png)

    图 7.6

    用户故事流程图

+   步骤 5：将用户故事翻译成对象类图，如图 7.7 所示，显示实体、数据结构和操作。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig7_HTML.png](img/480347_1_En_7_Fig7_HTML.png)

    图 7.7

    源自用户故事的对象类图

+   步骤 6：制作显示可能状态及导致状态变化的流的状态转换图。图示例见图 7.8，反映了 UML 风格的状态图。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig8_HTML.png](img/480347_1_En_7_Fig8_HTML.png)

    图 7.8

    源自对象类流的状态图

+   步骤 7：根据用户故事创建函数的过程规范，如表 7.2 所示。表 7.2

    从用户故事中提取函数的过程规范

    | Function | Modifiers, parameters | Action—Notes |
    | --- | --- | --- |
    | constructor | string nameFirmstring nameAdmin[(string nameSh, address addrSh, unit 16 noShares)] | 创建投票管理合约，输入公司名称、管理员姓名以及每个股东的姓名、地址和股份数量。添加一个新的股东，提供其姓名、地址和股份数量 |
    | addShareholder | onlyOwnerstring nameShaddress addrShunit16 noShares | 添加一个新的股东，提供其姓名、地址和股份数量 |
    | Delete Sharehold | onlyOwneraddress addrSh | 删除给定股东，提供其地址。只有当股东在会议中没有积极参与时才能执行此操作 |
    | editShareholder | onlyOwneraddress addrShstring nameShunit 16 noShares | 更新给定股东，提供其地址（不可更改）、姓名和股份数量。只有当股东在会议中没有积极参与时才能执行此操作 |
    | Change Administrator | onlyOwneraddress newOwnerstring nameAdmin | 给出新管理员的地址和姓名 |
    | Convene Assembly | onlyOwner | 召集一个会议，提供会议的开始和结束日期和时间、简短描述、确保其有效所需的最低股份百分比以及单个股东可获得的最大授权数量。任何现有会议都不能与新会议重叠 |
    | addVoting | onlyOwner | 给定议会添加一个投票调用，指定投票的名称，应选择的两个选项，投票股份的最低百分比，以及需要有效投票的票数。议会不能已经开始 |
    | participate | onlyShareholder | 注册发件人对给定议会的参与，前提是议会的开始日期和时间尚未过去，并且发件人尚未委派另一股东，或者已经注册 |
    | delegate | onlyShareholder | 将对给定议会的参与委派给另一股东，前提是议会的开始日期和时间尚未过去，发件人尚未注册他的参与或委派给另一股东，被委派的股东已经注册到议会，并且尚未达到最大委派数量 |
    | castVote | onlyShareholder | 为给定投票的选择之一投票，前提是发件人参与了投票的议会，该议会已经开始并且尚未过期，并且该投票尚未投票 |
    | verifyValidity ***view*** | OnlyOwnerOrShareholder | 读取参与给定议会的股份数量，并检查是否已达到最小数量。议会必须已过期 |
    | readResults ***view*** | OnlyOwnerOrShareholder | 读取给定议会和投票名称的投票结果（选择 1、选择 2 或无选择）。议会必须已过期 |
    | deleteContract | onlyOwner | 永久删除合同 |

Marchesi 等人的样本描述了 SDLC 中典型智能合约区块链的需求文档可能的外观。虽然可能存在许多变体，但重要的是要认识到传统分析工具如何嵌入到将插入到其他各种流程和数据接口中的区块链引擎中，这些流程和数据接口是任何复杂系统中所需的更大应用程序的一部分。

## 7.4 摘要

区块链代表了使物联网成为可行和安全引擎的基本架构组件，该引擎可以并入复杂系统中。基本上，区块链将作为使用基于会计分类账系统的验证和记录交易的引擎，以防止黑客攻击。如果没有这个引擎系统，物联网无法在各个行业和特定技术中实现广泛应用。虽然我们仍处于区块链发展的萌芽阶段，但预计将会有大量的第三方区块链产品提供特定行业相关产品处理的架构。

然而，重要的是要认识到延迟问题仍然是一个很大的挑战。从其更新过程的哲学角度来看，区块链架构非常类似于旧的 IBM 令牌环结构。回顾一下那种网络设计，IBM 的计算机节点必须在一个循环环中进行顺序更新。那时的问题在于，网络设计速度太慢，无法作为网络个人计算机的可行解决方案。图 7.9 描绘了 IBM 令牌环结构。区块链架构用区块替代了个人计算机。虽然更新区块比令牌环网络结构快，但在扩展方面仍然面临挑战，特别是在移动网络系统中。虽然 5G 将使区块链更加可行，但在大型移动网络中的可扩展性可能仍然阻碍广泛使用。下一章将讨论一些潜在的解决方案，这些解决方案最终可以增加处理能力，以支持更可扩展的区块链开发。![../images/480347_1_En_7_Chapter/480347_1_En_7_Fig9_HTML.png](img/480347_1_En_7_Fig9_HTML.png)

图 7.9

IBM 令牌环结构

## 7.5 问题与练习

1.  1.

    解释区块链与链表之间的关系。

1.  2.

    什么是哈希码？

1.  3.

    比较区块链的优缺点。

1.  4.

    区块链分析与设计的两个主要目标是什么？

1.  5.

    用例与区块链分析有何关联？

1.  6.

    用例图、散文写作和迷你规范之间有什么关系？

1.  7.

    迷你规范和伪代码之间的关系是什么？

1.  8.

    如何使用用户故事完成区块链建模工具的要求？

1.  9.

    状态转换图与区块链之间的关系是什么？为什么重要？

1.  10.

    为什么区块链架构在移动物联网系统设计中如此重要？
