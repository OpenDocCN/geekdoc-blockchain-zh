# 城镇传令官和链环:丰富和扩展神谕的可能性

> 原文：<https://blog.chain.link/town-crier-and-chainlink/>

人们经常问我，智能合约是否有一天会产生真正的影响。以我的经验来看，做技术预测是一件愚蠢的事情。令人高兴的是，在这种情况下，没有必要:智能合约已经产生了巨大的影响。

智能合同通过数十亿美元的 ERC20 代币销售转变了技术风险投资，这些代币销售已经超过了早期互联网创业投资。他们甚至设法让人们在[为数码猫支付比](https://thenextweb.com/hardfork/2018/09/05/most-expensive-cryptokitty/)[最昂贵的皮毛样品](https://www.telegraph.co.uk/business/2016/05/20/ten-of-the-most-expensive-animals-in-the-world/a-bengal-cat/)(一种英俊的动物，不同于隐猫)更高的。

![Bengal cat: ~$41,000 vs. Dragon, the CryptoKitty, ~$172,000 ‌‌(Sources: Wikimedia,Cryptokitties)](img/6376a56cef85763e022cb6b5518a7509.png)

<figcaption id="caption-attachment-385" class="wp-caption-text">Bengal cat: ~$41,000 vs. Dragon, the CryptoKitty, ~$172,000 ‌‌(Sources: Wikimedia,Cryptokitties)</figcaption>



尽管他们已经赚了很多钱，但是，从技术上来说，这些聪明的合同成功是非常平凡的。象征性合同只不过是区块链的账簿或区块链。密码猫只是(不可替代的)代币。

当我第一次开始研究远古时代的智能合约时(2015 年)，似乎很明显，要做任何有趣的事情，智能合约需要与现实世界的联系。这些连接被称为 [*神谕*](https://chain.link/education/blockchain-oracles) ，在区块链系统中严重不发达。这就是为什么我的团队，在张帆的带领下，开始着手创建城镇预言家(TC)甲骨文。

看到学术研究被工业界所接受，这是一件难得的令人欣慰的事情。然而，由于英特尔的帮助，TC 在 2017 年成为第一个使用英特尔新 SGX 技术的面向公众的生产应用程序(如下所述)。这就是快速发展的区块链世界，人们对好先知的渴望越来越强烈，现在《镇报》已经成为 Chainlink 的一部分。TC 团队很高兴看到这种情况发生。

我想提供一些关于 TC 如何丰富 Chainlink 的想法。具体来说，我想强调 TC *补充【Chainlink 作为一个去中心化系统所具有的功能的一些方式，以及它*扩展*这些功能的方式——使先知能够做你可能认为他们做不到的事情。*

不过，让我先回答这个问题:

## 什么是城镇呐喊者？

总之，TC 是一个由*可信执行环境* (TEE)做后盾的神谕。

oracle 最基本的形式是从智能合约 *SC* 接收查询 *q* 并返回答案 *A* 的服务。查询 *Q* 可以涉及几乎任何事情，例如，“今天下午 3 点乙醚的美元价格是多少？”(针对一份金融智能合约)“爱丽丝租了 2871 号无人机吗？”(对于无人机租赁智能合同)，“幸贺航空的 123 号航班准时降落了吗？”(针对一份飞行保险合同)“特朗普拿到他的墙了吗？”(对于一个投注合同)。通常，该服务从一个或多个可信任的网站获得答案。

TEE 是一种基于硬件的功能，它允许像 Town Crier 这样的程序在受保护的环境中运行。这种环境被称为飞地，既提供了完整性，又提供了 T2 保密性。完整性意味着攻击者不可能*在飞地中篡改*代码。它向用户保证 TC 是一个诚实的先知。保密性意味着攻击者也不可能*检查*飞地的内容。TC 利用 TEE 机密性来安全处理敏感数据——从密码到控制加密货币的私钥，再到个人身份信息。(我在这篇博客的注释中给出了一些附带条件，解释了 TEEs 的安全性如何远非完美。)

简而言之，你可以把 enclave 想象成一个黑盒，一个安全运行程序的不透明的环境。你可以把 TC 想象成运行在这样一个黑匣子里的神谕。

## Oracle 完整性

作为一个去中心化的 oracle 系统，Chainlink 可以为智能合同提供来自*多个节点或来源*的响应。例如，智能合约可以从三个不同的 Chainlink 节点接收对以下问题的答案:“今天下午 3 点乙醚的美元价格是多少？”如果这些节点中的大多数是诚实的，那么很容易确保 *A* 是正确的:只需从节点提供的答案中取多数值。只要三个回答中有两个是正确的(并且一致)，就会得到正确的值 *A* 。即使一个甲骨文行为不当，提供了一个不正确的答案，*一个*仍然是正确的。

而 TC 只需要一个节点就可以保证*的正确答案。更准确地说，它提供了一种端到端的保证:只要节点在 tee 中运行 TC，当 oracle 将答案从网站转发到智能合同时，对手就不能篡改答案。*

一些用户可能会怀疑 TEEs 的安全性——原因我会在本博客的附录中解释。幸运的是，权力下放和发球台不是一个非此即彼的选择。有可能以一种简单、互补的方式将两个都用在*上。在分散系统中的节点上运行 TC 有助于确保这些节点诚实地运行。为了使 oracle 向智能合约发送损坏的答案，大多数节点操作符需要被损坏或恶意，并且它们节点上的 tee 需要失败。换句话说，*一个使用球座的分散系统——即使是有缺陷的——严格来说比一个不使用球座的系统更强大。**

## 甲骨文保密性

TC 的另一个主要特性是它能够强制保密。这种能力特别表明了对分散式 oracles 可以安全提供的特性的扩展。

让我们举一个来自《Town Crier》的例子，它旨在说明一个功能丰富的甲骨文如何催生新的市场。Alice 想以 1 ETH 的价格向 Bob 出售一款蒸汽游戏。为了公平地做到这一点，即确保她得到她的钱，鲍勃得到他的游戏，两者可以使用智能合同。显然，智能合同可以在将第一个 ETH 从 Alice 转移到 Bob 的过程中充当中介。但是如果没有显式的 Steam 支持(一个 API)，Steam 并没有提供，那么合同如何确定 Alice 是否将游戏转让给 Bob 呢？

答案是爱丽丝可以*把她的密码*给 TC 甲骨文，TC 甲骨文可以登录她的账户，*验证她把游戏发给了鲍勃*。

由于使用了 TEE，TC 原则上可以安全地处理密码，包括 Alice 的。[1]相比之下，在分散式 oracle 中，无法将密码安全地委托给普通节点。即使像零知识证明和安全多方计算这样的技术也无济于事。无论使用什么加密技术，在一天结束时，某个节点需要将 Alice 的密码发送给 Steam。只有使用 TEE，该节点才能充分保护密码。

Steam 的例子只是众多例子中的一个，在这些例子中，TC 可以在合理的安全保证下完成分散式 oracles 无法完成的事情。以下是其他几个例子:

*机密查询:*对 oracle 服务的查询通常是敏感的，应该隐藏起来，不仅是在链上，而且是对 oracle 服务本身。

一个很好的用例是一份飞行保险合同。

假设爱丽丝购买了一份带有飞行保险合同的保险单。然后，合同需要知道她乘坐的是哪趟航班，以及随后她的航班是否延误，以便确定她是否应该得到报酬。

Alice 可以将她的航班信息直接发送到合同中，但这样她的旅行计划就会在网上公布，全世界都可以看到。她也可以通过在 oracle 服务的公钥下加密来隐藏她的航班信息(航线、号码和日期)。但是这个信息需要在某处*解密。*在一个分散的 oracle 系统中，它将由 oracle 节点解密，从而暴露给它们的操作员。

相比之下，TC 可以将 Alice 的航班信息隐藏在它的 TEE 中，既隐藏了链上的信息，也对 TC 的运营商隐藏了信息。此概念图展示了这一想法:

![A diagram showing a flight insurance smart contract.](img/a50e04b09ffada5ed6d80fdb3e3be418.png)

*私有计算:*考虑一个贷款智能合同，它需要根据合同创建者专有的一些特殊公式 *F* 来确定 Alice 是否可信。(例如， *F* 可能会结合她的银行账户余额、她在社交媒体上的朋友网络质量以及她在主要机构的信用评分。)在该示例中，潜在地有三种关键类型的机密性要被实施:(1)Alice 使用其数据登录网站的凭证(例如，密码)；(二)信用相关数据本身；以及(3)公式 *F* ，合同的创建者可能希望对其保密。

理想情况下，在一天结束时，oracle 节点操作者和合同应该只看到一点信息:根据 *F* ，Alice 是否有信誉。TC 为这个用例以及许多其他用例的复杂数据处理提供了强大的保密性。

## 《城镇呐喊者》在《链环》中的未来角色

“神谕”一词虽然令人回味，但却给想象力带来了不幸的限制。它提出了一种简单地回答问题的服务。一个 [oracle 可以而且将会更加](https://blog.chain.link/how-chainlink-supports-any-off-chain-data-resource-and-computation/):一个通用的、双向的、支持计算的链上和链下系统之间的连接器。这个观点实质上是 Chainlink 对扩展 oracles 功能的设想。

例如，在这种广义上使用甲骨文，智能合同可以监控物联网设备。他们可以使用 AIS GPS 跟踪食物运输，监控和分析温度传感器数据以确保冷链的完整性，并在满足支付和其他条件时打开集装箱。为了在现有行业中保持可行性，他们需要与遗留系统进行交互，这是“[声音迁移”IC3 大挑战](https://www.initc3.org/projects.html)中包含的目标。而且，在许多情况下，他们将需要做密集的、私人的计算，这些计算只有在离线时才可行。[2]所有这些都非常适合扩展的 oracle 体系结构。

如果我不得不做一个预测，那就是 TC 凭借其发球台支持的能力，将在 Chainlink 中发挥重要作用，使这一系列可能性成为现实。

*披露*:我在康乃尔理工大学担任教员期间共同开发了 TC，同时也是 IC3 加密货币和合同项目的联合主管。最近，我成为了 Chainlink 的技术顾问，这个角色与我的学术活动截然不同。本博文表达的所有观点均为本人观点。

[1]球座也可以这样使用，即爱丽丝自己用她自己的球座登录她的帐户，然后产生一个防篡改证明，证明她已经转让了游戏。
[2]关于如何在 TEEs 中实现完整的智能契约，使它们成为私有的和可执行的，参见[私有数据对象](https://arxiv.org/abs/1807.05686)和 [Ekiden](https://arxiv.org/pdf/1804.05141.pdf) 。

## 附录

### 你不害怕吗？

今天，英特尔软件保护扩展(SGX)是唯一一款广泛可用的 TEE，它具有我所描述的完整性和保密性，并且还支持另一项名为*认证*的关键特性，即远程证明某个特定程序正在某个区域运行。SGX 内置于 Skylake 和后来的英特尔 CPU 中。

SGX 注定要在一个强有力的对抗模式中工作。它为代码和数据提供硬件保护，甚至针对运行程序的机器的操作系统。它还可以防止物理篡改，从而防止主机的操作员和/或物理所有者。但是 SGX 有一些重要的附带条件。

英特尔已经发出警告，而且[研究人员从一开始就表明](https://www.ieee-security.org/TC/SP2015/papers-archived/6949a640.pdf)，SGX 很容易受到**攻击*。SGX 体系结构固有地泄露了一些关于应用程序执行的信息(比如页面错误，这是操作系统本身可能引起的)。最近更多的攻击，最明显的是[预示](https://www.usenix.org/conference/usenixsecurity18/presentation/bulck)，严重破坏了 SGX 的安全——完整性和保密性。*

 *那么 SGX 是无用的吗？鉴于对 SGX 的袭击所带来的建筑挑战，好的发球台是不可实现的吗？

安全没有绝对。问一个系统是否安全是没有意义的，只问它是否能抵御特定类别的对手是没有意义的。关键漏洞是所有计算基础设施中不可避免的事实。此外，攻击和防御也在发展。新的 TEE 架构已经出现在地平线上。

所以，重要的问题是:球座保护的是什么？谁在操作它？它将在什么时间范围内部署？一个由值得信赖的服务提供商托管的用于保护几百万美元资产的球座，我可能会对它充满信心。一份价值数百万美元的智能合同，其安全性依赖于世界上任何地方都不会被破坏，这显然不是一个好主意。

还有一些[模型](https://eprint.iacr.org/2016/635.pdf)，在这些模型中，有可能通过主要依靠其完整性，而不是其(更脆弱的)保密性来限制 TEE 暴露。

更一般地说，技术合作和技术转让可被视为权力下放的替代或补充。我相信，而且我最近的大部分研究都是基于这样一个假设:事实将证明，t 形三通不仅有价值，而且对区块链的实际基础设施至关重要。*