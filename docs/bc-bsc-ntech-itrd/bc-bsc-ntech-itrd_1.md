大多数人，也就是说，所有权的当前状态。

如何运作

使用区块链记录所有权涉及以下方面

•描述所有权的转移

•维护转账历史记录

描述所有权转移

*交易* 是将所有权从一个所有者转移给其他人的行为。所有权转移的行为依赖于描述的数据

预期的转移。这些数据包含执行所需的所有信息

所有权的转移。描述预期的数据示例

所以，转移所有权将是用于请求的银行转账表

一家银行代表客户进行汇款。银行转账

表格要求您提供允许银行进行的所有必要信息

代表您进行转账。类似地，使用的信息

区块链用于描述交易的数据为：

•要转移所有权的帐户的标识符

到另一个账户

•要接收所有权的帐户的标识符

•要转移货物的金额

•交易要进行的时间

•为执行支付给系统的费用

交易

•证明移交账户所有者

所有权确实同意该转移

这些数据大多对已经进行过汇款的人来说是熟悉的

与银行。但是，与银行转账的类比在收取费用时结束

被考虑。由于银行是中央机构，他们主要-

包含适用于所有客户的中央费用计划。与此相反，区块链是一个没有任何中央控制点的分布式系统。

因此，区块链不能有中央费用计划。在使用时

66

***第 9 步 |文档所有权***

区块链，每个用户都必须提前告诉系统他或她愿意支付多少

愿意支付以执行交易的帐户。移交帐户

所有权还支付交易费用。

维护转移历史记录

交易数据提供了执行所必需的强制信息

预期的所有权转移。执行交易意味着进行

通过交易数据描述的方式发生的所有权转移。执行

意。向账本中添加交易数据来添加交易

向账本添加交易数据，交易成为交易历史记录的一部分，

用于澄清所有权。下次使用账本时

通过聚合它包含的交易数据来澄清所有权，新添加的

添加的交易将被包括在汇总中，因此会对

结果的所有权状态。

区块链维护了有史以来发生的所有交易的整个历史

通过将其交易数据存储在区块链数据结构中发生

他们发生的顺序。任何不是这样的交易 His-

被视为从未发生过。因此，将交易数据添加到

区块链数据结构意味着进行这笔交易并允许

它影响使用历史记录的结果来识别当前所有者。

为什么它有效

由于交易数据包含有关帐户的所有信息

交接所有权、接收所有权的帐户以及物品和

要转移的金额，可以重建所有权信息

只要所有交易的完整历史记录都可用。由于

因此，所有交易数据的完整历史足以记录

所有权。

订单的重要性

聚合交易数据是为了恢复当前

所有权状态并澄清所有权。重要的是要认识到

交易发生的顺序必须得保持，以便

每次聚合数据时都会到达相同的结果。改变

交易数据的顺序将改变聚合它们的结果。起初

一览，结果似乎并没有发生太大的改变，无论是我先收到

朋友的$50 支付，然后转账了$50，以便

付款或这两笔交易发生的顺序相反。

但是如果我的银行账户根本没有任何钱

***区块链基础知识***

67

不允许透支吗？在这种情况下，我支付账单的能力取决于

在我朋友那里收到付款。否则，银行将

拒绝转移资金支付账单，因为资金不足。因此

交易数据的顺序确实很重要。

交易历史的完整性

毫不夸张地说，交易数据的历史是

管理所有权的任何区块链的核心，因为它是

重建所有权状态。因此，有必要确保数据的历史安全、完整、正确和一致，以维持

整个系统的完整性，因此能够制作真实状态-

关于所有权当前状态的陈述。因此，区块链需要

提供安全措施，以确保只有有效的交易数据

添加到区块链数据结构中。检验交易数据的有效性

包括三个方面：

• 形式正确性

• 语义正确性

• 授权

形式正确性

*形式正确性*意味着交易描述包含所有必需的数据，并且数据以正确的格式提供。

语义正确性

*语义正确性*关注交易数据的含义及其预期效果。因此，验证语义的正确性需要知识

的业务域。检验交易数据的语义正确性是

通常是基于业务规则完成的，比如：

• 确保账户未超出更多

当前拥有

• 防止双重支付

• 限制可以在一定时间内转移的物品数量

单个交易

• 限制每个用户的交易次数

• 限制在给定时间段内花费的物品总数

• 强制帐户至少保留一件物品的时间

之前的时间段才能进一步转移

68

***步骤 9 | 记录所有权***

授权

只有账户所有者可以转移所有权

以代表区块链执行其交易。作为

结果，区块链要求每笔交易携带信息

证明账户所有者的所有权转让确实同意

与该转移。

展望

这一步解释了交易及其在澄清所有权方面的作用。该

以下步骤主要涉及区块链如何强制执行

只有有效的交易数据被添加到历史中，以及历史是如何

受到操纵或伪造的保护。

摘要

• 交易数据为以下信息提供

描述所有权转移：

• 发起交易的账户的标识符

并且要将所有权转让给另一个账户

• 接收所有权的帐户的标识符

• 要转移的货物数量

• 交易应完成的时间

• 要支付给系统以执行交易的费用

交易

• 证明账户所有者的所有权转让

所有权者同意转移

• 交易数据的完整历史是一种审计

为人们如何获取和

转让了所有权。

• 任何未参与历史的交易都被视为

好像它从未发生过。

• 通过将其添加到历史记录中来执行交易

交易数据且允许其影响结果

聚合它们。

***区块链基础知识***

69

• 添加到他的顺序中的交易数据

必须保留才能产生相同的结果

在聚合这些数据时

• 为了保持完整性，只有那些交易数据

被添加到满足的区块链数据结构中

以下三个标准：

• 正式正确性

• 语义正确性

• 授权

**步骤**

10

散列数据

通过其数字指纹识别数据

这一步解释了区块链最重要的基础技术之一

区块链：哈希值。它讨论了密码哈希值的重要特性

哈希函数并介绍了应用哈希函数到数据的模式。

隐喻

指纹是所有或者任何部分的摩擦褶皱的印记

人手指的摩擦褶皱印记。它们被认为能够识别人类

独特地。它们已被用于调查犯罪，识别犯罪分子，并

使无辜者免责。这一步引入了一种用于识别数据的概念，

这可视为指纹的数字等效物。这一概念是

称为密码哈希值，并且区块链广泛使用它。

因此，了解加密哈希是理解的强制性

区块链。

目标

在分布式对等系统中，您将处理大量

交易数据。因此，您需要将它们唯一地识别并

尽快简单地比较它们。因此，目标是识别-

唯一地识别交易数据和可能任何类型的数据

指纹。

© 丹尼尔·德雷施 2017

D. 德雷施，《区块链基础》，DOI 10.1007/978-1-4842-2604-9_10

72

***第 10 步 | 哈希数据***

工作原理

哈希函数是小型计算机程序，可以转换任何类型的数据

转换为一定长度的固定长度，而不管输入数据。1 哈希函数一次只接受一个数据作为输入，并创建一个

基于构成数据的位和字节。哈希值可以

为了提供所需的长度，哈希值要求有前导零。有许多

不同的哈希函数在长度方面不同，其他哈希函数和

它们产生的哈希值。一个重要的哈希函数组被称为

*加密哈希函数*，可以为任何类型的数据创建数字指纹。加密哈希函数具有以下特性 2：

• 快速为任何类型数据提供哈希值

• 具有确定性

• 伪随机

• 一次函数

• 具有碰撞抵抗性

快速为任何数据提供哈希值

此属性实际上是两个属性的组合。首先，哈希

函数能够快速计算所有类型数据的哈希值。第二，哈希函数迅速进行计算。这些特性非常重要，因为您

不希望哈希函数产生无用的东西，如错误消息或

花费大量时间返回结果。

确定性

确定性意味着哈希函数对于

相同的输入数据。这意味着哈希的任何观察到的差异

数据的值必须仅仅由输入数据的差异引起，并且

不是由哈希函数的内部。

1 魏斯坦，埃里克 W.哈希函数。来源于 MathWorld：[`mathworld.wolfram.com/`](http://mathworld.wolfram.com/HashFunction.html)

[HashFunction.html.](http://mathworld.wolfram.com/HashFunction.html)

2 罗格维，菲利普，和托马斯·莱普顿。密码哈希-函数基础：定义，涵义以及抗原图攻击、第二原像攻击和碰撞抵抗的分离。在 B·罗伊和 W·梅尔（主编）， *快速软件加密。FSE 2004 年。 计算机科学讲座* *笔记，卷 3017. 国际快速软件加密研讨会。

柏林海德堡：施普林格，2004 年。

***区块链基础***

73

伪随机

伪随机意味着哈希函数返回的哈希值

当输入数据发生变化时，它会不可预测地更改。即使输入数据

变化很小，生成的哈希值将不可预测地不同。

换句话说，改变数据的哈希值必须始终是一个惊喜。

不应该能够根据输入数据预测哈希值。

单向函数

单向函数不提供任何追踪其输入值的方法

输出。因此，单向函数意味着它不能被使用

另一方面，换句话说，根据哈希值无法恢复原始输入数据。这意味着哈希值不告诉你

有关输入数据的内容的任何信息与孤立

指纹不告诉你任何有关其指纹创建的人员的信息

它。单向函数也被称为不可逆的。

抗碰撞

如果非常难以找到两个或

更不同的数据片段，对它们产生相同的哈希值。或者换句话说，如果不同数据片段获得相同的哈希值的机会很小，那么哈希函数是抗碰撞的。在这种情况下，你可以将哈希函数创建的哈希值视为唯一的。

因此可用于识别数据。如果对不同的数据片段获得相同的哈希值，那么就会发生哈希碰撞。哈希碰撞

是具有相同指纹的两个人的数字等效物。对于哈希值来说，抗碰撞是强制性的，以便作为数字指纹使用。哈希函数内部如何工作是超出了

本书不涵盖的范围，但可以肯定的是已经花费了大量精力在

减少它们产生哈希碰撞的风险。

亲自试一试

本节将帮助你熟悉应用哈希函数

通过一个简单的示例来指导你。为此，我参考

提供一个工具来创建简单哈希值的附带网站

文本数据：[`www.blockchain-basics.com/HashFunctions.html`](http://www.blockchain-basics.com/HashFunctions.html)。

当你在您的 Internet 浏览器中打开该网页时，您将看到一个输入框

窗口和一个输出框，如图 10-1 所示。在输入框中键入文本 Hello World!

在左侧的输入框中填写文本并单击标签

“计算哈希值”位于文本字段下方。确保你在输入框中完全输入

Hello World!，否则你将得到与图 10-1\.中显示的结果不同的结果

![](img/index-78_1.png)

![](img/index-78_2.png)

74

***第 10 步 | 哈希化数据***

**图 10-1\.** 计算短文本的哈希值

点击按钮后，右侧的输出框将

提供输入文本计算出的哈希值的不同哈希函数

函数。哈希值通常被视为哈希数字，因为它们使用

不仅包括数字 0 到 9，还包括表示 16 进制数的字母 A 到 F。

值 11 到 16 以便表示数字值。这些数字是

称为*十六进制数*。计算机科学家因某些原因而喜欢它们，这里我不想讨论。请注意，由于不同

函数的实现细节产生这些值。这些值

都是理所当然的，因为我们不想在广泛的领域中迷失自己

哈希函数的实现方式的课题。

加密哈希值很长，因此很难阅读或比较。

这种比较对人眼来说很困难。然而，在这一步骤中，你将

比较不同的数据哈希方式，涉及阅读和比较

哈希值。用加密哈希值这样做会很快变得

一项繁琐的任务。因此，出于教学目的，我使用了缩短版的

在本步骤的剩余部分中使用 SHA256 加密哈希值。你可以

使用附带工具重新生成所有哈希值。

网站：[www.blockchain-basics.com/Hashing.html.](http://www.blockchain-basics.com/Hashing.html)

当你在互联网浏览器中打开该网站时，你会看到一个输入框。

对于简单的文本，有一个按钮，上面有一个指向输出框的箭头，就像

在图 10-2 中。当你点击带箭头的按钮，输出框将呈现输入框中提供的文本的缩短哈希值。

**图 10-2。** 计算文本的缩短哈希值

![](img/index-79_1.png)

***区块链基础知识***

75

数据哈希的模式

到目前为止，你已经了解到一段数据可以作为哈希函数的输入。

函数，这反过来又产生了该数据的哈希值。这意味着每个独立的数据片段都有自己独特的加密哈希值。但是

如果要求你为一大堆独立数据提供一个哈希值，你会怎么做？

一堆独立的数据一次性被哈希吗？记住，哈希函数只接受

一次只处理一个给定时间的数据。没有一个哈希函数能够接受一个

一次性哈希一堆独立的数据，但实际上我们经常需要一个单一的

大量数据集的哈希值。特别是区块链数据

结构必须一次处理许多交易数据，并且需要一个

所有的哈希值。你如何处理这个任务？

答案是使用以下一种模式来应用哈希函数到数据：

• 独立哈希

• 重复哈希

• 组合哈希

• 顺序哈希

• 分层哈希

独立哈希

独立哈希意味着对每个数据片段应用哈希函数

独立地。通过计算两个不同单词分别的缩短哈希值来说明这个概念。

**图 10-3。** 哈希不同数据的示意图

![](img/index-80_1.png)

76

***第 10 步| 数据哈希***

每个包含一个单词的白色框代表要被哈希的数据

灰色圆圈展示了对应的哈希值。指示

箱子到圆圈的箭头从图示地说明了转换

数据分为哈希值。正如在图 10-3 中所示，不同的单词产生不同的哈希值。

反复哈希

您已经了解了哈希函数如何将任意一段数据转换

转化为哈希值。哈希值本身可以被视为一段数据。因此，应该可以将哈希值提供为哈希函数的输入并

也计算其哈希值。实际上是有效的！反复哈希是

哈希函数对其自身输出的反复应用。图 10-4

通过反复计算缩短的哈希值来说明这一概念。

文本“Hello World！”产生哈希值 7F83B165，然后产生

缩短的哈希值为 45A47BE7。

**图 10-4。** 反复计算哈希值

组合哈希

组合哈希的目标是为多个

在一个尝试中的一段数据。将所有独立的数据片段组合成

一块数据，并在之后计算其哈希值是实现这一目标的方法。特别是，在给定时间创建一种单一数据集的哈希值非常有用。由于组合数据会消耗计算能力、时间和内存空间，因此组合哈希应当仅

当个别数据片段很小时使用。组合哈希的另一个缺点是

因为数据的各个部分的哈希值不

由于仅将组合数据传递给哈希函数。

图 10-5 描述了组合哈希的概念。 首先将个别单词组合成一个单词，单词间有一个字母空格，然后对结果短语进行哈希。图中显示的结果哈希值

和图 10-4 中的第一个哈希值相同。请注意

![](img/index-81_1.png)

***区块链基础知识***

77

组合数据的哈希值关键取决于数据组合的方式

被组合。在图中 10-4 中，两个字通过将它们紧挨在一起，字之间有一个空格，因此产生

你好，世界！有时会使用特定符号，如加号（+）或井号符

标记连接数据的地方，作为

结果，影响了最终的哈希值。

**图 10-5。** 组合数据并随后计算哈希值 顺序哈希

顺序哈希的目标是作为

新数据到达。这是通过使用组合和重复哈希来实现的

相同时。现有的哈希值与新数据组合，然后

将被传递给哈希函数，以获得更新后的哈希值。

顺序哈希特别有用的是如果您想随着时间的推移保持单一哈希值并在新数据到达时更新它。这种方法的优势

类型的哈希是，在任何时间点，你都有一个哈希值

进化可以追溯到新数据到达的时刻。

图 10-6 阐明了从单独哈希单词 Hello 开始的顺序哈希的概念，得到了缩短的哈希值

185F8DB3\. 一旦由单词 World! 表示的新数据到达，它就是

结合现有的哈希值，并以输入方式提供给哈希函数-

样。哈希值 5795A986 是输入文本的缩短哈希值

世界！185F8DB3\.

![](img/index-82_1.png)

![](img/index-82_2.png)

78

***步骤 10 | 哈希数据***

**图 10-6\.** 顺序计算哈希值

分级哈希

图 10-7 阐述了分级哈希的概念。

**图 10-7\.** 分级计算哈希值

应用联合哈希到一对哈希值形成一个小

一系列哈希值的层次结构，顶部只有一个值。类似于组合

哈希，分级哈希的想法是创建一个单一哈希

数据集的值。分级哈希更有效，因为它结合了始终是固定大小的哈希值，而不是原始

可能是任何大小。此外，分级哈希只组合两个

每一步的哈希值，而组合哈希将组合尽可能多的数据

你提供在一次尝试中。

***区块链基础知识***

79

展望

这一步致力于哈希函数的概念。步骤 [11 阐明了](http://dx.doi.org/10.1007/978-1-4842-2604-9_11)

哈希值在现实生活中的使用以及区块链的突出特点

使用它们。

摘要

• 哈希函数将任何类型的数据转换为一个数字

固定长度，无论输入数据的大小。

• 有许多不同的哈希函数，它们在

其他哈希值与它们的长度相比

产出。

• 密码哈希函数是一个重要的

创建数字指纹的哈希函数，适用于任何类型

的数据。

• 密码哈希函数表现出以下特点

属性：

• 快速提供任何类型数据的哈希值

• 确定性

• 伪随机

• 单向使用

• 抗碰撞

• 哈希函数对数据的应用可以在很快的时间内完成

通过以下模式使用:

• 重复哈希

• 独立哈希

• 组合哈希

• 顺序哈希

• 分级哈希

**S T E P**

11

哈希在

真实世界

一个比较数据和创建的故事

计算难题

[第 10 步](http://dx.doi.org/10.1007/978-1-4842-2604-9_10)介绍了密码哈希函数并讨论了应用哈希函数到数据的不同模式。S

世界。它考虑了现实生活中哈希函数的主要用例，并解释了

这些用例背后的想法。这一步还概述了为什么这些用例起作用

如预期的那样。最后，这一步指出了区块链使用哈希值的地方。

比较数据

因为这是哈希值的最简单的用途之一，所以比较数据

首先考虑基于它们的哈希值比较数据。

目标

目标是比较数据（例如文件或交易数据），而不比较

按部分比较它们的内容并作出任何种类的数据比较，

少量大小和内容，与比较两个数字一样容易。

© Daniel Drescher 2017

D. Drescher，*区块链基础*，DOI 10.1007/978-1-4842-2604-9_11

82

***第 11 步|现实世界中的哈希算法***

主意

而不是通过显式地逐个比较它们的内容来比较数据

您比较它们的加密哈希值。

工作原理

您计算并比较所有数据的加密哈希值

考虑。如果所有的加密哈希值不同，所有数据

考虑未考虑也因此在考虑之前。

值相同，则它们对应的输入数据也相同。

为什么它起作用

通过比较它们的加密哈希值来比较数据是因为

密码哈希函数的碰撞抵抗性。

检测数据中的更改

根据它们的哈希值比较数据的想法可以很容易扩展

以便检测更改的情况。

目标

目标是确定数据（例如文件或交易数据）是否在特定日期或发送后发生了变化

将数据传送给某人或将其存储在数据库中之后。

主意

比较正在考虑的数据的加密哈希值

在过去创建的数据的新创建加密哈希值

相同的数据是识别变化的关键。如果两个哈希值相同，则数据在旧哈希值创建的时间之后没有发生变化。

工作原理

您创建了数据的加密哈希值，这些数据应该保持不变

不变。当您需要验证数据是否在特定时间内发生变化时

后来，再次创建数据的加密哈希值。然后

将新创建的哈希值与已创建的哈希值进行比较

1Tsudik，Gene。使用单向哈希函数进行消息认证。*ACM SIGCOMM*

*计算机通信评论*22.5（1992 年）：29-38。

***区块链基础***

83 年

过去。如果两个哈希值相同，则数据在传输后未被更改。

创建第一个哈希值时。否则，数据已经发生了变化

同时。当将数据发送给别人时，同样的想法也可以应用。

如果您在发送数据之前创建数据的哈希值，并且接收方

创建他接收的数据的哈希值，发送方和接收方

接收者比较两个哈希值。如果两个哈希值相同，则数据

在传输过程中未被改变。

为什么它有效

检测数据的更改实际上是一个将数据与它们进行比较的过程

在某些事件之前和之后自身，例如时间的流逝，存储或

从数据库中检索，或通过网络发送它们。检测

那些应该保持不变的数据中的更改是由于冲突

密码哈希函数。

在一个敏感于更改的数据中引用数据

方式

基于它们的哈希值来比较数据并检测更改可以

考虑哈希值的基本用例。稍微复杂一点的应用

哈希值案例是哈希引用，以下将介绍哈希引用。

目标

目标是引用存储在某处的数据（例如交易数据）

其他地方（例如硬盘或数据库）并确保数据保持不变。

这个想法

这个想法是将正在存储的数据的密码哈希值与

与数据所在位置的信息相结合。如果数据被更改

更改，两者的信息将不再一致，因此

哈希引用将变得无效。

它是如何工作的

对数据的引用是衣帽间票据的数字等效物。衣帽间

票据指向您的夹克衣在哪里存放的物理位置

衣帽间。您可以使用衣帽间票据稍后找回您的夹克衫

上。计算机中的数据引用方式相同：它们是一小片

引用其他数据。计算机程序使用引用来

![](img/index-87_1.png)

84

***第 11 步|现实世界中的哈希***

记住数据存储的位置并检索

以后。哈希引用是一种利用密码哈希值的特定引用。简单来说，您可以将哈希引用视为显示哈希值而不是普通数字的衣帽间票据。

哈希引用指的是其他数据，并额外验证数据

被引用的数据自引用创建后未被更改。在

引用的数据已更改，引用不再

者允许检索数据。在这种情况下，哈希引用被视为不可靠或无效。这类似于拿着指向不再挂有您夹克衫的衣钩的衣帽间票据。在这种情况下，衣帽间管理员

您再也无法交出您的夹克衫。

哈希引用的整个理念是保护其用户不会检索到数据

由于技术错误或者故意修改导致发生变化的

某人在不通知你的情况下更改。因此，哈希引用是

所有场合都要使用数据一旦创建就应该保持不变的情况。

一个图解

区块链高度依赖哈希引用。因此，理解

对于理解区块链和理解

本书的后续步骤。因此，以下三个图的作用有两个：首先，它们形象地说明了哈希引用的功能。其次，它们引入了哈希引用的图示表示

在以下步骤中使用，用来说明

区块链数据结构的功能。

图 11-1 用图示的方式说明了哈希 r 引用的功能。标有 R1 的灰色圆圈代表一个有效的哈希引用。

哈希引用。白色方框代表一些数据，应该

保持不变。从圆圈到方框的箭头描述

哈希引用的功能。箭头指向引用

它所引用的数据。

**图 11-1\.** 一个有效哈希引用的图解

![](img/index-88_1.png)

![](img/index-88_2.png)

***区块链基础知识***

85

图 11-2 说明了一个破损或无效的哈希引用的象征性表示。

**图 11-2\.** 一个无效哈希引用的图解

包含一个修改后的问候语的黑匣子代表被更改的数据

引用被创建后。灰色圆圈仍然代表最初创建的哈希引用。指向

被更改的方框强调了哈希引用 R1 已经破损，它不再允许检索数据，因为它们在这段时间内已经被更改。

图 11-3 说明了当数据更改后创建了一个新的哈希引用的情况。这种情况由一个代表被更改的数据的黑匣子、一个代表新创建的哈希引用的黑圆圈和指向方框的直箭头表示。

**图 11-3\.** 修改后新创建的哈希引用的图解

86

***第 11 步 | 现实中的哈希化***

为什么它起作用

哈希引用的关键点是它们利用了加密技术

哈希值，可以看作是数据的唯一指纹。因此，几乎不可能有两个具有相同哈希值的不同数据。

因此，一个破碎的哈希引用被视为证据表明数据

在创建哈希引用之后被更改。

以变化敏感的方式存储数据

基于它们的哈希值引用数据的想法可以被扩展

进一步。这个想法的自然扩展是以变化敏感的方式存储数据

方式。

目标

目标是存储大量数据，例如交易数据

应该保持不变。对此类数据的任何更改都应该被检测到。

迅速且轻松。

想法

衣帽间票指向携带夹克的衣钩。这很简单且

直接了当。但是什么阻止你把一个衣帽间票放在

放在另一件夹克的口袋里并将这第二件夹克放在衣帽间里

同样吗？结果，后一个衣帽间票指向包含衣帽间票的夹克，后者又指向另一个夹克。实际上，你可以

创建长且复杂的连锁衣钩，它们口袋里有衣帽间票

它们分别指向其他夹克的衣帽间票，这些夹克也有

他们口袋里有一张衣帽间票，等等。同样，人们可以

存储数据与指向其他数据的哈希引用在一起，这

并将存储哈希引用，指向更多的数据，依此类推。

如果任何数据或哈希引用在它们的创建后更改，那么所有的

哈希引用损坏。由于损坏的哈希引用作为证据

在引用创建后，数据被更改，整个构造

以一种改变敏感的方式存储数据。

工作原理

有两种使用哈希引用以存储数据的经典模式

以一种改变敏感的方式存储数据：

•链

•树

![](img/index-90_1.png)

***区块链基础***

87

链

当每个数据片段还包含指向另一数据片段的哈希引用时，就会形成一条链接数据的链，也称为链表。这种结构对于存储和链接在一个给定时间点上并非完全可得的数据非常有用，而是步骤性地以持续方式到达。图 11-4 通过使用上面介绍的符号来说明了此概念，

这样的链的创建始于标记为 Data 1 的数据片段，

创建哈希引用 R1 的过程。作为第一片数据，Data 1

不包含任何哈希引用。当新的数据到达时，它们被放置

与指向 Data 1 的哈希引用。哈希引用

R2 指向新到达的数据和哈希引用 R1。哈希

引用 R3，指向 Data 3 和哈希引用 R2，被创建

以相似的方式。

**图 11-4。**数据以链式方式相互关联

哈希引用 R3 是为了访问链中的所有数据

以它们到达的相反顺序。引用 R3 也被称为**链的头部**，因为它指向最新添加的数据。重要的是不要混淆术语“**头部**”（即最新添加的数据）和术语“**头部**”，它将在[步骤 14 中引入](http://dx.doi.org/10.1007/978-1-4842-2604-9_14)

当我们讨论区块链数据结构时。

树

图 11-5 说明了交易数据如何以树形方式通过哈希引用链接在一起。

2Cormen，Thomas H. *算法导论*（第三版）。剑桥：麻省理工学院出版社，2009 年。

![](img/index-91_1.png)

88

***第 11 步|在现实世界中进行哈希***

**图 11-5。** 数据以树状方式链接在一起

这样的结构也被称为默克尔树 3，因为一个名叫默克尔的计算机科学家提出了这个概念，它看起来像一棵上下颠倒的树。

它非常适用于对许多不同的数据片段进行分组

同时并通过单个哈希引用使它们可访问。

为了创建图 11-5 中所示的树形结构，首先从图底部的四个交易数据开始。一开始

为个别交易数据创建哈希引用（R1 到 R4），

接着两两分组。随后，

创建哈希引用对（R12 和 R34）的哈希引用。

此过程重复进行，直到最终得到单一的哈希引用

因此，也称为默克尔树的根（标为 R）。

为什么它有效

所解释的数据结构以一种敏感于变化的方式存储数据，因为

它们如何连接和组合数据以哈希引用。这些引用获得

当数据引用的数据在引用后发生变化时，它们会被损坏

创建。因此，在这样的结构中观察到一个损坏的引用证明

一些数据在生成结构后发生了变化。否则，

可以推断整个结构自创建以来没有发生过变化

它是如何创建的。

3Merkle，Ralph C.用于公钥密码系统的协议。 *IEEE 安全和隐私研讨会* 122（1980）。

***区块链基础知识***

89

导致耗时的计算

哈希值不仅有助于进行基本的文件操作，比如

比较、引用和存储数据的安全和有效。哈希值也可以

用于让计算机通过复杂的

难题挑战其他计算机。虽然这听起来有点奇怪，但事实证明哈希值的这种用法是区块链中最重要的概念之一。

目标

由于在本书的后续步骤中将变得可理解的原因，您

可能需要创建需要计算资源的谜题，以便

要解决。不应该基于知识来解决这些难题

边缘或数据存储在某处或通过思考，如智商测试或

知识测试。解决这些难题的唯一方法就是通过纯粹的计算

功率和艰苦的计算工作。

思路

一个组合锁是一种特定的锁，需要一串独特的数字

数字，以便能够打开它。如果你不知道打开的顺序

锁，你会系统地尝试所有可能的组合直到你

最终到达了打开锁的独特组合。这一过程-

这一过程保证打开锁，但非常耗时。系统地

试图所有可能的组合与知识或智力无关

知识推理的方法。打开组合锁的方法基于

毫无疑问是纯粹的勤奋和努力工作。哈希拼图是计算拼图

可以被看作是数字化任务相当于打开组合锁的任务

通过试错来完成。

工作原理

哈希拼图的元素为 4:

• 必须保持不变的给定数据

• 可自由更改的数据，所谓的 nonce

• 要应用的哈希函数

• 对组合哈希的哈希值的限制，

也称为难度级别

4Back, Adam. Hashcash—a denial of service counter-measure. 2002\. [`www.hashcash.`](http://www.hashcash.org/papers/hashcash.pdf)

[org/papers/hashcash.pdf](http://www.hashcash.org/papers/hashcash.pdf).

![](img/index-93_1.png)

90

***步骤 11 | 现实世界中的哈希***

图 11-6 说明了哈希拼图的设置。组合哈希被应用于数据和 nonce。生成的哈希值必须满足

给定的限制条件。

**图 11-6\.** 哈希拼图的示意图

哈希拼图只能通过试错来解决。这需要猜测一个

nonce，计算所要求的哈希值的组合数据的哈希值

函数，并根据限制条件评估生成的哈希值。如果

如果哈希值满足限制条件，那么你已经解决了哈希拼图；否则，你就需要继续尝试另一个 nonce，直到最终解决

与给定数据组合的 nonce 产生一个哈希

满足限制条件的值被称为解决方案。当你声称你解决了一个哈希拼图时，你必须提供那个特定的 nonce。

一个说明性例子

让我们考虑一个真实的哈希拼图来说明它的功能。在第 10 步中，你看到了 Hello World!的缩短哈希值为 7F83B165\. 但是，什么样的数据

与 Hello World!组合将产生一个首部带有三个零的缩短哈希值

领先的零？所以哈希拼图是：找到与 Hello

World!产生首三个领先零的缩短哈希值。

让我们动手尝试一些 nonce。表 11-1 显示了 nonce，要进行哈希的文本以及结果缩短的哈希值。正如你所看到的那样，

nonce 614 解决了哈希拼图，这意味着从一个 nonce 开始

0 和逐步递增 1，你需要 615 步才能找到

解决方案。如果限制条件是找到一个具有一个领先零的哈希值，那么你只需经过四个步骤就已经解决了，因为 Hello World! 3 产生一个

具有一个领先零的哈希值。

***区块链基础知识***

91

**表 11-1\.** 解决哈希拼图的 Nonce

**Nonce**

**要散列的文本**

**输出**

0

你好，世界！0

4EE4B774

1

你好，世界！1

3345B9A3

2

你好，世界！2

72040842

3

你好，世界！3

02307D5F

…

613

你好，世界！613

E861901E

614

你好，世界！614

**00068A3C**

615

你好，世界！615

5EB7483F

你可以在 www.blockchain-basics.com/HashPuzzle 自行尝试。

[html](http://www.blockchain-basics.com/HashPuzzle.html).

难度级别

要求哈希值满足某些限制是散列谜题的核心。因此，限制和其描述都不是任意的。相反，哈希谜题使用的限制是标准化的，以便计算机可以

挑战其他计算机，执行散列谜题。在散列谜题的背景下，

这些限制通常被称为*难度*或*难度*

散列值必须为零。因此，难度为 1 意味着散列

值必须具有（至少）一个前导零，而难度为 10 意味着散列值必须至少有 10 个前导零。难度越

级别，需要的前导零越多，哈希值越复杂

谜题。哈希谜题越复杂，所需的计算量越大

力或时间，需要解决它。

为何有效

散列谜题的运作关键依赖于哈希

函数是单向函数。不可能通过解决哈希谜题

检查哈希值必须满足的约束条件并应用

哈希函数然后以相反的方向进行（即，从所需的

输出到所需的输入）。哈希谜题只能通过试验和

错误，这需要大量的计算能力，因此也需要大量时间和

能量。难度级别直接影响所需的试验次数

平均找到解决方案，从而影响计算

资源或寻找解决方案所需的时间。

92

***第 11 步 | 实际中的散列***

哈希函数是确定性的，可以快速产生任何类型的哈希值

数据的组合再加上随机数组合产生一个满足约束的哈希值。如果计算出的值不满足约束条件，则哈希函数无法

责任，因为偏差只是由于谜题

尚未解决。

■ **注意** 在区块链的背景下，散列谜题通常被称为*工作证明*，因为其解决证明了某人已经做了必要的工作来解决它。

在区块链中使用散列

在区块链内部，散列用于以下情况：

• 以敏感变化的方式存储交易数据

• 作为交易数据的数字指纹

• 作为增加计算成本的手段，以改变

区块链数据结构

展望

这一步解释了哈希值的主要用例，并勾画了它们的用法

在区块链中。接下来的步骤将更详细地讨论哈希算法是如何被区块链利用的。

概要

• 哈希值可以使用：

• 比较数据

• 检测本来应该保持不变的数据是否已被更改

未被改变的已经被改变

• 以一种变化敏感的方式引用数据

• 以变化敏感的方式存储一组数据

• 创建计算昂贵的任务

**步骤**

12

辨识和

保护用户

账户

一个关于密码学的温和介绍

除哈希函数之外，区块链还使用另一种基础技术扩展

非对称密码学。这是在区块链中识别用户并保护其财产的基础。密码学通常被认为是

复杂并且难以理解。因此，这一步集中介绍

区块链的密码学是为了以一种易于理解并且足够的方式对其进行。

理解区块链安全概念。

隐喻

早在电子邮件、传真、电话和即时聊天应用被发明之前

人们使用传统邮件发送消息。随着现代

竞争对手，传统邮件仍在使用且被许多人使用。

传统信件仍然由邮政员递送，他们将信件交给收件人。功能

放入收件人信箱。信箱的功能

像陷阱一样。按照设计，通过信封槽插入信件很容易，但

© Daniel Drescher 2017

D. Drescher, *区块链基础*, DOI 10.1007/978-1-4842-2604-9_12

94

***步骤 12 | 辨识和保护用户账户***

这样拉取一个字母出来是非常困难的，因为那样做是令人吃力的

通常仅由拥有必要打开的密钥的收件人完成

信箱。这个概念已经使用了很长时间，我们仍然使用

当我们向一个邮件地址发送电子邮件时，存在一个类似的概念

在最新的聊天应用中发送消息，或者当我们向银行账户转账时。

在所有这些情况下，安全概念基于两种不同

信息的：首先，作为通向类似陷阱的盒子的公开已知信息；第二，作为密钥的私人信息

打开盒子并访问它包含的东西。区块链应用

保护私人数据时，也会涉及类似的概念。因此，保持这个隐喻

在学习有关在区块链中识别用户并保护其财产的过程中，心中或许提供一些指导

密码学。

目标

目标是唯一标识所有者和财产，并确保只有

合法所有者可以访问他或她的财产。

挑战

区块链是对所有人开放的点对点系统。每个人

可以连接和贡献计算资源或提交新的交易

向系统提交信息数据。然而，每个人都可以访问由区块链管理的账户分配的财产并不是理想的。构成

characteristic of private property is its exclusiveness. The right to transfer

ownership to another account is restricted to the owner of the account who

hands off ownership. Hence, the challenge of the blockchain is to protect the

property assigned to the accounts without restricting the open architecture

of the distributed system.

The Idea

The idea is to treat accounts like mailboxes: everyone can transfer property to

it, but only the owner of the account can access the things that are collected

inside. The major characteristic of a mailbox is that its location is known and

hence anyone can put something in but only the owner can open it with a

key. The duality of a public mailbox, on the one hand, and a privately held key,

***Blockchain Basics***

95

on the other hand, has an equivalent in the digital world: public-private-key

encryption. One uses public keys for identifying accounts to which everyone

can transfer ownership, while access is restricted to those who possess the

corresponding private keys. 1

A Short Detour to Cryptography

In order to help you understand cryptography, I will discuss the following

aspects:

• The major idea of cryptography

• Terminology

• Symmetric cryptography

• Asymmetric cryptography

The Major Idea of Cryptography

The major idea of cryptography is to protect data from being accessed by

unauthorized people. It is the digital equivalent to door locks or bank safes,

which also protect their content from being accessed by unauthorized people.

Similar to locks and keys in the physical world, cryptography also uses keys to

protect data.

Terminology2

The digital equivalent to closing a lock is encryption, while the digital equivalent to opening a lock is decryption. Hence, when talking about protecting data by

using cryptography, we use the terms encryption and decryption for protect-

ing data and unprotecting data, respectively. Encrypted data are called cypher

text. Cypher text looks like a useless pile of letters and figures to everyone

who does not know how to decrypt it. However, cypher text is indeed useful

but only for those who possess the key necessary to decrypt it. Decrypted

cypher text is identical to the original data that have been encrypted. Hence,

the whole round trip through cryptography can be summed up as: start with

some data, produce cypher text by encrypting the original data with a cryp-

tographic key, preserve the cypher text or send it to someone, and finally

recover the original data by decrypting the cypher text with a cryptographic

key. Figure 12-1 illustrates the basic functioning of cryptography.

1Nakamoto, Satoshi. Bitcoin: A peer-to-peer electronic cash system. 2008\. [`bitcoin.`](https://bitcoin.org/bitcoin.pdf)

[org/bitcoin.pdf](https://bitcoin.org/bitcoin.pdf).

2 请参见 Van Tilborg, Henk 和 Sushil Jajodia，编。*密码和安全的百科全书*。纽约：斯普林格科学与商业媒体，2014 年。

![](img/index-99_1.png)

![](img/index-99_2.png)

96

***第 12 步|识别和保护用户帐户***

**图 12-1。**基本密码概念及其术语的示意图 如果有人尝试使用不正确的方式解密密文会发生什么

密钥？结果是一堆无用的数字、字母和符号

揭示任何加密的数据。

对称加密

多年来，人们利用了相同的密码方法

用于加密和解密数据。因此，每个-

有人能够使用这样的密钥加密数据，就能自动完成

解密使用该密钥创建的密文。由于相同的密钥是

对于这两种方法都使用，这被称为对称加密。图 12-2

说明了具有相同信标的对称加密的基本功能-

用于加密和解密短信。

**图 12-2。**对称加密的原理示意图

然而，事实证明，拥有加密和解密的一个密钥

并不总是可取的。因此，非对称加密被发明了。

非对称加密

非对称加密总是使用两个互补的键。但是有

这一点技巧：使用其中一个键创建的密文只能

使用其他密钥解密，反之亦然。

图 12-3 说明了加密-解密的往返旅程对于非对称加密。您可以以以下方式查看此图：上部

图 12-3 说明了加密，下部说明了解密。

![](img/index-100_1.png)

***区块链基础知识***

97

有两个键: 白色键和黑色键。它们一起形成了一对

相应密钥。原始消息使用黑键加密，

产生由包含白色字母的白色盒子表示的密文

信。原始消息也可以使用第二个密钥加密

产生由包含黑色字母的白色框表示的不同密文

信。出于教学目的，代表密文的框的颜色

文本和用于生成它们的键的颜色相同，以便

突出它们之间的关系: 黑键产生黑色密文，而白键产生白色密文。

**图 12-3。**非对称加密的原理示意图

图 12-3 的下半部分说明了非对称加密中解密的工作原理。黑色密文只能使用白色密钥解密

反之亦然。

非对称加密的诀窍在于您永远不能解密密文

使用生成它的密钥的密钥。关于使用哪个密钥的决定

选择用于加密和解密的哪个密钥由你决定。 你可以

随意切换密钥的角色，用于每一个新的你想要的数据

用于加密，但是做加密和解密都需要保持两个密钥

和解密。 如果你只有其中之一，你的权力是有限的。 虽然

你总是可以通过将你的密钥应用于数据来创建密码文本，你不能

解密，因为你缺少互补的密钥。 但是，你可以

解密相应的互补

密钥。 孤立的密钥就像单行道：你可以沿着这条街开车

98

***第 12 步 | 识别和保护用户帐户***

但是你永远不能在同一条街上开车回去。 由于非对称

在它们的加密权力的分发，这两个密钥允许您分离

能够从创建密码文本的人群到那些可以

解密它。

实际生活中的非对称密码学

在现实生活中使用非对称密码学包括两个主要步骤：

• 创建和分发密钥

• 使用密钥

创建和分发密钥

在实际生活中使用非对称加密时，你会给予两个密钥

为了突出每个密钥的作用。 通常这些密钥是

称为私钥和公钥。 因此，非对称密码学

被称为公私钥加密。 但是，没有这样的东西

如私钥和非对称密码学中的公钥因为

你知道你可以用每一个来加密数据和解密密码文本

他们。 它是分配给这些密钥的角色使它们私有或

公开。 公钥是给每个人的，不管他们的可信度如何。

实际上任何人都可以拥有公钥的副本。 但是，私钥是

保持安全和私密。

因此，应用非对称密码学的第一步是执行

图表是：

1\. 通过使用加密来创建一对互补的密钥

图形软件

2\. 给一个密钥起名叫公钥

3\. 给另一个密钥取名私钥

4\. 将私钥保留给自己

5\. 将你的公钥给每个人

使用密钥

有两种一般使用密钥的方式，它们在方向上有所不同

数据流向的方向：

• 公钥到私钥

• 私钥到公钥

***区块链基础***

99

公共到私人

通过这种方式使用密钥，信息从公钥流向

它是加密的，到私钥，那里它是解密的。 这种使用两个互补密钥的方式类似于邮箱，每个人都可以把信件放入

但是只有所有者才能打开它。 这是非对称的简单用法

加密术是因为它符合我们对隐私和公开的直觉

我们的地址和我们的邮箱是公开的，但它的内容是私有的

因此，这种使用非对称密码学的方式是关于发送信息

以安全方式将加密权力分配给私钥的所有者。 它有效因为

每个人都可以使用公钥创建密文，但只有所有者

私钥可以解密密文并阅读消息。

私有到公共

通过以这种方式使用密钥，信息从加密的私钥流向解密的公钥。使用这两个密钥的方式类似于公共新闻板或公共布告板，每个拥有公钥副本的人都可以阅读消息，但只有所有者

私钥可以创建消息。因此，使用非对称加密的这种方式

密码术是关于证明作者身份。它起作用是因为每个人都可以

使用公钥解密使用正确私钥创建的密文

相应的私钥。使用私钥创建的密文的事实

只能用相应的公钥解密的密文作为证据表明

具有相应私钥的所有者已加密消息。

区块链中的非对称加密

区块链使用非对称加密实现两个目标：

• 辨识账户

• 授权交易

辨识账户

区块链需要分别识别用户或用户账户，以便

保持所有者和属性之间映射的。区块链使用

用于识别的非对称加密的公共到私有方法

用户账户和它们之间的所有权转移。账号号码

在区块链中实际上是公共加密密钥。因此，交易

数据使用公共加密密钥来识别涉及的账户

所有权的转移。在这方面，区块链处理用户账户

类似于邮箱：它们有一个众所周知的地址，每个人都能够

发送消息给他们。

100

***步骤 12 | 辨识和保护用户账户***

授权交易

交易数据始终必须包括作为证据的一部分的数据，

确实同意转让所有权的账户所有者

所描述的所有权转让。这种信息流暗示的流动

协议始于转让所有权的账户所有者，并

应该达到所有检查交易数据的人。这种类型的

信息流与非对称加密的私钥-公钥使用场景所暗示的类似。同意转让所有权的账户所有者使用他或她的私钥创建了一些密文。所有其他人可以通过使用公钥来验证此协议的证据，这发生在

作为转让所有权的帐户号码的细节

程序，称为数字签名，将在下一步中详细解释。

Outlook

这一步解释了非对称加密的概念以及它是如何

在现实生活中作为公私钥加密使用。此外，这一步

解释了区块链中使用加密公钥来识别-

鉴定用户帐户。此外，合法所有者通过

创建可以追溯到他或她的私人密码的数字签名-

密钥。下一步将更详细地解释这一概念，因为非对称加密的这种用法不如公钥对用户帐户进行标识直观。

摘要

• 密码学的主要目标是保护数据免受

被未经授权的人访问。

• 主要的加密活动包括：

• 加密：将数据转化为密码来保护数据

使用加密密钥的文本

• 解密：将密文转换回实用数据

使用匹配的加密密钥

• 非对称加密总是使用两个互补的-

钥：使用其中一个密钥创建的密文可以

只能通过另一个密钥解密，反之亦然。

***区块链基础***

101

• 在现实生活中利用非对称加密时，这些

密钥通常称为公钥和私钥

以突出它们的作用。公钥与

每个人，而私钥是保密的。为此

原因，非对称加密也被称为公开-

私钥加密。

• 公钥和私钥有两个经典的用例

密钥：

• 每个人使用公钥来加密数据，这些数据可以

只能由相应所有者解密

私钥。这是相当于公开

所有人都可以将信件放入其中，但只有

所有者才能打开它。

• 拥有私钥的所有者使用它来加密数据

可以被所有拥有相应公钥的人解密

相应的公钥。这是数字等价物

公共公告牌上证明作者身份。

• 区块链使用非对称加密来

实现两个目标：

• 身份验证账户：用户账户是公开的

密码密钥。

• 授权交易：账户所有者

谁接手所有权创建一段密文

与相应私钥的文本。这是一块

密文可以通过使用相应的

公钥，这恰好是该

账户交接所有权。

**S T E P**

13

授权

交易

利用数字等价物

handwritten signatures

第[12](http://dx.doi.org/10.1007/978-1-4842-2604-9_12) 步骤提供了非对称加密的简要介绍。它还指出，区块链使用公共加密密钥作为账户

数字并利用非对称密码的公共到私有途径-

用于转让所有权。然而，这只是

故事的一半。区块链需要确保只有合法所有者

可以将其财产转移给其他账户。这是这一点

授权的概念进入场景。因此，本步骤解释了如何

区块链内部使用非对称加密来授权交换-

行动。特别是，这一步致力于数字签名概念，利用了非对称加密的私有到公共方法。

隐喻

手写签名起到了重要作用：它们表示对

文档的内容并同意其执行。我们接受手写签名作为同意的证据的原因是

接受手写签名作为同意的证据之所以重要是因为

每个人的笔迹。每个人都有自己独特的特征

© Daniel Drescher 2017

D. Drescher，《区块链基础》，DOI 10.1007/978-1-4842-2604-9_13

104

***第 13 步 | 授权交易***

的一种方式。因此，当我们识别出以这种方式书写名字的时候

特定方式，我们得出这样一个结论：以这种方式书写名字的人

特定方式确实产生了手写签名，因此我们可以得出结论，这个人已经同意了文档的内容。

及其实现。这一步解释了在电子分类帐中声明对交易的同意的概念，类似于手写签名。这个概念对区块链中个人交易的安全非常重要。

目标

确保只有账户所有者才能转移

与其关联的财产转移到其他账户。每次尝试访问

一个账户及其相关财产任何其他人

所有者应当被识别为未经授权，并应当被拒绝。

挑战

考虑中的点对点系统对所有人开放。因此，

每个人都可以创建交易，并将其提交给系统。

交易数据是描述和澄清所有权的基础。

只有合法的账户所有者才能转移财产或

与其它账户进行的所有权转让。这

区块链的挑战在于保持其开放性的同时限制着

将所有权的转移授权给合法所有者。

思想

确保只有合法所有者才能转移所有权的主要思想

以利用相当于手写签名的数字安全措施，起到相同的目的：识别一个账户，声明同意

其所有者与特定交易数据的内容进行验证，通过允许将数据添加到交易数据历史记录来批准其执行。

对数字签名的简短介绍

数字签名是手写签名的等价物。它们利用

加密哈希和非对称加密的私有到公共信息流

度密码学的特点。以下是三个主要

数字签名的要素：

• 创建签名

• 使用签名验证数据

• 使用签名识别欺诈

![](img/index-107_1.png)

***区块链基础***

105

创建签名

假设我想向世界发送一个“Hello World！”的问候

方式。因此，我创建了一个包含问候和相应的

数字签名相同。图 13-1 描绘了整个数字签名过程。

过程从图 13-1 左上角的白色盒子开始

包含问候。我创建问候的哈希值，即 7F83B165，并用我的私钥加密。问候的哈希值的密文（黑色框内的白色字母）是我对问候的数字签名。

它在两个方面是独特的：首先，可以追溯到我

独特的，因为我用我的唯一私钥创建了它。其次，它是独特的

关于问候文本，因为它基于问候的数字指纹。问候和数字签名都被放在一个文件中（灰色框），这是我向世界发送的数字签名消息。

**图 13-1**。创建数字签名的示意图

通过使用签名验证数据

信息，也就是我的问候和数字签名一起发送

对整个世界。每个人都可以验证我通过授权这条消息

利用我的公钥。图 13-2 说明了使用数字签名验证消息的过程。过程以问候开始。在

首先，消息的接收者计算问候的哈希值

自己，得到的值为 7F83B165。然后我消息的接收者

用我的公钥解密附加的密文（数字签名）。

这样做得到的值为 7F83B165，这是那个版本的哈希值

我想发送给世界的问候。比较两个哈希值

![](img/index-108_1.png)

![](img/index-108_2.png)

106

***步骤 13 | 授权交易***

完成验证。由于两个哈希值相同，接收者

正确地得出结论，首先，消息是我签署的，因为他是

能够使用我的公钥解密签名，并且第二个，问候

文本找到的确实是我想要发送的那个，因为

解密后的密文与问候的哈希值在

消息。

**图 13-2**。使用数字签名验证消息

通过使用签名来识别欺诈

图 13-3 说明了数字签名如何指出伪造的问候。

**图 13-3**。使用数字签名识别欺诈

***区块链基础知识***

107

图 13-3 展示了到达我朋友邮箱的消息。请注意问候文本的变化。一些黑客用

一个问号，从而改变了问候的整个语气。这就是

不是我想要向世界问候的方式。幸运的是，数字签名会告诉所有人，消息已经被违背了我的意愿进行了修改。

首先，消息的接收者将自己创建问候的哈希值，得到值为 8A0B7C66。然后我的消息的接收者

用我的公钥解密数字签名。这样得到 7F83B165，

这是我想要发送给

世界。对比两个哈希值发现它们不一致。这

明确指出消息中的问候不是我想要发送给世界的问候。因此，每个人都得出结论，我没有授权这个

消息，因此没有人会因其内容而责怪我。

它是如何起作用的

区块链中的数字签名满足以下要求：

• 他们声明账户的所有者的同意

以特定交易数据转移所有权。

• 它们对整个交易数据是唯一的

为了防止其被用来授权

其他交易，未经其作者的同意。

• 只有转移所有权的账户的所有者可以执行以下步骤：

可以创建这样的签名。

•  他们易于被每个人所验证。

区块链中数字签名有两个用例：

• 签署交易

• 验证交易

签署交易

为了为交易创建数字签名，转移所有权的账户的

转移所有权的账户所有者执行以下步骤：

1\. 描述包含账号号码、转移金额等所有必要信息的交易

涉及的账户号码、转移金额等的交易

转移，等等，除了签名本身

目前尚不可用

2\. 创建交易的加密哈希值

数据。

108

***第 13 步|授权交易***

3\. 用私钥加密交易的哈希值

转移所有权的账户的密钥。

4\. 将第 3 点创建的密码文本添加到交易中

作为数字签名。

验证交易

为了验证交易，必须执行以下步骤：

1\. 创建待验证的交易数据的哈希值

除了签名本身，交易的整个内容是唯一的。

2\. 用我的公钥解密交易的数字签名

与转移所有权的账户号码相关的考虑事项

所有权。

3\. 比较步骤[1](http://dx.doi.org/10.1007/978-1-4842-2604-9_1)中获取的值与步骤[2](http://dx.doi.org/10.1007/978-1-4842-2604-9_2)中获取的值。如果两者相同，则该交易由对应于

转移所有权的账户，否则不行。

它如何起作用

交易数据的数字签名是以下内容的组合：

• 交易数据的加密哈希值

• 可以追溯到对应的密码文本

私钥加密的分散的用途

由于加密哈希值可以被视为数字化

指纹，它们对每个交易都是唯一的。 构成特性的一个属性

使用公私钥加密法，用一个秘钥创建的密码文本可以

只能使用相应的密钥解密。 两个密钥的关联

是唯一的。 因此，成功解密具有特定公共密钥的密码文本

密钥作为证据表明它是使用相应的私钥创建的。

结合使用这两个概念来创建可追溯的密码文本

返回到一个特定的交易数据和一个特定的私钥

一次过程中的密钥。 这种属性使数字签名适合用作

证明使用来创建数字签名的私钥的所有者

签名确实与交易的内容一致。

***区块链基础***

109

展望

这一步完成了区块链如何保护所有权的过程

在个别交易数据的水平上。 因此，交易及其用于转移和证明所有权的目的是安全的和可靠的。然而，它

确保交易数据不仅在个别上得到保障很重要

个别水平上。 仍然需要以安全的方式存储整个交易数据的完整历史。接下来的步骤将详细解释如何实现这一点。

总结

•文件上的手写签名陈述同意

其作者的声明与签署内容相匹配

文件并授权其实施。

•手写签名的证据力是基于

根据手写的独特性。

• 数字签名是手写的数字等价物

十个签名。

• 数字签名有两个目的：

•唯一识别其作者

•其作者对交易内容的状态一致性

文件并授权其执行

•在区块链中，交易的数字签名

交易的加密哈希值

与对应于帐户的私钥对的私钥

接手所有权。

• 区块链中的数字签名可以被追溯

唯一对应一个特定的私钥和一个特定的

一个过程中的交易。

**S T E P**

14

存储

交易

数据

建立和维护历史记录

交易数据

基于前面的五个步骤，您现在应该能够追溯所有权

基于整个交易数据的历史以及描述个别

通过数字签名授权交易的所有权转移

签名和唯一识别用户帐户。 但我还没花

随时讨论如何存储构成

交易历史记录以安全的方式。 这是区块链的地方

进入讨论。 这一步介绍了区块链数据结构。

区块链数据结构，并解释其构造方法。

©丹尼尔·德雷施尔 2017

D. Drescher，《区块链基础》，DOI 10.1007/978-1-4842-2604-9_14

112

***步骤 14 | 存储交易数据***

隐喻

你还记得你上次去图书馆并使用了一个 tra-吗？

附加卡录？图书馆目录是图书馆拥有的所有书籍目录的注册表。一些传统图书馆仍然使用卡录来管理他们的库存。这些目录中的每张卡片代表一本书，而

卡片显示关于那本书的主要信息，如书名

作者、书名、出版日期和位置等

图书馆内的书籍，如楼层、房间、书架和架子号码。为了

以识别书籍，目录卡通常包含唯一的参考号

这也显示在书脊上。大多数图书馆都维护了超过

一个卡片目录，其根据用于排序的标准不同

卡片。例如，在作者目录中，卡片按字母顺序排序

按照作者的名称，而在标题目录中，卡片根据书名按字母顺序排列。还可以提出一种排序目录，其卡片根据书籍添加的顺序进行排序

在图书馆中添加。本步骤解释了区块链如何存储

交易数据的方法与具有排序目录的图书馆类似。

目标

区块链的目标是维护整个交易数据的历史

有序地展示。

挑战

挑战是以一种方式存储所有曾经发生的交易数据。

保留了交易发生顺序，并以一种方式

快速、容易地检测对数据的任何更改。检测更改

非常重要，因为这是防止操纵或伪造交易历史的基础。

这个想法

这个想法是创建一个交易数据的图书库，并维护一个排序

目录，保留了交易添加到其中的顺序

图书馆。为了检测对排序目录或书籍做出的任何更改

或个别交易数据，数据必须存储在一个改变-

使用哈希引用进行敏感方式排序。

***区块链基础***

113

将一本书转变为区块链数据-

结构

本节解释了如何将一本书转变为一个带有排序目录的小型图书馆，实际上是区块链数据结构的简化版本。

起点：一本书

多个世纪以来，书面信息保存在笨重的卷轴上

羊皮卷，被称为卷轴。今天，我们习惯于有着写作-

保存在圣约的十条信息：编号的精装束

页，我们称之为书。由于书籍如此常见，我们可能认为

他们的创新。他们的一些重要特性包括：

• 存储内容：书籍在它们的页面上存储内容。

• 排序：页面上的句子以及页面

在书中保持顺序。

• 连接页：页面通过物理方式连接

书脊，并通过它们的内容和逻辑连接

页码。

由于这些特性，我们可以前进浏览书籍和

通过向后移动页面或直接跳转到特定页面利用

维持页码。让我们看看如果我们改变一些

这些属性。

转化 1：使页面依赖明确

图 14-1 展示了一本非常简单书的两页的示意图。每页包含一个顶部边距，显示页码和

仅包含一个单词的内容区域。

![](img/index-115_1.png)

114

***第 14 步 | 存储交易数据***

**图 14-1\.** 书页的示意图

页码有重要作用：你可以找出是否

有人移除了一页，通过验证页码

继续而不遗漏任何数字。想象一下你目前正在阅读第

简化书籍的第 42 页。前一页应该是什么页码？

页码应该是多少？这很简单：前一页应该是 41 号，

即等于 42 减 1\. 为了验证确实没有人移除

在前一页上，我们比较显示在前

预期的页码，即当前页的页码

减去 1\. 如果两个数字相等，我们可以得出结论，前一页

没有被移除。

我们如何知道前一页的号码应该等于

当前页的页码减去 1？答案是我们假设所有书

遵循连续标记页面的约定。

但如果这个假设不成立，因为作者或出版商

书中决定使用不同的页码方案（例如，仅使用

甚至数字或三的倍数）？在这种情况下，我们验证的方式

前一页未被移除，失败。为了让这变得容易

验证书中没有一页被移除，我们可以指出

每页与其前身的连接。图 14-2 展示了我们简单书中是如何实现的。每页不仅展示自己的页码，还

也展示其前一页的号码。这种页码方案

使得任何一页与其前一页的依赖关系变得明确。这本

明确引用前一页使得验证没有一页被移除变得非常容易，因为不再依赖隐含的假设。

![](img/index-116_1.png)

![](img/index-116_2.png)

***区块链基础***

115

**图 14-2\.** 带有明确引用其前身页的书页 转化 2：外包内容

我们的书包含内容和信息

维持它们的顺序：页码。我们可以使我们的书更方便

通过外包内容并让其专注于维护任务的唯一目标

页的顺序。图 14-3 展示了我们的示意书中内容外包后的页面外观。页面不再包含任何内容，

反而它们包含指向内容的参考数字，这些内容可以

可以被存放在任何我们想要的地方（例如，盒子里，书架上，或其他地方）。

**图 14-3.** 书页与外包内容的参考值

![](img/index-117_1.png)

116

***步骤 14 | 存储交易数据***

此步骤的成就是：我们将书籍变成了一本小册子

图书馆。曾经存储内容和页码的书籍已经

被转换成了一个目录，其唯一目的是维护页面的顺序

内容，而内容存储在单独的标识的页面上

唯一的参考数字。

变换 3：替换页码

我们现在的订货目录保持了页面的顺序

两种不同的方式：首先，通过书中页面的物理位置

固定在书脊上;其次，通过页码和明确的参考

由于事实，书的实际构造

保持书页的顺序，我们可以尝试不同

页码架构。我们实际上可以用自然数取代

标记带有参考数字的页面。图 14-4 显示了此次转换的结果。例如，原先带有页码

42 现在标识为页面参考数字 8118E736。类似地

，先前标有页码 41 的页面现在标识为

用页面参考数字 B779E800。请注意，对

在先前的页面上也更新了。具有参考数字的页面-

者 8118E736 包含其前一页的正确参考编号

**图 14-4.** 使用参考数字作为页码的书页

***区块链基础***

117

转换 4：创建参考编号

在之前的转换中，我们用替代

参考数字。但是，我尚未讨论它们将如何创建。

创建唯一参考编号的最佳方法是使用密码

哈希值。因此，我们可以识别我们目录中的页面以及相应的

与其关联的前面的内容页面及其密码哈希值，这些是数字化的

它们的内容指纹。为了简单起见，图 14-3 and Figure 14-4 两者都已被更新

使用缩短的哈希值。（您可以使用该工具验证结果

[vide 于 www.blockchain-basics.com/Hashing.html。] F](http://www.blockchain-basics.com/Hashing.html) 例如，包含词 Hello 的内容页面由缩短的哈希标识

Hello 的值为 185F8DB3。我们书页的参考值

根据它们的内容计算出的，即内容参考数字和

前一页的参考数字。例如，页面参考

号 B779E800 是 011C01C1 185F8DB3 的哈希值。

转换 5：摆脱书脊

我们的排序目录是一本不寻常的书，因为每一页都包含其

自己的参考编号，前一页的参考编号以及

相应内容页的参考编号。然而，我们的排序

目录仍然是一本传统的书，其页面固定在书脊上。

如果我们摆脱书脊并将我们的排序书变成

成为一堆散页？这样做会破坏

页，结果我们也失去了页面的物理排序。

幸运的是，页面的排序并没有完全丢失。每一页都包含

包含其前一页的参考编号。因此，我们可以逐个移动

从一页到下一页向后遵循页面参考编号

前一页。如果我们将排序目录的最后一页分开，我们

可以始终反向浏览所有页面。

达到的目标：欣赏结果

让我们总结一下这个例子中取得的成就。我们将一个经典的

的一页，它们通过独特的参考编号链接

在一起。一堆页面包含

内容，而另一堆页面保留排序。为简单起见，

我们称后面一摞页面为排序目录。书中的每一页

排序目录包含其前一个页面的参考编号以及

相应内容页的参考编号。因此，我们

已将排序与存储信息和逻辑位置分离

（顺序）从页面的物理位置。由于我们

使用哈希值作为参考编号，每个人都可以验证其正确性

118

***步骤 14 | 存储交易数据***

通过简单地重新计算它们。由于排序目录的页不再

不再固定在书脊上，我们只能向后浏览

逐页地遵循指向的页面参考编号

前一页。为了方便参考，表 14-1 总结了变换前后书本的属性。

**表 14-1。** 比较转换前后的书本

**属性**

**书**

**转换后的书**

存储内容

在页面上

在单独的内容页上

每个内容页都有一个标识符

通过独特的参考编号

排序内容

物理上：基于位置

逻辑上：通过排序目录

书页

包含参考值

逻辑上：基于页面

到内容页

数字

连接页面

物理上：通过固定页面在

逻辑上：通过参考编号

书脊

逻辑上：基于页面编号

浏览

向前

仅向后：通过遵循

页面

回退

参考编号

前一页

直接跳转到页面，使用

页码

区块链数据结构

区块链数据结构是什么？实际上，你已经知道答案

因为前面的示例开发了一个简化的区块链数据结构-

但是，我们使用了不同的术语。本节完成了类比

通过使用转换后的书中使用的术语将转换的书的元素链接起来-

区块链的背景。

我们转换的书包括：

• 由订购目录的一页组成的心理单位

和其对应的内容页面

• 一个散页堆叠称为订单目录

• 包含内容的散页堆叠

• 用于识别和链接页面的页面参考号码

订购目录的

• 用于识别和链接的内容参考号码

内容页面

***区块链基础***

119

为了便于参考，表 14-2 在本节末尾通过比较转换后的简化书籍的元素总结了结果，与

区块链数据结构的元素。

**表 14-2\.** 将转换后的书与区块链数据结构进行比较 **转换后的书**

**区块链数据结构 1**

订购目录中的一页

一个块头

整个订购目录

区块头链

订购目录中页面的参考编号

一个块的密码哈希值

订购目录

头部

前一页的参考编号

区块链数据结构的密码哈希值

前块头

内容

交易数据

一个内容页面

包含交易数据的默克尔树

对内容页面的参考

包含的默克尔树根

交易数据

订购目录页的心理单位

区块链数据结构的一个块

目录及其对应的内容页面

整个订购目录和所有内容

区块链数据结构

一起的页面

订购目录的心理单位

和其对应的内容页面

订购目录页面的心理单位及其对应的内

到内容页面的关系与区块链数据结构中的一个块相关。所有这些

块一起形成区块链数据结构。指出重要的一点

得出，订购页面和对应的内容页面的单位只是一个

心理单位因为订购目录的页面和内容页面

是物理上不同的实体。前者通过哈希引用后者-

作为结果构成心理统一的参考，

订单目录

我们转换的书的订购目录等价于块链的链

区块链数据结构中的块头。每个订购目录页

等同于区块链数据结构中的一个单独的块头。由于

1Nakamoto, Satoshi. 比特币: 一个点对点的电子现金系统. 2008\. [https://](https://bitcoin.org/bitcoin.pdf)

[bitcoin.org/bitcoin.pdf](https://bitcoin.org/bitcoin.pdf)。

120

***第 14 步|存储交易数据***

块头通过一种线性方式相互连接-

就像链条的链接一样，它们形成了一个区块头链。类似于

我们的订购目录，区块头的链不存储交易

直接存储交易的数据，而仅存储对应的哈希引用

了。这是订单目录和

内容变得重要。

内容页

转换书的内容等同于交易数据

由区块链维护。它们特定于我们的应用领域

正在管理所有权。真实世界区块中没有内容页面-

链应用；我为教学目的创造了术语内容页。

真实世界的区块链应用存储内容数据（例如，交易

数据）直接存储在数据库中，并且我们将它们称为默克尔树，其根

存储在区块头中。

目录页参考编号

我们变换的书中用于识别页面的页面引用编号

订单目录的重要单位等同于个别区块的加密哈希值

区块链数据结构中的区块头。它们称为块哈希或前

先区块的哈希，分别。它们用于识别每个区块头

独特并且引用前一个区块头。实际的引用

从一个区块头到其前任的引用是通过哈希引用完成的。

内容参考编号

我们变换的书中用于识别

内容页相当于区块头链中的哈希引用

指向相关的交易数据。更具体地说，内容引用

存储在区块头中的参考编号是默克尔树的根

存储在数据库中的交易数据。这是关键

订单目录（区块头）及其对应的内

（带交易数据的默克尔树）都是由构成的。

在区块链数据中存储交易-

结构

图 14-5 通过图示显示了一个存储四笔交易的区块链数据结构所学到的内容。给出的图示

在图 14-5 显示了一个简化的区块链数据结构，由

![](img/index-122_1.png)

***区块链基础知识***

121

两个标记为 BLOCK 1 和 BLOCK 2 的块。为了强调

区块的天性，它们用虚线绘制。两个区块均

保持区块头标为区块头 1 和区块头 2。

BLOCK 1 是此数据结构中的第一个区块，因此它没有

一个前任，并且因此，区块头 1 不包含任何

对之前区块头的引用。由于 BLOCK 2 有一个前任，区块

标题 2 保持对其前一个块标题的哈希引用，标记为

B1\. 所示的区块链数据结构维护对两个的哈希引用

不同的默克尔树，它们的根分别标记为 R12 和 R34。这

Merkle 根的标签已经给我们一个提示，表明它们包含的交易数据（例如，根为 R12 的 Merkle 树包含前两个

交易标记为 Transaction 1 和 Transaction 2 及其对应值 -

的哈希引用 R1 和 R2）。

如果您加入了一个维护区块链数据结构的分布式对等系统，如图 14-5，您将接收所有交易数据，所有哈希引用值以及所有区块头。根据这些数据，您的本地计算机将创建包括哈希引用的区块链数据结构

指向存储在您的本地计算机上的数据。凭借这些数据和

对最新区块头的引用，你可以浏览

自从系统建立以来，曾经提交到系统的所有交易数据的历史。

它的创建是相反的顺序，也就是我们这里只有四笔交易。注意，对最新添加的区块头的引用称为

**区块链数据结构的头部**，因为它是下一个区块将添加的地方。有时，最近添加的区块头

以及指向它的引用称为区块链头部的

结构。在图 14-5 中，标记为 B2 的引用是区块链的头部，

链数据结构。重要的是不要混淆术语“头部”和“头部”：

区块链数据结构由许多每个都有其自身的区块

区块头，但整个区块链数据结构只有一个头部。

**图 14-5\.** 包含四笔交易的简化区块链数据结构

122

***第 14 步 | 存储交易数据***

■ **注意** 在本步骤中讨论的区块链数据结构，并在图 14-5 中

由于教学目的，本书简化了该区块链数据结构。故意略去了一些关于区块头中存储的信息的细节。某些信息将在接下来的步骤中涉及，随着您对区块链的理解

展望

本步骤介绍了区块链数据结构，并解释了它的构造方式。

结构。区块链数据结构的使用大大

使用哈希引用使其成为非常敏感的数据存储。下一个

此步骤更详细地解释了该属性，因为它是理解

区块链如何确保安全。

概要

• 区块链数据结构是一种特定类型的数据

由有序单元组成的结构。

• 区块链数据结构的每个区块包括一个

区块头和包含交易的 Merkle 树

数据。

• 区块链数据结构包括两个主要数据

结构：一个有序的区块头链和 Merkle

树。

• 人们可以想象有序的区块头链就像是

是老式图书馆卡目录的数字化等价物，

个人目录卡根据排序

他们被添加到目录中的顺序。

• 每个区块头引用其前面的区块头

保留个别的顺序

区块头和区块，分别组成

区块链数据结构。

• 区块链数据结构中的每个区块头部

通过其加密哈希值标识，包含一个

指向其前一个区块头的哈希引用和一个哈希

指向其产生的应用特定数据的顺序

维护。

• 对应用特定数据的哈希引用是

通常是维护哈希的默克尔树根

对应用特定数据的引用。

**S T E P**

15

使用数据

存储

链接数据块

步骤 [14 intr](http://dx.doi.org/10.1007/978-1-4842-2604-9_14)内：介绍了区块链数据结构。结果表明，区块链数据结构由两个主要组成部分组成：有序链和

包含交易数据的区块头部和默克尔树。这种数据结构

目标是以安全的方式存储交易数据。但

在这种情况下，以安全的方式存储数据意味着什么？回答

这个问题就是这一步的目的。这一步指出了更改区块链中的数据的后果，并且说明了区块链数据结构如何检测更改。此外，这一步突出了哈希的威力

存储数据时的引用。最后，这一步解释了如何以正确的方式将新区块添加到区块链数据结构中。

比喻

编织是通过纱线创建纺织品或织物的工艺，方法是

多个相互锁定的纱线环的序列，即所谓的针脚。当

手工生产，编织针织针大小差别很大。因此，在编织过程中，有时需要纠正个别针脚。

为了纠正位于织物某处的编织针脚，必须

© Daniel Drescher 2017

D. Drescher，*区块链基础*，DOI 10.1007/978-1-4842-2604-9_15

124

***第 15 步 | 使用数据存储***

从织物的最后一行开始逆序拆下所有后续的针脚，直到最终到达要纠正的针脚。在考虑的针脚被纠正后，必须重新创建所有的

接下来的针脚。由于这个过程相当复杂，所以在创建时，必须确保所有针脚满足质量要求。

第一次。这一步解释了使用区块链数据结构

与编织非常相似：在区块链数据的末端添加一个新区块

结构很容易，而在链条某处更改数据相当

复杂。有了这个比喻，你应该很容易理解

是区块链数据结构如何检测更改的一方面，以及如何

数据被正确添加和更改，另一方面。

添加新的交易

为了理解如何向现有块添加新交易-

以有序的方式理解链数据结构，让我们考虑一个简单的例子。

图 15-1 说明了仅包含一个块的区块链数据结构的初始情况。现有的区块链数据结构仅维护两笔交易。图 15-3\.说明了如果我们改变交易 2 会发生什么。这笔交易是默克尔树的一部分，由哈希引用组成。通过改变一些

图 15-1 还未添加到区块链数据结构中。为了添加新交易数据，必须执行以下步骤：

1\. 创建一个包含所有新交易的新默克尔树

要添加的交易数据，如图 15-2\.所示。

2\. 创建一个新的块头（块头 2），其中包含

同时包含指向其前一块头的哈希引用

其前序块的头（块头 1）和

默克尔树的根

数据（R34），如图 15-3\.所示。

3\. 创建一个新的哈希引用（B2）指向新块

头，如图 15-4,所示，并将其声明为更新的整个链式数据结构的新**head**。

记住，指向大部分的引用

目前添加的数据片在链中也被称为

整个链的**head**（见[11](http://dx.doi.org/10.1007/978-1-4842-2604-9_11)步）。

![](img/index-126_1.png)

![](img/index-126_2.png)

***区块链基础知识***

125

**图 15-1\.** 初始情况：两笔新交易（交易 3 和交易 4）应该被添加到现有的区块链数据结构中

**图 15-2\.** [步骤 1](http://dx.doi.org/10.1007/978-1-4842-2604-9_1)：创建一个包含新交易的新默克尔树

![](img/index-127_1.png)

![](img/index-127_2.png)

126

***第 15 步 | 使用数据存储***

**图 15-3\.** [步骤 2](http://dx.doi.org/10.1007/978-1-4842-2604-9_2)：创建一个包含新交易数据的新块头，其中包含指向其前一块头的哈希引用和新交易数据的默克尔树根 **图 15-4\.** [步骤 3](http://dx.doi.org/10.1007/978-1-4842-2604-9_3)：创建一个指向新块头的新哈希引用，现在它是整个更新的区块链数据结构的新**head**

![](img/index-128_1.png)

***区块链基础知识***

127

检测变化

图 15-4 ser 表现的步骤作为研究已经是区块链数据结构一部分的数据更改的初始情况。

我会讨论以下情况：

• 改变交易数据的内容

• 改变默克尔树中的引用

• 替换交易

• 改变默克尔根

• 改变块头引用

改变交易数据内容

图 15-5 说明了如果改变交易 2 会发生什么。这笔交易是默克尔树的一部分，由哈希引用组成。通过改变一部分

财物数量）

或接收所有权的帐户）时，也将更改其指纹或加密哈希值。因此，哈希参考 R2

指向的原始交易数据已被破坏。它检测到原始参考的交易数据在此期间已更改，因此违反了

保持不变的规则。因此，整个区块链数据结构是

无效。

**图 15-5。**更改交易的细节使指向原始数据的哈希参考无效，从而使整个数据结构无效

![](img/index-129_1.png)

128

***第 15 步|使用数据存储***

更改默克尔树中的参考

图 15-6 说明了如果不仅更改交易的细节还更改指向更新的交易的哈希参考时会发生什么-

操作。更新的哈希参考(R2)有效，因为它正确指向

新交易数据。但是，更新的哈希参考是默克尔树的一部分

其根为哈希参考的树。默克尔树(R12)的根

指向包含哈希参考 R1 和 R2 的数据片段。这

后者已更改以与被操纵的内容保持一致

交易 2 的版本。因此，数据片段的加密哈希值

包含更新版本的 R2 的数据被同时更改，进而

使默克尔树根 R12 失效。

**图 15-6。**更改默克尔树中的交易和其哈希参考将使默克尔树的根无效，从而使整个数据结构无效

替换交易

图 15-7 考虑了替换整个交易而不仅是操纵现有交易的细节并更新其哈希参考的情况。

![](img/index-130_1.png)

***区块链基础知识***

129

**图 15-7。**更换默克尔树中的交易和其哈希参考将使默克尔树的根无效，从而使整个数据结构无效

当您比较图 15-6 和图 15-7 时，您只会发现关于交易名称及其哈希参考名称的微小差异。

关于后果，两个示例是相同的。在这两种情况下

默克尔树根 R12 将由于发生的更改而无效

在默克尔树内。因此，我们发现更改交易或

替换交易将对区块链数据

结构。在两种情况下都将被检测到并将使之无效

整个数据结构。

■ **注意** 在区块链数据结构中更改或替换数据将产生相同的结果，因为两者对哈希参考具有相同的影响。

更改默克尔树根

图 15-8 说明了如果整个默克尔树，包括其根节点，被改变会发生什么。

![](img/index-131_1.png)

130

***第 15 步 | 使用数据存储***

**图 15-8\.** 更改默克尔树会使指向包含它的区块头的哈希引用无效，从而使整个数据结构无效

操纵的默克尔树的根（R12）是一个区块头

（区块头 1）。更改默克尔根会改变密码学的

区块头 1 的哈希值，这反过来引起了指向它的哈希引用的无效。

它指向它（B1）变为无效。维持连接的哈希引用 B1 使得连-

或者作为从区块头 2 指向区块头 1 的链接变为

无效，因为它检测到了变化。因此，整个区块链数据结构

结构变得无效。

更改区块头引用

图 15-9 说明了如果不仅整个默克尔树，还有指向操纵区块头的哈希引用都被改变会发生什么。

![](img/index-132_1.png)

***区块链基础***

131

**图 15-9\.** 在区块头内更改哈希引用会使指向操纵块头的哈希引用无效，从而使整个数据结构无效

如果向操纵的区块头（区块头 1）的哈希引用

被更改，结果如下：从哈希引用 B1 开始，所有指向操纵数据的哈希引用均一致且有效，因为

它们已经调整以适应所做的操作。然而，操纵的

B1 的哈希引用是区块头 2 的一部分，因此其密码哈希

值的改变，导致指向它的哈希引用 B2 无效

原始的数据区块头，包含原始版本的哈希引用的

B1。结果，整个区块链数据结构也无效。

有序地更改数据

在讨论了许多操纵区块链数据的方法之后

结构，这些结构都导致了一个无效的数据结构，现在是时候阐明如何有条不紊地改变或更新区块链数据结构了。

图 15-10 说明了正确地改变区块链数据结构的方法。

![](img/index-133_1.png)

132

***第 15 步 | 使用数据存储***

**图 15-10\.** 更改交易顺序包括更改所有后续的哈希引用

如果考虑更改或更新交易 2 的某些细节，我们有

以便随后更新所有哈希引用的整个序列：R2，R12，B1，

和 B2。这意味着所有哈希引用，从直接指向操纵的数据开始，一直到指向

到最新的区块头以及两者之间的所有哈希引用

它们，需要被改变和更新以反映

它们的目标。这是一个相当复杂的任务。也是一个复杂的过程

故意的。为了保持整个区块链数据的完整性

使结构一致并保持其完整性。所有其他尝试更改

或操纵作为区块链数据结构一部分的数据将会导致

无效的哈希引用会使整个数据结构无效。

有意与无意的变化

前面的讨论显示了区块链数据结构的目的-

当涉及到改变它的数据时，它遵循一种极端的全有或全无的方式：

要么完全从

导致变化，直到整个链的头或最好是全部离开

首先保持不变。所有其他半心半意，一半途中或部分-

初始的更改会使整个区块链数据结构变得不一致

状态，这将很容易被发现并快速。这是由于哈希引用的属性，区块链数据结构不区分

有意或无意的变化之间。实际上并不存在这种事情

作为有意或无意的改变在区块链中。这些词指的是一种

评估动机或导致变化的人。但区块-

链数据结构既不关心动机也不关心导致

***区块链基础知识***

133

不一致。区块链只关心正确性和一致性

所有哈希引用。如果其中一个无效，则整个数据结构无效，无论是谁或什么导致了那个变化或为什么做出了改变。和

这个属性使区块链数据结构非常有价值。

展望

这一步详细说明了区块链数据结构如何处理

随着数据的变化。结果表明区块链数据结构是

非常敏感于变化。当涉及到改变数据时

在更改其数据时的意图或无意。

用于使数据不可更改，这正是使区块链数据结构

存储数据的理想候选人。在不可靠和不可信任的地方

环境。

总结

• 所需执行的步骤以添加新的交易-

向区块链数据结构添加交易数据的步骤是：

• 创建一个包含所有新内容的默克尔树

交易数据要添加。

• 创建一个包含哈希的新块头

对其前一个标题和根的引用

包含新的交易数据的默克尔树。

• 创建对新块头的哈希引用，

这现在是区块链数据结构的当前头

数据结构。

• 改变区块链数据结构中的数据需要

更新所有哈希引用，从第一个开始

直接指向被篡改的数据，并以

整个区块链数据结构的头部也是如此

就像它们之间的所有哈希引用一样。

• 区块链数据结构实行一种极端的全-

一种全无的方式，当涉及到改变其数据时：

要么完全改变整个数据结构

从导致改变的点开始，直到

整个链的头或者更好地保持它不变

首先。

134

***第 15 步 | 使用数据存储***

• 所有半心半意、中途或部分变更都不会

留下整个区块链数据结构不一致-

容易和快速地检测到。

• 完全改变区块链数据结构是一个

故意很复杂的过程。

• 区块链数据结构的高灵敏度

关于改变的咋是由哈希属性导致的

参考。

**步骤**

16

保护

数据存储

发现不可变性的力量

第 [15](http://dx.doi.org/10.1007/978-1-4842-2604-9_15) 步以发现区块链数据结构以敏感于改变的方式存储数据为结论。在区块链数据结构中存储的任何数据的改变都会显现出来，并需要一个复杂的过程才能进行

将其并入已有的结构。这一步解释了如何利用这种属

性用于准备要分享的交易数据历史

并在一个不可信的环境中分发，而无需担心

诚实的对等系统成员可能操纵其内容

自己的好处。

比喻

假如我想假装是贵族家族的一员

家庭。我怎么能做到？伪造我的家谱可以做到。关于

例如，我可以编造一个贵族祖父并把自己

用一个虚假的家谱来欺骗他。这足以说服别人吗？

虚假的贵族血统？好吧，这个假冒行为很快就会被揭穿，因为家庭

树很少单独存在；相反，它们通过家族关系与其他家族谱联系和交织在一起。因此，如果没有一个家族谱

© Daniel Drescher 2017

D. Drescher, *区块链基础*，DOI 10.1007/978-1-4842-2604-9_16

136

***第 16 步 | 保护数据存储***

已建立的贵族家族中的一些人有参考或和我虚构的

非官方的祖父，我的虚构的家庭历史很快就会被发现是假的。

为了让我的虚构家庭被接受，我需要伪造家庭

已建立的贵族家庭的一些文件通过嵌入参考来制造参

他们家族历史中对我的虚构家谱的引用。但这可能还不够。真实的人有真实的生活并留下他们在我们世界的足迹。但是我的虚构祖父从未真正活过。因此，我必须捏造他的生活，使假像看起来真实。这意味着我必须编造我虚构祖父的整个人生，包括他的童年以及他的教育和职业历史。此外，支持文件也需要

被伪造，比如出生证明、学校注册文件、学校

证书、大学学位、专业认证、会员资格、和

等等。学校、大学和雇主会保留他们学生的记录

并出版社交活动的年鉴和照片。 因此，

如果需要操纵他们的文件，这将是必要的

我的虚构祖父是这些机构的前成员。 由于操纵-

所有这些文件，这将是复杂和昂贵的，我可能会

决定留在我真实但非贵族的家族历史。

这个智力游戏说明过去的伪造是可能的，但非常昂贵，因为它需要重写和伪造大部分历史

为了将假信息嵌入到许多文档和引用中

真实的历史。 这样做的成本是极其高昂的； 因此，坚持真相要容易得多，成本要低得多。 此步骤解释了如何

区块链利用这一发现来保护其交易历史

预防数据被伪造。

目标

重要的是，由

区块链总是代表真相，因此使其成为值得信赖的

用于澄清与所有权相关事项的来源。

挑战

区块链是纯粹的分布式点对点系统，对

所有人。 因此，不诚实的同行可能操纵或

为了获得自己的利益而伪造交易历史的挑战是

保持系统对所有人开放，但保护交易历史

防止数据被伪造或操纵。

***区块链基础知识***

137

这个想法

在开放系统中事先区分诚实和不诚实的节点是必要的

很难甚至不可能。 因此，为了保护交易的历史

由于不诚实的节点的操纵，我们要防止任何人

自从一开始操纵历史。 如果没有人能改变他的-

交易数据的历史，无论诚实与否，我们

不必担心它会被操纵。 因此，首先使交易历史数据无法更改就解决了问题。 作为

结果，该系统可以对所有人保持开放，没人需要担心

不诚实的节点操纵交易历史。

一段短暂的不可变性之旅

不变性意味着某物无法改变。 被感染的数据是不会变的-

一旦创建或写入后，表格就无法更改。 为了

因此，这些数据也被称为只读数据。 它们的唯一好处仅仅是呈现信息以供阅读或演示。 如果需要将数据给其他人并因此失去了控制，那么这个事实尤为可取

关于数据如何使用。 交接不可变数据是一种有效的方式

防止数据被更改或操纵。 驾驶执照，护照，

和教育证书是现实生活中不可变的对象的例子。

当局者根据需要制作文件以及他们唯一

可读的用途是被展示和阅读。

它的工作原理：大局观

区块链使用的主要思想是使交易历史不可变

向区块链数据结构中添加新块的过程，就像

所有人都不会改变它。使交易数据历史不可变

有三个要素：

1\. 将交易数据历史存储在一种即使

139

变得明显

2\. 实施了将操作嵌入到交易

历史记录需要重写其中的一大部分。

表格是为了使其不可承受的代价以及使这些成本能够阻止

计算成本极高。

138

***第 16 步 | 保护数据存储***

使操纵显而易见

以一种敏感于变化的方式存储数据的区块链数据结构

满足第一个要素。因此，无法悄悄地操纵属于区块链数据结构的数据，然后希望没有人注意到。

任何变化都将因改变其所指向的数据而引起的巨大的“噪音”而显现

使无效的哈希引用变得无效。

强制重写历史以嵌入

变化

区块链数据结构还满足第二个要素，因为它净化了

当涉及到改变其数据时，区块链数据结构采取一种激进的全有全无的方式：

要么从导致

在不改变整个链或最好不改变的情况下，一

首先。

使添加数据的计算成本极高

第三个元素是给那些不怕重写大部分内容的人

区块链数据结构在进行操作嵌入时产生巨大的计算成本

植入事务历史不但减小，完全是因为要维持计算难题的

链数据结构会产生巨大的计算成本，人们会三思而行

关于是否最初改变它是个好主意。

区块链技术套件使区块链数据的内容

每次对其进行最小的更改都会显著增加计算成本

正在写入、重写或添加到区块链数据结构中的块。这

哈希难题充当唯一的计算成本。

块头开始进行数据结构的整体成本，或者最好是

链，需要为每个涉及到的块头解决一个哈希难题，或者最好

使改变变得代价高昂，并使这些成本能够阻止

1Nakamoto, Satoshi. Bitcoin: A peer-to-peer electronic cash system. 2008\. [`bitcoin.`](https://bitcoin.org/bitcoin.pdf)

[org/bitcoin.pdf](https://bitcoin.org/bitcoin.pdf)

***区块链基础知识***

3\. 添加、写入或重写到历史记录的数据

工作原理：细节

改变的最小操作就会显现出来，并且

[15 步讨论](http://dx.doi.org/10.1007/978-1-4842-2604-9_15)不会因为其只需要添加指向当前链头的哈希引用而产生巨大的计算成本

新的区块头并将其声明为链的新头。挑战

使区块链数据结构不可变的挑战在于添加新

区块成为一个计算密集型的任务。需要考虑以下几个方面：

在实现这一目标的过程中需要考虑以下几个方面：

• 区块头的强制性数据

• 创建新区块头的过程

• 区块头的验证规则

强制数据

区块链数据结构的每个区块头至少要携带以下内容：

跟随数据 2:

• 包含交易数据的 Merkle 树的根节点

• 前一个区块头的哈希引用

• 哈希难题的难度级别

• 解决哈希难题开始的时间

• 解决哈希难题的随机数
