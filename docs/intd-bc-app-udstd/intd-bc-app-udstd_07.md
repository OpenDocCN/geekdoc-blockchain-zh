© 作者，独家许可给 APress Media, LLC，属于 Springer Nature 的一部分 2022J. T. George《区块链应用介绍》[`doi.org/10.1007/978-1-4842-7480-4_7`](https://doi.org/10.1007/978-1-4842-7480-4_7)

# 7. 区块链的共识算法

Joseph Thachil George^(1  )(1)罗马，意大利

*共识算法* 是一种机制，使人类或机器能够在分布式环境中合作。即使一些代理失败了，系统也必须能够就所有代理的共同事实来源达成一致。换句话说，系统必须对故障具有容忍性。

在集中式设计中，系统由一个单一实体控制。在大多数情况下，该系统可以进行调整，因为没有复杂的治理机制来在多个管理员之间达成共识。

在分散式设置下情况就不一样了。比如你在使用一个分布式数据库，你怎么决定添加哪些条目呢？

打开了区块链道路的最关键发展是克服了在陌生人不信任彼此的环境中的这一困难。本章将探讨共识算法对加密货币和分布式账本运作的关键性。

## 7.1 共识算法和加密货币

区块链是一个存储加密货币用户余额的数据库。每个人（或者更准确地说，每个节点）都必须拥有数据库的副本是至关重要的。否则，很快你会发现自己得到了矛盾的信息，从而破坏了加密货币网络的目的。

用户们无法花费对方的货币，这要归功于公钥密码学。然而，网络参与者仍然必须依赖于一个单一的事实来源，以确定资金是否已经被花费。

为了协调参与，比特币创始人中本聪建议采用工作证明方法。我们稍后将深入探讨 PoW 的工作原理；现在，我们将查看各种共识算法的一些常见特征。

要开始，你需要愿意贡献区块（称为*验证者*）的人提供一个赌注。这个赌注是验证者必须提供的一笔货币金额，这会阻止他们不诚实行事。如果他们作弊，他们将失去他们的赌注。计算能力、加密货币，甚至声誉都是例子。

他们为什么要冒着危害自己的资产的风险呢？这里有一个货币激励。这通常由其他用户支付的费用、新铸造的加密货币单位或两者组成，并且通常由协议的本机加密货币组成。

透明度是你最后需要的东西。你必须能够识别出别人在说谎时。对于他们来说，创建区块应该是昂贵的，但对于任何人来验证它们应该是廉价的。这保证了普通用户保持对验证者的监督。

一个团队的个体成员使用共识算法制定并支持整个团队的最佳选择。这是一个决策系统，其中个人必须支持整体选择，无论他们是否同意。

简单地说，这是一种让一群人做出决策的方法。举个例子，考虑一个由 10 个人组成的团队，他们想选择一个对所有人都有利的项目。他们每个人都可以提出建议，但大多数人会选择对自己最有利的建议。其他人会受到这个决定的影响，无论他们是否同意。

想象一下有数万名参与者的情况。这不会使事情变得更加困难吗？

共识算法不仅同意普选的结果，而且同意对每个人都有利的解决方案。因此，网络总是胜利的。

区块链上的共识模型是在在线世界建立公平和公正的方式。 共识定理是指用于达成此协议的共识机制。

## 7.2 共识模型的目标

这些区块链共识模型有许多具体的目标，包括：

+   **达成协议：** 尽可能收集小组的所有协议的机制。

+   **合作：** 每一方都致力于达成对整个团体有利的更有利的协议。

+   **合作：** 每个人都作为一个团队，将个人目标放在一边。

+   **平等权利：** 每个选民在投票过程中具有相同的价值，每个人的投票都很重要。

+   **参与：** 投票必须由网络中的每个人完成。 没有人会被排除在外，也没有人可以弃权投票。

## 7.3 不同类型的共识算法

拜占庭的另一个非常困难的方面是达成协议。 如果出现一个缺陷，节点将无法达成妥协或难以达成更大的困难值。

使用共识算法，您不必处理这个问题。 它们的主要目的是通过任何必要的手段实现既定目标。 拜占庭共识结构比区块链共识模型不可信得多。

因此，在一个潜在输出相互矛盾的分布式系统中，采用共识技术是为了获得更大或更高的结果。

共识算法是一种计算机工程方法，允许分散的进程或系统就*单个数据值*达成一致意见。 在具有许多故障节点的网络中，使用共识方法来确保可靠性。 在分布式计算和多代理系统中，解决这个问题，即*共识问题*，是至关重要的。

共识算法必须假设某些进程和系统将不可用，并且将丢失某些通信，以处理这种现实。因此，共识方法必须具有容错性。

一致性方法用于具有大量故障节点的网络，以确保可靠性。它们必须确保系统的代理能够就一个真实性来源达成一致。

## 7.4 区块链共识算法类型

区块链共识算法有各种特征（参见图 7-1）。接下来的章节将涵盖许多这样的算法。

### 7.4.1 工作量证明（PoW）

中本聪发明了 PoW，它是区块链世界中最早的共识机制。它也被称为挖矿，参与其中的节点被称为*矿工*。

矿工必须利用大量的计算能力来解决这种技术中的复杂数学谜题。他们采用了各种挖矿技术，包括图形处理单元（GPU）挖矿、专用集成电路（ASIC）挖矿和可编程门阵列（FPGA）挖矿。首先解决问题的人会得到一个区块作为奖励。![../images/520777_1_En_7_Chapter/520777_1_En_7_Fig1_HTML.jpg](img/520777_1_En_7_Fig1_HTML.jpg)

图 7-1

共识算法类型

几种加密货币，包括比特币、莱特币、ZCash、Primecoin、门罗币和 Vertcoin，都利用了工作量证明机制。

PoW 不仅对金融行业产生了影响，还对医疗保健、治理、管理等领域产生了影响。事实上，它提供了多渠道支付和在一个地址上进行多签名交易的选项，以提高安全性。

### 7.4.2 权益证明（PoS）

工作量证明（PoW）共识机制的最简单、最环保的替代方案是权益证明（PoS）。

此区块链系统中的区块创建者不是充当矿工，而是充当验证者。他们可以在所有人之上构建一个块，这将节省能源和时间。为了验证区块，他们必须投入一定金额的资金或权益。

此外，与 PoW 不同，矿工可以选择将其交易费用留在此算法中，因为在此共识模型中没有奖励机制。

结果，像以太坊这样的公司被推动升级他们的范例，从 PoW 到 PoS，在他们的以太坊 2.0 发布中。它还有助于正确运行一些区块链生态系统，如 Dash、Peercoin、Decred、ReddCoin 和 Piv X。

虽然 PoS 解决了之前困扰 PoW 的一些缺陷，但市场仍面临着许多挑战。为了解决这些问题并提供更好的区块链生态系统，创建了几种类型的 PoS。权益证明（PoS）的两个主要变体是 PoSD 和 LPoS，将在接下来讨论。

#### 7.4.2.1 委托型权益证明（PoSD）

在 PoSD 中，参与者质押他们的货币并投票给一定数量的代表，他们投资的数量决定了他们获得的权重。例如，如果用户 A 在一个代表那里投资了 10 枚硬币，而用户 B 花费了 5 枚，则 A 的投票比 B 的更重要。

代表还将以互换费用或一定数量的比特币支付。

由于其权益加权投票方法，PoSD 通常被认为是数字民主和最快的区块链共识算法之一。区块链共识机制的一些实际用途包括 Steem、EOS 和 Bit Shares。

#### 7.4.2.2 租赁型权益证明（LPoS）

LPoS 是 Waves 平台上 PoS 共识机制的更新变种。

与传统的权益证明方法不同，该共识过程允许用户将他们的剩余余额出租给完整节点，而不是租用他们的加密货币余额。

那些租赁量最大的人有创建区块的最佳机会。此外，出租方还将获得从整个节点收集的交易费用中获得的一部分报酬。

这种权益证明变体提供了一种快速且安全的方式来构建公共加密货币。

### 7.4.3 拜占庭容错（BFT）

拜占庭错误 是系统参与者必须就避免灾难性失败达成适当方法的情况，然而其中一些人并不确定。PBFT 和 DBFT 是区块链行业中最常见的两种 BFT 共识模型。

### 7.4.4 实用 BFT

Practical-BFT 是一种简单的方法，通过允许用户同意已发送给他们的消息来解决拜占庭共识的困难，通过完成验证有效决策的计算。

然后，该方告知其他节点其决定，随后其他节点必须做出决定。最终选择将基于从其他节点收集的信息。

### 7.4.5 委托拜占庭容错（dBFT）

dBFT 技术是由 NEO 提出的，NEO 币持有者也有选举代表的能力。

这一点与他们投资的金额无关。符合最低要求的任何人都可以作为代表，这些要求包括经过验证的身份、足够的设备和 1,000 GAS。之后，从代表中随机选择一个发言人。

### 7.4.6 有向无环图（DAG）

DAG 是一种简单但重要的区块链共识机制，每个处理区块链的移动应用开发企业都应该熟悉。

在这种类型的区块链共识架构中，每个节点都准备成为“矿工”。如果从方程式中移除矿工，并且交易由用户验证，则与之相关的成本将降低至$0。在任何两个节点之间验证交易的过程变得更加容易，使其更轻、更快和更安全。

尽管这些是开发环境中最常见的共识模型，但其他几种区块链共识机制已经开始获得关注，包括以下几种。

### 7.4.7 容量证明（PoC）

所遵循的方法是绘图。使用这种区块链共识技术的两种加密货币是 Burstcoin 和 SpaceMint。

它是如何工作的？首先，你需要掌握两个概念——绘图和挖矿，才能理解共识定理的本质。

+   PoC 算法使用的随机数与比特币中使用的随机数不同。在随机数被解决之前，你将不得不对你的身份和数据进行哈希处理。

+   硬盘“挖矿”是接下来的概念。如前所述，你可以一次获得零到 4095 个数据块，然后你可以将其存储在我们的存储空间中。你将被赋予一个严格的时间框架来解决随机数。这个时间表提到了创建区块需要多长时间。

如果你能比其他矿工更快地解决随机数，你将获得一个区块作为奖励。Burst 是一个采用 PoC 算法的公司的著名例子。

### 7.4.8 燃烧证明（PoB）

PoB 共识架构是在能源消耗方面对 PoW 和 PoS 的一种替代方案。它通过让矿工烧毁/损毁虚拟加密货币代币来运作，从而允许他们按比例生成区块。如果他们烧毁的代币越多，他们就越有可能赢得一个新的区块。

然而，为了烧毁资金，他们必须将其传输到一个地址，该地址无法用于验证区块。这在分布式共识的情况下经常被利用。这种共识机制的最佳例子是 Slimcoin。

### 7.4.9 身份证明（PoI）

PoI 类似于授权身份的概念。它是对用户的私钥的一种加密确认，该私钥与每笔交易相关联。

每个被识别的用户都可以创建和管理一个数据块，该数据块可以与网络中的其他用户共享。

这个区块链的方法确保了数据的有效性和完整性。因此，它是智慧城市使用的一个很好的候选方案。

### 7.4.10 Proof-of-Activity (PoA)

PoA（Proof-of-Activity）结合了 PoW 和 PoS 共识模型的优点。

矿工们竞相尽快解决密码难题，使用特殊硬件和电能，就像在 PoW 中一样。然而，组合在一起的区块只包含了区块后继的身份信息和奖励交易。

Proof-of-Activity (PoA)是 Proof-of-Stake (PoS)和 Proof-of-Work (PoW)共识技术的结合体。它允许合法的交易和矿工之间的共识达成。在 PoS 和 PoW 中，PoA 旨在解决集中化的问题。它还希望以节约资源的方式来做到这一点。

### 7.4.11 Proof-of-Elapsed Time (PoET)

PoET（Proof-of-Elapsed Time）基于均匀分配和增加更多参与者的几率的原则。因此，每个参与节点都需要等待一定的时间才能开始下一次挖矿过程。等待时间最短的成员被要求提出一个区块。

同时，每个节点选择进入睡眠模式前等待的时间。

### 7.4.12 Proof-of-Importance (PoI)

PoI 是 NEM 开发的 PoS 协议的一种变体，考虑了验证者的角色。这不仅受到他们股份的数量和可能性的影响，还受其他因素的影响，例如声誉、总余额以及通过每个特定地址完成的交易数量。

图 7-2 显示的表格比较了不同的共识算法。![../images/520777_1_En_7_Chapter/520777_1_En_7_Fig2_HTML.jpg](img/520777_1_En_7_Fig2_HTML.jpg)

图 7-2

算法比较表

## 7.5 分布式系统和区块链技术中的共识

区块链的两种主要形式是授权的，被称为授权的区块链。在无需授权的区块链上，节点是匿名的。

添加一个修改后的交易块会造成分叉。当一个有效的交易与一个无效的交易不一致时，就会发生分叉。共识算法的主要目的是在节点之间达成共识，以便每个节点都能达成真实值的共识。在授权的区块链中，节点并非匿名，被视为已知实体。

此外，在定义共识系统时，通信范式，无论是同步还是异步，都要考虑在内。崩溃错误、瞬时错误、遗漏错误、安全错误、软件错误、拜占庭错误、时间错误和环境问题都是错误的例子。

在进程突然停止时发生崩溃故障。在同步环境中，超时措施将有助于揭示此故障，然而在非同步环境中，故障很难识别。

+   **通道故障：** 非必然性和持久性故障被称为*瞬时*故障。低电池或电力波动可能会导致硬件问题。这些软件缺陷可能是在内部代码中偶尔出现并在测试中被忽视的缺陷。

+   **可靠性故障：** 可靠性故障是由于安全攻击和冒名顶替而产生的。因此，数据可能会被破坏。

+   **软件故障：** 软件故障是由于设计和建模的缺陷引起的。这种类型的故障可能导致其他类型的故障，比如崩溃或遗漏。

+   **拜占庭故障：** 拜占庭故障是系统中每个成员表现不同的故障。这使得所有成员都难以达成协议或共识。

这些错误使系统困惑，使其更难接受它们。例如，一个服务器对一个观察者似乎是宕机的，但对另一个观察者而言是正常的。由于他们持有相互矛盾的观点，两位观察者都无法达成一致，服务器也不能被视为宕机。

+   **时间失败：** 时间失败发生在错过截止日期时。也就是说，可能得到准确的结果，但它们已经太晚以至于无法被视为有用。在实时系统中，这个类别非常重要。

+   **环境扰动** **：** 如果解决方案不对环境变化做出适应，它将失败。环境的变化可能导致正确的结果变成错误。

区块链是由中央机构管理的分散账本。恶意个体可能会因试图引发故障而获得丰厚的奖励。因此，思考拜占庭问题及其解决方案对于区块链至关重要。

拜占庭错误在系统的每个成员中表现不同。它阻止所有参与者达成一致或形成共识。这些错误使系统困惑，使其难以接受这些错误。

## 7.6 复习问题

1.  1.

    “共识是分布式系统中的一个基本概念，但它是区块链独有的。” 这个说法正确吗？

1.  2.哪个说法是正确的？

    1.  a.

        共识算法是一种允许公司或机器在分散的环境中合作的方法。

    1.  b.

        共识算法是一种阻止用户或机器在分布式环境中合作的方法。

    1.  c.

        共识算法阻止用户或机器在分布式环境中合作。

    1.  d.

        你可以使用共识程序展示等价关系，这是一种机制。

1.  3.关于工作证明概念的下列哪个说法是正确的？

    1.  a.

        PoW 系统允许知道一个秘密，通常是一个公钥的玩家进行更快的计算。

    1.  b.

        PoW 系统允许知道一个秘密，通常是一个私钥的玩家进行更快的计算。

    1.  c.

        通过这个过程，矿工们必须使用大量计算能力来解决复杂的数学挑战。

    1.  d.

        通过这个过程，矿工们必须使用算法来解决复杂的数学挑战。

1.  4.以下关于活动证明的哪个陈述是正确的？

    1.  a.

        矿工们竞争，就像在 PoW 中一样，尽快使用专用硬件和电力解决密码问题。

    1.  b.

        矿工们尽快使用特定硬件和电能解决加密挑战，就像在 PoW 中一样。

    1.  c.

        矿工们使用特殊软件和电能尽快解决加密挑战，就像在 PoW 中一样。

    1.  d.

        矿工们竞争以尽快使用特殊软件和能源解决加密挑战，就像在 PoW 中一样。

1.  5.

    “在其运行过程中，PoI 是一种考虑股东和验证者角色的 PoS 版本。”你认为这个陈述是真还是假？

## 7.7 回顾答案

1.  1.

    回答：不正确。共识是分布式系统的一个重要概念，不仅仅存在于区块链中。

1.  2.

    回答：A，共识算法是一种允许公司或机器在分散的环境中合作的方法。

1.  3.

    回答：C，矿工必须使用大量计算能力来解决这种技术中的复杂数学谜题。

1.  4.

    回答：A，矿工们竞争，就像在 PoW 中一样，尽快使用专用硬件和电力解决密码问题。

1.  5.

    此陈述为真。

## 7.8 总结

区块链可以是一个分布式账本，引起了各行各业的兴趣。区块链技术已经在各个领域被使用来创建商品和服务。要欣赏区块链的影响和适用性，重要的是要掌握其核心组成部分、功能特性和架构。

比特币，一种加密货币，是区块链最著名的应用。由于区块链网络是一个分布式账本，它需要节点之间的共识机制来确保其正常运行。

要理解区块链对各种应用的影响和适用性，了解其基本组成部分、功能特性和设计至关重要。现代世界提出了几种共识算法，每种算法都具有其独特的可靠性和可扩展性特征。为了满足所有企业的需求，单一的共识算法是不够的。评估各种共识算法的优点、缺点和应用是至关重要的。

确定和讨论了与区块链共识、隐私和可扩展性相关的参数。共识技术在这些因素方面进行了比较和对比。在高效共识算法的开发以及对当前算法的评估方面存在研究空白。本书将指导开发人员和研究人员评估和创建共识算法的过程。

由于共识算法的显而易见，区块链网络的性质非常灵活。不存在所谓的“完美”区块链共识算法。但是，我们猜想，这就是技术的魅力所在：它一直在改进。由于本章详细解释了区块链和共识算法，你现在应该准备好基于这些技术开始一个项目了。下一章将解释本书的第一个项目。
