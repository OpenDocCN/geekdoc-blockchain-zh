第九章

# 掌握 Hyperledger

在本章

![check](img/check.png) **探索四个重要的 Hyperledger 项目**

![check](img/check.png) **深入研究 PoET 算法**

![check](img/check.png) **发现 Chaincode 智能合约**

![check](img/check.png) **了解 Sumeragi**

[Hyperledger](https://www.hyperledger.org/) 是一个由软件开发人员和技术爱好者组成的社区，致力于构建区块链框架和平台的行业标准。 他们的工作很重要，因为他们是引导区块链行业走向主流和商业采用的主要力量。 Hyperledger 是企业团队的“安全”部署平台。

该组织及其独特项目每天都在成长。 截至本文撰写时，他们已经有 100 多家成员公司，并有几个项目正在孵化。 他们的前几个项目包括 Explorer，一个用于查看和查询区块的 Web 应用程序，以及 Fabric，一个即插即用的区块链应用程序构建器。 他们还有 Iroha 和 Sawtooth，这是模块化的区块链平台。

在本章中，我将探讨 Hyperledger 孵化中的三个关键项目。您将深刻理解未来商业化区块链对您的公司和行业的影响。这些知识将帮助您探索该使用哪些技术，哪些需要避免，节省您的开发时间和资源。## 了解 Hyperledger：超级未来的梦想

2015 年底，Linux Foundation 成立了 Hyperledger 项目，开发企业级和开源的分布式账本框架。 他们希望将区块链社区的注意力集中在构建强大的，面向行业具体应用的应用程序，平台和硬件系统上，以支持企业。

Linux Foundation 发现有许多不同的团队在构建区块链技术，但没有一个统一的方向。 该行业存在重复努力，排他主义导致团队重复解决同一个问题。 基金会根据自己的经验知道，如果这项技术要发挥其全部潜力，就迫切需要一种开源和协作的开发策略。

Hyperledger 项目由执行董事 Brian Behlendorf 领导，他拥有几十年的经验，可以追溯到最初的 Linux Foundation 和 Apache Foundation，以及曾担任世界经济论坛的首席技术官。 因此，Hyperledger 很受欢迎并不奇怪。许多顶级商业和行业领导人已经加入了该项目，包括安永，思科，富士通，IBM，英特尔，摩根大通和富国银行。 它还吸引了许多顶级区块链组织。

R3，支持银行业的财团，已经贡献了其金融交易架构框架。 软件公司 Digital Asset 给出了超级账本标志和部分企业级代码。 Factom Foundation 也在贡献企业级代码和开发资源。 IBM 和许多其他组织正在为该项目贡献代码和其他资源。

超级账本的技术指导委员会确保这些不同技术之间的稳健性和互操作性。 希望跨行业的开源合作将推动区块链技术的进步，并通过许多组织共享研究开发成本，创造数十亿美元的经济价值。

超级账本正在识别和解决区块链技术生态系统中缺失的重要功能和要求。 它还在促进分布式分类账的跨行业开放标准，并为开发人员提供开放空间，以共同构建更好的区块链系统。

超级账本有与 Linux Foundation 类似的项目生命周期。 提交提案，然后被接受的提案被引入孵化。 当一个项目达到稳定状态时，它就会毕业，并被移入活跃状态。 到目前为止，所有超级账本项目都处于提案或孵化阶段。 每个项目都由一个大型公司或初创公司领导。 例如，Fabric 由 IBM 领导，Sawtooth 由英特尔领导，Iroha 由初创公司 Soramitsu 领导。

超级账本（Hyperledger），像许多开源项目一样，使用 GitHub（[`www.github.com/hyperledger`](http://www.github.com/hyperledger)）和 Slack（[`https://slack.hyperledger.org`](https://slack.hyperledger.org)）与各个项目组的团队联系。 这些都是获取最新的更新并查看这些项目在开发中取得的进展的好地方。  ## Focusing on Fabric

超级账本的第一个孵化项目 Fabric 是一个受许可的区块链平台。 它的工作原理与大多数区块链相似，它保留了数字事件的分类帐。 这些事件被构造为交易，并在不同参与者之间共享。 这些交易是在没有加密货币的情况下执行的。 深入了解此主题的一个可选资源位于[`https://trustindigitallife.eu/wp-content/uploads/2016/07/marko_vukolic.pdf`](https://trustindigitallife.eu/wp-content/uploads/2016/07/marko_vukolic.pdf)。

所有交易是安全、私密和机密的。 Fabric 只能通过参与者的共识进行更新。 记录一旦输入，就永远不能被改变。

Fabric 是一个企业解决方案，对可扩展性和合规性非常感兴趣。所有参与者必须向成员服务注册身份证明，才能获得系统访问权。Fabric 发出的交易附带的证书是不可追踪到持有参与者的，因此在网络上提供匿名性。此外，为了确保只有预期参与者可以看到内容，每个交易的内容都是加密的。

Fabric 具有模块化架构。通过实现其协议规范，您可以添加或删除组件。其容器技术可以处理大多数主流智能合约开发的语言。

另一方面，比特币允许任何人匿名参与，社区一直在寻找方式来做到抗审查，以及让那些被剥夺权利的人能够参与。比特币主要是为其加密货币代币的移动和安全而设计。因此，将比特币的最佳实践与 Fabric 的最佳实践进行比较可能是不公平的。

### 在 Fabric 中构建您的系统

在使 Fabric 变得易于访问方面已经付出了很多努力，但只有技术娴熟的人才能接触到它。

超级账本已经详细说明了将其技术用于多个用例。您将能够使用直观的用户界面在不久的将来在所列出的用例上使用 Fabric。目前，您可以在核心开发人员的帮助下开发和测试列出的用例。 ### 深入链码开发

两个当事方之间的合同可以通过 Hyperledger Fabric 上的链码转换为代码。链码是对以太坊智能合约的超级账本版。它以一种让双方都能信任的方式自动化了合同内的协议。

链码像以太坊的智能合约一样是图灵完备的。目前，您可以让 Java 开发人员为您构建链码合同。Fabric 团队已经准备了一些常见用例，比如数字货币和发送文本消息作为核心框架的一部分。

Fabric 团队还在探索其他有趣的商业用例，这些用例在我撰写本文时尚未完全完成，但在您阅读时可能已经可用。

超级账本还处于开发初期，其项目比以太坊的工作滞后约两年。但是，每个项目都有实质性的团队和资源。

+   **商业合同：**超级账本提出了两种合同的方式，公共合同和私人合同。私人合同是两个或多个当事方之间的合同，包含机密信息。公共合同可以被超级账本内的任何人查看，只要他们愿意花时间搜索。例如，您可以使用公共合同来公开出售产品或者作为征询合同竞标的方式。

    这些合同的构成比传统合同更复杂，因为取消仲裁和第三方执行。此外，需要对参与合同的个人进行验证。而且，大多数合同都是独一无二的，无法标准化。合同越复杂，它就会越容易从原意中腐化。Hyperledger 正在努力创建一个合同管理系统，以帮助增强 Chaincode 的可扩展性。

+   **制造供应链：** 供应链管理是在 Fabric 上探索的一项令人兴奋的区块链方案。最终的装配器可以管理他们在创建产品时使用的所有零部件和原材料。这一特性将使您能够对需求做出响应，并能够追溯每个零件的来源到原始生产者。在产品召回的情况下，可以很容易找到罪魁祸首，或者能够在使用之前确定每个零件的真实性。

    Fabric 在准备使用此用例之前需要更多的开发，因为它将需要易于所有供应链中的所有人都能访问。Fabric 团队正在努力创建一个标准协议，允许供应链网络上的每个参与者输入和跟踪生产和使用在特定产品上的编号零件。

    完成后，该用例将允许在任何时间对每个产品的生产进行深度搜索。任何一个制成品的生产可能有十层以上。消费者随后可以确定任何由其他零部件和原材料制成的制造商品的出处。这可能对消费产生有趣的社会影响。

+   **证券和资产：** 证券和其他资产非常适合区块链，因为它们可以自动执行许多第三方执行的功能。Fabric 将允许资产的所有利益相关者直接访问该资产及其构成和历史，绕过现在持有该信息的中间人。Fabric 还将加快资产的结算时间，几乎实时。

+   **直接沟通：** 未来，Fabric 也可以用作公司发布公告和报价的地方。例如，如果一家公司想筹集资金，并需要实时通知所有股东有关报价完整细节，它可以做到。就像以太坊的分散自治组织（DAO），股东可以做出决定并执行。他们的决定将实时处理和结算。这将使股东会议和投票变得更容易和更快。

+   **资产的互操作性：**在未来，Fabric 可能也会拥有与瑞波网络相同的一些功能（见第六章）。它设想了一种使用情形，即公司可以通过匹配多方需求在低流动性市场中交换资产。与在直接交易双方之间结算市场限制不同，链网络连接买家和卖家，并在多个资产类别之间找到最佳匹配。超级账本希望未来能够进行衍生品交易。您可以在[`http://events.linuxfoundation.org/sites/events/files/slides/TradingDerivatives_LinuxCon_2016.pdf`](http://events.linuxfoundation.org/sites/events/files/slides/TradingDerivatives_LinuxCon_2016.pdf)了解更多相关信息。  ## 调查伊罗哈项目

超级账本的伊罗哈项目是建立在 Fabric 项目完成的工作基础之上的。它旨在与 Fabric、Sawtooth Lake 和超级账本下的其他项目相辅相成。超级账本将伊罗哈项目列入孵化计划，因为其他项目中没有任何用 C++编写的基础设施项目。没有 C++项目严重限制了多少人可以受益于超级账本的工作，以及可以为该项目做出贡献的开发人员数量。

此外，迄今为止，大多数区块链开发都集中在基础设施层面，几乎没有涉及用户交互或移动应用程序的开发工作。超级账本认为伊罗哈对于推广区块链技术是必不可少的。该项目通过吸引更多开发人员并提供移动用户界面开发的库来填补市场空白。

在撰写本文时，伊罗哈是一个非常新的项目，并且尚未与 Fabric 或 Sawtooth Lake 集成。超级账本计划很快扩展功能，以与其他区块链项目一起使用。它的 iOS、Android 和 JavaScript 库将提供支持函数，如数字签名交易。对于商业应用开发，它将非常有用，并且将为区块链技术可能的新安全性和商业模型增加新的层面。

### 介绍 Sumeragi：新的共识算法

区块链系统可以首先达成对真相的一致意见，然后将达成的一致意见记录在账本上，这种一致性系统被称为*共识*。

共识是复杂的。理解共识机制的细微差别以及共识机制为何以某种方式行事远远超出了本书的范围。对于商业专业人士来说，这远远超出了您需要了解的内容。对您来说真正重要的是不同共识机制的后果以及它们对特定区块链上正在进行的工作的影响。我强调伊罗哈的共识机制 Sumeragi，因为它与传统区块链非常不同。

以下是使 Sumeragi 与众不同的几个关键因素：

+   **苏美拉基没有加密货币。**

+   **启动共识的节点是由面料成员服务添加到系统中的。** 节点根据它们与账本的互动方式随着时间构建声誉。这是由已知实体运行的权限区块链。

+   **新条目以独特的方式添加到账本中。** 开始共识的第一个节点，称为*领导者*，将条目广播给另一组节点；这些节点然后进行验证。如果他们未经过验证，第一个节点将在预定时间间隔后重新广播。广播元素类似于瑞波的共识方式。

根据您对区块链的使用情况，对于 Iroha 可能是积极的，也可能是消极的。如果您担心审查，Iroha 可能不适合您。在这种情况下，您最好查看一个抗审查的区块链。如果您担心网络上的其他参与者进行套利，Iroha 可能也不适合，需要进一步调查。如果您想了解区块链中所有参与者，Iroha 可能正是您要找的。### 开发移动应用

![提示](img/tip.png) 如果你不是应用开发领域的一部分，请跳过这一部分。

Iroha 专为网络和移动应用开发人员打造，以便他们可以访问 Hyperledger 系统的优势。Iroha 团队认为，如果没有应用程序利用分布式账本，那么拥有分布式账本是没有用的。

Iroha 有以下封装的 C++组件的开发路径：

+   苏美拉基共识库

+   Ed25519 数字签名库

+   SHA-3 哈希库

+   Iroha 交易序列化库

+   P2P 广播库

+   API 服务器库

+   iOS 库

+   Android 库

+   JavaScript 库

+   区块链浏览器/数据可视化套件

区块链行业的一个主要障碍是使系统用户友好化。Iroha 为 iOS、Android 和 JavaScript 创建了开源软件库，并使常见 API 功能易于调用。尽管还处于早期开发阶段，但 Iroha 是探索商业用例的好资源。## 深入了解 Sawtooth Lake

由英特尔推出的 Sawtooth Lake 是 Hyperledger 中的另一个分布式账本项目。它专注于成为一个高度模块化的平台，用于为公司构建新的分布式账本。

![警告](img/warning.png) 截至目前，发布版本的软件仅*模拟*了共识。它并不为您的项目提供安全性，仅应用于测试新想法。

Sawtooth Lake 不使用加密货币。它通过允许企业创建私有区块链来维护平台的安全性。运行私有区块链的这些企业共享网络的计算需求负担。Sawtooth Lake 在其文档中表示，这种设置将确保对共享账本状态的普遍一致性。

Sawtooth Lake 改变了基本的区块链模型。大多数区块链都有三个元素：

+   区块链的当前状态的共享记录

+   输入新数据的方式

+   达成对该数据的一致意见的方式

Sawtooth Lake 将前两者合并成了他们称之为*交易系列*的一个信号过程。此模型最适用于所有参与各方对于拥有正确记录有共同利益的用例。

Intel 已经允许其软件具有足够的灵活性，以适应反映每个业务独特需求的自定义交易系列。它还建立了三个用于构建数字资产的模板：

+   **EndPointRegistry：** 记录区块链中物品的地点

+   **IntegerKey：** 用于供应链管理的共享账本

+   **MarketPlace：** 用于购买、出售和交易数字资产的区块链交易平台

### 探索共识算法：经过时间证明

Sawtooth Lake 的共识算法称为经过时间证明（PoET）。它被设计为在计算机的主处理器的安全区域运行，称为可信执行环境（TEE）。PoET 利用 TEE 的安全性来证明时间已经过去，通过给交易打上时间戳。

其他共识算法也有一定的时间戳元素。它们确保记录未被更改的方式是通过公开发布其区块链作为未被更改的证明。已发布的账本作为任何人都可以回滚并检查的公共见证。这有点像在报纸上发布广告证明发生了某事。

PoET 还拥有一种彩票系统，其工作方式与其他使用工作量证明的区块链有些不同。它会从验证节点池中随机选择一个节点。节点被选中的概率会随着该节点对共享账本贡献的处理资源增加而成比例地增加。可以采取措施防止节点操纵系统并破坏账本。

Intel 在[`https://intelledger.github.io/tutorial.html`](https://intelledger.github.io/tutorial.html)上提供了一些极好的文档和教程。它们会引导你完成为区块链设置虚拟开发环境的过程，甚至还有一个用于构建区块链 Tic-Tac-Toe 游戏的教程。你需要熟悉 Vagrant 和 VirtualBox 才能充分利用他们所提供的内容。

![提示](img/tip.png) 在尝试这些教程之前，您可能还想参考尼克希尔·亚伯拉罕（Wiley）的《呆瓜编程》。
