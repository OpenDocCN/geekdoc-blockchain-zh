© Chris Dannen 2017Chris DannenIntroducing Ethereum and Solidity10.1007/978-1-4842-2535-6_9

# 9. 创建私人链

与公链爱好者的论点相反，私有链作为学习工具确实具有优点，并且最终可能会被大型公司、国家或非政府组织（NGO）使用。然而，应该指出的是，区块链并不是所有数据库和网络都固有地更好。Chris Dannen^(1 )(1)美国纽约布鲁克林在过去的几章中，我们专注于部署智能合约、dapps 和代币。在本章中，我们将简要讨论区块链作为数据库，以更彻底地了解链本身是如何部署的。

## 私有链和权限链

私有链只是通过点对点以太坊协议实现的云数据库：它是一个你可以控制并且可以授予访问权限的数据仓库。这应该与许可区块链形成对比，后者就像企业软件应用程序一样，有着由中央管理员设定的权限和角色。大局观上，私有链在实践中并不比云数据库更具优势。实际上，以太坊协议的效用在于将分散的群体聚集在一起共享安全的基础设施，而不是重复努力。如今，以太坊网络已经运转良好，但尚未扩展到现有网络应用程序提供商可以迁移的程度。但这只是在发展两年之后，正如你将在第十一章中看到的，未来的里程碑相当令人难以置信，并且按计划实现。相比之下，HTTP Web 自 1989 年一直在发展中。【¹】分散式云存储、命名空间和 HTTP Web 的其他常见元素尚未在以太坊网络中复制，但很快就会实现。让我们继续，这样你就可以创建自己的定制区块链，以更好地了解它们是如何运作的。

## 设置本地私有链

私有链的用处有限，因为如第六章和第七章所述，链的安全性与正在其上进行挖矿的节点数量成正比。当你启动你的链时，它只会有一个矿工：你。然而，启动一个本地私有链是在课堂环境中创建一个测试网的好方法，使学生能够进行挖矿并执行他们自己和同学的交易和智能合约。一旦你看到它有多么容易，你就会欣赏以太虚拟机的高度通用性。内容与配置参数提供的起源字段相同：因为你已经安装了 Geth，并且知道如何使用命令行，你只需要三样东西来创建一个私有链：

+   定制的起源 JSON 文件

+   定制的网络 ID（一个数字）

+   存储网络 ID 文件的目录

你可以构建网络 ID；它不能仅是数字 1 或 2，因为测试网（2）和主网络（1）已经使用了。我们接下来将讨论自定义创世文件。创建您的区块链创世文件每个区块链都必须有一个起点，在这个你自己的伊甸园中，你可以种下成为私有链的种子。区块 0 不指向前任区块，因此与链中的任何其他区块都不同。协议确保您的链将仅接受可以追溯其根源到此创世区块的区块，方法是查看区块头中的根哈希。下面是如何创建自定义创世文件的方法。首先，打开您的文本编辑器。您将创建一个名为 765 的网络，因此您将设置 765 作为随机值。它需要是一个非零数。您可以在 [`github.com/chrisdannen/Introducing-Ethereum-and-Solidity/blob/master/genesis765.json`](https://github.com/chrisdannen/Introducing-Ethereum-and-Solidity/blob/master/genesis765.json) 或 [`eth.guide`](http://eth.guide) 的第九章标题下找到代码。在您的文本编辑器中，粘贴以下文本：{"nonce": "0x0000000000000765","timestamp": "0x0","parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000","extraData": "0x0","gasLimit": "0x4c4b40","difficulty": "0x400","mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000","coinbase": "0x0000000000000000000000000000000000000000","alloc": {}}将此文件保存到桌面，并将其命名为 genesis765.json。要使用 JavaScript 控制台打开您的新链，就像您在第六章中使用的那个一样，在终端中输入以下七个元素：

+   geth

+   控制台

+   --网络 ID

+   --创世

+   创世文件路径

+   --数据目录

+   用于存储您的新链的数据目录

你将创建一个名为∼/.ethereum/chain765 的隐藏目录来存储你的链。你完整的终端命令应该是这样的：geth console --networkid 765 --genesis ∼/Desktop/genesis765.json --datadir ∼/.ethereum/chain765 请注意，在你的新链的控制台中键入 eth 类型来查看可用的 JavaScript 方法列表。在群体测试环境中，你可以使用命令比如 net.peercount 来查看有多少其他人在你的链上挖矿，以及其他杂项。就是这样！你的新链已经启动运行了，你可以像在第六章中一样在控制台中使用它。请记住，在你的合同执行之前，你需要在控制台中使用 miner.start()命令打开你的矿工。

## 用于新链的可选标志

创建一个新链时，你可以使用其他标志来定制你的测试网络环境：

+   --nodiscover：防止具有相同创世文件和相同网络 ID 的任何人意外连接到你的链。

+   --maxpeers 0：如果你知道你想要连接到你的节点的对等体数量（比如你有一个有限数量的学生的教室），你可以使用此标志限制你的链的参与者数量。

+   --rpcapi "db,eth,net,web3"：启用 RPC 和各种通过 RPC 访问的 Web3.js API。

+   --rpcport "8080"：Geth 的默认端口为 8080，但你可以使用此标志选择不同的端口。

+   --rpccorsdomain " [`eth.guide/`](http://eth.guide/) "：使用此标志来指定允许连接到你的节点并进行 RPC 调用的服务器域名。

+   --identity "TestnetMainNode"：这为你的链提供了一个易于识别的人类可读名称，这使得在对等体列表中很容易识别。

## 生产环境中的私有区块链使用

在本章中，我们介绍了私有区块链的概念，作为学习 Solidity 和以太坊智能合约部署范例的沙盒。然而，一些人非常认真地想要将私有区块链摆脱测试网角色，并将它们用于企业或中小型业务计算环境中，以创建真正的网络服务。这与以太坊开发者在设计协议时所考虑的安全模型背道而驰。在实践中，你的私有链对于黑客来说几乎没有动机去攻击它。毕竟，你的链上挖出的代币的价值（或任何链上挖出的代币的价值）只是其他人愿意为它们支付的价值。停下来想一想！主网，我们所考虑的以太坊公共区块链网络，与任何其他链没有什么不同。测试网和主网在技术上是无法区分的，除了它们的参与率以及一个被社会认可为主要公共链。如果你感到惊讶，那么你已经忘记了以太坊的核心口号：泛化一切，并保持协议的无特征性。使主网成为主网的是它是由 Vitalik Buterin 和以太坊核心开发团队发起（并后来进行了分叉）。只有对这些个人的信任、兴趣和好奇心才能保持人们使用主链。在 Mist 或 Geth 中没有任何技术特性是不能通过协议分叉进行更改的，这将指定一个新的链作为主链。（事实上，在 2016 年夏天的 DAO 黑客事件之后，这种情况发生了，留下了一个被称为以太坊经典的“旧”链，今天仍然有一些矿工在挖掘它。）这种固有的灵活性和不稳定性使得网络具有弹性。这种灵活性在网络的早期阶段是必要的，但随着网络的增长和用户对更可预测性和可靠性的需求，它将变得越来越不吸引人。不久之后，由于网络的规模巨大，状态分叉几乎不可能进行，另一个以太坊链的可能性也越来越小。确实，以太坊在运行大型、关键业务逻辑合约之前还有很多成熟过程。然而，当你考虑到其令人难以置信的易用性时，很容易理解为什么以太坊以及类似的网络注定会取代僵化老化的超文本传输协议。

## 概要

尽管私有和许可的区块链具有所有的便利和保证，为什么还需要公共链呢？为什么大型企业不简单地在全球各地的办公室搭建大量节点，创建自己的私有以太坊网络呢？简短的回答是，对于大型组织来说，在无需付费建设和维护的分布式基础设施上构建更容易、更便宜。更好的是，他们无需为其安全性付费；随着组织添加其节点，网络本身变得更加安全。事实上，只有公共链对于高价值交易才是真正可信的，因为只有公共链由如此多的工作证明来保障安全。就所有用户而言，私有或许可的 EVM 实例可能已被修改，使其变得不公平或不可信。对于公共链，协议分叉需要所有矿工发起才能在整个网络范围内生效。在下一章中，我们将讨论个人和公司可能选择在公共链上构建的内容。脚注 1 维基百科，“超文本传输协议”，[`en.wikipedia.org/wiki/Hypertext_Transfer_Protocol`](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol) ，2016 年。
