© 作者（们），独家许可给 Springer Nature Switzerland AG 2022Y。 Maleh 等人（编）《区块链技术在物联网技术、通信和计算中的应用》[`doi.org/10.1007/978-3-030-93646-4_12`](https://doi.org/10.1007/978-3-030-93646-4_12)

# 区块链技术研究工具的开发

Dmitry Kushnir^(1  ), Maxim Kovtsur^(1), Ammar Muthanna^(1), Anastasiia Kistruga^(1), Mark Akilov^(1) 和 Anton Batalov^(1)(1)M. A. Bonch-Bruevich 圣彼得堡国立电信大学, 圣彼得堡, 俄罗斯关键词区块链分布式数据库哈希函数默克尔根 Nonce 私钥公钥共识工作证明 CPS

## 1 引言

区块链最初作为比特币系统的分布式注册表[1]出现。这样的注册表允许解决加密货币的双重支付问题。区块链的关键特性之一是分布式注册表的不可变性。这种属性允许感兴趣的各方之间交换数据，确保最初不信任的信息交互各方之间的信任。比特币的迅速成功吸引了研究人员对支撑其背后的新技术——区块链的极大关注。尽管区块链起源于加密货币的基础设施，但它已经成为分布式系统技术，这导致了从集中式系统到分散式系统的重心转移。基于区块链形成了分散化和开放的架构，因为它是在大量分布式节点上实现的，每个节点都包含一个加密链接记录的副本。这样的记录按照一些共识协议被组织成区块，这些协议在区块链节点之间达成共识。加密链接的区块链，连同分布式共识协议，确保了区块链的不可变性。区块链的开放性和不可变性允许任何人检查区块链中的记录历史，从而防止任何试图干扰存储数据并在添加到区块后更改信息的企图。因此，在分散式架构的基础上也可以建立不信任各方之间的信任。区块链的分散化、开放和不可修改的特性使其成为一个透明、公开可验证的系统。此外，由于记录被复制到许多分布式节点，区块链架构允许摆脱单点故障的问题。这些属性的结合使我们可以将区块链技术视为广泛应用的基础。这样的应用可以是物联网（IoT）和物联网系统（CPS）的解决方案，其中需要巨量异构设备之间的交互可能性。传统的集中式解决方案可能面临诸如信息交换节点彼此不信任、大量交互、单点故障存在等困难，以及其他一些问题。如果我们注意到 CPS，还应该注意到许多现有的工业网络现在才开始远离上世纪 70 年代制定的标准，基于区块链的解决方案可能会有效地解决这一领域的许多问题。

使用各种系统广泛使用或声称使用区块链来实现某些任务在现代数字世界中创造了一个新的现实。如果最早的著名区块链实现之一与创建加密货币有关[1]，那么今天的项目早已超出了这个狭窄的框架。基于长期存在的平台或其自己的实现创建的大量项目[2–4]在分类某些系统和评估潜在机会方面造成了重大困难。此外，值得注意的是，不时会出现一些只声称基于运行中的区块链或具有类似功能的任何其他机制的项目，但并没有适当的技术。这些项目试图利用这个问题，并吸引潜在客户，从而使得真正任务的资源被挪用。这类行为中最著名的一个例子是一个被伪加密货币 OneCoin 所掩盖的金字塔骗局[5]。

此外，重要的是要注意，即使成功运行的区块链存在，也不能保证基于其上实施的项目一定会成功。根据应用程序的不同，区块链可能需要不同的参数。这些参数可以是可以写入块的数据量，以及记录时的速度和延迟。对事件的高速反应速度尤其对许多物联网和 CPS 解决方案至关重要，例如，对于车联网（IoV）的解决方案。还需要牢记的是，在某些情况下，转向区块链或选择其特定实现失败可能只会增加超额成本和系统内交互的效率。然而，对传统解决方案进行小幅改进可能更有效地克服现有问题。

在这方面，研究人员面临的任务之一是创建和积极使用实现和分析构建区块链的主要机制的工具。将来，这将使我们能够建立形成方法，评估软件中特定问题的解决方案在构建 IoT/CPS 解决方案时的可用性和效果。

## 2 问题

目前，基于区块链构建各种系统的现象已经成为数字数据存储系统中的一个显着现象。在这方面，一个重要的方面是分析现有和未来解决方案，以正确实现声明的功能，并且，除此之外，存在这样的功能本身的事实。

一些研究[6，7]集中于在物联网和 CPS 领域构建基于各种区块链的应用解决方案的可能性。这些发展的一个特点是事先选择了一两个或三个特定的分布式账本，如以太坊、超级账本 Fabric 和 IOTA，用于物联网/CPS 应用。一方面，这种方法是合理的，因为在开发解决方案时必须考虑到特定组件的特性，但另一方面，这种方法可能会通过排除正在开发的解决方案中的某些区块链形成机制而限制最终解决方案的功能。

然而，在智能城市中构建选择区块链的解决方案的研究中，存在着自己的区块链架构的开发[8]。这种开发是有道理的，因为传统的区块链存在冗余性，而系统中的个别节点的高计算负载是许多智能城市元素所无法承受的。这种方法在某些应用中可能相当合适，但它可能会显著复杂化最终解决方案的开发，引入额外的错误，并延迟实施。

在这方面，有关在解决特定问题的框架内有意选择或开发具有必要特性的区块链的可能性的问题仍然是相关的。此外，理解区块链的功能本质对于所有参与者来说都很重要，从各个层次的开发人员到服务人员甚至是用户，只有这样，才能从在各种物联网/CPS 解决方案中实施分布式账本中获得最大效益。

允许我们解决其中一些问题的方法之一是演示与区块链形成主要功能相关的示范实现。研究领域中存在的项目在大多数情况下都是难以分析的现成解决方案。这既适用于加密货币和相关的区块链[1，9，10]，也适用于其他分散式系统[11]。

有许多解决方案，既教育性又示范性，也有研究性，允许分析区块形成的主要阶段、节点相互作用和共识建立[12–14]。然而，所有这些解决方案要么过于简化了区块形成的本质，要么以黑盒子的形式为用户工作，实际上，如果不更改源代码，则不允许有效地将它们用于研究目的。表 1 总结了在区块链建模研究领域指定的解决方案的主要特性。在本文中，我们分析了一个区块链形成的软件模型，旨在部分填补这些空白。表 1

区块链建模研究领域解决方案的特性

| 解决方案 | 需要配置/安装 | 能够任意添加节点 | 实现共识建立机制 | 查看区块参数 |
| --- | --- | --- | --- | --- |
| 区块链演示 2.0 | X | √ | X | ~ |
| 区块链技术的可视演示 | X | X | ~ | √ |
| 由丹尼尔·范·弗莱曼构建区块链 | √ | √ | ~ | ~ |

√ 是，X 否，~ 部分实现或需要编辑代码进行分析

开发的工具应具有以下功能：

+   不需要复杂的配置和安装

+   模拟分散式分布式系统

+   能够任意添加节点

+   进行交易

+   向所有网络参与者发送交易

+   检查从其他网络参与者接收的交易

+   支持共识建立机制

+   创建区块

+   发送区块进行验证

+   检查区块，包括显示其参数

+   如果检查成功，则将区块添加到数据库中

+   有图形表示以清晰显示工作内容

## 3 材料和方法

可以选择各种开发/编程环境来研究区块链的构建方法，但从开发效率和由于在一个研究者的计算设备上实现不同节点的分布式网络所需的速度指标的数量的角度来看，选择 C++与跨平台 Qt 框架看起来更为可取。对于这项研究，从扩展所提出的方法的使用到各种平台的角度来看，确保跨平台兼容性是重要的任务。

由于研究区块链主要阶段的实施需要实现加密功能，因此需要具有处理加密功能的功能的库。 OpenSSL 是一个通用的加密库。它支持几乎所有低级哈希、加密和电子签名算法，并且还实现了大多数流行的加密标准。 OpenSSL 是用 C 编写的，这使得它可以用于 C++项目，并保证了高性能和工作速度。

对构建的区块链进行研究的可能性假设每个节点都存储区块，包括独立创建的和从其他参与者接收的区块（在此分析中，假设每个节点都是完整的，即它存储整个区块链）。在这种情况下，研究应在单个计算设备框架内进行，并且所有节点都形成在同一台计算机上（参见图 1）。这个条件允许你通过使用内置跨平台数据库管理系统（DBMS），如 SQLite，来处理每个节点上的区块链的数据存储系统的选择。选择这种解决方案用于数据存储可以潜在地提高最终解决方案的性能，特别是由于不需要客户端-服务器体系结构，这在这种情况下是不需要的。![](img/513458_1_En_12_Fig1_HTML.png)

图 1

在开发的工具包框架内实现所有网络节点

## 分析区块链模型的方法

作为研究的一部分，需要确定将要分析的功能[15, 16]。相应的功能如图 2 所示。![](img/513458_1_En_12_Fig2_HTML.png)

图 2

建模去中心化分布式系统的主要阶段

在开发的解决方案框架内需要的功能包括以下内容：

+   形成节点：

    +   生成密钥。

    +   计算公钥。

    +   形成节点地址。

+   生成写入区块的数据：

    +   准备数据本身。

    +   检查正确性/平衡。

    +   创建数字签名。

+   将准备好的数据分发到所有节点。

+   检查来自其他节点的接收数据。

+   形成一个区块：

    +   收集初步版本区块的其他节点的数据

    +   为区块数据构建 Merkle 树

    +   将服务信息添加到区块中，包括上一个区块的哈希值

    +   选择 nonce 值以满足当前复杂性参数下哈希值的条件

+   将接收到的区块分发给其他节点

+   检查从其他节点接收的区块

+   将正确的区块添加到当前节点的区块链

节点将负责主要功能，即处理写入区块（交易）、区块和数据库的数据形成。每个节点都将有自己的数据库来展示网络正在达成共识。在检查时，数据库必须相同。

节点和程序核心将模拟去中心化分布式系统[17]；节点将使用核心相互通信。在这种情况下，内核可以被表示为网络节点之间的数据传输介质。

控制将通过图形界面进行。控制信号将被发送到程序核心，并且核心将要么将信号重定向到节点，要么执行其他必要的操作。

图形界面的形式如图 3 所示。![](img/513458_1_En_12_Fig3_HTML.png)

图 3

程序的主窗口

接口具有以下元素：

1.  1.

    “添加节点”按钮 - 这将添加一个新节点。

1.  2.

    “开始”按钮 - 当按下时，所有添加的节点开始连续计算块。

1.  3.

    “停止”按钮 - 这将停止块的计算。

1.  4.

    “接受”按钮 - 这将应用(5)中指定的哈希复杂度到该块。

1.  5.

    用于输入计算块哈希复杂度的小部件设置为 2 到 8 的数字。该数字确定了 16 位哈希项开头的零的数量。

1.  6.

    “发送令牌” - 这将打开一个窗口，用于进行交易。

1.  7.

    “制作块” - 当点击时，所有节点开始计算块哈希，但仅一次。该函数用于逐步操作。

1.  8.

    所选节点的日志字段 - 它显示跟踪该节点当前操作的信息。

1.  9.

    用于在网络节点之间切换的标签。

1.  10.

    当前选定节点的信息（见图 4）。

![](img/513458_1_En_12_Fig4_HTML.png)

图 4

用于准备输入到块中的数据（执行交易）的窗口

1.  1.

    发件人信息

1.  2.

    用于输入接收者地址的字段

1.  3.

    用于转移令牌数量的输入字段

1.  4.

    发送按钮

1.  5.

    取消按钮

为了实现该程序，总共创建了六个类，其中可以区分三个主要类，mainCore，作为应用程序核心（见图 5）；MainWindow，表示主窗口（见图 5）；和 Client，实现节点功能（见图 6）。![](img/513458_1_En_12_Fig5_HTML.png)

图 5

mainCore 类和 MainWindows 类的示意图

![](img/513458_1_En_12_Fig6_HTML.png)

图 6

Client 类的示意图

让我们考虑一些开发工具的特点。

在 Qt 中，信号和插槽技术用于对象之间的通信。当发生某个特定事件时，会发出信号。插槽是响应于某个信号调用的函数。信号和插槽机制是 Qt 的一个核心特性，可能是与其他框架提供的功能最不同的部分。

当对象的内部状态以任何方式发生变化时，会发出信号。信号是公共函数，可以从任何地方发出，但建议只从定义信号及其子类的类中发出它们。

插槽在相关信号发出时被调用。插槽是普通的 C++ 函数，可以按照通常的方式调用；它们的唯一特点是信号可以连接到它们。

mainCore 和 MainWindow 之间通过以下信号进行交互：news、generateWallet、wallet、start、changeBalance、sendTokens、stop、makeBlock、setHashLevel 和 logMessage。

当“添加节点”按钮被按下时，将发出 generateWallet(int num)信号。此信号与 addNode 插槽(int num)相关联，并传递“int num”参数 - 此参数表示要添加的节点数，并且需要用于节点和图形界面之间的交互。发出 generateWallet 信号时，将执行“addNode”插槽。让我们更详细地看一下。

“addNode”创建新节点。为新节点生成密钥，这就是使用 OpenSSL 库的地方。EC_KEY_new_by_curve_name()函数分配内存并将 EC_KEY 对象绑定到指定的曲线。在我们的情况下，选择了 secp256k1 曲线。EC_KEY_generate_key()生成新的私钥和公钥。通过从公钥中取 SHA-256 哈希来获取地址。

使用 QSqlDatabase db 对象创建新节点的数据库。数据库以节点的公钥对应的名称创建。

然后，创建一个新的节点，并使用生成的密钥进行初始化。对于每个新节点，都会创建一个单独的线程来执行它的工作。

在图 7 中显示的客户端类型对象模拟客户端操作，还使用 startBlock 插槽和 makeBlock 函数生成新的区块。![](img/513458_1_En_12_Fig7_HTML.png)

图 7

客户端类型对象

首先，发出带有日志消息的信号，表示开始计算区块，然后调用 makeBlock()函数，如图 8 所示。![](img/513458_1_En_12_Fig8_HTML.png)

图 8

makeBlock 函数

在这个函数中，形成区块头，并通过区块头结构初始化 creator，并发出 startCreateHashBlock()信号。

Creator 是 HashBlockCreator 类型的对象，如图 9 所示。HashBlockCreator 是为选择给定复杂度的哈希而创建的类。init()方法初始化一个新的区块头。在 start 插槽中选择哈希，并在触发 start Create Hash Block()信号时调用此插槽。![](img/513458_1_En_12_Fig9_HTML.png)

图 9

HashBlockCreator 源代码

在这个插槽中，区块头被哈希，区块结构被写入 QByteArray 头对象，并使用 QCryptographicHash::hash 函数进行哈希，根据 Sha-256 算法。得到的哈希转换为 16 位形式并进行检查。如果收到的哈希不满足指定的复杂度并且没有信号表示需要停止哈希选择，则重复执行动作，但是更改区块头结构的字段，如 nonce 和 timestamp。nonce 字段增加 1，timestamp 获得新的时间戳。否则，检查是否收到停止信号。如果没有，发出 createdCorrectHash 信号表示选择了所需复杂度的哈希。

启动槽在单独的线程中执行，以便在选择哈希时，节点可以处理事务并从其他节点接收信号。

## 5 分析区块链技术的应用程序开发

在第一阶段构建区块链的主要阶段的分析工具形成了进一步研究所涉及的必要节点数量（图 10）。![](img/513458_1_En_12_Fig10_HTML.png)

图 10

添加新节点。 检查相应数据库的创建

下一步是创建新的区块。 区块可以自动创建，也可以分步创建。 区块被创建、验证并添加到节点数据库中。 网络达成共识。 这可以从节点数据库中的相同数据看出。

为了能够详细研究模拟每个步骤执行的操作的可能性，所有操作都保存在日志文件中以供进一步分析。

在这个模拟中将任意记录引入区块链的方法是通过创建交易来实现的。 交易被形成、签名、添加到区块中，并写入节点数据库中。 节点的余额发生变化，并且令牌到达目标地址（图 11 和 12）。![](img/513458_1_En_12_Fig11_HTML.png)

图 11

形成新区块之前和之后节点编号 2 的余额

![](img/513458_1_En_12_Fig12_HTML.png)

图 12

数据库中的交易记录

对于每个区块链系统来说，一个重要参数是平均区块创建时间以及与预期值的可能偏差。 这些参数可能会影响达成网络共识的时间、系统参与者认可所需的时间延迟以及某些类型的攻击可能性。 在一些区块链形成技术中，影响区块创建时间的主要参数是复杂性参数。 在研究的模型中，复杂性被设置为计算的哈希值的上限，以十六进制表示的边界中的领先零位的数量，并且另一个参数将是参与的节点数量。 复杂性对于四个节点网络和复杂性为 6 时在分布式注册表中进行条目的时间的影响如图 13，以及复杂性为 7 时的情况如图 14。 点表示在系统中创建下一个区块所花费的时间。![](img/513458_1_En_12_Fig13_HTML.png)

图 13

在难度为 6 时形成区块的时间跨度

![](img/513458_1_En_12_Fig14_HTML.png)

图 14

在难度为 7 时形成区块的时间跨度

图表清楚地显示了创建下一个区块所花费的平均时间与复杂性参数之间的依赖关系，具有对应于泊松分布定律的特征异常值。

## 6 结论

用于进行区块链技术研究的分析工具结合了易用性和跟踪构建区块链的每一步以及检查当前参数并获取聚合数据的能力，这使其在考虑早期类似解决方案时具有一定优势。所提供的阶段允许我们评估传统方法的可能性以及该领域最新发展的潜在优势。本文特别介绍和研究了以下技术组件：

+   创建用于确认分布式注册中条目真实性的密钥

+   形成节点，即分散网络的参与者

+   管理网络复杂性参数，以影响在分布式注册中生成记录的平均速度

+   构建 Merkle 树，形成源区块，并选择 nonce 参数以获取系统的最终区块

+   由区块创建者检查所创建的区块是否符合当前系统规则

+   在网络的每个节点上独立查看区块链状态

+   通过分布式网络的其他参与者创建的区块的正确性检查

分析的一个重要特点是能够从分析系统的一般参数模式切换到逐步执行模式，并在每个完成的步骤中监视所有操作的所有参数。因此，本文提供的结果一方面允许在评估各种区块链构建方法的功能方面取得进展，另一方面解决了详细分析和展示区块链技术基本组件能力的问题。分析分布式注册方法和支持区块链实现的技术允许您为物联网/ CPS 或智能城市中的特定任务选择解决方案。
